!function(){"use strict";let e,t=!1;const s=["items","itemstats","skills","traits","specializations","pvp/amulets","pets","palettes"];function n(){return new Promise(((n,a)=>{const o=self.indexedDB.open("gw2api");o.onerror=e=>{t=!0,console.error(e),a(e)},o.onsuccess=s=>{e=s.target.result,t=!0,n()},o.onupgradeneeded=e=>{const t=e.target.result;for(const e of s)t.createObjectStore(e);console.log("stores created",t)}}))}self.addEventListener("install",(e=>e.waitUntil(n()))),self.addEventListener("activate",(e=>{var t;return e.waitUntil(Promise.all([null===(t=self.registration)||void 0===t?void 0:t.navigationPreload.enable(),self.clients.claim()]))})),self.addEventListener("fetch",(s=>{s.request.headers.has("X-TTJS-Worker-Cached")&&s.respondWith(async function(s,a){var o;t||await n();const r=new URL(s.url);let i,l=null===(o=r.searchParams.get("ids"))||void 0===o?void 0:o.split(",").map((e=>parseInt(e))).filter((e=>!isNaN(e)));if(l)i=r.pathname.slice(1);else{const e=r.pathname,t=e.lastIndexOf("/");i=e.slice(1,t);const s=parseInt(e.slice(t+1));l=isNaN(s)?[]:[s]}const c=null==e?void 0:e.transaction(i,"readwrite").objectStore(i);if(c){const t=Math.min.apply(null,l),s=Math.max.apply(null,l),n=new Set(l),a=[];if(await new Promise(((e,o)=>{const r=c.openCursor(IDBKeyRange.bound(t,s));r.onsuccess=t=>{const s=t.target.result;s?(n.delete(s.key)&&a.push(s.value),s.continue()):e()},r.onerror=e=>o(e)})),n.size>0){const t=await fetch(r.origin+"/"+i+"?ids="+Array.from(n).join(",")),s=await t.json(),o=e.transaction(i,"readwrite").objectStore(i);for(const e of s){const t=JSON.stringify(e);a.push(t),o.put(t,e.id)}o.transaction.commit()}return new Response("["+a.join(",")+"]",{status:200,headers:{"Content-Type":"application/json"}})}return console.log("no cache",i,caches),await fetch(s)}(s.request,s.preloadResponse))}))}();
//# sourceMappingURL=worker.min.js.map
