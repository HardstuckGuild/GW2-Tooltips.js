{"version":3,"file":"tooltips.min.js","sources":["../src/TUtilsV2.ts","../src/API.ts","../src/APICache.ts","../src/FactsProcessor.ts","../src/Collect.ts","../src/Inflators.ts","../src/TooltipsV2.ts"],"sourcesContent":["export function newElm(spec, ...inner) {\n    const [tag, ...classes] = spec.split('.');\n    const el = document.createElement(tag);\n    if (classes.length)\n        el.classList.add(...classes);\n    if (inner.length)\n        el.append(...inner);\n    return el;\n}\nexport const IMAGE_CDN = 'https://assets.gw2dat.com/';\nconst missingImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABuCAIAAACfnGvJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMCSURBVHhe7ZjpkeowEAaJywERD9GQDMGwumyPLj+2XssH+/UPyjMjjVBjUWXf3oJGTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSU51inr8d0u02PVwp/xf/MHQvt9Hm/Be7PlMgIHhyzCjn9hNlpc7ebxe9hhNPp8QifpTdfuz9Oe3thjHH6Cndkfv7DWb0/syNbnN8QJuzkZr5q5K+Xk2C6BtbCTDEAZJDTuIfKi0tUKuZgHhBx89P1Zj5rtK4YQzspL43z6RnltFBR5DMVKVhGFPTy3UYBO6vo0GuIMcxpvs1O2gbhei0tbOazRusvmCe+x6nddDtbBA4/LmEFNfN1o57TOD0F5ZIDGOh0CbL91SrqDYZ07iiQ5etGdrxNpGkz9XowQ53GG2Sa7H5rFc095n1W1nzdqOPUXzbXGMVYp1FqlqlVxMCNXEd9kG806t2n87cw2KE4g53mO/fUKrJgxkzp5Ou5Paf//E4wtNPzUelupki+32k8+cZgMDpQ6V9w6ij+UAeee8/fcLovcsojpzxyyiOnPHLKI6c8csqDOx39MH0B5JRHTnmGO00v2uKLi0B8e7E8ghf+7aP5RimyDrC1ga9HPmIXp2ajy95tvEhwUaHJlpaouUandgD7OF3MpHijbrAlf13MmsOwoulQxruzu9NfGLClvtO6QTF2d87mNISWuWT7ZGtUMwJy2nLVKK2YBcqGx3Mmp+XUomQqGUcf9YpT3afZ2BBUoWFpElqYnm7ooY5P9n8a9QRcDz83lfylFdVcJnGoUAfudAjlD+FopM7CNZy27/aTKr2KU4c93Y6jD/gG13F6HeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklOb9/gEv6oxxwmIw6QAAAABJRU5ErkJggg==';\nexport function newImg(src, className, alt) {\n    if (typeof src == 'number')\n        src = src + '.png';\n    const img = document.createElement('img');\n    img.src = src ? (src.includes(':') ? src : IMAGE_CDN + src) : missingImage;\n    if (className)\n        img.classList.add(className);\n    img.alt = alt ? alt + ' icon' : 'icon';\n    return img;\n}\nexport function fromHTML(html) {\n    const dummy = document.createElement('template');\n    dummy.innerHTML = html;\n    return dummy.content;\n}\nexport const GW2Text2HTML = (text, ...formatArgs) => text\n    ? text\n        .replaceAll(/<c=(#.*?)>(.*?)<\\/c>/g, `<span style=\"color: $1;\">$2</span>`)\n        .replaceAll(/<c=@(.*?)>(.*?)<\\/c>/g, `<span class=\"gw2-color-$1\">$2</span>`)\n        .replaceAll('[lbracket]', '[').replaceAll('[rbracket]', ']')\n        .replaceAll('[null]', '')\n        .replaceAll('\\n', '<br />')\n        .replaceAll(/%str(\\d)%/g, (_, i) => formatArgs[+i - 1] || '')\n        .replaceAll('%%', '%')\n    : '';\nexport const resolveInflections = (text, count, character) => text\n    .replaceAll('[s]', count > 1 ? 's' : '')\n    .replaceAll(/(\\S+)\\[pl:\"(.+?)\"]/g, count > 1 ? '$2' : '$1')\n    .replaceAll(/(\\S+)\\[f:\"(.+?)\"]/g, character.sex == \"Female\" ? '$2' : '$1');\nexport function n3(v) { return withUpToNDigits(v, 3); }\nexport function withUpToNDigits(x, digits) {\n    let str = x.toFixed(digits);\n    while (str.charAt(str.length - 1) === '0')\n        str = str.slice(0, -1);\n    if (str.charAt(str.length - 1) === '.')\n        str = str.slice(0, -1);\n    return str;\n}\nexport function drawFractional(value, config) {\n    if (!config.showPreciseAbilityTimings) {\n        const sign = value < 0 ? '-' : '';\n        value = Math.abs(value);\n        const index = (Math.min(Math.round((value % 1) * 4), 4));\n        let fraction = '';\n        switch (index) {\n            case 0:\n            case 4:\n                {\n                    value = Math.round(value);\n                    break;\n                }\n            case 1: {\n                value = Math.floor(value);\n                fraction = '¼';\n                break;\n            }\n            case 2: {\n                value = Math.floor(value);\n                fraction = '½';\n                break;\n            }\n            case 3: {\n                value = Math.floor(value);\n                fraction = '¾';\n                break;\n            }\n        }\n        if (value == 0 && fraction == '') {\n            return '0';\n        }\n        return `${sign}${value > 0 ? value : ''}${fraction}`;\n    }\n    else {\n        return withUpToNDigits(value, 3);\n    }\n}\nexport function mapLocale(type) {\n    switch (type) {\n        case 'ConditionDuration': return 'Condition Duration';\n        case 'ConditionDamage': return 'Condition Damage';\n        case 'HealingPower': return 'Healing Power';\n        case 'BowLong': return 'Longbow';\n        case 'BowShort': return 'Shortbow';\n        case 'Projectile20': return 'Projectile (20% Chance)';\n        case 'MagicFind': return 'Magic Find';\n        case 'CritChance': return 'Critical Chance';\n        case 'CritDamage': return 'Critical Damage';\n        case 'BoonDuration': return 'Boon Duration';\n        default: return type;\n    }\n}\nexport function findSelfOrParent(self, selector, depth = 10) {\n    let current = self;\n    while (current && depth-- > 0 && !current.matches(selector))\n        current = current.parentElement;\n    if (depth == 0)\n        return null;\n    return current;\n}\nexport function joinWordList(words, quoteWords = false) {\n    if (quoteWords)\n        words = words.map(w => `'${w}'`);\n    switch (words.length) {\n        case 0: return '';\n        case 1: return words[0];\n        default:\n            const last = words[words.length - 1];\n            return words.slice(0, -1).join(', ') + last;\n    }\n}\n//# sourceMappingURL=TUtilsV2.js.map","export class FakeAPI {\n    constructor() {\n        this.hsApi = new HSAPI('http://127.0.0.1:3000');\n        this.fallback = new HSAPI();\n    }\n    async bulkRequest(endpoint, ids) {\n        try {\n            return await this.hsApi.bulkRequest(endpoint, ids);\n        }\n        catch (ex) {\n            console.warn(`[gw2-tooltips] [FakeAPI] error trying to get ep '${endpoint}' from localhost, will try to use the fallback API.\\n${ex}`);\n            return await this.fallback.bulkRequest(endpoint, ids);\n        }\n    }\n}\nexport class HSAPI {\n    constructor(baseUrl = 'https://api-v0.hardstuck.gg') {\n        this.baseUrl = baseUrl;\n    }\n    async bulkRequest(endpoint, ids) {\n        return fetch(`${this.baseUrl}/${endpoint}?ids=${ids.join(',')}`).then(r => r.json());\n    }\n}\n//# sourceMappingURL=API.js.map","class APICache {\n    static async ensureExistence(endpoint, initialIds) {\n        if (!this.apiImpl) {\n            this.apiImpl = new HSAPI();\n        }\n        let additionalIds = Object.assign({\n            skills: new Set(),\n            items: new Set(),\n            traits: new Set(),\n            pets: new Set(),\n            'pvp/amulets': new Set(),\n            specializations: new Set(),\n            itemstats: new Set(),\n        }, { [endpoint]: new Set(initialIds) });\n        const findNextRelevantEndpoint = () => {\n            for (const [endpoint, ids] of Object.entries(additionalIds))\n                if (ids.size > 0)\n                    return endpoint;\n            return undefined;\n        };\n        let currentEndpoint = endpoint;\n        let i = 0;\n        do {\n            const storageSet = this.storage[currentEndpoint];\n            const request = Array.from(additionalIds[currentEndpoint].values());\n            additionalIds[currentEndpoint].clear();\n            console.info(`[gw2-tooltips] [API cache] round #${i++} for a ${endpoint} request, currently fetching ${currentEndpoint}. Ids: `, request);\n            try {\n                const response = await this.apiImpl.bulkRequest(currentEndpoint, request);\n                const unobtainable = request.filter(id => !response.some(obj => obj.id == id));\n                if (unobtainable.length)\n                    console.warn(`[gw2-tooltips] [API cache] Did not receive all requested ${currentEndpoint} ids. missing: `, unobtainable);\n                for (const datum of response) {\n                    if (storageSet.has(datum.id))\n                        continue;\n                    storageSet.set(datum.id, datum);\n                    this.collectConnectedIds({ endpoint: currentEndpoint, datum }, additionalIds);\n                }\n            }\n            catch (ex) {\n                console.error(ex);\n            }\n        } while ((currentEndpoint = findNextRelevantEndpoint()) && i < 100);\n    }\n    static collectConnectedIds({ endpoint, datum }, connectedIdsStorage) {\n        const addFacts = (facts) => {\n            for (const fact of facts) {\n                if (fact.type == 'Buff' || fact.type == 'BuffBrief') {\n                    if (!this.storage.skills.has(fact.buff))\n                        connectedIdsStorage.skills.add(fact.buff);\n                }\n                if (fact.type === 'PrefixedBuffBrief' || fact.type === 'PrefixedBuff') {\n                    if (!this.storage.skills.has(fact.prefix))\n                        connectedIdsStorage.skills.add(fact.prefix);\n                    if (!this.storage.skills.has(fact.buff))\n                        connectedIdsStorage.skills.add(fact.buff);\n                }\n            }\n        };\n        if ('palettes' in datum) {\n            for (const palette of datum.palettes) {\n                for (const slot of palette.slots) {\n                    if (slot.profession && slot.next_chain && !this.storage.items.has(slot.next_chain)) {\n                        connectedIdsStorage.skills.add(slot.next_chain);\n                    }\n                    if (slot.traited_alternatives)\n                        for (const [_, skillId] of slot.traited_alternatives) {\n                            if (!this.storage.skills.has(skillId))\n                                connectedIdsStorage.skills.add(skillId);\n                        }\n                }\n            }\n        }\n        if ('related_skills' in datum) {\n            for (const subSkill of datum.related_skills)\n                if (!this.storage.skills.has(subSkill))\n                    connectedIdsStorage.skills.add(subSkill);\n        }\n        if ('blocks' in datum)\n            for (const block of datum.blocks) {\n                if (block.facts)\n                    addFacts(block.facts);\n            }\n        if ('override_groups' in datum) {\n            for (const { blocks } of datum.override_groups)\n                if (blocks)\n                    for (const block of blocks)\n                        if (block.facts)\n                            addFacts(block.facts);\n        }\n        if ('attribute_set' in datum) {\n            if (!this.storage.itemstats.has(datum.attribute_set))\n                connectedIdsStorage.itemstats.add(datum.attribute_set);\n        }\n        if ('skills' in datum)\n            for (const subSkillId of datum.skills) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('skills_ai' in datum)\n            for (const subSkillId of datum.skills_ai) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('skills_soulbeast' in datum)\n            for (const subSkillId of datum.skills_soulbeast) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('specialization' in datum) {\n            if (!this.storage.specializations.has(datum.specialization))\n                connectedIdsStorage.specializations.add(datum.specialization);\n        }\n    }\n}\nAPICache.storage = {\n    skills: new Map(),\n    items: new Map(),\n    traits: new Map(),\n    pets: new Map(),\n    'pvp/amulets': new Map(),\n    specializations: new Map(),\n    itemstats: new Map(),\n};\nexport default APICache;\nwindow.APICache = APICache;\nimport { HSAPI } from './API';\n//# sourceMappingURL=APICache.js.map","export function calculateModifier({ formula, base_amount, formula_param1: level_scaling, formula_param2 }, { level, stats: { values: { Power, ConditionDamage, HealingPower } } }) {\n    switch (formula) {\n        case 'BuffLevelLinear':\n            return level * level_scaling + base_amount;\n        case 'ConditionDamage':\n            return level * level_scaling + base_amount + ConditionDamage * formula_param2;\n        case 'ConditionDamageSquared':\n            return level * level * level_scaling + base_amount + ConditionDamage * formula_param2;\n        case 'NoScaling':\n            return base_amount;\n        case 'Regeneration':\n            return level * level_scaling + base_amount + HealingPower * formula_param2;\n        case 'RegenerationSquared':\n            return level * level * level_scaling + base_amount + HealingPower * formula_param2;\n        case 'SpawnScaleLinear':\n        case 'TargetLevelLinear':\n            return level * level_scaling + base_amount;\n        case 'BuffFormulaType11':\n            return level * level_scaling + base_amount - formula_param2;\n        case 'Power':\n            return level * level_scaling + base_amount + Power * formula_param2;\n        case 'PowerSquared':\n            return level * level * level_scaling + base_amount + Power * formula_param2;\n    }\n    console.warn('[gw2-tooltips] [facts processor] Could not find formula #', formula, ', using base amount for now!');\n    return base_amount;\n}\nexport function generateFacts(blocks, weaponStrength, context) {\n    const [looseBlock, ...remainingBlocks] = blocks;\n    let totalDefianceBreak = 0;\n    const makeFactElements = (facts) => (!facts ? [] : facts\n        .sort((a, b) => a.order - b.order)\n        .map(fact => {\n        const { wrapper, defiance_break } = generateFact(fact, weaponStrength, context);\n        totalDefianceBreak += defiance_break;\n        return wrapper;\n    })\n        .filter(d => d));\n    const elements = [];\n    for (const block of remainingBlocks) {\n        const wrapper = newElm('div.fact-block');\n        if (block.trait_requirements) {\n            const trait_names = joinWordList(block.trait_requirements.map(id => { var _a; return `'<span class=\"gw2-color-traited-fact\">${((_a = APICache.storage.traits.get(id)) === null || _a === void 0 ? void 0 : _a.name) || id}</span>'`; }));\n            wrapper.append(fromHTML(`<span class=\"detail\">Block exists because of trait${block.trait_requirements.length == 1 ? '' : 's'} ${trait_names}</span>`));\n        }\n        if (block.description)\n            wrapper.append(newElm('p.description', fromHTML(GW2Text2HTML(block.description))));\n        const blockFacts = makeFactElements(block.facts);\n        wrapper.append(...blockFacts);\n        elements.push(wrapper);\n    }\n    if (looseBlock)\n        elements.push(...makeFactElements(looseBlock.facts));\n    if (totalDefianceBreak > 0) {\n        const defianceWrap = newElm('div.fact', newImg(ICONS.DEFIANCE_BREAK, 'iconmed'), newElm('div.gw2-color-defiance-fact', `Defiance Break: ${withUpToNDigits(totalDefianceBreak, 2)}`));\n        elements.push(defianceWrap);\n    }\n    return elements;\n}\nexport function generateFact(fact, weapon_strength, context) {\n    let iconSlug = fact.icon;\n    let buffStackSize = 1;\n    let buffDuration = fact.duration;\n    let defiance_break_per_s = fact.defiance_break;\n    const generateBuffDescription = (buff, fact, duration, valueMod) => {\n        let modsArray = [];\n        if (buff.modifiers && !buff.description_brief) {\n            const relevantModifiers = buff.modifiers.filter(modifier => ((!modifier.trait_req || context.character.traits.includes(modifier.trait_req))\n                && (!modifier.mode || modifier.mode === context.gameMode)));\n            let modsMap = new Map();\n            for (let i = 0; i < relevantModifiers.length; i++) {\n                const modifier = relevantModifiers[i];\n                let entry = modsMap.get(modifier.id) || modsMap.set(modifier.id, { modifier: modifier, value: 0 }).get(modifier.id);\n                let value = calculateModifier(modifier, context.character);\n                if (modifier.attribute_conversion) {\n                    value *= getAttributeValue(context.character, modifier.attribute_conversion);\n                }\n                entry.value += value;\n                if (modifier.flags.includes('SkipNextEntry')) {\n                    i++;\n                }\n            }\n            for (let { value, modifier } of modsMap.values()) {\n                if (modifier.flags.includes('Subtract')) {\n                    value -= 100;\n                }\n                if (modifier.flags.includes('MulByDuration')) {\n                    duration /= 1000;\n                    if (modifier.flags.includes('DivDurationBy3')) {\n                        duration /= 3;\n                    }\n                    if (modifier.flags.includes('DivDurationBy10')) {\n                        duration /= 10;\n                    }\n                    value *= duration || 1;\n                }\n                if (!modifier.flags.includes('NonStacking')) {\n                    value *= fact.apply_count;\n                }\n                if (modifier.formula.includes('Regeneration'))\n                    value *= valueMod;\n                let strValue = modifier.flags.includes('FormatFraction')\n                    ? drawFractional(value, config)\n                    : Math.floor(Math.fround(value)).toString();\n                if (modifier.flags.includes('FormatPercent')) {\n                    if (value > 0) {\n                        strValue = '+' + strValue;\n                    }\n                    strValue += '%';\n                }\n                strValue += ' ' + modifier.description;\n                modsArray.push(strValue);\n            }\n        }\n        return GW2Text2HTML(buff.description_brief || modsArray.join(', ') || buff.description);\n    };\n    const applyMods = (baseDuration, buff, detailStack) => {\n        let durMod = 1, valueMod = 1, cap = Number.MAX_SAFE_INTEGER;\n        const durationAttr = (buff.buff_type == 'Boon' && 'BoonDuration') || (buff.buff_type == 'Condition' && 'ConditionDuration');\n        if (durationAttr) {\n            const { baseAttribute, div, cap: cap_ } = getAttributeInformation(durationAttr, context.character);\n            cap = cap_;\n            const attribVal = getAttributeValue(context.character, baseAttribute);\n            durMod += attribVal / div;\n            if (attribVal > 0 && config.showFactComputationDetail) {\n                detailStack.push(`base duration: ${n3(baseDuration / 1000)}s`);\n                detailStack.push(`+${n3(baseDuration / 1000 * attribVal / div)}s (${n3(attribVal / div * 100)}%) from ${n3(attribVal)} ${baseAttribute}`);\n            }\n            for (const source of sumUpModifiers(context.character, durationAttr)) {\n                let mod = calculateModifier(source.modifier, context.character) * source.count;\n                const innerSuffix = source.modifier.flags.includes('FormatPercent') ? '%' : '';\n                const displayMul = innerSuffix ? 100 : 1;\n                mod /= displayMul;\n                durMod += mod;\n                const toAdd = innerSuffix ? mod * baseDuration : mod;\n                if (config.showFactComputationDetail) {\n                    let text = ` +${n3(toAdd / 1000)}s`;\n                    if (innerSuffix)\n                        text += ` (${n3(mod * displayMul)}%)`;\n                    text += ' from ';\n                    if (source.count > 1)\n                        text += `${source.count} `;\n                    text += source.source;\n                    detailStack.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n                }\n            }\n        }\n        let durModStack = sumUpModifiers(context.character, buff.id);\n        if (durModStack.length) {\n            if (durMod === 1 && config.showFactComputationDetail)\n                detailStack.push(`base duration: ${n3(baseDuration / 1000)}s`);\n            let percentMod = 0;\n            for (const { source, modifier, count } of durModStack) {\n                const mod = calculateModifier(modifier, context.character);\n                if (config.showFactComputationDetail)\n                    detailStack.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                percentMod += mod;\n            }\n            durMod += percentMod / 100;\n        }\n        const uncappedMod = durMod;\n        durMod = Math.min(uncappedMod, cap);\n        if (durMod != uncappedMod && config.showFactComputationDetail) {\n            detailStack.push(newElm('span.detail', `(Capped to ${n3(baseDuration / 1000 * cap)}s! Uncapped duration would be ${n3(baseDuration / 1000 * uncappedMod)}s)`));\n        }\n        baseDuration *= durMod;\n        if (buff.name.includes('Regeneration')) {\n            let valueModStack = context.character.stats.sources.HealEffectiveness;\n            if (valueModStack.length) {\n                if (config.showFactComputationDetail)\n                    detailStack.push('regeneration value mods:');\n                let percentMod = 0;\n                for (const { source, modifier, count } of valueModStack) {\n                    const mod = calculateModifier(modifier, context.character);\n                    if (config.showFactComputationDetail)\n                        detailStack.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                valueMod += percentMod / 100;\n            }\n        }\n        return [baseDuration, valueMod];\n    };\n    const factInflators = {\n        AdjustByAttributeAndLevelHealing: ({ fact }) => {\n            var _a;\n            let value = (fact.value + context.character.level ** fact.level_exponent * fact.level_multiplier) * fact.hit_count;\n            let attributeVal = 0;\n            if (fact.attribute) {\n                attributeVal = getAttributeValue(context.character, fact.attribute);\n                value += attributeVal * fact.attribute_multiplier * fact.hit_count;\n            }\n            const lines = [];\n            if (config.showFactComputationDetail) {\n                lines.push(`${n3(fact.value)} base value`);\n                if (fact.level_multiplier)\n                    lines.push(`+ ${n3(context.character.level ** fact.level_exponent * fact.level_multiplier)} from lvl ${context.character.level} ^ ${n3(fact.level_exponent)} lvl exp. * ${n3(fact.level_multiplier)} lvl mul.`);\n                if (fact.attribute)\n                    lines.push(`+ ${n3(attributeVal * fact.attribute_multiplier)} from ${n3(attributeVal)} ${mapLocale(fact.attribute)} * ${n3(fact.attribute_multiplier)} attrib. mod.`);\n                if (fact.hit_count != 1)\n                    lines.push(` * ${fact.hit_count} hits`);\n            }\n            if (!((_a = fact.text) === null || _a === void 0 ? void 0 : _a.includes('Barrier'))) {\n                let percentMod = 100;\n                for (const { source, modifier, count } of sumUpModifiers(context.character, 'HealEffectiveness')) {\n                    const mod = calculateModifier(modifier, context.character);\n                    if (config.showFactComputationDetail)\n                        lines.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                value *= percentMod / 100;\n            }\n            lines.unshift(`${GW2Text2HTML(fact.text) || mapLocale(fact.attribute)}: ${Math.round(value)}`);\n            return lines;\n        },\n        AttributeAdjust: ({ fact }) => {\n            const value = Math.round((fact.range[1] - fact.range[0]) / (context.character.level / 80) + fact.range[0]);\n            const sign = value > 0 ? '+' : '';\n            const text = GW2Text2HTML(fact.text) || mapLocale(fact.target);\n            return [`${text}: ${sign}${value}`];\n        },\n        Buff: ({ fact, buff }) => {\n            if (!buff)\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n            buff = buff || MISSING_BUFF;\n            iconSlug = buff.icon || iconSlug;\n            const lines = [];\n            let valueMod;\n            [buffDuration, valueMod] = applyMods(fact.duration, buff, lines);\n            let buffDescription = generateBuffDescription(buff, fact, buffDuration, valueMod);\n            if (buffDescription) {\n                buffDescription = `: ${buffDescription}`;\n            }\n            const seconds = buffDuration > 0 ? `(${drawFractional(buffDuration / 1000, config)}s)` : '';\n            lines.unshift(`${GW2Text2HTML(fact.text) || buff.name_brief || buff.name} ${seconds}${buffDescription}`);\n            buffStackSize = fact.apply_count;\n            return lines;\n        },\n        BuffBrief: ({ fact, buff }) => {\n            if (!buff)\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n            buff = buff || MISSING_BUFF;\n            iconSlug = buff.icon || iconSlug;\n            return [`${GW2Text2HTML(fact.text, buff.name)}`];\n        },\n        Distance: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${Math.round(fact.distance)}`];\n        },\n        HealthAdjustHealing: ({ fact }) => {\n            let value = fact.value * fact.hit_count;\n            if (fact.attribute) {\n                value += getAttributeValue(context.character, fact.attribute) * fact.attribute_multiplier;\n            }\n            const text = GW2Text2HTML(fact.text) || mapLocale(fact.attribute);\n            return [`${text}: ${value}`];\n        },\n        Number: ({ fact: { text, value } }) => {\n            const lines = [];\n            if (defiance_break_per_s && text && text.includes('Defiance')) {\n                const modifiers = sumUpModifiers(context.character, 'Stun');\n                if (modifiers.length) {\n                    if (config.showFactComputationDetail)\n                        lines.push(`${n3(value)} base value`);\n                    let percentMod = 100;\n                    for (const { source, modifier, count } of modifiers) {\n                        const mod = calculateModifier(modifier, context.character);\n                        if (config.showFactComputationDetail)\n                            lines.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                        percentMod += mod;\n                    }\n                    const mod = percentMod / 100;\n                    value *= mod;\n                    defiance_break_per_s *= mod;\n                }\n            }\n            lines.unshift(`${GW2Text2HTML(text)}: ${drawFractional(value, config)}`);\n            return lines;\n        },\n        Percent: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${drawFractional(fact.percent, config)}%`];\n        },\n        PercentDamage: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${drawFractional(fact.percent, config)}%`];\n        },\n        PercentLifeForceAdjust: ({ fact: { percent, text } }) => {\n            const hpPool = getAttributeValue(context.character, 'Health');\n            const lines = [];\n            const modifiers = sumUpModifiers(context.character, 'LifeForce');\n            if (modifiers.length) {\n                if (config.showFactComputationDetail)\n                    lines.push(`${n3(percent * hpPool * 0.69)} from ${n3(percent)}% * (${n3(hpPool)} HP * 0.69) base pool`);\n                let percentMod = 100;\n                for (const { source, modifier, count } of modifiers) {\n                    const mod = calculateModifier(modifier, context.character);\n                    if (config.showFactComputationDetail)\n                        lines.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                percent *= percentMod / 100;\n            }\n            let raw = Math.round(hpPool * 0.69 * percent * 0.01);\n            lines.unshift(`${GW2Text2HTML(text)}: ${drawFractional(percent, config)}% (${raw})`);\n            return lines;\n        },\n        PercentHealth: ({ fact: { percent, text } }) => {\n            const raw = Math.round(getAttributeValue(context.character, 'Health') * percent * 0.01);\n            return [`${GW2Text2HTML(text)}: ${drawFractional(percent, config)}% (${raw})`];\n        },\n        LifeForceAdjust: ({ fact: { percent, text } }) => {\n            const hpPool = getAttributeValue(context.character, 'Health');\n            const lines = [];\n            const modifiers = sumUpModifiers(context.character, 'LifeForce');\n            if (modifiers.length) {\n                if (config.showFactComputationDetail)\n                    lines.push(`${n3(percent * 0.01 * hpPool * 0.69)} from ${n3(percent)}% * (${n3(hpPool)} HP * 0.69) base pool`);\n                let percentMod = 100;\n                for (const { source, modifier, count } of modifiers) {\n                    const mod = calculateModifier(modifier, context.character);\n                    if (config.showFactComputationDetail)\n                        lines.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                percent *= percentMod / 100;\n            }\n            let raw = Math.round(hpPool * 0.69 * percent * 0.01);\n            lines.unshift(`${GW2Text2HTML(text)}: ${drawFractional(percent, config)}% (${raw})`);\n            return lines;\n        },\n        Damage: ({ fact: { dmg_multiplier, hit_count, text }, weaponStrength }) => {\n            const lines = [];\n            const power = getAttributeValue(context.character, 'Power');\n            let damage = dmg_multiplier * hit_count * weaponStrength * power / context.targetArmor;\n            if (config.showFactComputationDetail) {\n                lines.push(`${n3(damage)} from ${n3(dmg_multiplier)} internal mod. * ${n3(power)} power * ${weaponStrength} avg. weapon str. / ${context.targetArmor} target armor`);\n                if (hit_count != 1)\n                    lines.push(`* ${hit_count} hits`);\n            }\n            const precision = getAttributeValue(context.character, 'Precision');\n            const ferocity = getAttributeValue(context.character, 'Ferocity');\n            const critChance = Math.min(0.05 + (precision - 1000) / 21 * 0.01, 1);\n            const critDamage = 1.5 + ferocity / 15 * 0.01;\n            const moreDmgFromCrit = damage * critChance * (critDamage - 1);\n            damage += moreDmgFromCrit;\n            if (config.showFactComputationDetail) {\n                lines.push(`+${n3(moreDmgFromCrit)} (${n3(critChance * (critDamage - 1) * 100)}%) from ${n3(critChance * 100)}% crit chance and ${n3(critDamage * 100)}% damage on crit (${n3(precision)} precision and ${n3(ferocity)} ferocity)`);\n            }\n            const modifiers = sumUpModifiers(context.character, 'Damage');\n            if (modifiers.length) {\n                let percentMod = 100;\n                for (const { source, modifier, count } of modifiers) {\n                    const mod = calculateModifier(modifier, context.character);\n                    if (config.showFactComputationDetail)\n                        lines.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                damage *= percentMod / 100;\n            }\n            const times = hit_count > 1 ? `(${hit_count}x)` : '';\n            lines.unshift(`${GW2Text2HTML(text)}${times}: ${Math.round(damage)}`);\n            return lines;\n        },\n        Time: ({ fact: { text } }) => {\n            const lines = [];\n            if (defiance_break_per_s && text && (text.includes('Stun') || text.includes('Daze')\n                || text.includes('Defiance'))) {\n                const modifiers = sumUpModifiers(context.character, 'Stun');\n                if (modifiers.length) {\n                    if (config.showFactComputationDetail)\n                        lines.push(`${n3(buffDuration / 1000)}s base duration`);\n                    let percentMod = 100;\n                    for (const { source, modifier, count } of modifiers) {\n                        const mod = calculateModifier(modifier, context.character);\n                        if (config.showFactComputationDetail)\n                            lines.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                        percentMod += mod;\n                    }\n                    buffDuration *= percentMod / 100;\n                }\n            }\n            const time = buffDuration != 1000 ? 'seconds' : 'second';\n            lines.unshift(`${GW2Text2HTML(text)}: ${drawFractional(buffDuration / 1000, config)} ${time}`);\n            return lines;\n        },\n        ComboField: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${mapLocale(fact.field_type)}`];\n        },\n        ComboFinisher: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${mapLocale(fact.finisher_type)}`];\n        },\n        BuffConversion: ({ fact }) => {\n            return [`Gain ${mapLocale(fact.target)} Based on a Percentage of ${mapLocale(fact.source)}: ${fact.percent}%`];\n        },\n        NoData: ({ fact }) => {\n            return [GW2Text2HTML(fact.text)];\n        },\n        PrefixedBuff: ({ fact, buff }) => {\n            let prefix = APICache.storage.skills.get(fact.prefix);\n            if (!prefix)\n                console.error('[gw2-tooltips] [facts processor] prefix #', fact.prefix, ' is apparently missing in the cache');\n            prefix = prefix || MISSING_BUFF;\n            iconSlug = prefix.icon || iconSlug;\n            if (!buff)\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n            buff = buff || MISSING_BUFF;\n            let { duration, apply_count, text } = fact;\n            const details = [];\n            let valueMod;\n            [buffDuration, valueMod] = applyMods(duration, buff, details);\n            let buffDescription = generateBuffDescription(buff, fact, buffDuration, valueMod);\n            if (buffDescription) {\n                buffDescription = `: ${buffDescription}`;\n            }\n            const seconds = buffDuration > 0 ? `(${drawFractional(buffDuration / 1000, config)}s)` : '';\n            const list = [newElm('div.fact', generateBuffIcon(buff.icon, apply_count), newElm('span', fromHTML(`${GW2Text2HTML(text) || buff.name_brief || buff.name} ${seconds}${buffDescription}`)))];\n            list.push(...details);\n            return list;\n        },\n        PrefixedBuffBrief: ({ fact, buff }) => {\n            let prefix = APICache.storage.skills.get(fact.prefix);\n            if (!prefix)\n                console.error('[gw2-tooltips] [facts processor] prefix #', fact.prefix, ' is apparently missing in the cache');\n            prefix = prefix || MISSING_BUFF;\n            iconSlug = prefix.icon || iconSlug;\n            if (!buff)\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n            buff = buff || MISSING_BUFF;\n            let node = newElm('div.fact', newImg(buff.icon), newElm('span', `${GW2Text2HTML(fact.text) || buff.name_brief || buff.name}`));\n            return [node];\n        },\n        Range: ({ fact: { min, max } }) => {\n            return [`Range: ${min ? `${min} - ${max}` : max}`];\n        },\n        StunBreak: () => {\n            return [\"Breaks Stun\"];\n        },\n    };\n    const buff = APICache.storage.skills.get(fact.buff || 0);\n    const data = { fact, buff, weaponStrength: weapon_strength };\n    const [firstLine, ...remainingDetail] = factInflators[fact.type](data);\n    const wrapper = newElm('div.fact');\n    if (fact.requires_trait) {\n        wrapper.classList.add('gw2-color-traited-fact');\n    }\n    let defianceBreak = 0;\n    if (defiance_break_per_s) {\n        let effectiveBuffDuration = buffDuration || 1000;\n        let breakDetail = '';\n        if (buffDuration < 1000 && fact.text && (fact.text.includes('Stun') || fact.text.includes('Daze') || fact.text.includes('Float') || fact.text.includes('Knockdown'))) {\n            effectiveBuffDuration = 1000;\n            breakDetail = ' (hard CC -> min = 100)';\n        }\n        else if (effectiveBuffDuration != 1000) {\n            breakDetail = ` (${fact.defiance_break}/s)`;\n        }\n        defianceBreak = defiance_break_per_s * effectiveBuffDuration / 1000;\n        remainingDetail.push(newElm('span.detail.gw2-color-defiance-fact', `Defiance Break: ${withUpToNDigits(defianceBreak, 2)}${breakDetail}`));\n    }\n    if (fact.requires_trait) {\n        const trait_names = joinWordList(fact.requires_trait.map(id => { var _a; return `'<span class=\"gw2-color-traited-fact\">${((_a = APICache.storage.traits.get(id)) === null || _a === void 0 ? void 0 : _a.name) || id}</span>'`; }));\n        remainingDetail.unshift(fromHTML(`<span class=\"detail\">${fact.skip_next ? 'overridden' : 'exists'} because of trait${fact.requires_trait.length == 1 ? '' : 's'} ${trait_names}</span>`));\n    }\n    wrapper.append(generateBuffIcon(iconSlug, buffStackSize));\n    wrapper.append(newElm('div', newElm('span', typeof firstLine == 'string' && firstLine.includes('<') ? fromHTML(firstLine) : firstLine), ...remainingDetail.map(d => typeof d == 'string' ? newElm('span.detail', d) : d)));\n    return { wrapper, defiance_break: defianceBreak };\n}\nexport function generateBuffIcon(icon, stackSize = 1) {\n    const img = newImg(icon);\n    if (stackSize == 1) {\n        return img;\n    }\n    else {\n        const wrap = newElm('span.buff-ico', img);\n        wrap.setAttribute('count', String(stackSize));\n        return wrap;\n    }\n}\nexport const MISSING_BUFF = {\n    id: 0,\n    name: 'Missing Buff',\n    description: '<c=@warning>This Buff failed to load</c>',\n    categories: [], palettes: [], modifiers: [],\n};\nexport const MISSING_SKILL = {\n    id: 0,\n    name: 'Missing Skill',\n    description: '<c=@warning>This Skill failed to load</c>',\n    categories: [], palettes: [], modifiers: [],\n};\nimport { newElm, newImg, drawFractional, GW2Text2HTML, withUpToNDigits, mapLocale, joinWordList, fromHTML, n3, resolveInflections } from './TUtilsV2';\nimport APICache from './APICache';\nimport { ICONS, config, getAttributeInformation, getAttributeValue, sumUpModifiers } from './TooltipsV2';\n//# sourceMappingURL=FactsProcessor.js.map","export function allUpgradeCounts(scope, mode = 3) {\n    const elements = scope.getElementsByTagName('gw2object');\n    for (const pair of contexts.entries()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) == pair[0]);\n        if (elsInCorrectCtx.length)\n            _upgradeCounts(...pair, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificUpgradeCounts(contextIndex, targetContext, scope, mode = 3) {\n    _upgradeCounts(contextIndex, targetContext, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _upgradeCounts(contextIndex, targetContext, elements, mode) {\n    var _a, _b, _c, _d;\n    const counts = {};\n    for (const element of elements) {\n        let id;\n        if (element.getAttribute('type') !== 'item' || !(id = +String(element.getAttribute('objid'))))\n            continue;\n        const item = APICache.storage.items.get(id);\n        if (!item || !('subtype' in item) || (!['Rune', 'Infusion'].includes(item.subtype)))\n            continue;\n        let amountToAdd = 1;\n        if (item.subtype == \"Infusion\") {\n            if (!(amountToAdd = +String(element.getAttribute('count')))) {\n                if (config.legacyCompatibility) {\n                    amountToAdd = _legacy_getInfusionCount(element);\n                    if (!amountToAdd)\n                        continue;\n                }\n            }\n            if (!amountToAdd) {\n                console.warn(\"[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement \", element, \". Will not assume anything and just ignore the stack.\");\n                continue;\n            }\n        }\n        else if (targetContext.gameMode == \"Pvp\" && item.subtype == 'Rune') {\n            amountToAdd = 6;\n        }\n        counts[item.id] = (counts[item.id] || 0) + amountToAdd;\n    }\n    switch (mode) {\n        case 0:\n            targetContext.character.upgradeCounts = counts;\n            break;\n        case 3:\n            targetContext.character.upgradeCounts = Object.assign(targetContext.character.upgradeCounts, counts);\n            break;\n        case 1:\n            {\n                if (window.GW2TooltipsContext instanceof Array) {\n                    targetContext.character.upgradeCounts = Object.assign(counts, (_a = window.GW2TooltipsContext[contextIndex].character) === null || _a === void 0 ? void 0 : _a.upgradeCounts);\n                }\n                else if (window.GW2TooltipsContext) {\n                    targetContext.character.upgradeCounts = Object.assign(counts, (_b = window.GW2TooltipsContext.character) === null || _b === void 0 ? void 0 : _b.upgradeCounts);\n                }\n                else {\n                    targetContext.character.upgradeCounts = counts;\n                }\n            }\n            break;\n        case 2:\n            {\n                if (window.GW2TooltipsContext instanceof Array) {\n                    targetContext.character.upgradeCounts = Object.assign({}, (_c = window.GW2TooltipsContext[contextIndex].character) === null || _c === void 0 ? void 0 : _c.upgradeCounts, counts);\n                }\n                else if (window.GW2TooltipsContext) {\n                    targetContext.character.upgradeCounts = Object.assign({}, (_d = window.GW2TooltipsContext.character) === null || _d === void 0 ? void 0 : _d.upgradeCounts, counts);\n                }\n                else {\n                    targetContext.character.upgradeCounts = counts;\n                }\n            }\n            break;\n    }\n}\nexport function allStatSources(scope, mode = 3) {\n    const elements = scope.getElementsByTagName('gw2object');\n    for (const contextIndex of contexts.keys()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) == contextIndex);\n        if (elsInCorrectCtx.length)\n            _statSources(contextIndex, contexts, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificStatSources(contextIndex, scope, mode = 3) {\n    _statSources(contextIndex, contexts, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _statSources(contextIndex, contexts, elements, mode) {\n    var _a, _b, _c, _d, _e, _f, _g, _h;\n    const context = contexts[contextIndex];\n    const sources = structuredClone(DEFAULT_CONTEXT.character.stats.sources);\n    const weaponSetSources = [];\n    let upgrades = {};\n    for (const element of elements) {\n        let id, type = element.getAttribute('type');\n        if (!(id = +String(element.getAttribute('objid'))))\n            continue;\n        let amountToAdd = 1;\n        let tiersToProcess, item, tierNumber, sourceRuneSuffix;\n        if (type == 'item') {\n            item = APICache.storage.items.get(id);\n            if (!item || !('subtype' in item))\n                continue;\n            if (item.type === 'UpgradeComponent' || item.type === 'Consumable') {\n                let tiersToAdd = 1;\n                if (item.subtype === 'Rune' && item.flags.includes('Pvp')) {\n                    tiersToAdd = 6;\n                }\n                tierNumber = upgrades[item.id] = (upgrades[item.id] || 0) + tiersToAdd;\n                if (item.subtype === 'Rune') {\n                    sourceRuneSuffix = true;\n                    if (tierNumber > 6) {\n                        if (!context.character.upgradeCounts[item.id])\n                            console.warn(\"[gw2-tooltips] [collect] Found more than 6 runes of the same type. Here is the 7th rune element: \", element);\n                        continue;\n                    }\n                    if (item.flags.includes('Pvp'))\n                        tiersToProcess = item.tiers;\n                    else\n                        tiersToProcess = [item.tiers[tierNumber - 1]];\n                }\n                else {\n                    if (item.subtype == 'Infusion' || item.subtype == 'Enrichment') {\n                        if (!(amountToAdd = +String(element.getAttribute('count')))) {\n                            if (config.legacyCompatibility) {\n                                amountToAdd = _legacy_getInfusionCount(element);\n                                if (!amountToAdd)\n                                    continue;\n                            }\n                        }\n                        if (!amountToAdd) {\n                            console.warn(\"[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement \", element, \". Will not assume anything and just ignore the stack.\");\n                            continue;\n                        }\n                    }\n                    else if (item.subtype === 'Sigil' && tierNumber > 1) {\n                        if (tierNumber > 2)\n                            console.warn(\"[gw2-tooltips] [collect] Found more than 2 sigils of the same type. Here is the 3th sigil element: \", element);\n                        continue;\n                    }\n                    tiersToProcess = item.tiers;\n                }\n            }\n        }\n        else if (type == 'pvp/amulet') {\n            item = APICache.storage['pvp/amulets'].get(id);\n            if (!item)\n                continue;\n        }\n        let attributeSet = item && findCorrectAttributeSet(item, +String(element.getAttribute('stats')) || undefined);\n        if (attributeSet) {\n            tiersToProcess = [{\n                    modifiers: attributeSet.attributes.map(a => ({\n                        target_attribute_or_buff: a.attribute,\n                        base_amount: a.base_value + item.attribute_base * a.scaling,\n                        formula: \"NoScaling\",\n                        flags: [], id: -1, formula_param1: 0, formula_param2: 0, description: '',\n                    }))\n                }];\n        }\n        if (item && 'defense' in item) {\n            const defense = (typeof item.defense == \"number\")\n                ? item.defense\n                : LUT_DEFENSE[Math.min(100, (item.defense[0] + context.character.level))] * item.defense[1];\n            tiersToProcess[0].modifiers.push({\n                target_attribute_or_buff: 'Armor',\n                base_amount: defense,\n                formula: \"NoScaling\",\n                flags: [], id: -1, formula_param1: 0, formula_param2: 0, description: '',\n            });\n        }\n        let targetSources = sources;\n        const weaponSetId = +String(element.getAttribute('weaponSet'));\n        if (!isNaN(weaponSetId)) {\n            targetSources = weaponSetSources[weaponSetId] || (weaponSetSources[weaponSetId] = structuredClone(DEFAULT_CONTEXT.character.stats.sources));\n        }\n        if (tiersToProcess)\n            for (const [i, tier] of tiersToProcess.entries()) {\n                if (tier.modifiers)\n                    for (const mod of tier.modifiers) {\n                        if (!mod.target_attribute_or_buff || (mod.mode && mod.mode !== context.gameMode) || (mod.trait_req && !context.character.traits.includes(mod.trait_req)))\n                            continue;\n                        let source = formatItemName(item, context, attributeSet, undefined, -1);\n                        if (sourceRuneSuffix) {\n                            source = `${source} (Tier ${tiersToProcess.length === 1 ? tierNumber : i + 1} Bonus)`;\n                        }\n                        (targetSources[mod.target_attribute_or_buff] || (targetSources[mod.target_attribute_or_buff] = []))\n                            .push({ modifier: mod, source, count: amountToAdd });\n                    }\n            }\n    }\n    const character = context.character;\n    const overwriteWeaponStatSources = () => {\n        for (const [i, sources] of weaponSetSources.entries()) {\n            const target = character.statsWithWeapons[i];\n            if (target)\n                target.sources = sources;\n            else\n                character.statsWithWeapons[i] = { sources, values: Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values) };\n        }\n    };\n    switch (mode) {\n        case 0:\n            character.stats.sources = sources;\n            overwriteWeaponStatSources();\n            break;\n        case 3:\n            {\n                for (const [k, values] of Object.entries(sources)) {\n                    (character.stats.sources[k] || (character.stats.sources[k] = []))\n                        .push(...values);\n                }\n                for (const [i, sources] of weaponSetSources.entries()) {\n                    const target = character.statsWithWeapons[i];\n                    if (target) {\n                        for (const [k, values] of Object.entries(sources)) {\n                            (target.sources[k] || (target.sources[k] = []))\n                                .push(...values);\n                        }\n                    }\n                    else\n                        character.statsWithWeapons[i] = { sources, values: Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values) };\n                }\n            }\n            break;\n        case 1:\n            {\n                if (window.GW2TooltipsContext instanceof Array) {\n                    character.stats.sources = Object.assign(sources, (_b = (_a = window.GW2TooltipsContext[contextIndex].character) === null || _a === void 0 ? void 0 : _a.stats) === null || _b === void 0 ? void 0 : _b.sources);\n                    console.assert(false && \"todo weaponStats\");\n                }\n                else if (window.GW2TooltipsContext) {\n                    character.stats.sources = Object.assign(sources, (_d = (_c = window.GW2TooltipsContext.character) === null || _c === void 0 ? void 0 : _c.stats) === null || _d === void 0 ? void 0 : _d.sources);\n                    console.assert(false && \"todo weaponStats\");\n                }\n                else {\n                    character.stats.sources = sources;\n                    overwriteWeaponStatSources();\n                }\n            }\n            break;\n        case 2:\n            {\n                if (window.GW2TooltipsContext instanceof Array) {\n                    character.stats.sources = Object.assign({}, (_f = (_e = window.GW2TooltipsContext[contextIndex].character) === null || _e === void 0 ? void 0 : _e.stats) === null || _f === void 0 ? void 0 : _f.sources, sources);\n                    console.assert(false && \"todo weaponStats\");\n                }\n                else if (window.GW2TooltipsContext) {\n                    character.stats.sources = Object.assign({}, (_h = (_g = window.GW2TooltipsContext.character) === null || _g === void 0 ? void 0 : _g.stats) === null || _h === void 0 ? void 0 : _h.sources, sources);\n                    console.assert(false && \"todo weaponStats\");\n                }\n                else {\n                    character.stats.sources = sources;\n                    overwriteWeaponStatSources();\n                }\n            }\n            break;\n    }\n}\nfunction _legacy_getInfusionCount(element) {\n    var _a, _b;\n    const ownIndex = Array.prototype.indexOf.call(element.parentElement.children, element);\n    const amountEl = element.parentElement.getElementsByClassName('amount')[ownIndex];\n    if (!amountEl) {\n        console.warn(\"[gw2-tooltips] [collect] `legacyCompatibility` is active, but no amount element for infusion \", element, \" could be found. Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    const amountToAdd = +String((_b = (_a = amountEl.textContent) === null || _a === void 0 ? void 0 : _a.match(/\\d+/)) === null || _b === void 0 ? void 0 : _b[0]);\n    if (!amountToAdd) {\n        console.warn(\"[gw2-tooltips] [collect] [legacyCompatibility] Amount element \", amountEl, \" for infusion element \", element, \" did not contain any readable amount. Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    if (amountToAdd < 1 || amountToAdd > 20) {\n        console.warn(\"[gw2-tooltips] [collect] [legacyCompatibility] Amount element \", amountEl, \" for infusion element \", element, \" did got interpreted as x\", amountToAdd, \" which is outside of the range of sensible values (amount in [1...20]). Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    return amountToAdd;\n}\nexport function allTraits(scope, mode = 3) {\n    const elements = scope.querySelectorAll('gw2object[type=specialization]:not(.gw2objectembed)');\n    for (const pair of contexts.entries()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) == pair[0]);\n        if (elsInCorrectCtx.length)\n            _traits(...pair, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificTraits(contextIndex, targetContext, scope, mode = 3) {\n    _traits(contextIndex, targetContext, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _traits(contextIndex, targetContext, elements, mode) {\n    var _a, _b;\n    const traits = [];\n    for (const specialization of elements) {\n        const selectedPositions = String(specialization.getAttribute('selected_traits')).split(',').map(i => +i).filter(i => !isNaN(i) && 0 <= i && i <= 2);\n        if (selectedPositions.length != 3) {\n            console.warn(\"[gw2-tooltips] [collect] Specialization object \", specialization, \" does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\\\"0,2,1\\\"` where the numbers are 0-2 indicating top, middle or bottom selection. Will not assume anything and just ignore the element.\");\n            continue;\n        }\n        for (const [x, y] of selectedPositions.entries()) {\n            {\n                const traitEl = specialization.children[1 + x * 2].children[y];\n                let id;\n                if (!traitEl || !(id = +String(traitEl.getAttribute('objid')))) {\n                    console.warn(\"[gw2-tooltips] [collect] Trait object \", traitEl, \" is selected but does not exist or does not have an objid set. Add the attribute as `objid=\\\"1234\\\"`. Will not assume anything and just ignore the element.\");\n                    continue;\n                }\n                traits.push(id);\n            }\n            {\n                const traitEl = specialization.children[x * 2];\n                let id;\n                if (!(id = +String(traitEl.getAttribute('objid')))) {\n                    console.warn(\"[gw2-tooltips] [collect] Minor trait object \", traitEl, \" does not have an objid set. Add the attribute as `objid=\\\"1234\\\"`. Will not assume anything and just ignore the element.\");\n                    continue;\n                }\n                traits.push(id);\n            }\n        }\n    }\n    switch (mode) {\n        case 0:\n        case 2:\n            targetContext.character.traits = traits;\n            break;\n        case 3:\n        case 1:\n            {\n                if (window.GW2TooltipsContext instanceof Array) {\n                    const set = new Set((_a = window.GW2TooltipsContext[contextIndex].character) === null || _a === void 0 ? void 0 : _a.traits);\n                    traits.forEach(t => set.add(t));\n                    targetContext.character.traits = Array.from(set);\n                }\n                else if (window.GW2TooltipsContext) {\n                    const set = new Set((_b = window.GW2TooltipsContext.character) === null || _b === void 0 ? void 0 : _b.traits);\n                    traits.forEach(t => set.add(t));\n                    targetContext.character.traits = Array.from(set);\n                }\n                else {\n                    targetContext.character.traits = traits;\n                }\n            }\n            break;\n    }\n}\nexport function traitEffects(contexts) {\n    for (const context of contexts) {\n        for (const traitId of context.character.traits) {\n            const trait = APICache.storage.traits.get(traitId);\n            if (!trait) {\n                console.error(`[gw2-tooltips] [collect] Trait #${traitId} is apparently missing in the cache.`);\n                continue;\n            }\n            const addModifiers = (modifiers) => {\n                for (const mod of modifiers) {\n                    if (!mod.target_attribute_or_buff || (mod.mode && mod.mode !== context.gameMode) || (mod.trait_req && !context.character.traits.includes(mod.trait_req)))\n                        continue;\n                    (context.character.stats.sources[mod.target_attribute_or_buff] || (context.character.stats.sources[mod.target_attribute_or_buff] = []))\n                        .push({ source: `trait '<span class=\"gw2-color-traited-fact\">${trait.name}</span>'`, modifier: mod, count: 1 });\n                }\n            };\n            if (trait.modifiers)\n                addModifiers(trait.modifiers);\n            const contextBoundInfo = resolveTraitsAndOverrides(trait, context);\n            if (contextBoundInfo.blocks)\n                for (const block of contextBoundInfo.blocks)\n                    if (block.facts)\n                        for (const fact of block.facts) {\n                            if (!('buff' in fact))\n                                continue;\n                            const buff = APICache.storage.skills.get(fact.buff);\n                            if (!buff) {\n                                console.error(`[gw2-tooltips] [collect] Buff #${fact.buff} required for trait effect collection is apparently missing in the cache.`);\n                                continue;\n                            }\n                            if (buff.modifiers && !['Boon', 'Condition'].includes(buff.buff_type)) {\n                                console.info(`[gw2-tooltips] [collect] [trait-effects] ${trait.name} applies ${buff.buff_type} ${buff.name}: ${buff.modifiers.length} mods`);\n                                addModifiers(buff.modifiers);\n                            }\n                        }\n        }\n    }\n}\nimport APICache from \"./APICache\";\nimport { resolveTraitsAndOverrides, config, formatItemName, contexts, LUT_DEFENSE, findCorrectAttributeSet, DEFAULT_CONTEXT } from './TooltipsV2';\n//# sourceMappingURL=Collect.js.map","export function inflateGenericIcon(gw2Object, data) {\n    if (gw2Object.childElementCount > 0)\n        return;\n    const wikiLink = newElm('a', newImg(data.icon, undefined, data.name));\n    wikiLink.href = 'https://wiki-en.guildwars2.com/wiki/Special:Search/' + GW2Text2HTML(data.name).replaceAll(/\\[.*?\\]/g, '');\n    wikiLink.target = '_blank';\n    if (gw2Object.classList.contains('gw2objectembed') && !gw2Object.classList.contains('icononly')) {\n        const cleanName = GW2Text2HTML(data.name).replaceAll(/\\[.*?\\]/g, '');\n        wikiLink.append(cleanName);\n    }\n    gw2Object.append(wikiLink);\n}\nexport function inflateSkill(gw2Object, skill) {\n    const contextSet = +String(gw2Object.getAttribute('contextSet')) || 0;\n    const context = specializeContextFromInlineAttribs(contexts[contextSet], gw2Object);\n    if (gw2Object.classList.contains('auto-transform')) {\n        const replacementSkill = findTraitedOverride(skill, context);\n        if (replacementSkill) {\n            gw2Object.setAttribute('objid', String(replacementSkill.id));\n            skill = replacementSkill;\n        }\n    }\n    inflateGenericIcon(gw2Object, skill);\n}\nexport function inflateItem(gw2Object, item) {\n    if (gw2Object.childElementCount > 0)\n        return;\n    const stackSize = +String(gw2Object.getAttribute('count')) || 1;\n    const context = contexts[+String(gw2Object.getAttribute('contextSet')) || 0];\n    const wikiLink = newElm('a', newImg(item.icon, undefined, item.name));\n    wikiLink.href = 'https://wiki-en.guildwars2.com/wiki/Special:Search/' + GW2Text2HTML(item.name).replaceAll(/\\[.*?\\]/g, '');\n    wikiLink.target = '_blank';\n    if (gw2Object.classList.contains('gw2objectembed'))\n        wikiLink.append(formatItemName(item, context, undefined, undefined, stackSize));\n    gw2Object.append(wikiLink);\n}\nexport function inflateSpecialization(gw2Object, spec) {\n    if (gw2Object.classList.contains('gw2objectembed')) {\n        inflateGenericIcon(gw2Object, spec);\n    }\n    else {\n        gw2Object.style.backgroundImage = `url(${spec.background.includes(':') ? spec.background : IMAGE_CDN + spec.background})`;\n        gw2Object.dataset.label = spec.name;\n        const selectedPositions = String(gw2Object.getAttribute('selected_traits')).split(',').map(i => +i).filter(i => !isNaN(i) && 0 <= i && i <= 2);\n        if (selectedPositions.length != 3) {\n            console.warn(\"[gw2-tooltips] [inflator] Specialization object \", gw2Object, \" does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\\\"0,2,1\\\"` where the numbers are 0-2 indicating top, middle or bottom selection.\");\n            return;\n        }\n        for (const [x, y] of selectedPositions.entries()) {\n            const column = gw2Object.children[1 + x * 2];\n            if (!column) {\n                console.warn(\"[gw2-tooltips] [inflator] Cannot mark selected trait object in column #\", x, \" for specialization object \", gw2Object, \" because the column doesn't seem to exist. Either mark the specialization object as inline or add the missing column.\");\n                continue;\n            }\n            for (const [i, traitEl] of Array.prototype.entries.call(column.children)) {\n                traitEl.classList.toggle('trait_unselected', i !== y);\n            }\n        }\n    }\n}\nexport function inflateAttribute(gw2Object, attribute) {\n    const context = contexts[+String(gw2Object.getAttribute('contextSet')) || 0];\n    const value = getAttributeValue(context.character, attribute);\n    const _p = {\n        Power: [66722, ''],\n        Toughness: [104162, ''],\n        Vitality: [104163, ''],\n        Precision: [156609, ''],\n        Ferocity: [156602, ''],\n        ConditionDamage: [156600, ''],\n        Expertise: [156601, ''],\n        Concentration: [156599, ''],\n        HealingPower: [156606, ''],\n        AgonyResistance: [536049, ''],\n        Health: [536052, ''],\n        Armor: [536048, ''],\n        ConditionDuration: [156601, '%'],\n        BoonDuration: [156599, '%'],\n        CritChance: [536051, '%'],\n        CritDamage: [784327, '%'],\n        MagicFind: [536054, '%'],\n    }[attribute];\n    let img, suffix = '';\n    if (_p)\n        [img, suffix] = _p;\n    else {\n        console.warn(`[gw2-tooltips] [inflator] Unknown attribute '${attribute}' on object `, gw2Object);\n    }\n    const displayMul = suffix ? 100 : 1;\n    let search = mapLocale(attribute);\n    if (attribute == 'Profession') {\n        search = \"Attribute#Profession_Attributes\";\n    }\n    const wikiLink = newElm('a', newImg(img));\n    wikiLink.href = `https://wiki-en.guildwars2.com/wiki/Special:Search/${search}`;\n    wikiLink.target = '_blank';\n    if (gw2Object.classList.contains('gw2objectembed')) {\n        if (value !== undefined) {\n            wikiLink.append(withUpToNDigits(value * displayMul, 1) + suffix);\n        }\n        else {\n            wikiLink.append('???' + suffix);\n        }\n    }\n    gw2Object.replaceChildren(wikiLink);\n}\nexport function _legacy_transformEffectToSkillObject(gw2Object, error_store) {\n    const name = String(gw2Object.getAttribute('objId'));\n    let id = {\n        chaos_aura: 10332,\n        dark_aura: 39978,\n        fire_aura: 5677,\n        frost_aura: 5579,\n        light_aura: 25518,\n        magnetic_aura: 5684,\n        shocking_aura: 5577,\n        aegis: 743,\n        alacrity: 30328,\n        fury: 725,\n        might: 740,\n        protection: 717,\n        quickness: 1187,\n        regeneration: 718,\n        resistance: 26980,\n        resolution: 873,\n        stability: 1122,\n        swiftness: 719,\n        vigor: 726,\n        bleeding: 736,\n        blinded: 720,\n        burning: 737,\n        chill: 722,\n        chilled: 722,\n        confusion: 861,\n        crippled: 721,\n        fear: 896,\n        immobilize: 727,\n        poison: 723,\n        slow: 26766,\n        taunt: 27705,\n        torment: 19426,\n        vulnerability: 738,\n        weakness: 742,\n        daze: 833,\n        stun: 872,\n        agony: 15773,\n        invulnerability: 56227,\n        revealed: 890,\n        stealth: 58026,\n        superspeed: 5974,\n        unblockable: 18843,\n        blight: 62653,\n        bloodstone_blessed: 34917,\n        blue_pylon_power: 31413,\n        champion_of_the_legions: 20845,\n        compromised: 35096,\n        crowd_favor: 36173,\n        curse_of_frailty: 53723,\n        debilitated: 67972,\n        debilitating_void: 64967,\n        defense_up: 28482,\n        derangement: 34965,\n        elemental_empowerment: 62733,\n        empowering_auras: 62939,\n        equalization_matrix: 67047,\n        expose_weakness: 26660,\n        exposed: 28778,\n        extreme_vulnerability: 65662,\n        fixated: 47434,\n        growing_rage_ashym: 3362,\n        ignite: 16259,\n        intervention: 35061,\n        necrosis: 47414,\n        not_sticking_together: 54378,\n        nova: 39193,\n        ooze_pheromone: 21538,\n        photon_saturation: 67872,\n        positive_flow: 66665,\n        power_of_the_void: 65601,\n        reinforced_armor: 9283,\n        relentless_fire: 62805,\n        retaliation_ashym: 24646,\n        sentinel_retribution: 16350,\n        shattering_ice: 62909,\n        shell_shocked: 33361,\n        spectral_darkness: 31498,\n        sticking_together: 54604,\n        synchronized_vitality: 63840,\n        unnatural_signet: 38224,\n        use_soul_binder: 55630,\n        void_empowerment: 68083,\n        xeras_embrace: 34979,\n    }[name];\n    if (!id) {\n        const hardCoded = {\n            barrier: {\n                id: 1,\n                name: 'Barrier',\n                icon: ICONS.BARRIER,\n                description: \"Creates a health barrier that takes damage prior to the health bar. Barrier disappears 5s after being applied. Applying a barrier while one is already active will add to it, but the previously-existing barrier will still disappear 5s after it was originally applied. The amount of barrier generated is based on the source's healing power, and is capped at 50% of the recipient's maximum health.\",\n                description_brief: \"Creates a health barrier that takes damage prior to the health bar.\",\n                categories: [], palettes: [],\n            },\n            stunbreak: {\n                id: 2,\n                name: 'Stun Break',\n                description: 'Cancel control effects such as stuns.',\n                icon: ICONS.STUN_BREAK,\n                categories: [], palettes: [],\n            },\n            knockdown: {\n                id: 3,\n                name: 'Knockdown',\n                description: 'Knocks the target on ground, preventing movement and actions for a short duration.',\n                icon: ICONS.KNOCKDOWN,\n                categories: [], palettes: [],\n            },\n            pull: {\n                id: 4,\n                name: 'Pull',\n                description: 'Pulls the caster to the target or the target to a specific location and disables them for a short duration.',\n                icon: ICONS.PULL,\n                categories: [], palettes: [],\n            },\n            knockback: {\n                id: 5,\n                name: 'Knockback',\n                description: 'Knocks back the target away and on the ground, preventing movement and actions for a short duration.',\n                icon: ICONS.KNOCKBACK,\n                categories: [], palettes: [],\n            },\n            launch: {\n                id: 6,\n                name: 'Launch',\n                description: 'Throws the target in the air over a short distance, preventing movement and actions for a short duration. Can move Downed targets.',\n                icon: ICONS.LAUNCH,\n                categories: [], palettes: [],\n            },\n            float: {\n                id: 7,\n                name: 'Float',\n                description: 'Causes the target to float in the air, preventing movement and actions for a short duration. Causes underwater targets to move up.',\n                icon: ICONS.FLOAT,\n                categories: [], palettes: [],\n            },\n            sink: {\n                id: 8,\n                name: 'Sink',\n                description: 'Causes the underwater target to move downwards.',\n                icon: ICONS.SINK,\n                categories: [], palettes: [],\n            },\n        }[name];\n        if (hardCoded) {\n            id = hardCoded.id;\n            APICache.storage.skills.set(id, hardCoded);\n        }\n    }\n    if (id) {\n        gw2Object.setAttribute('type', 'skill');\n        gw2Object.setAttribute('objId', String(id));\n        return id;\n    }\n    else {\n        gw2Object.innerText = name;\n        gw2Object.title = `Failed to translate effect '${name}'.`;\n        gw2Object.style.cursor = \"help\";\n        gw2Object.classList.add('error');\n        error_store.add(name);\n        return 0;\n    }\n}\nexport function inferItemUpgrades(wrappers) {\n    const remainingInfusionsByContext = contexts.map(ctx => {\n        const counts = {};\n        for (const [id, c] of Object.entries(ctx.character.upgradeCounts)) {\n            let item;\n            if ((item = APICache.storage.items.get(+id)) && 'subtype' in item && item.subtype == 'Infusion')\n                counts[+id] = c;\n        }\n        return counts;\n    });\n    const enrichmentByContext = contexts.map(ctx => {\n        for (const [id, c] of Object.entries(ctx.character.upgradeCounts)) {\n            let item;\n            if ((item = APICache.storage.items.get(+id)) && 'subtype' in item && item.subtype == 'Enrichment')\n                return id;\n        }\n    });\n    for (const wrapper of wrappers) {\n        if (wrapper.childElementCount < 2)\n            continue;\n        const [itemEl, ...upgradeEls] = wrapper.children;\n        if (itemEl.getAttribute('type') !== 'item')\n            continue;\n        const itemCtx = +String(itemEl.getAttribute('contextSet')) || 0;\n        const upgradeIds = upgradeEls.filter(u => u.getAttribute('type') === 'item' && u.getAttribute('objid')\n            && (+String(itemEl.getAttribute('contextSet')) || 0) === itemCtx)\n            .map(u => u.getAttribute('objid'));\n        {\n            let id, item;\n            if ((id = +String(itemEl.getAttribute('objid'))) && (item = APICache.storage.items.get(id)) && 'slots' in item) {\n                for (const slot of item.slots) {\n                    if (slot == 'Infusion') {\n                        const remainingInfusions = remainingInfusionsByContext[itemCtx];\n                        for (const infusionId of Object.keys(remainingInfusions)) {\n                            upgradeIds.push(infusionId);\n                            if (--remainingInfusions[infusionId] < 1) {\n                                delete remainingInfusions[infusionId];\n                            }\n                            break;\n                        }\n                    }\n                    else if (slot == 'Enrichment') {\n                        const enrichment = enrichmentByContext[itemCtx];\n                        if (enrichment)\n                            upgradeIds.push(enrichment);\n                    }\n                }\n            }\n        }\n        const attrString = upgradeIds.join(',');\n        if (attrString)\n            itemEl.setAttribute('slotted', attrString);\n    }\n}\nimport APICache from \"./APICache\";\nimport { GW2Text2HTML, IMAGE_CDN, mapLocale, newElm, newImg, withUpToNDigits } from \"./TUtilsV2\";\nimport { ICONS, contexts, findTraitedOverride, formatItemName, getAttributeValue, specializeContextFromInlineAttribs } from \"./TooltipsV2\";\n//# sourceMappingURL=Inflators.js.map","let tooltip;\nlet lastTooltipTarget;\nlet cyclePos = 0;\nlet lastMouseX;\nlet lastMouseY;\nexport const contexts = [];\nexport let config = null;\nfunction _constructor() {\n    if (window.GW2TooltipsContext instanceof Array) {\n        for (const partialContext of window.GW2TooltipsContext)\n            contexts.push(createCompleteContext(partialContext));\n    }\n    else if (window.GW2TooltipsContext) {\n        contexts.push(createCompleteContext(window.GW2TooltipsContext));\n    }\n    else {\n        contexts.push(createCompleteContext({}));\n    }\n    config = Object.assign({}, DEFAULT_CONFIG, window.GW2TooltipsConfig);\n    if (config.apiImpl)\n        APICache.apiImpl = config.apiImpl(APIs);\n    tooltip = newElm('div.tooltipWrapper');\n    tooltip.style.display = 'none';\n    document.body.appendChild(tooltip);\n    const isMobile = /android|webos|iphone|ipad|ipod|blackberry|bb|playbook|mobile|windows phone|kindle|silk|opera mini/.test(navigator.userAgent.toLowerCase());\n    document.addEventListener('mousemove', event => {\n        if (isMobile && (Math.abs(event.pageX - lastMouseX) + Math.abs(event.pageY - lastMouseY) > 20)) {\n            tooltip.style.display = 'none';\n        }\n        lastMouseX = event.pageX;\n        lastMouseY = event.pageY;\n        if (tooltip.style.display != 'none')\n            positionTooltip();\n    });\n    document.addEventListener('contextmenu', event => {\n        const node = findSelfOrParent(event.target, 'gw2object');\n        if (!node)\n            return;\n        if (node.classList.contains('cycler') && tooltip.style.display != 'none') {\n            event.preventDefault();\n            do {\n                cyclePos = (cyclePos + 1) % tooltip.childElementCount;\n            } while (tooltip.children[cyclePos].classList.contains('not-collapsable'));\n            activateSubTooltip(cyclePos);\n            scrollSubTooltipIntoView(cyclePos, true);\n            positionTooltip(true);\n        }\n        if (isMobile && tooltip.style.display == 'none') {\n            event.preventDefault();\n            showTooltipFor(node);\n            positionTooltip();\n        }\n    });\n    let touch;\n    const scrollHandler = (event) => {\n        if (tooltip.style.display == 'none')\n            return;\n        const activeTT = tooltip.children[cyclePos];\n        if (activeTT.scrollHeight == activeTT.clientHeight)\n            return;\n        event.preventDefault();\n        const deltaY = event.deltaY || event.detail || event.touches[0].clientY - touch.clientY;\n        activeTT.scrollBy(0, deltaY);\n    };\n    const passive = 'onwheel' in window ? { passive: false } : false;\n    window.addEventListener('DOMMouseScroll', scrollHandler, false);\n    window.addEventListener('wheel', scrollHandler, passive);\n    window.addEventListener('touchstart', event => {\n        touch = event.touches[0];\n    });\n    window.addEventListener('touchmove', scrollHandler, passive);\n    window.addEventListener('keydown', e => {\n        if (e.ctrlKey && e.altKey) {\n            if (e.key == 'd') {\n                e.preventDefault();\n                config.showFactComputationDetail = !config.showFactComputationDetail;\n                console.log(`[gw2-tooltips] [cfg] showFactComputationDetail is now ${config.showFactComputationDetail}`);\n                if (lastTooltipTarget && tooltip.style.display != 'none') {\n                    showTooltipFor(lastTooltipTarget, cyclePos);\n                    positionTooltip();\n                }\n            }\n            else if (e.key == 't') {\n                e.preventDefault();\n                config.showPreciseAbilityTimings = !config.showPreciseAbilityTimings;\n                console.log(`[gw2-tooltips] [cfg] showPreciseAbilityTimings is now ${config.showPreciseAbilityTimings}`);\n                if (lastTooltipTarget && tooltip.style.display != 'none') {\n                    showTooltipFor(lastTooltipTarget, cyclePos);\n                    positionTooltip();\n                }\n            }\n        }\n    });\n}\nfunction activateSubTooltip(tooltipIndex) {\n    const tooltips = tooltip.children;\n    for (let index = 0; index < tooltips.length; index++) {\n        if (!tooltips[index].classList.contains('not-collapsable'))\n            tooltips[index].classList.toggle('active', index === tooltipIndex);\n    }\n}\nfunction scrollSubTooltipIntoView(tooltipIndex, animate = false) {\n    const tooltips = tooltip.children[tooltipIndex];\n    tooltip.style.transition = animate ? 'transform 0.25s' : '';\n    tooltip.style.transform = `translate(0, -${tooltips.offsetTop + tooltips.offsetHeight}px)`;\n}\nfunction positionTooltip(animate = false) {\n    const wpadminbar = document.getElementById('wpadminbar');\n    const topBarHeight = wpadminbar ? wpadminbar.offsetHeight : 0;\n    const marginX = 22;\n    const marginY = 13;\n    const offsetX = 6;\n    const offsetY = 6;\n    const currentSubTooltip = tooltip.children[cyclePos];\n    let tooltipXpos = lastMouseX + offsetX;\n    if (tooltipXpos + tooltip.offsetWidth > document.documentElement.clientWidth - marginX) {\n        tooltipXpos = document.documentElement.clientWidth - (tooltip.offsetWidth + marginX);\n    }\n    let tooltipYpos = lastMouseY - offsetY;\n    if (tooltipYpos - currentSubTooltip.offsetHeight < document.documentElement.scrollTop + topBarHeight + marginY) {\n        if (animate) {\n            tooltip.style.transition += ', top 0.25s';\n            setTimeout(() => tooltip.style.transition = '', 250);\n        }\n        tooltipYpos = document.documentElement.scrollTop + topBarHeight + marginY + currentSubTooltip.offsetHeight;\n    }\n    tooltip.style.left = `${tooltipXpos}px`;\n    tooltip.style.top = `${tooltipYpos}px`;\n}\nexport async function hookDocument(scope, _unused) {\n    const objectsToGet = {\n        skills: new Map(),\n        traits: new Map(),\n        items: new Map(),\n        specializations: new Map(),\n        pets: new Map(),\n        'pvp/amulets': new Map(),\n        attributes: new Map(),\n    };\n    const statsToGet = new Set();\n    const _legacy_effectErrorStore = new Set();\n    for (const gw2Object of scope.getElementsByTagName('gw2object')) {\n        const stats = +String(gw2Object.getAttribute('stats'));\n        if (!isNaN(stats))\n            statsToGet.add(stats);\n        let objId_raw = gw2Object.getAttribute('objId');\n        let type = (gw2Object.getAttribute('type') || 'skill') + 's';\n        if (type === 'attributes') {\n            if (typeof objId_raw === 'string') {\n                const elementsWithThisId = objectsToGet.attributes.get(objId_raw);\n                if (elementsWithThisId)\n                    elementsWithThisId.push(gw2Object);\n                else\n                    objectsToGet.attributes.set(objId_raw, [gw2Object]);\n            }\n        }\n        else {\n            let objId = +String(objId_raw);\n            if (type === 'effects') {\n                if (config.legacyCompatibility) {\n                    type = 'skills';\n                    objId = _legacy_transformEffectToSkillObject(gw2Object, _legacy_effectErrorStore);\n                }\n                else {\n                    continue;\n                }\n            }\n            if (!isNaN(objId) && type in objectsToGet) {\n                const elementsWithThisId = objectsToGet[type].get(objId);\n                if (elementsWithThisId)\n                    elementsWithThisId.push(gw2Object);\n                else\n                    objectsToGet[type].set(objId, [gw2Object]);\n            }\n            else {\n                continue;\n            }\n        }\n        gw2Object.addEventListener('mouseenter', (e) => showTooltipFor(e.target));\n        gw2Object.addEventListener('mouseleave', () => {\n            tooltip.style.display = 'none';\n            tooltip.style.transform = '';\n        });\n    }\n    if (_legacy_effectErrorStore.size) {\n        console.error(\"[gw2-tooltips] [legacy-compat] Some effects could not be translated into skills: \", Array.from(_legacy_effectErrorStore));\n    }\n    if (statsToGet.size > 0)\n        APICache.ensureExistence('itemstats', statsToGet.values());\n    await Promise.all(Object.entries(objectsToGet)\n        .filter(([key, _]) => key != 'attributes')\n        .map(async ([key, values]) => {\n        if (values.size == 0)\n            return;\n        let inflator;\n        switch (key) {\n            case 'skills':\n                inflator = inflateSkill;\n                break;\n            case 'items':\n                inflator = inflateItem;\n                break;\n            case 'specializations':\n                inflator = inflateSpecialization;\n                break;\n            default:\n                inflator = inflateGenericIcon;\n                break;\n        }\n        const cache = APICache.storage[key];\n        await APICache.ensureExistence(key, values.keys());\n        for (const [id, objects] of values) {\n            const data = cache.get(id);\n            if (!objects || !data)\n                continue;\n            for (const gw2Object of objects)\n                inflator(gw2Object, data);\n        }\n    }));\n    return objectsToGet;\n}\nfunction showTooltipFor(gw2Object, visibleIndex = 0) {\n    const type = ((gw2Object.getAttribute('type') || 'skill') + 's');\n    const objId = gw2Object.getAttribute('objId');\n    let context = contexts[+String(gw2Object.getAttribute('contextSet')) || 0];\n    const statSetId = +String(gw2Object.getAttribute('stats')) || undefined;\n    const stackSize = +String(gw2Object.getAttribute('count')) || undefined;\n    if (type == 'specializations' || type == 'effects')\n        return;\n    lastTooltipTarget = gw2Object;\n    if (type == 'attributes') {\n        if (objId) {\n            cyclePos = visibleIndex;\n            tooltip.replaceChildren(generateAttributeTooltip(objId, context));\n            tooltip.style.display = '';\n            for (const tt of tooltip.children)\n                tt.classList.add('active');\n            scrollSubTooltipIntoView(cyclePos);\n        }\n        return;\n    }\n    const data = APICache.storage[type].get(+String(objId));\n    if (data) {\n        cyclePos = visibleIndex;\n        context = specializeContextFromInlineAttribs(context, gw2Object);\n        tooltip.replaceChildren(...generateToolTipList(data, gw2Object, context, statSetId, stackSize));\n        tooltip.style.display = '';\n        if (Array.from(tooltip.children).filter(tt => !tt.classList.contains('not-collapsable')).length > 1) {\n            gw2Object.classList.add('cycler');\n            gw2Object.title = 'Right-click to cycle through tooltips';\n            activateSubTooltip(cyclePos);\n        }\n        else {\n            for (const tt of tooltip.children)\n                tt.classList.add('active');\n        }\n        scrollSubTooltipIntoView(cyclePos);\n    }\n}\nfunction getSlotName(skill) {\n    let skillSlot;\n    for (const palette of skill.palettes) {\n        for (const slot of palette.slots) {\n            switch (palette.type) {\n                case 'Equipment':\n                case 'Bundle':\n                    if (palette.weapon_type || palette.type == 'Bundle') {\n                        skillSlot = slot.slot.replace(/(Offhand|Main)(\\d)/, (_, hand, digit) => {\n                            if (hand == 'Offhand') {\n                                digit = digit === '1' ? '4' : '5';\n                            }\n                            return `${palette.weapon_type ? mapLocale(palette.weapon_type) : 'Bundle'} ${digit}`;\n                        });\n                    }\n                    break;\n                case 'Standard':\n                    if (slot.slot === 'Standard') {\n                        skillSlot = 'Utility';\n                    }\n                    break;\n                case 'Heal':\n                case 'Toolbelt':\n                case 'Elite':\n                    skillSlot = palette.type;\n                    break;\n                case 'Pet':\n                case 'Profession':\n                    skillSlot = slot.slot.replace(/Profession(\\d)/, \"Profession $1\");\n                    break;\n                case 'Monster':\n                    break;\n                default:\n                    console.error(`[gw2-tooltips] [tooltip engine] unknown palette type '${palette.type}' for skill '${skill.name}'`);\n            }\n        }\n    }\n    return skillSlot;\n}\nfunction generateToolTip(apiObject, notCollapsable, context, weaponSet) {\n    var _a;\n    const headerElements = [newImg(apiObject.icon), newElm('teb', GW2Text2HTML(apiObject.name).replaceAll('[s]', '')), newElm('div.flexbox-fill')];\n    const currentContextInformation = resolveTraitsAndOverrides(apiObject, context);\n    if (0) {\n        headerElements.push(newImg(ICONS.NO_UNDERWATER, 'iconsmall'));\n    }\n    if (currentContextInformation.activation) {\n        const value = drawFractional(currentContextInformation.activation / 1000, config);\n        if (value != '0') {\n            headerElements.push(newElm('ter', value, newImg(ICONS.ACTIVATION, 'iconsmall')));\n        }\n    }\n    if (currentContextInformation.resource_cost) {\n        headerElements.push(newElm('ter', String(currentContextInformation.resource_cost), newImg(context.character.profession == 'Revenant' ? ICONS.RESOURCE_REV : ICONS.RESOURCE_THIEF, 'iconsmall')));\n    }\n    if (currentContextInformation.endurance_cost) {\n        headerElements.push(newElm('ter', String(Math.round(currentContextInformation.endurance_cost)), newImg(ICONS.ENDURANCE_COST, 'iconsmall')));\n    }\n    if (currentContextInformation.upkeep_cost) {\n        headerElements.push(newElm('ter', String(currentContextInformation.upkeep_cost), newImg(ICONS.UPKEEP_COST, 'iconsmall')));\n    }\n    if (currentContextInformation.recharge) {\n        const value = drawFractional(currentContextInformation.recharge / 1000, config);\n        if (value != '0') {\n            headerElements.push(newElm('ter', value, newImg(ICONS.RECHARGE, 'iconsmall')));\n        }\n    }\n    if (currentContextInformation.supply_cost) {\n        headerElements.push(newElm('ter', String(currentContextInformation.supply_cost), newImg(ICONS.SUPPLY_COST, 'iconsmall')));\n    }\n    const secondHeaderRow = [];\n    {\n        let slotName = ('slot' in apiObject && apiObject.slot) || ('palettes' in apiObject && getSlotName(apiObject));\n        if ('specialization' in apiObject)\n            slotName = (((_a = APICache.storage.specializations.get(apiObject.specialization)) === null || _a === void 0 ? void 0 : _a.name) || apiObject.specialization) + ' - ' + slotName;\n        if (slotName)\n            secondHeaderRow.push(newElm('tes', `( ${slotName} )`));\n        if (weaponSet !== undefined)\n            secondHeaderRow.push(newElm('tes', `( Weapon Set ${weaponSet + 1} )`));\n    }\n    secondHeaderRow.push(newElm('div.flexbox-fill'));\n    if ('override_groups' in apiObject && apiObject.override_groups) {\n        const baseContext = new Set(['Pve', 'Pvp', 'Wvw']);\n        for (const override of apiObject.override_groups) {\n            for (const context of override.context) {\n                baseContext.delete(context);\n            }\n        }\n        const splits = [Array.from(baseContext), ...apiObject.override_groups.map(o => o.context)];\n        const splits_html = [];\n        for (const mode of ['Pve', 'Pvp', 'Wvw']) {\n            let split;\n            for (let i = 0; i < splits.length; i++) {\n                if (splits[i].includes(mode)) {\n                    split = splits.splice(i, 1)[0];\n                    break;\n                }\n            }\n            if (!split)\n                continue;\n            const text = split.join('/');\n            if (split.includes(context.gameMode))\n                splits_html.push(`<span style=\"color: var(--gw2-tt-color-text-accent) !important;\">${text}</span>`);\n            else\n                splits_html.push(text);\n        }\n        secondHeaderRow.push(newElm('tes', '( ', fromHTML(splits_html.join(' | ')), ' )'));\n    }\n    const parts = [newElm('tet.title', ...headerElements)];\n    if (secondHeaderRow.length > 1)\n        parts.push(newElm('tet.detail', ...secondHeaderRow));\n    if ('description' in apiObject && apiObject.description) {\n        parts.push(newElm('p.description', fromHTML(GW2Text2HTML(apiObject.description))));\n    }\n    if (currentContextInformation.blocks) {\n        let weaponStrength = 690.5;\n        if ('palettes' in apiObject && apiObject.palettes.length) {\n            const criteria = context.character.profession\n                ? ((s) => s.profession === context.character.profession)\n                : ((s) => s.profession);\n            const relevantPalette = apiObject.palettes.find(p => p.slots.some(criteria));\n            if (relevantPalette) {\n                weaponStrength = getWeaponStrength(relevantPalette);\n            }\n        }\n        parts.push(...generateFacts(currentContextInformation.blocks, weaponStrength, context));\n    }\n    const tooltip = newElm('div.tooltip', ...parts);\n    if (notCollapsable)\n        tooltip.classList.add('not-collapsable');\n    tooltip.dataset.id = String(apiObject.id);\n    return tooltip;\n}\nexport function resolveTraitsAndOverrides(apiObject, context) {\n    var _a, _b, _c, _d;\n    let override = (_a = apiObject.override_groups) === null || _a === void 0 ? void 0 : _a.find(g => g.context.includes(context.gameMode));\n    let result = Object.assign({}, apiObject, override);\n    result.blocks = structuredClone(apiObject.blocks);\n    if (result.blocks && (override === null || override === void 0 ? void 0 : override.blocks)) {\n        const end = Math.max(apiObject.blocks.length, override.blocks.length);\n        for (let blockId = 0; blockId < end; blockId++) {\n            const baseBlock = apiObject.blocks[blockId];\n            const overrideBlock = override.blocks[blockId];\n            if (!baseBlock && overrideBlock) {\n                result.blocks[blockId] = structuredClone(overrideBlock);\n            }\n            else if (overrideBlock) {\n                if (!overrideBlock.facts)\n                    continue;\n                if (!baseBlock.facts) {\n                    result.blocks[blockId].facts = overrideBlock.facts.slice();\n                    continue;\n                }\n                const facts = result.blocks[blockId].facts = baseBlock.facts.slice();\n                for (const fact of overrideBlock.facts) {\n                    if ((_b = fact.requires_trait) === null || _b === void 0 ? void 0 : _b.some(t => !context.character.traits.includes(t)))\n                        continue;\n                    if (fact.insert_before !== undefined)\n                        facts.splice(fact.insert_before, 0, fact);\n                    else\n                        facts.push(fact);\n                }\n            }\n        }\n    }\n    if (result.blocks) {\n        const finalBlocks = [];\n        for (const block of result.blocks) {\n            if ((_c = block.trait_requirements) === null || _c === void 0 ? void 0 : _c.some(t => !context.character.traits.includes(t)))\n                continue;\n            if (block.facts) {\n                const finalFacts = [];\n                for (let i = 0; i < block.facts.length; i++) {\n                    const fact = block.facts[i];\n                    if ((_d = fact.requires_trait) === null || _d === void 0 ? void 0 : _d.some(t => !context.character.traits.includes(t)))\n                        continue;\n                    finalFacts.push(fact);\n                    if (fact.skip_next)\n                        i++;\n                }\n                block.facts = finalFacts;\n            }\n            finalBlocks.push(block);\n        }\n        result.blocks = finalBlocks;\n    }\n    return result;\n}\nfunction getWeaponStrength({ weapon_type, type: palette_type }) {\n    if (!weapon_type) {\n        if (palette_type === 'Bundle') {\n            return 922.5;\n        }\n        return 690.5;\n    }\n    else {\n        return {\n            BundleLarge: 0,\n            Standard: 690.5,\n            Focus: 900,\n            Shield: 900,\n            Torch: 900,\n            Warhorn: 900,\n            Greatsword: 1100,\n            Hammer: 1100,\n            Staff: 1100,\n            BowLong: 1050,\n            Rifle: 1150,\n            BowShort: 1000,\n            Axe: 1000,\n            Sword: 1000,\n            Dagger: 1000,\n            Pistol: 1000,\n            Scepter: 1000,\n            Mace: 1000,\n            Spear: 1000,\n            Speargun: 1000,\n            Trident: 1000,\n        }[weapon_type];\n    }\n}\nfunction generateToolTipList(initialAPIObject, gw2Object, context, statSetId, stackSize) {\n    const objectChain = [];\n    const adjustTraitedSkillIds = gw2Object.classList.contains('auto-transform');\n    const addObjectsToChain = (currentObj) => {\n        let hasChain = false;\n        if ('palettes' in currentObj) {\n            if (adjustTraitedSkillIds) {\n                const replacementSkill = findTraitedOverride(currentObj, context);\n                if (replacementSkill)\n                    currentObj = replacementSkill;\n            }\n            objectChain.push({ obj: currentObj, notCollapsable: false });\n            const palette = currentObj.palettes.find(p => VALID_CHAIN_PALETTES.includes(p.type));\n            if (palette)\n                for (const slot of palette.slots) {\n                    if (slot.next_chain && slot.profession) {\n                        const nextSkillInChain = APICache.storage.skills.get(slot.next_chain);\n                        if (nextSkillInChain) {\n                            hasChain = true;\n                            addObjectsToChain(nextSkillInChain);\n                        }\n                    }\n                }\n        }\n        else {\n            objectChain.push({ obj: currentObj, notCollapsable: false });\n        }\n        if (!hasChain && 'related_skills' in currentObj) {\n            const type = gw2Object.getAttribute('type') || 'skill';\n            for (const subSkillId of currentObj.related_skills) {\n                const subSkillInChain = APICache.storage.skills.get(subSkillId);\n                if (subSkillInChain && ((type != 'skill') || subSkillInChain.palettes.some(palette => VALID_CHAIN_PALETTES.includes(palette.type)))) {\n                    objectChain.push({ obj: subSkillInChain, notCollapsable: false });\n                }\n            }\n        }\n        if ('skills' in currentObj)\n            for (const petSkillId of currentObj.skills) {\n                let petSkill = APICache.storage.skills.get(petSkillId);\n                if (!petSkill) {\n                    console.warn(`[gw2-tooltips] pet skill #${petSkillId} is missing from the cache. The query was caused by `, gw2Object);\n                    petSkill = MISSING_SKILL;\n                }\n                objectChain.push({ obj: petSkill, notCollapsable: true });\n            }\n    };\n    addObjectsToChain(initialAPIObject);\n    let weaponSet = +String(gw2Object.getAttribute('weaponSet'));\n    if (isNaN(weaponSet))\n        weaponSet = undefined;\n    const tooltipChain = objectChain.map(({ obj, notCollapsable }) => (('type' in obj) ? generateItemTooltip(obj, context, gw2Object, statSetId, stackSize) : generateToolTip(obj, notCollapsable, context, weaponSet)));\n    tooltip.append(...tooltipChain);\n    return tooltipChain;\n}\nexport function findTraitedOverride(skill, context) {\n    var _a;\n    for (const palette of skill.palettes) {\n        for (const slot of palette.slots) {\n            if (slot.traited_alternatives) {\n                const pair = slot.traited_alternatives.find(([a, _]) => context.character.traits.includes(a));\n                if (!pair)\n                    return;\n                const [traitId, altId] = pair;\n                if (altId == skill.id)\n                    return;\n                const replacementSkill = APICache.storage.skills.get(altId);\n                if (!replacementSkill) {\n                    console.error(`[gw2-tooltips] Corrected skill #${altId} is missing in the cache.`);\n                    return undefined;\n                }\n                else {\n                    console.info(`[gw2-tooltips] Corrected skill #${skill.id} (${skill.name}) to #${replacementSkill.id} (${replacementSkill.name}) because the trait #${traitId} (${((_a = APICache.storage.traits.get(traitId)) === null || _a === void 0 ? void 0 : _a.name) || '<not cached>'}) is active.`);\n                    return replacementSkill;\n                }\n            }\n        }\n    }\n}\nfunction generateItemTooltip(item, context, target, statSetId, stackSize = 1) {\n    var _a;\n    let statSet = findCorrectAttributeSet(item, statSetId);\n    let slottedItems;\n    if ('slots' in item) {\n        slottedItems = (_a = target.getAttribute('slotted')) === null || _a === void 0 ? void 0 : _a.split(',').map(id => APICache.storage.items.get(+String(id) || 0)).filter(i => i && 'subtype' in i);\n    }\n    const countPrefix = stackSize > 1 ? stackSize + ' ' : '';\n    const upgradeNameSource = (slottedItems === null || slottedItems === void 0 ? void 0 : slottedItems.find(i => !['Infusion', 'Enrichment'].includes(i.subtype))) || (slottedItems === null || slottedItems === void 0 ? void 0 : slottedItems[0]);\n    const name = countPrefix + formatItemName(item, context, statSet, upgradeNameSource, stackSize);\n    const parts = [newElm('tet.title', newImg(item.icon), newElm('teb.gw2-color-rarity-' + item.rarity.toLowerCase(), name), newElm('div.flexbox-fill'))];\n    if ('defense' in item && item.defense) {\n        const defense = (typeof item.defense == \"number\")\n            ? item.defense\n            : LUT_DEFENSE[Math.min(100, (item.defense[0] + context.character.level))] * item.defense[1];\n        parts.push(newElm('te', newElm('tem', 'Defense: ', newElm('span.gw2-color-stat-green', String(defense)))));\n    }\n    if ('power' in item) {\n        let power;\n        if ('mul' in item.power) {\n            let maxRarity = Rarity.Legendary;\n            if (['PlayerLevelScaleRarity', 'ItemScale4'].includes(item.power.scaling)) {\n                if (context.character.level < 14)\n                    maxRarity = Rarity.Common;\n                else if (context.character.level < 30)\n                    maxRarity = Rarity.Uncommon;\n                else if (context.character.level < 60)\n                    maxRarity = Rarity.Rare;\n                else if (context.character.level < 80)\n                    maxRarity = Rarity.Exotic;\n            }\n            const rarity = Math.min(Rarity[item.rarity], maxRarity);\n            let index = LUT_RARITY[rarity];\n            if (!item.power.scaling)\n                index += item.level;\n            else {\n                index += context.character.level;\n            }\n            const avg = (context.character.isPlayer ? LUT_POWER_PLAYER : LUT_POWER_MONSTER)[Math.min(100, index)] * item.power.mul * LUT_RARITY_MUL[rarity];\n            const spread = avg * item.power.spread;\n            power = [Math.ceil(avg - spread), Math.ceil(avg + spread)];\n        }\n        else {\n            power = item.power;\n        }\n        const line = newElm('tem', 'Weapon Strength: ', newElm('span.gw2-color-stat-green', `${power[0]} - ${power[1]}`));\n        if (item.damage_type)\n            line.append(` (${item.damage_type})`);\n        parts.push(newElm('te', line));\n    }\n    if ('tiers' in item) {\n        parts.push(generateUpgradeItemGroup(item, context));\n    }\n    if (statSet && 'attribute_base' in item) {\n        parts.push(...statSet.attributes.map(({ attribute, base_value, scaling }) => {\n            const computedValue = Math.round(base_value + item.attribute_base * scaling);\n            return newElm('te', newElm('tem.gw2-color-stat-green', `+${computedValue} ${mapLocale(attribute)}`));\n        }));\n    }\n    if ('slots' in item) {\n        parts.push(newElm('div.group.slots', ...item.slots.map(s => {\n            let slottedItemIdx = -1;\n            if (slottedItems) {\n                switch (s) {\n                    case 'Upgrade':\n                        slottedItemIdx = slottedItems.findIndex(i => ['Rune', 'Sigil', 'Gem'].includes(i.subtype));\n                        break;\n                    case 'Infusion':\n                        slottedItemIdx = slottedItems.findIndex(i => i.subtype == 'Infusion');\n                        break;\n                    case 'Enrichment':\n                        slottedItemIdx = slottedItems.findIndex(i => i.subtype == 'Enrichment');\n                        break;\n                }\n            }\n            if (slottedItemIdx > -1) {\n                const slottedItem = slottedItems.splice(slottedItemIdx, 1)[0];\n                const group = generateUpgradeItemGroup(slottedItem, context);\n                const name = formatItemName(slottedItem, context, statSet);\n                group.prepend(newElm('tet', newImg(slottedItem.icon, 'iconsmall'), newElm('teb.gw2-color-rarity-' + slottedItem.rarity, name), newElm('div.flexbox-fill')));\n                return group;\n            }\n            else {\n                return newElm('te', newImg(ICONS['SLOT_' + s], 'iconsmall'), `Empty ${s} Slot`);\n            }\n        })));\n    }\n    const metaInfo = newElm('div.group');\n    if (item.type == \"Armor\" || item.type == \"Weapon\" || (item.type == \"Trinket\" && !item.flags.includes('Pvp'))) {\n        metaInfo.append(newElm('span.gw2-color-rarity-' + item.rarity, item.rarity));\n        if ('weight' in item)\n            metaInfo.append(newElm('span', item.weight));\n        metaInfo.append(newElm('span', `${item.type}: ${item.subtype}`));\n        if (item.type == \"Weapon\" && isTwoHanded(item.subtype))\n            metaInfo.append(newElm('span.gw2-color-rarity-Junk', `(Two-Handed)`));\n        if (item.required_level)\n            metaInfo.append(newElm('span', 'Required Level: ' + item.required_level));\n    }\n    if (item.description)\n        metaInfo.append(newElm('span', fromHTML(GW2Text2HTML(item.description))));\n    if (!item.flags.includes('Pvp')) {\n        if (item.flags.includes('Unique'))\n            metaInfo.append(newElm('span', 'Unique'));\n        if (item.flags.includes('AccountBound'))\n            metaInfo.append(newElm('span', 'Account Bound'));\n        if (item.flags.includes('SoulBindOnUse'))\n            metaInfo.append(newElm('span', 'Soulbound on Use'));\n        else if (item.flags.includes('SoulBindOnAcquire'))\n            metaInfo.append(newElm('span', 'Soulbound on Acquire'));\n    }\n    if (!item.flags.includes('NoSalvage')) {\n        const salvageOptions = [item.type == 'Consumable' && item.subtype == 'Food'\n                ? 'Compost'\n                : item.rarity == 'Ascended' ? 'Ascended' : 'Standard'\n        ];\n        if (item.flags.includes('SalvageResearch'))\n            salvageOptions.push('Research');\n        if (salvageOptions.length)\n            metaInfo.append(newElm('span', 'Salvage: ' + salvageOptions.join(', ')));\n    }\n    if (item.vendor_value) {\n        let inner = ['Vendor Value: ', formatCoins(item.vendor_value * stackSize)];\n        if (stackSize > 1)\n            inner.push(' (', formatCoins(item.vendor_value), ` x ${stackSize})`);\n        metaInfo.append(newElm('span', ...inner));\n    }\n    parts.push(metaInfo);\n    const tooltip = newElm('div.tooltip.item.active', ...parts);\n    tooltip.dataset.id = String(item.id);\n    return tooltip;\n}\nexport function findCorrectAttributeSet(item, statSetId) {\n    let statSet = undefined;\n    if (item.type == \"Armor\" || item.type == \"Trinket\" || item.type == \"Weapon\") {\n        statSetId = statSetId || item.attribute_set;\n        if (statSetId === undefined)\n            console.warn(`[gw2-tooltips] [tooltip engine] Hovering on item without specified or innate stats. Specify the stats by adding 'stats=\"<stat_set_id>\" to the html element.' `);\n        else {\n            statSet = APICache.storage.itemstats.get(statSetId);\n            if (!statSet)\n                console.error(`[gw2-tooltips] [tooltip engine] itemstat #${statSetId} is missing in cache.`);\n            else {\n                if (config.adjustIncorrectStatIds && statSet.similar_sets) {\n                    const correctSetId = statSet.similar_sets[item.subtype];\n                    if (correctSetId !== undefined) {\n                        console.info(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${statSetId} to #${correctSetId} because the target is of type ${item.subtype}.`);\n                        const newSet = APICache.storage.itemstats.get(correctSetId);\n                        if (!newSet)\n                            console.error(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${correctSetId} is missing in the cache.`);\n                        else\n                            statSet = newSet;\n                    }\n                }\n            }\n        }\n    }\n    return statSet;\n}\nfunction generateUpgradeItemGroup(item, context) {\n    const group = newElm('div.group');\n    for (const [i, tier] of item.tiers.entries()) {\n        let tier_wrap = newElm('te');\n        if (tier.description)\n            tier_wrap.append(newElm('span', fromHTML(GW2Text2HTML(tier.description))));\n        else if (tier.facts) {\n            for (const fact of tier.facts) {\n                const { wrapper } = generateFact(fact, null, context);\n                if (wrapper)\n                    tier_wrap.append(wrapper);\n            }\n        }\n        else if (tier.modifiers) {\n            tier_wrap.style.flexDirection = \"column\";\n            for (const modifier of tier.modifiers) {\n                let modifierValue = calculateModifier(modifier, context.character);\n                let text;\n                if (modifier.flags.includes('FormatPercent')) {\n                    text = `+${Math.round(modifierValue)}% ${mapLocale(modifier.description)}`;\n                }\n                else {\n                    text = `+${Math.round(modifierValue)} ${mapLocale(modifier.description)}`;\n                }\n                tier_wrap.append(newElm('te', text));\n            }\n        }\n        const w = newElm('te', tier_wrap);\n        if (item.subtype == \"Rune\") {\n            const colorClass = i < (context.character.upgradeCounts[item.id] || 0) ? '.gw2-color-stat-green' : '';\n            w.prepend(newElm('span' + colorClass, `(${i + 1})`));\n        }\n        group.append(w);\n    }\n    return group;\n}\nfunction generateAttributeTooltip(attribute, context) {\n    const [value, parts] = computeAttributeFromMods(attribute, context, true);\n    if (['ConditionDuration', 'BoonDuration'].includes(attribute)) {\n        const target_type = attribute === 'ConditionDuration' ? 'Condition' : 'Boon';\n        const completeSources = structuredClone(context.character.stats.sources);\n        for (const [key, mods] of Object.entries(context.character.statsWithWeapons[context.character.selectedWeaponSet].sources)) {\n            if (isNaN(+key))\n                continue;\n            (completeSources[key] || (completeSources[key] = [])).push(...mods);\n        }\n        const modCap = (getAttributeInformation(attribute, context.character).cap - 1) * 100;\n        for (const [effect_id, sources] of Object.entries(completeSources)) {\n            if (isNaN(+effect_id))\n                continue;\n            const effect = APICache.storage.skills.get(+effect_id);\n            if (!effect) {\n                console.error(`[gw2-tooltips] [tooltip engine] effect #${effect_id} is missing in cache.`);\n                continue;\n            }\n            if (effect.buff_type !== target_type)\n                continue;\n            let specificMod = value * 100;\n            let specificParts = [];\n            for (const { source, modifier, count } of sources) {\n                const mod = calculateModifier(modifier, context.character);\n                specificParts.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                specificMod += mod;\n            }\n            const uncappedMod = specificMod;\n            specificMod = Math.min(specificMod, modCap);\n            if (uncappedMod != specificMod) {\n                specificParts.push(newElm('span.detail.capped', `(Capped to +${n3(specificMod)}%! Uncapped value would be ${n3(uncappedMod)}%)`));\n            }\n            parts.push(newElm('div.fact', newImg(effect.icon), newElm('div', newElm('span', `${effect.name}: +${n3(specificMod)}%`), ...specificParts)));\n        }\n    }\n    return newElm('div.tooltip.item.active', ...parts);\n}\nfunction computeAttributeFromMods(attribute, context, generateHtml = false, weaponSet) {\n    const stats = context.character.stats;\n    const weaponStats = context.character.statsWithWeapons[weaponSet !== null && weaponSet !== void 0 ? weaponSet : context.character.selectedWeaponSet];\n    let { baseAttribute, suffix, isComputed, base, div, cap } = getAttributeInformation(attribute, context.character);\n    const displayMul = suffix ? 100 : 1;\n    let value = base, text;\n    const parts = [];\n    if (!baseAttribute) {\n        if (generateHtml)\n            parts.push(newElm('tet.title', newElm('teb', attribute)));\n    }\n    else {\n        {\n            if (generateHtml) {\n                text = `${n3(base * displayMul) + suffix} base value`;\n                if (base) {\n                    text += ' from lvl 80';\n                }\n                parts.push(newElm('div.detail', text));\n            }\n            if (isComputed) {\n                const baseAttrValue = stats.values[baseAttribute] + weaponStats.values[baseAttribute];\n                let attrValue = baseAttrValue;\n                if (attribute == 'CritChance')\n                    attrValue -= 1000;\n                const statBonus = attrValue / div;\n                value += statBonus;\n                if (generateHtml && statBonus) {\n                    text = ` +${n3(statBonus * displayMul) + suffix} from ${n3(baseAttrValue)} ${mapLocale(baseAttribute)}`;\n                    if (div != 1)\n                        text += ` / ${div / displayMul} (attrib. specific conv. factor)`;\n                    parts.push(newElm('div.detail', text));\n                }\n            }\n        }\n        const statSources = stats.sources[attribute].concat(weaponStats.sources[attribute]);\n        let modValue = 0;\n        for (const source of statSources.filter(s => !s.modifier.flags.includes('FormatPercent'))) {\n            const mod = calculateModifier(source.modifier, context.character) * source.count;\n            modValue += mod;\n            if (generateHtml) {\n                text = ` +${n3(mod)} from `;\n                if (source.count > 1)\n                    text += `${source.count} `;\n                text += source.source;\n                parts.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n            }\n        }\n        const valueAndAdditiveMods = value + modValue;\n        for (const source of statSources.filter(s => s.modifier.flags.includes('FormatPercent'))) {\n            const mod = calculateModifier(source.modifier, context.character) * source.count / 100;\n            const toAdd = suffix ? mod : valueAndAdditiveMods * mod;\n            modValue += toAdd;\n            if (generateHtml) {\n                text = ` +${n3(toAdd * displayMul)}${suffix}`;\n                if (!suffix)\n                    text += ` (${n3(mod * 100)}%)`;\n                text += ' from ';\n                if (source.count > 1)\n                    text += `${source.count} `;\n                text += source.source;\n                parts.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n            }\n        }\n        const uncappedValue = value + modValue;\n        value = Math.min(uncappedValue, cap - 1);\n        if (generateHtml) {\n            if (uncappedValue != value)\n                parts.push(newElm('span.detail.capped', `(Capped to ${n3(value * displayMul)}${suffix}! Uncapped value would be ${n3(uncappedValue * displayMul)}${suffix})`));\n            parts.unshift(newElm('tet.title', newElm('teb', ' +' + n3(value * displayMul) + suffix + ' ' + mapLocale(attribute))));\n        }\n    }\n    return [value, parts];\n}\nexport function getAttributeInformation(attribute, character) {\n    const MAX_VAL = Number.MAX_SAFE_INTEGER;\n    const _p2 = {\n        Power: ['Power', 66722, '', false, 1000, 1, MAX_VAL],\n        Toughness: ['Toughness', 104162, '', false, 1000, 1, MAX_VAL],\n        Vitality: ['Vitality', 104163, '', false, 1000, 1, MAX_VAL],\n        Precision: ['Precision', 156609, '', false, 1000, 1, MAX_VAL],\n        Ferocity: ['Ferocity', 156602, '', false, 0, 1, MAX_VAL],\n        ConditionDamage: ['ConditionDamage', 156600, '', false, 0, 1, MAX_VAL],\n        Expertise: ['Expertise', 156601, '', false, 0, 1, MAX_VAL],\n        Concentration: ['Concentration', 156599, '', false, 0, 1, MAX_VAL],\n        HealingPower: ['HealingPower', 156606, '', false, 0, 1, MAX_VAL],\n        AgonyResistance: ['AgonyResistance', 536049, '', false, 0, 1, MAX_VAL],\n        Health: ['Vitality', 536052, '', true, 0, 0.1, MAX_VAL],\n        Armor: ['Toughness', 536048, '', true, 0, 1, MAX_VAL],\n        ConditionDuration: ['Expertise', 156601, '%', true, 0, 1500, 2],\n        BoonDuration: ['Concentration', 156599, '%', true, 0, 1500, 2],\n        CritChance: ['Precision', 536051, '%', true, 0.05, 2100, MAX_VAL],\n        CritDamage: ['Ferocity', 784327, '%', true, 1.5, 1500, MAX_VAL],\n    }[attribute];\n    let baseAttribute, img, suffix = '', isComputed, base = 0, div = 1, cap = MAX_VAL;\n    if (_p2)\n        [baseAttribute, img, suffix, isComputed, base, div, cap] = _p2;\n    if (attribute == 'Health')\n        base = getBaseHealth(character);\n    return { baseAttribute, img, suffix, isComputed, base, div, cap };\n}\nfunction getBaseHealth(character) {\n    return !character.profession\n        ? 1000\n        : {\n            Guardian: 1645,\n            Thief: 1645,\n            Elementalist: 1645,\n            Engineer: 5922,\n            Ranger: 5922,\n            Mesmer: 5922,\n            Revenant: 5922,\n            Necromancer: 9212,\n            Warrior: 9212,\n        }[character.profession];\n}\nfunction recomputeCharacterAttributes(context) {\n    const attributeOrder = [\n        'Power', 'Toughness', 'Vitality', 'Precision', 'Ferocity', 'ConditionDamage', 'Expertise', 'Concentration', 'HealingPower', 'AgonyResistance',\n        'Health', 'Armor', 'ConditionDuration', 'BoonDuration', 'CritChance', 'CritDamage',\n    ];\n    for (const [weaponSetId, weaponSet] of context.character.statsWithWeapons.entries()) {\n        for (const attribute of attributeOrder) {\n            const [value, _] = computeAttributeFromMods(attribute, context, false, weaponSetId);\n            weaponSet.values[attribute] = value;\n        }\n    }\n}\nfunction calculateConditionDuration(level, expertise) {\n    return expertise / (LUT_CRITICAL_DEFENSE[level] * (15 / LUT_CRITICAL_DEFENSE[80]));\n}\nfunction calculateBoonDuration(level, concentration) {\n    return concentration / (LUT_CRITICAL_DEFENSE[level] * (15 / LUT_CRITICAL_DEFENSE[80]));\n}\nexport function getAttributeValue(character, attribute) {\n    return character.statsWithWeapons[character.selectedWeaponSet].values[attribute];\n}\nexport function sumUpModifiers(character, attribute) {\n    return [...(character.stats.sources[attribute] || []), ...(character.statsWithWeapons[character.selectedWeaponSet].sources[attribute] || [])];\n}\nexport function formatItemName(item, context, statSet, upgradeComponent, stackSize = 1) {\n    let name;\n    if (item.type == 'TraitGuide') {\n        name = item.trait;\n    }\n    else {\n        name = item.name;\n    }\n    let arg1, arg2, arg3, arg4;\n    arg1 = arg2 = arg3 = arg4 = '';\n    if (!item.flags.includes('HidePrefix')) {\n        if (statSet && statSet.name) {\n            arg1 = statSet.name;\n            arg2 = \" \";\n        }\n    }\n    if (!item.flags.includes('HideSuffix')) {\n        if (upgradeComponent && upgradeComponent.suffix) {\n            arg4 = upgradeComponent.suffix;\n            arg3 = \" \";\n        }\n    }\n    name = GW2Text2HTML(name, arg1, arg2, arg3, arg4);\n    if (stackSize > -1)\n        name = resolveInflections(name, stackSize, context.character);\n    if (!item.flags.includes('Pve') && (item.flags.includes('Pvp') || item.flags.includes('PvpLobby')))\n        name += \" (PvP)\";\n    return name;\n}\nexport function specializeContextFromInlineAttribs(context, gw2Object) {\n    let traitOverrides;\n    if (gw2Object.getAttribute('type') === 'skill' && (traitOverrides = gw2Object.getAttribute('with-traits'))) {\n        context = structuredClone(context);\n        const invalid = [];\n        context.character.traits = traitOverrides.split(',').map(t => {\n            const v = +t;\n            if (!v)\n                invalid.push(t);\n            return v;\n        }).filter(t => t);\n        if (invalid.length)\n            console.warn(\"[gw2-tooltips] [tooltip engine] Inline trait-override for element \", gw2Object, \" has misformed overrides: \", invalid);\n    }\n    return context;\n}\nfunction formatCoins(amount) {\n    const parts = [String(Math.floor(amount % 100)), newImg(ICONS.COIN_COPPER, 'iconsmall', '')];\n    if (amount > 99)\n        parts.unshift(String(Math.floor((amount / 100) % 100)), newImg(ICONS.COIN_SILVER, 'iconsmall', ''));\n    if (amount > 9999)\n        parts.unshift(String(Math.floor(amount / 10000)), newImg(ICONS.COIN_GOLD, 'iconsmall', ''));\n    return newElm('span', ...parts);\n}\nfunction isTwoHanded(type) {\n    switch (type) {\n        case 'Axe': return false;\n        case 'Dagger': return false;\n        case 'Mace': return false;\n        case 'Pistol': return false;\n        case 'Scepter': return false;\n        case 'Focus': return false;\n        case 'Sword': return false;\n        case 'BowShort': return false;\n        case 'Torch': return false;\n        case 'Shield': return false;\n        case 'Warhorn': return false;\n        case 'Toy': return false;\n        case 'ToyTwoHanded': return false;\n        case 'BundleSmall': return false;\n        case 'Hammer': return true;\n        case 'BowLong': return true;\n        case 'Greatsword': return true;\n        case 'Polearm': return true;\n        case 'Rifle': return true;\n        case 'Staff': return true;\n        case 'BundleLarge': return true;\n        case 'Spear': return true;\n        case 'Speargun': return true;\n        case 'Trident': return true;\n    }\n}\nexport const DEFAULT_CONTEXT = {\n    gameMode: 'Pve',\n    targetArmor: 2597,\n    character: {\n        level: 80,\n        isPlayer: true,\n        sex: \"Male\",\n        traits: [],\n        stats: {\n            values: {\n                Power: 0,\n                Toughness: 0,\n                Vitality: 0,\n                Precision: 0,\n                Ferocity: 0,\n                ConditionDamage: 0,\n                Expertise: 0,\n                Concentration: 0,\n                HealingPower: 0,\n                AgonyResistance: 0,\n            },\n            sources: {\n                Power: [],\n                Toughness: [],\n                Vitality: [],\n                Precision: [],\n                Ferocity: [],\n                ConditionDamage: [],\n                Expertise: [],\n                Concentration: [],\n                HealingPower: [],\n                AgonyResistance: [],\n                Armor: [],\n                Damage: [],\n                LifeForce: [],\n                Health: [],\n                HealEffectiveness: [],\n                Stun: [],\n                ConditionDuration: [],\n                BoonDuration: [],\n                CritChance: [],\n                CritDamage: [],\n            },\n        },\n        statsWithWeapons: [{\n                values: {\n                    Power: 1000,\n                    Toughness: 1000,\n                    Vitality: 1000,\n                    Precision: 1000,\n                    Ferocity: 0,\n                    ConditionDamage: 0,\n                    Expertise: 0,\n                    Concentration: 0,\n                    HealingPower: 0,\n                    AgonyResistance: 0,\n                    Health: 10000,\n                    Armor: 1000,\n                    CritChance: 0.05,\n                    CritDamage: 1.5,\n                    ConditionDuration: 0,\n                    BoonDuration: 0,\n                },\n                sources: {\n                    Power: [],\n                    Toughness: [],\n                    Vitality: [],\n                    Precision: [],\n                    Ferocity: [],\n                    ConditionDamage: [],\n                    Expertise: [],\n                    Concentration: [],\n                    HealingPower: [],\n                    AgonyResistance: [],\n                    Armor: [],\n                    Damage: [],\n                    LifeForce: [],\n                    Health: [],\n                    HealEffectiveness: [],\n                    Stun: [],\n                    ConditionDuration: [],\n                    BoonDuration: [],\n                    CritChance: [],\n                    CritDamage: [],\n                },\n            }],\n        selectedWeaponSet: 0,\n        upgradeCounts: {},\n    },\n};\nfunction createCompleteContext(partialContext) {\n    var _a, _b, _c, _d, _e, _f;\n    if (partialContext.gameMode == \"Pvp\" && ((_a = partialContext.character) === null || _a === void 0 ? void 0 : _a.level) && ((_b = partialContext.character) === null || _b === void 0 ? void 0 : _b.level) != 80) {\n        console.error('[gw2-tooltips] [init] supplied (partial) context has its gamemode set to pvp, but has a character level specified thats other than 80. In pvp you are always level 80. This will lead to unexpected results; Remove the explicit level or change the gamemode. The (partial) context in question is: ', partialContext);\n    }\n    const stats = createCompletedBaseStats((_c = partialContext.character) === null || _c === void 0 ? void 0 : _c.stats);\n    const upgradeCounts = Object.assign({}, (_d = partialContext.character) === null || _d === void 0 ? void 0 : _d.upgradeCounts);\n    const weaponStats = ((_f = (_e = partialContext.character) === null || _e === void 0 ? void 0 : _e.statsWithWeapons) === null || _f === void 0 ? void 0 : _f.map(s => createCompletedStats(s))) || [createCompletedStats()];\n    const character = Object.assign({}, DEFAULT_CONTEXT.character, partialContext.character, { stats, upgradeCounts, weaponStats });\n    return Object.assign({}, DEFAULT_CONTEXT, partialContext, { character });\n}\nexport function createCompletedBaseStats(partialSource = {}) {\n    const values = Object.assign({}, DEFAULT_CONTEXT.character.stats.values, partialSource.values);\n    const sources = Object.assign({}, structuredClone(DEFAULT_CONTEXT.character.stats.sources), partialSource.sources);\n    return { values, sources };\n}\nexport function createCompletedStats(partialSource = {}) {\n    const values = Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values, partialSource.values);\n    const sources = Object.assign({}, structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].sources), partialSource.sources);\n    return { values, sources };\n}\nconst DEFAULT_CONFIG = {\n    autoInitialize: true,\n    autoCollectRuneCounts: true,\n    autoCollectStatSources: true,\n    autoCollectSelectedTraits: true,\n    autoRecomputeCharacterAttributes: true,\n    adjustIncorrectStatIds: true,\n    autoInferEquipmentUpgrades: true,\n    autoInferWeaponSetAssociation: true,\n    legacyCompatibility: true,\n    showPreciseAbilityTimings: false,\n    showFactComputationDetail: false,\n};\nexport const LUT_DEFENSE = [\n    115, 120, 125, 129, 133, 137, 142, 146, 150, 154, 162, 168, 175, 182, 189, 196, 202, 209, 216, 223, 232, 240, 248, 257, 265, 274, 282, 290, 299, 307, 319, 330, 341, 352, 363, 374, 385, 396, 407, 418, 431, 443, 456, 469, 481, 494, 506, 519, 532, 544, 560, 575, 590, 606, 621, 636, 651, 666, 682, 697, 714, 731, 748, 764, 781, 798, 815, 832, 848, 865, 885, 905, 924, 943, 963, 982, 1002, 1021, 1040, 1060, 1081, 1102, 1123, 1144, 1165, 1186, 1207, 1228, 1249, 1270, 1291, 1312, 1333, 1354, 1375, 1396, 1417, 1438, 1459, 1480, 1501,\n];\nconst LUT_POWER_PLAYER = [\n    170, 173, 176, 179, 182, 185, 188, 191, 194, 197, 202, 207, 212, 217, 222, 227, 232, 237, 242, 247, 253, 259, 265, 271, 277, 283, 289, 295, 301, 307, 315, 323, 331, 339, 347, 355, 363, 371, 379, 387, 396, 405, 414, 423, 432, 441, 450, 459, 468, 477, 488, 499, 510, 521, 532, 543, 554, 565, 576, 587, 599, 611, 623, 635, 647, 659, 671, 683, 695, 707, 721, 735, 749, 763, 777, 791, 805, 819, 833, 847, 862, 877, 892, 907, 922, 937, 952, 967, 982, 997, 1012, 1027, 1042, 1057, 1072, 1087, 1102, 1117, 1132, 1147, 1162,\n];\nconst LUT_POWER_MONSTER = [\n    162, 179, 197, 214, 231, 249, 267, 286, 303, 322, 344, 367, 389, 394, 402, 412, 439, 454, 469, 483, 500, 517, 556, 575, 593, 612, 622, 632, 672, 684, 728, 744, 761, 778, 820, 839, 885, 905, 924, 943, 991, 1016, 1067, 1093, 1119, 1145, 1193, 1220, 1275, 1304, 1337, 1372, 1427, 1461, 1525, 1562, 1599, 1637, 1692, 1731, 1802, 1848, 1891, 1936, 1999, 2045, 2153, 2201, 2249, 2298, 2368, 2424, 2545, 2604, 2662, 2723, 2792, 2854, 2985, 3047, 3191, 3269, 3348, 3427, 3508, 3589, 3671, 3754, 3838, 3922, 4007, 4093, 4180, 4267, 4356, 4445, 4535, 4625, 4717, 4809, 4902,\n];\nvar Rarity;\n(function (Rarity) {\n    Rarity[Rarity[\"Junk\"] = 0] = \"Junk\";\n    Rarity[Rarity[\"Basic\"] = 1] = \"Basic\";\n    Rarity[Rarity[\"Common\"] = 2] = \"Common\";\n    Rarity[Rarity[\"Uncommon\"] = 3] = \"Uncommon\";\n    Rarity[Rarity[\"Rare\"] = 4] = \"Rare\";\n    Rarity[Rarity[\"Exotic\"] = 5] = \"Exotic\";\n    Rarity[Rarity[\"Ascended\"] = 6] = \"Ascended\";\n    Rarity[Rarity[\"Legendary\"] = 7] = \"Legendary\";\n})(Rarity || (Rarity = {}));\nconst LUT_RARITY = [0, 0, 1, 2, 3, 4, 4, 4];\nconst LUT_RARITY_MUL = [0.5, 0.65, 0.8, 0.85, 0.9, 1.0, 1.05, 1.05];\nconst LUT_CRITICAL_DEFENSE = [\n    1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3.0, 3.2, 3.4, 3.6, 3.8, 4.0, 4.2, 4.4, 4.6, 4.8, 5.0, 5.2, 5.4, 5.6, 5.8, 6.0, 6.2, 6.4, 6.6, 6.8, 7.0, 7.3, 7.6, 7.9, 8.2, 8.5, 8.8, 9.1, 9.4, 9.7, 10.0, 10.3, 10.6, 10.9, 11.2, 11.5, 11.8, 12.1, 12.4, 12.7, 13.0, 13.4, 13.8, 14.2, 14.6, 15.0, 15.4, 15.8, 16.2, 16.6, 17.0, 17.4, 17.8, 18.2, 18.6, 19.0, 19.4, 19.8, 20.2, 20.6, 21.0, 21.5, 22.0, 22.5, 23.0, 23.5, 24.0, 24.5, 25.0, 25.5, 26.0, 26.5, 27.0, 27.5, 28.0, 28.5, 29.0, 29.5, 30.0, 30.5, 31.0,\n];\nexport const ICONS = {\n    COIN_COPPER: 156902,\n    COIN_SILVER: 156907,\n    COIN_GOLD: 156904,\n    SLOT_Upgrade: 517197,\n    SLOT_Infusion: 517202,\n    SLOT_Enrichment: 517204,\n    RESOURCE_THIEF: 156649,\n    RESOURCE_REV: 156647,\n    UPKEEP_COST: 156058,\n    SUPPLY_COST: 2111003,\n    ENDURANCE_COST: 156649,\n    NO_UNDERWATER: 358417,\n    RECHARGE: 156651,\n    ACTIVATION: 496252,\n    RANGE: 156666,\n    DEFIANCE_BREAK: 1938788,\n    WEAPON_SWAP: 156583,\n    BARRIER: 1770209,\n    STUN_BREAK: 156654,\n    KNOCKDOWN: 2440716,\n    PULL: 2440717,\n    KNOCKBACK: 2440715,\n    LAUNCH: 2440712,\n    FLOAT: 2440713,\n    SINK: 2440714,\n};\nconst VALID_CHAIN_PALETTES = ['Bundle', 'Heal', 'Elite', 'Profession', 'Standard', 'Equipment'];\n_constructor();\nif (config.autoInitialize) {\n    const buildNodes = document.getElementsByClassName('gw2-build-wrapper');\n    if (config.autoCollectSelectedTraits) {\n        if (buildNodes.length)\n            for (const target of buildNodes)\n                Collect.allTraits(target);\n        else {\n            console.warn(\"[gw2-tooltips] [collect] `config.autoCollectSelectedTraits` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.\");\n        }\n    }\n    hookDocument(document)\n        .then(gw2Objects => {\n        var _a;\n        if (config.autoInferWeaponSetAssociation) {\n            for (const buildNode of buildNodes) {\n                for (const [i, setNode] of buildNode.querySelectorAll('.weapon-set').entries()) {\n                    for (const objNode of setNode.getElementsByTagName('GW2OBJECT'))\n                        objNode.setAttribute('weaponSet', String(i));\n                }\n                const skillIdsBySet = [];\n                for (const [i, setSkillsNode] of buildNode.querySelectorAll('.skills-weapon-set').entries()) {\n                    const skillIds = [];\n                    const chainIds = (skill) => {\n                        skillIds.push(skill.id);\n                        let hasChain = false;\n                        const palette = skill.palettes.find(p => VALID_CHAIN_PALETTES.includes(p.type));\n                        if (palette)\n                            for (const slot of palette.slots) {\n                                if (slot.next_chain && slot.profession) {\n                                    const nextSkillInChain = APICache.storage.skills.get(slot.next_chain);\n                                    if (nextSkillInChain) {\n                                        hasChain = true;\n                                        chainIds(nextSkillInChain);\n                                    }\n                                }\n                            }\n                        if (!hasChain && skill.related_skills) {\n                            for (const subSkillId of skill.related_skills) {\n                                const subSkillInChain = APICache.storage.skills.get(subSkillId);\n                                if (subSkillInChain && subSkillInChain.palettes.some(palette => VALID_CHAIN_PALETTES.includes(palette.type)))\n                                    skillIds.push(subSkillId);\n                            }\n                        }\n                    };\n                    for (const objNode of setSkillsNode.children) {\n                        objNode.setAttribute('weaponSet', String(i));\n                        const skill = APICache.storage.skills.get(+String(objNode.getAttribute('objid')));\n                        if (skill)\n                            chainIds(skill);\n                        else {\n                            console.warn(\"[gw2-tooltips] [collect] failed to find skill for object \", objNode);\n                        }\n                    }\n                    skillIdsBySet.push(skillIds);\n                }\n                if (skillIdsBySet.length > 1 && (skillIdsBySet[0][0] != skillIdsBySet[1][0] || skillIdsBySet[0][skillIdsBySet[0].length - 1] != skillIdsBySet[1][skillIdsBySet[1].length - 1])) {\n                    console.info(\"[gw2-tooltips] [collect] Will mark the following skills as belonging to weapon sets: \", skillIdsBySet);\n                    const descriptionNode = (_a = buildNode.parentElement.nextElementSibling) === null || _a === void 0 ? void 0 : _a.nextElementSibling;\n                    if (descriptionNode)\n                        for (const skillNode of descriptionNode.querySelectorAll('gw2object[type=skill]')) {\n                            const id = +String(skillNode.getAttribute('objid')) || 0;\n                            if (id)\n                                for (const [i, skills] of skillIdsBySet.entries()) {\n                                    if (skills.includes(id))\n                                        skillNode.setAttribute('weaponSet', String(i));\n                                }\n                        }\n                }\n            }\n        }\n        if (config.autoCollectRuneCounts) {\n            if (buildNodes.length)\n                for (const target of buildNodes)\n                    Collect.allUpgradeCounts(target);\n            else {\n                console.warn(\"[gw2-tooltips] [collect] `config.autoCollectRuneCounts` is active, but no element with class `gw2-build` could be found to use as source. Upgrades will not be collected as there is no way to tell which upgrades belongs to the build and which ones are just in some arbitrary text.\");\n            }\n        }\n        if (config.autoCollectStatSources) {\n            if (buildNodes.length)\n                for (const target of buildNodes)\n                    Collect.allStatSources(target);\n            else {\n                console.warn(\"[gw2-tooltips] [collect] `config.autoCollectStatSources` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.\");\n            }\n        }\n        if (config.autoCollectSelectedTraits) {\n            Collect.traitEffects(contexts);\n        }\n        if (config.autoInferEquipmentUpgrades) {\n            const targets = document.querySelectorAll('.weapon, .armor, .trinket');\n            if (targets.length)\n                inferItemUpgrades(targets);\n            else {\n                console.warn(\"[gw2-tooltips] [collect] `config.autoInferEquipmentUpgrades` is active, but no wrapper elements element with class `'weapon`, `armor` or `trinket` could be found to use as source. No elements will be updated\");\n            }\n        }\n        if (config.autoRecomputeCharacterAttributes) {\n            for (const context of contexts) {\n                recomputeCharacterAttributes(context);\n            }\n        }\n        for (const [attribute, elements] of gw2Objects.attributes) {\n            for (const element of elements) {\n                inflateAttribute(element, attribute);\n            }\n        }\n    });\n}\nimport { newElm, newImg, GW2Text2HTML, mapLocale, drawFractional, fromHTML, findSelfOrParent, n3, resolveInflections } from './TUtilsV2';\nimport * as APIs from './API';\nimport APICache from './APICache';\nimport { MISSING_SKILL, calculateModifier, generateFact, generateFacts } from './FactsProcessor';\nimport * as Collect from './Collect';\nimport { _legacy_transformEffectToSkillObject, inferItemUpgrades, inflateAttribute, inflateGenericIcon, inflateItem, inflateSkill, inflateSpecialization } from './Inflators';\n//# sourceMappingURL=TooltipsV2.js.map"],"names":["newElm","spec","inner","tag","classes","split","el","document","createElement","length","classList","add","append","IMAGE_CDN","missingImage","newImg","src","className","alt","img","includes","fromHTML","html","dummy","innerHTML","content","GW2Text2HTML","text","formatArgs","replaceAll","_","i","resolveInflections","count","character","sex","n3","v","withUpToNDigits","x","digits","str","toFixed","charAt","slice","drawFractional","value","config","showPreciseAbilityTimings","sign","Math","abs","fraction","min","round","floor","mapLocale","type","joinWordList","words","quoteWords","map","w","last","join","HSAPI","constructor","baseUrl","this","bulkRequest","endpoint","ids","fetch","then","r","json","hsApi","fallback","ex","console","warn","APICache","ensureExistence","initialIds","apiImpl","additionalIds","Object","assign","skills","Set","items","traits","pets","specializations","itemstats","findNextRelevantEndpoint","entries","size","currentEndpoint","storageSet","storage","request","Array","from","values","clear","info","response","unobtainable","filter","id","some","obj","datum","has","set","collectConnectedIds","error","connectedIdsStorage","addFacts","facts","fact","buff","prefix","palette","palettes","slot","slots","profession","next_chain","traited_alternatives","skillId","subSkill","related_skills","block","blocks","override_groups","attribute_set","subSkillId","skills_ai","skills_soulbeast","specialization","calculateModifier","formula","base_amount","formula_param1","level_scaling","formula_param2","level","stats","Power","ConditionDamage","HealingPower","generateFact","weapon_strength","context","iconSlug","icon","buffStackSize","buffDuration","duration","defiance_break_per_s","defiance_break","generateBuffDescription","valueMod","modsArray","modifiers","description_brief","relevantModifiers","modifier","trait_req","mode","gameMode","modsMap","Map","entry","get","attribute_conversion","getAttributeValue","flags","apply_count","strValue","fround","toString","description","push","applyMods","baseDuration","detailStack","durMod","cap","Number","MAX_SAFE_INTEGER","durationAttr","buff_type","baseAttribute","div","cap_","getAttributeInformation","attribVal","showFactComputationDetail","source","sumUpModifiers","mod","innerSuffix","displayMul","toAdd","durModStack","percentMod","uncappedMod","name","valueModStack","sources","HealEffectiveness","factInflators","AdjustByAttributeAndLevelHealing","_a","level_exponent","level_multiplier","hit_count","attributeVal","attribute","attribute_multiplier","lines","unshift","AttributeAdjust","range","target","Buff","MISSING_BUFF","buffDescription","seconds","name_brief","BuffBrief","Distance","distance","HealthAdjustHealing","Percent","percent","PercentDamage","PercentLifeForceAdjust","hpPool","raw","PercentHealth","LifeForceAdjust","Damage","dmg_multiplier","weaponStrength","power","damage","targetArmor","precision","ferocity","critChance","critDamage","moreDmgFromCrit","times","Time","time","ComboField","field_type","ComboFinisher","finisher_type","BuffConversion","NoData","PrefixedBuff","details","list","generateBuffIcon","PrefixedBuffBrief","Range","max","StunBreak","data","firstLine","remainingDetail","wrapper","requires_trait","defianceBreak","effectiveBuffDuration","breakDetail","trait_names","skip_next","d","stackSize","wrap","setAttribute","String","window","categories","MISSING_SKILL","allUpgradeCounts","scope","elements","getElementsByTagName","pair","contexts","elsInCorrectCtx","e","getAttribute","_upgradeCounts","elsWithWrongCtx","contextIndex","targetContext","_b","_c","_d","counts","element","item","subtype","amountToAdd","legacyCompatibility","_legacy_getInfusionCount","upgradeCounts","GW2TooltipsContext","allStatSources","keys","_statSources","_e","_f","_g","_h","structuredClone","DEFAULT_CONTEXT","weaponSetSources","upgrades","tiersToProcess","tierNumber","sourceRuneSuffix","tiersToAdd","tiers","attributeSet","findCorrectAttributeSet","undefined","attributes","a","target_attribute_or_buff","base_value","attribute_base","scaling","defense","LUT_DEFENSE","targetSources","weaponSetId","isNaN","tier","formatItemName","overwriteWeaponStatSources","statsWithWeapons","k","assert","ownIndex","prototype","indexOf","call","parentElement","children","amountEl","getElementsByClassName","textContent","match","allTraits","querySelectorAll","_traits","selectedPositions","y","traitEl","forEach","t","inflateGenericIcon","gw2Object","childElementCount","wikiLink","href","contains","cleanName","inflateSkill","skill","contextSet","specializeContextFromInlineAttribs","replacementSkill","findTraitedOverride","inflateItem","inflateSpecialization","style","backgroundImage","background","dataset","label","column","toggle","inflateAttribute","_p","Toughness","Vitality","Precision","Ferocity","Expertise","Concentration","AgonyResistance","Health","Armor","ConditionDuration","BoonDuration","CritChance","CritDamage","MagicFind","suffix","search","replaceChildren","_legacy_transformEffectToSkillObject","error_store","chaos_aura","dark_aura","fire_aura","frost_aura","light_aura","magnetic_aura","shocking_aura","aegis","alacrity","fury","might","protection","quickness","regeneration","resistance","resolution","stability","swiftness","vigor","bleeding","blinded","burning","chill","chilled","confusion","crippled","fear","immobilize","poison","slow","taunt","torment","vulnerability","weakness","daze","stun","agony","invulnerability","revealed","stealth","superspeed","unblockable","blight","bloodstone_blessed","blue_pylon_power","champion_of_the_legions","compromised","crowd_favor","curse_of_frailty","debilitated","debilitating_void","defense_up","derangement","elemental_empowerment","empowering_auras","equalization_matrix","expose_weakness","exposed","extreme_vulnerability","fixated","growing_rage_ashym","ignite","intervention","necrosis","not_sticking_together","nova","ooze_pheromone","photon_saturation","positive_flow","power_of_the_void","reinforced_armor","relentless_fire","retaliation_ashym","sentinel_retribution","shattering_ice","shell_shocked","spectral_darkness","sticking_together","synchronized_vitality","unnatural_signet","use_soul_binder","void_empowerment","xeras_embrace","hardCoded","barrier","ICONS","BARRIER","stunbreak","STUN_BREAK","knockdown","KNOCKDOWN","pull","PULL","knockback","KNOCKBACK","launch","LAUNCH","float","FLOAT","sink","SINK","innerText","title","cursor","tooltip","lastTooltipTarget","lastMouseX","lastMouseY","cyclePos","activateSubTooltip","tooltipIndex","tooltips","index","scrollSubTooltipIntoView","animate","transition","transform","offsetTop","offsetHeight","positionTooltip","wpadminbar","getElementById","topBarHeight","currentSubTooltip","tooltipXpos","offsetWidth","documentElement","clientWidth","tooltipYpos","scrollTop","setTimeout","left","top","async","hookDocument","_unused","objectsToGet","statsToGet","_legacy_effectErrorStore","objId_raw","elementsWithThisId","objId","addEventListener","showTooltipFor","display","Promise","all","key","inflator","cache","objects","visibleIndex","statSetId","parts","computeAttributeFromMods","target_type","completeSources","mods","selectedWeaponSet","modCap","effect_id","effect","specificMod","specificParts","generateAttributeTooltip","tt","initialAPIObject","objectChain","adjustTraitedSkillIds","addObjectsToChain","currentObj","hasChain","notCollapsable","find","p","VALID_CHAIN_PALETTES","nextSkillInChain","subSkillInChain","petSkillId","petSkill","weaponSet","tooltipChain","slottedItems","statSet","countPrefix","upgradeNameSource","rarity","toLowerCase","maxRarity","Rarity","Legendary","Common","Uncommon","Rare","Exotic","LUT_RARITY","avg","isPlayer","LUT_POWER_PLAYER","LUT_POWER_MONSTER","mul","LUT_RARITY_MUL","spread","ceil","line","damage_type","generateUpgradeItemGroup","s","slottedItemIdx","findIndex","slottedItem","splice","group","prepend","metaInfo","weight","isTwoHanded","required_level","salvageOptions","vendor_value","formatCoins","generateItemTooltip","apiObject","headerElements","currentContextInformation","resolveTraitsAndOverrides","activation","ACTIVATION","resource_cost","RESOURCE_REV","RESOURCE_THIEF","endurance_cost","ENDURANCE_COST","upkeep_cost","UPKEEP_COST","recharge","RECHARGE","supply_cost","SUPPLY_COST","secondHeaderRow","slotName","skillSlot","weapon_type","replace","hand","digit","getSlotName","baseContext","override","delete","splits","o","splits_html","criteria","relevantPalette","palette_type","BundleLarge","Standard","Focus","Shield","Torch","Warhorn","Greatsword","Hammer","Staff","BowLong","Rifle","BowShort","Axe","Sword","Dagger","Pistol","Scepter","Mace","Spear","Speargun","Trident","getWeaponStrength","looseBlock","remainingBlocks","totalDefianceBreak","makeFactElements","sort","b","order","trait_requirements","blockFacts","defianceWrap","DEFIANCE_BREAK","generateFacts","generateToolTip","generateToolTipList","g","result","end","blockId","baseBlock","overrideBlock","insert_before","finalBlocks","finalFacts","traitId","altId","adjustIncorrectStatIds","similar_sets","correctSetId","newSet","tier_wrap","flexDirection","modifierValue","colorClass","generateHtml","weaponStats","isComputed","base","baseAttrValue","attrValue","statBonus","statSources","concat","modValue","valueAndAdditiveMods","uncappedValue","MAX_VAL","_p2","Guardian","Thief","Elementalist","Engineer","Ranger","Mesmer","Revenant","Necromancer","Warrior","getBaseHealth","recomputeCharacterAttributes","attributeOrder","upgradeComponent","arg1","arg2","arg3","arg4","trait","traitOverrides","invalid","amount","COIN_COPPER","COIN_SILVER","COIN_GOLD","LifeForce","Stun","createCompleteContext","partialContext","createCompletedBaseStats","createCompletedStats","partialSource","DEFAULT_CONFIG","autoInitialize","autoCollectRuneCounts","autoCollectStatSources","autoCollectSelectedTraits","autoRecomputeCharacterAttributes","autoInferEquipmentUpgrades","autoInferWeaponSetAssociation","SLOT_Upgrade","SLOT_Infusion","SLOT_Enrichment","NO_UNDERWATER","RANGE","WEAPON_SWAP","GW2TooltipsConfig","APIs","body","appendChild","isMobile","test","navigator","userAgent","touch","event","pageX","pageY","node","self","selector","depth","current","matches","findSelfOrParent","preventDefault","scrollHandler","activeTT","scrollHeight","clientHeight","deltaY","detail","touches","clientY","scrollBy","passive","ctrlKey","altKey","log","_constructor","buildNodes","Collect.allTraits","gw2Objects","buildNode","setNode","objNode","skillIdsBySet","setSkillsNode","skillIds","chainIds","descriptionNode","nextElementSibling","skillNode","Collect.allUpgradeCounts","Collect.allStatSources","addModifiers","contextBoundInfo","Collect.traitEffects","targets","wrappers","remainingInfusionsByContext","ctx","c","enrichmentByContext","itemEl","upgradeEls","itemCtx","upgradeIds","u","remainingInfusions","infusionId","enrichment","attrString","inferItemUpgrades"],"mappings":"2CAAO,SAASA,EAAOC,KAASC,GAC5B,MAAOC,KAAQC,GAAWH,EAAKI,MAAM,KAC/BC,EAAKC,SAASC,cAAcL,GAKlC,OAJIC,EAAQK,QACRH,EAAGI,UAAUC,OAAOP,GACpBF,EAAMO,QACNH,EAAGM,UAAUV,GACVI,CACX,CACO,MAAMO,EAAY,6BACnBC,EAAe,6qCACd,SAASC,EAAOC,EAAKC,EAAWC,GACjB,iBAAPF,IACPA,GAAY,QAChB,MAAMG,EAAMZ,SAASC,cAAc,OAKnC,OAJAW,EAAIH,IAAMA,EAAOA,EAAII,SAAS,KAAOJ,EAAMH,EAAYG,EAAOF,EAC1DG,GACAE,EAAIT,UAAUC,IAAIM,GACtBE,EAAID,IAAMA,EAAMA,EAAM,QAAU,OACzBC,CACX,CACO,SAASE,EAASC,GACrB,MAAMC,EAAQhB,SAASC,cAAc,YAErC,OADAe,EAAMC,UAAYF,EACXC,EAAME,OACjB,CACO,MAAMC,EAAe,CAACC,KAASC,IAAeD,EAC/CA,EACGE,WAAW,wBAAyB,sCACpCA,WAAW,wBAAyB,wCACpCA,WAAW,aAAc,KAAKA,WAAW,aAAc,KACvDA,WAAW,SAAU,IACrBA,WAAW,KAAM,UACjBA,WAAW,cAAc,CAACC,EAAGC,IAAMH,GAAYG,EAAI,IAAM,KACzDF,WAAW,KAAM,KACpB,GACOG,EAAqB,CAACL,EAAMM,EAAOC,IAAcP,EACzDE,WAAW,MAAOI,EAAQ,EAAI,IAAM,IACpCJ,WAAW,sBAAuBI,EAAQ,EAAI,KAAO,MACrDJ,WAAW,qBAAuC,UAAjBK,EAAUC,IAAkB,KAAO,MAClE,SAASC,EAAGC,GAAK,OAAOC,EAAgBD,EAAG,EAAK,CAChD,SAASC,EAAgBC,EAAGC,GAC/B,IAAIC,EAAMF,EAAEG,QAAQF,GACpB,KAAsC,MAA/BC,EAAIE,OAAOF,EAAIhC,OAAS,IAC3BgC,EAAMA,EAAIG,MAAM,GAAI,GAGxB,MAFmC,MAA/BH,EAAIE,OAAOF,EAAIhC,OAAS,KACxBgC,EAAMA,EAAIG,MAAM,GAAI,IACjBH,CACX,CACO,SAASI,EAAeC,EAAOC,GAClC,GAAKA,EAAOC,0BAkCR,OAAOV,EAAgBQ,EAAO,GAlCK,CACnC,MAAMG,EAAOH,EAAQ,EAAI,IAAM,GAC/BA,EAAQI,KAAKC,IAAIL,GAEjB,IAAIM,EAAW,GACf,OAFeF,KAAKG,IAAIH,KAAKI,MAAOR,EAAQ,EAAK,GAAI,IAGjD,KAAK,EACL,KAAK,EAEGA,EAAQI,KAAKI,MAAMR,GACnB,MAER,KAAK,EACDA,EAAQI,KAAKK,MAAMT,GACnBM,EAAW,IACX,MAEJ,KAAK,EACDN,EAAQI,KAAKK,MAAMT,GACnBM,EAAW,IACX,MAEJ,KAAK,EACDN,EAAQI,KAAKK,MAAMT,GACnBM,EAAW,IAInB,OAAa,GAATN,GAA0B,IAAZM,EACP,IAEJ,GAAGH,IAAOH,EAAQ,EAAIA,EAAQ,KAAKM,GAC7C,CAIL,CACO,SAASI,EAAUC,GACtB,OAAQA,GACJ,IAAK,oBAAqB,MAAO,qBACjC,IAAK,kBAAmB,MAAO,mBAC/B,IAAK,eAAgB,MAAO,gBAC5B,IAAK,UAAW,MAAO,UACvB,IAAK,WAAY,MAAO,WACxB,IAAK,eAAgB,MAAO,0BAC5B,IAAK,YAAa,MAAO,aACzB,IAAK,aAAc,MAAO,kBAC1B,IAAK,aAAc,MAAO,kBAC1B,IAAK,eAAgB,MAAO,gBAC5B,QAAS,OAAOA,EAExB,CASO,SAASC,EAAaC,EAAOC,GAAa,GAG7C,OAFIA,IACAD,EAAQA,EAAME,KAAIC,GAAK,IAAIA,QACvBH,EAAMlD,QACV,KAAK,EAAG,MAAO,GACf,KAAK,EAAG,OAAOkD,EAAM,GACrB,QACI,MAAMI,EAAOJ,EAAMA,EAAMlD,OAAS,GAClC,OAAOkD,EAAMf,MAAM,GAAI,GAAGoB,KAAK,MAAQD,EAEnD,CCzGO,MAAME,EACT,WAAAC,CAAYC,EAAU,+BAClBC,KAAKD,QAAUA,CAClB,CACD,iBAAME,CAAYC,EAAUC,GACxB,OAAOC,MAAM,GAAGJ,KAAKD,WAAWG,SAAgBC,EAAIP,KAAK,QAAQS,MAAKC,GAAKA,EAAEC,QAChF,8CArBE,MACH,WAAAT,GACIE,KAAKQ,MAAQ,IAAIX,EAAM,yBACvBG,KAAKS,SAAW,IAAIZ,CACvB,CACD,iBAAMI,CAAYC,EAAUC,GACxB,IACI,aAAaH,KAAKQ,MAAMP,YAAYC,EAAUC,EACjD,CACD,MAAOO,GAEH,OADAC,QAAQC,KAAK,oDAAoDV,yDAAgEQ,WACpHV,KAAKS,SAASR,YAAYC,EAAUC,EACpD,CACJ,aCbL,MAAMU,EACF,4BAAaC,CAAgBZ,EAAUa,GAC9Bf,KAAKgB,UACNhB,KAAKgB,QAAU,IAAInB,GAEvB,IAAIoB,EAAgBC,OAAOC,OAAO,CAC9BC,OAAQ,IAAIC,IACZC,MAAO,IAAID,IACXE,OAAQ,IAAIF,IACZG,KAAM,IAAIH,IACV,cAAe,IAAIA,IACnBI,gBAAiB,IAAIJ,IACrBK,UAAW,IAAIL,KAChB,CAAEnB,CAACA,GAAW,IAAImB,IAAIN,KACzB,MAAMY,EAA2B,KAC7B,IAAK,MAAOzB,EAAUC,KAAQe,OAAOU,QAAQX,GACzC,GAAId,EAAI0B,KAAO,EACX,OAAO3B,CACC,EAEpB,IAAI4B,EAAkB5B,EAClBvC,EAAI,EACR,EAAG,CACC,MAAMoE,EAAa/B,KAAKgC,QAAQF,GAC1BG,EAAUC,MAAMC,KAAKlB,EAAca,GAAiBM,UAC1DnB,EAAca,GAAiBO,QAC/B1B,QAAQ2B,KAAK,qCAAqC3E,aAAauC,iCAAwC4B,WAA0BG,GACjI,IACI,MAAMM,QAAiBvC,KAAKgB,QAAQf,YAAY6B,EAAiBG,GAC3DO,EAAeP,EAAQQ,QAAOC,IAAOH,EAASI,MAAKC,GAAOA,EAAIF,IAAMA,MACtEF,EAAanG,QACbsE,QAAQC,KAAK,4DAA4DkB,mBAAkCU,GAC/G,IAAK,MAAMK,KAASN,EACZR,EAAWe,IAAID,EAAMH,MAEzBX,EAAWgB,IAAIF,EAAMH,GAAIG,GACzB7C,KAAKgD,oBAAoB,CAAE9C,SAAU4B,EAAiBe,SAAS5B,GAEtE,CACD,MAAOP,GACHC,QAAQsC,MAAMvC,EACjB,CACJ,QAASoB,EAAkBH,MAA+BhE,EAAI,IAClE,CACD,0BAAOqF,EAAoB9C,SAAEA,EAAQ2C,MAAEA,GAASK,GAC5C,MAAMC,EAAYC,IACd,IAAK,MAAMC,KAAQD,EACE,QAAbC,EAAKhE,MAA+B,aAAbgE,EAAKhE,MACvBW,KAAKgC,QAAQZ,OAAO0B,IAAIO,EAAKC,OAC9BJ,EAAoB9B,OAAO7E,IAAI8G,EAAKC,MAE1B,sBAAdD,EAAKhE,MAA8C,iBAAdgE,EAAKhE,OACrCW,KAAKgC,QAAQZ,OAAO0B,IAAIO,EAAKE,SAC9BL,EAAoB9B,OAAO7E,IAAI8G,EAAKE,QACnCvD,KAAKgC,QAAQZ,OAAO0B,IAAIO,EAAKC,OAC9BJ,EAAoB9B,OAAO7E,IAAI8G,EAAKC,MAE/C,EAEL,GAAI,aAAcT,EACd,IAAK,MAAMW,KAAWX,EAAMY,SACxB,IAAK,MAAMC,KAAQF,EAAQG,MAIvB,GAHID,EAAKE,YAAcF,EAAKG,aAAe7D,KAAKgC,QAAQV,MAAMwB,IAAIY,EAAKG,aACnEX,EAAoB9B,OAAO7E,IAAImH,EAAKG,YAEpCH,EAAKI,qBACL,IAAK,MAAOpG,EAAGqG,KAAYL,EAAKI,qBACvB9D,KAAKgC,QAAQZ,OAAO0B,IAAIiB,IACzBb,EAAoB9B,OAAO7E,IAAIwH,GAKvD,GAAI,mBAAoBlB,EACpB,IAAK,MAAMmB,KAAYnB,EAAMoB,eACpBjE,KAAKgC,QAAQZ,OAAO0B,IAAIkB,IACzBd,EAAoB9B,OAAO7E,IAAIyH,GAE3C,GAAI,WAAYnB,EACZ,IAAK,MAAMqB,KAASrB,EAAMsB,OAClBD,EAAMd,OACND,EAASe,EAAMd,OAE3B,GAAI,oBAAqBP,EACrB,IAAK,MAAMsB,OAAEA,KAAYtB,EAAMuB,gBAC3B,GAAID,EACA,IAAK,MAAMD,KAASC,EACZD,EAAMd,OACND,EAASe,EAAMd,OAMnC,GAJI,kBAAmBP,IACd7C,KAAKgC,QAAQN,UAAUoB,IAAID,EAAMwB,gBAClCnB,EAAoBxB,UAAUnF,IAAIsG,EAAMwB,gBAE5C,WAAYxB,EACZ,IAAK,MAAMyB,KAAczB,EAAMzB,OACtBpB,KAAKgC,QAAQZ,OAAO0B,IAAIwB,IACzBpB,EAAoB9B,OAAO7E,IAAI+H,GAE3C,GAAI,cAAezB,EACf,IAAK,MAAMyB,KAAczB,EAAM0B,UACtBvE,KAAKgC,QAAQZ,OAAO0B,IAAIwB,IACzBpB,EAAoB9B,OAAO7E,IAAI+H,GAE3C,GAAI,qBAAsBzB,EACtB,IAAK,MAAMyB,KAAczB,EAAM2B,iBACtBxE,KAAKgC,QAAQZ,OAAO0B,IAAIwB,IACzBpB,EAAoB9B,OAAO7E,IAAI+H,GAEvC,mBAAoBzB,IACf7C,KAAKgC,QAAQP,gBAAgBqB,IAAID,EAAM4B,iBACxCvB,EAAoBzB,gBAAgBlF,IAAIsG,EAAM4B,gBAEzD,ECjHE,SAASC,GAAkBC,QAAEA,EAAOC,YAAEA,EAAaC,eAAgBC,EAAaC,eAAEA,IAAkBC,MAAEA,EAAOC,OAAS7C,QAAQ8C,MAAEA,EAAKC,gBAAEA,EAAeC,aAAEA,MAC3J,OAAQT,GACJ,IAAK,kBAYL,IAAK,mBACL,IAAK,oBACD,OAAOK,EAAQF,EAAgBF,EAZnC,IAAK,kBACD,OAAOI,EAAQF,EAAgBF,EAAcO,EAAkBJ,EACnE,IAAK,yBACD,OAAOC,EAAQA,EAAQF,EAAgBF,EAAcO,EAAkBJ,EAC3E,IAAK,YACD,OAAOH,EACX,IAAK,eACD,OAAOI,EAAQF,EAAgBF,EAAcQ,EAAeL,EAChE,IAAK,sBACD,OAAOC,EAAQA,EAAQF,EAAgBF,EAAcQ,EAAeL,EAIxE,IAAK,oBACD,OAAOC,EAAQF,EAAgBF,EAAcG,EACjD,IAAK,QACD,OAAOC,EAAQF,EAAgBF,EAAcM,EAAQH,EACzD,IAAK,eACD,OAAOC,EAAQA,EAAQF,EAAgBF,EAAcM,EAAQH,EAGrE,OADApE,QAAQC,KAAK,4DAA6D+D,EAAS,gCAC5EC,CACX,CAiCO,SAASS,EAAahC,EAAMiC,EAAiBC,GAChD,IAAIC,EAAWnC,EAAKoC,KAChBC,EAAgB,EAChBC,EAAetC,EAAKuC,SACpBC,EAAuBxC,EAAKyC,eAChC,MAAMC,EAA0B,CAACzC,EAAMD,EAAMuC,EAAUI,KACnD,IAAIC,EAAY,GAChB,GAAI3C,EAAK4C,YAAc5C,EAAK6C,kBAAmB,CAC3C,MAAMC,EAAoB9C,EAAK4C,UAAUzD,QAAO4D,KAAeA,EAASC,WAAaf,EAAQzH,UAAUyD,OAAOvE,SAASqJ,EAASC,eACvHD,EAASE,MAAQF,EAASE,OAAShB,EAAQiB,YACpD,IAAIC,EAAU,IAAIC,IAClB,IAAK,IAAI/I,EAAI,EAAGA,EAAIyI,EAAkB/J,OAAQsB,IAAK,CAC/C,MAAM0I,EAAWD,EAAkBzI,GACnC,IAAIgJ,EAAQF,EAAQG,IAAIP,EAAS3D,KAAO+D,EAAQ1D,IAAIsD,EAAS3D,GAAI,CAAE2D,SAAUA,EAAU3H,MAAO,IAAKkI,IAAIP,EAAS3D,IAC5GhE,EAAQgG,EAAkB2B,EAAUd,EAAQzH,WAC5CuI,EAASQ,uBACTnI,GAASoI,EAAkBvB,EAAQzH,UAAWuI,EAASQ,uBAE3DF,EAAMjI,OAASA,EACX2H,EAASU,MAAM/J,SAAS,kBACxBW,GAEP,CACD,IAAK,IAAIe,MAAEA,EAAK2H,SAAEA,KAAcI,EAAQrE,SAAU,CAC1CiE,EAASU,MAAM/J,SAAS,cACxB0B,GAAS,KAET2H,EAASU,MAAM/J,SAAS,mBACxB4I,GAAY,IACRS,EAASU,MAAM/J,SAAS,oBACxB4I,GAAY,GAEZS,EAASU,MAAM/J,SAAS,qBACxB4I,GAAY,IAEhBlH,GAASkH,GAAY,GAEpBS,EAASU,MAAM/J,SAAS,iBACzB0B,GAAS2E,EAAK2D,aAEdX,EAAS1B,QAAQ3H,SAAS,kBAC1B0B,GAASsH,GACb,IAAIiB,EAAWZ,EAASU,MAAM/J,SAAS,kBACjCyB,EAAeC,EAAOC,UACtBG,KAAKK,MAAML,KAAKoI,OAAOxI,IAAQyI,WACjCd,EAASU,MAAM/J,SAAS,mBACpB0B,EAAQ,IACRuI,EAAW,IAAMA,GAErBA,GAAY,KAEhBA,GAAY,IAAMZ,EAASe,YAC3BnB,EAAUoB,KAAKJ,EAClB,CACJ,CACD,OAAO3J,EAAagG,EAAK6C,mBAAqBF,EAAUrG,KAAK,OAAS0D,EAAK8D,YAAY,EAErFE,EAAY,CAACC,EAAcjE,EAAMkE,KACnC,IAAIC,EAAS,EAAGzB,EAAW,EAAG0B,EAAMC,OAAOC,iBAC3C,MAAMC,EAAkC,QAAlBvE,EAAKwE,UAAuB,eAAsC,aAAlBxE,EAAKwE,WAA4B,oBACvG,GAAID,EAAc,CACd,MAAME,cAAEA,EAAaC,IAAEA,EAAKN,IAAKO,GAASC,EAAwBL,EAActC,EAAQzH,WACxF4J,EAAMO,EACN,MAAME,EAAYrB,EAAkBvB,EAAQzH,UAAWiK,GACvDN,GAAUU,EAAYH,EAClBG,EAAY,GAAKxJ,EAAMA,OAACyJ,4BACxBZ,EAAYH,KAAK,kBAAkBrJ,EAAGuJ,EAAe,SACrDC,EAAYH,KAAK,IAAIrJ,EAAGuJ,EAAe,IAAOY,EAAYH,QAAUhK,EAAGmK,EAAYH,EAAM,eAAehK,EAAGmK,MAAcJ,MAE7H,IAAK,MAAMM,KAAUC,EAAe/C,EAAQzH,UAAW+J,GAAe,CAClE,IAAIU,EAAM7D,EAAkB2D,EAAOhC,SAAUd,EAAQzH,WAAauK,EAAOxK,MACzE,MAAM2K,EAAcH,EAAOhC,SAASU,MAAM/J,SAAS,iBAAmB,IAAM,GACtEyL,EAAaD,EAAc,IAAM,EACvCD,GAAOE,EACPhB,GAAUc,EACV,MAAMG,EAAQF,EAAcD,EAAMhB,EAAegB,EACjD,GAAI5J,EAAAA,OAAOyJ,0BAA2B,CAClC,IAAI7K,EAAO,KAAKS,EAAG0K,EAAQ,QACvBF,IACAjL,GAAQ,KAAKS,EAAGuK,EAAME,QAC1BlL,GAAQ,SACJ8K,EAAOxK,MAAQ,IACfN,GAAQ,GAAG8K,EAAOxK,UACtBN,GAAQ8K,EAAOA,OACfb,EAAYH,KAAKzL,EAAO,aAAcqB,EAASW,EAAmBL,EAAM8K,EAAOxK,MAAO0H,EAAQzH,aACjG,CACJ,CACJ,CACD,IAAI6K,EAAcL,EAAe/C,EAAQzH,UAAWwF,EAAKZ,IACzD,GAAIiG,EAAYtM,OAAQ,CACL,IAAXoL,GAAgB9I,EAAAA,OAAOyJ,2BACvBZ,EAAYH,KAAK,kBAAkBrJ,EAAGuJ,EAAe,SACzD,IAAIqB,EAAa,EACjB,IAAK,MAAMP,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAW8K,EAAa,CACnD,MAAMJ,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAC5Ca,EAAMA,OAACyJ,2BACPZ,EAAYH,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACvK8K,GAAcL,CACjB,CACDd,GAAUmB,EAAa,GAC1B,CACD,MAAMC,EAAcpB,EAMpB,GALAA,EAAS3I,KAAKG,IAAI4J,EAAanB,GAC3BD,GAAUoB,GAAelK,EAAMA,OAACyJ,2BAChCZ,EAAYH,KAAKzL,EAAO,cAAe,cAAcoC,EAAGuJ,EAAe,IAAOG,mCAAqC1J,EAAGuJ,EAAe,IAAOsB,SAEhJtB,GAAgBE,EACZnE,EAAKwF,KAAK9L,SAAS,gBAAiB,CACpC,IAAI+L,EAAgBxD,EAAQzH,UAAUmH,MAAM+D,QAAQC,kBACpD,GAAIF,EAAc1M,OAAQ,CAClBsC,EAAMA,OAACyJ,2BACPZ,EAAYH,KAAK,4BACrB,IAAIuB,EAAa,EACjB,IAAK,MAAMP,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAWkL,EAAe,CACrD,MAAMR,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAC5Ca,EAAMA,OAACyJ,2BACPZ,EAAYH,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACvK8K,GAAcL,CACjB,CACDvC,GAAY4C,EAAa,GAC5B,CACJ,CACD,MAAO,CAACrB,EAAcvB,EAAS,EAE7BkD,EAAgB,CAClBC,iCAAkC,EAAG9F,WACjC,IAAI+F,EACJ,IAAI1K,GAAS2E,EAAK3E,MAAQ6G,EAAQzH,UAAUkH,OAAS3B,EAAKgG,eAAiBhG,EAAKiG,kBAAoBjG,EAAKkG,UACrGC,EAAe,EACfnG,EAAKoG,YACLD,EAAe1C,EAAkBvB,EAAQzH,UAAWuF,EAAKoG,WACzD/K,GAAS8K,EAAenG,EAAKqG,qBAAuBrG,EAAKkG,WAE7D,MAAMI,EAAQ,GAUd,GATIhL,EAAAA,OAAOyJ,4BACPuB,EAAMtC,KAAK,GAAGrJ,EAAGqF,EAAK3E,qBAClB2E,EAAKiG,kBACLK,EAAMtC,KAAK,KAAKrJ,EAAGuH,EAAQzH,UAAUkH,OAAS3B,EAAKgG,eAAiBhG,EAAKiG,8BAA8B/D,EAAQzH,UAAUkH,WAAWhH,EAAGqF,EAAKgG,8BAA8BrL,EAAGqF,EAAKiG,8BAClLjG,EAAKoG,WACLE,EAAMtC,KAAK,KAAKrJ,EAAGwL,EAAenG,EAAKqG,8BAA8B1L,EAAGwL,MAAiBpK,EAAUiE,EAAKoG,gBAAgBzL,EAAGqF,EAAKqG,sCAC9G,GAAlBrG,EAAKkG,WACLI,EAAMtC,KAAK,MAAMhE,EAAKkG,qBAEH,QAApBH,EAAK/F,EAAK9F,YAAyB,IAAP6L,OAAgB,EAASA,EAAGpM,SAAS,YAAa,CACjF,IAAI4L,EAAa,IACjB,IAAK,MAAMP,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAWyK,EAAe/C,EAAQzH,UAAW,qBAAsB,CAC9F,MAAMyK,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAC5Ca,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACjK8K,GAAcL,CACjB,CACD7J,GAASkK,EAAa,GACzB,CAED,OADAe,EAAMC,QAAQ,GAAGtM,EAAa+F,EAAK9F,OAAS6B,EAAUiE,EAAKoG,eAAe3K,KAAKI,MAAMR,MAC9EiL,CAAK,EAEhBE,gBAAiB,EAAGxG,WAChB,MAAM3E,EAAQI,KAAKI,OAAOmE,EAAKyG,MAAM,GAAKzG,EAAKyG,MAAM,KAAOvE,EAAQzH,UAAUkH,MAAQ,IAAM3B,EAAKyG,MAAM,IACjGjL,EAAOH,EAAQ,EAAI,IAAM,GAE/B,MAAO,CAAC,GADKpB,EAAa+F,EAAK9F,OAAS6B,EAAUiE,EAAK0G,YACnClL,IAAOH,IAAQ,EAEvCsL,KAAM,EAAG3G,OAAMC,WACNA,GACD3C,QAAQsC,MAAM,0CAA2CI,EAAKC,KAAM,uCAExEkC,GADAlC,EAAOA,GAAQ2G,GACCxE,MAAQD,EACxB,MAAMmE,EAAQ,GACd,IAAI3D,GACHL,EAAcK,GAAYsB,EAAUjE,EAAKuC,SAAUtC,EAAMqG,GAC1D,IAAIO,EAAkBnE,EAAwBzC,EAAMD,EAAMsC,EAAcK,GACpEkE,IACAA,EAAkB,KAAKA,KAE3B,MAAMC,EAAUxE,EAAe,EAAI,IAAIlH,EAAekH,EAAe,IAAMhH,EAAMA,YAAQ,GAGzF,OAFAgL,EAAMC,QAAQ,GAAGtM,EAAa+F,EAAK9F,OAAS+F,EAAK8G,YAAc9G,EAAKwF,QAAQqB,IAAUD,KACtFxE,EAAgBrC,EAAK2D,YACd2C,CAAK,EAEhBU,UAAW,EAAGhH,OAAMC,WACXA,GACD3C,QAAQsC,MAAM,0CAA2CI,EAAKC,KAAM,uCAExEkC,GADAlC,EAAOA,GAAQ2G,GACCxE,MAAQD,EACjB,CAAC,GAAGlI,EAAa+F,EAAK9F,KAAM+F,EAAKwF,UAE5CwB,SAAU,EAAGjH,UACF,CAAC,GAAG/F,EAAa+F,EAAK9F,UAAUuB,KAAKI,MAAMmE,EAAKkH,aAE3DC,oBAAqB,EAAGnH,WACpB,IAAI3E,EAAQ2E,EAAK3E,MAAQ2E,EAAKkG,UAC1BlG,EAAKoG,YACL/K,GAASoI,EAAkBvB,EAAQzH,UAAWuF,EAAKoG,WAAapG,EAAKqG,sBAGzE,MAAO,CAAC,GADKpM,EAAa+F,EAAK9F,OAAS6B,EAAUiE,EAAKoG,eACnC/K,IAAQ,EAEhCiJ,OAAQ,EAAGtE,MAAQ9F,OAAMmB,aACrB,MAAMiL,EAAQ,GACd,GAAI9D,GAAwBtI,GAAQA,EAAKP,SAAS,YAAa,CAC3D,MAAMkJ,EAAYoC,EAAe/C,EAAQzH,UAAW,QACpD,GAAIoI,EAAU7J,OAAQ,CACdsC,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAK,GAAGrJ,EAAGU,iBACrB,IAAIkK,EAAa,IACjB,IAAK,MAAMP,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAWqI,EAAW,CACjD,MAAMqC,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAC5Ca,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACjK8K,GAAcL,CACjB,CACD,MAAMA,EAAMK,EAAa,IACzBlK,GAAS6J,EACT1C,GAAwB0C,CAC3B,CACJ,CAED,OADAoB,EAAMC,QAAQ,GAAGtM,EAAaC,OAAUkB,EAAeC,EAAOC,aACvDgL,CAAK,EAEhBc,QAAS,EAAGpH,UACD,CAAC,GAAG/F,EAAa+F,EAAK9F,UAAUkB,EAAe4E,EAAKqH,QAAS/L,EAAMA,YAE9EgM,cAAe,EAAGtH,UACP,CAAC,GAAG/F,EAAa+F,EAAK9F,UAAUkB,EAAe4E,EAAKqH,QAAS/L,EAAMA,YAE9EiM,uBAAwB,EAAGvH,MAAQqH,UAASnN,YACxC,MAAMsN,EAAS/D,EAAkBvB,EAAQzH,UAAW,UAC9C6L,EAAQ,GACRzD,EAAYoC,EAAe/C,EAAQzH,UAAW,aACpD,GAAIoI,EAAU7J,OAAQ,CACdsC,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAK,GAAGrJ,EAAG0M,EAAUG,EAAS,aAAc7M,EAAG0M,UAAgB1M,EAAG6M,2BAC5E,IAAIjC,EAAa,IACjB,IAAK,MAAMP,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAWqI,EAAW,CACjD,MAAMqC,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAC5Ca,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACjK8K,GAAcL,CACjB,CACDmC,GAAW9B,EAAa,GAC3B,CACD,IAAIkC,EAAMhM,KAAKI,MAAe,IAAT2L,EAAgBH,EAAU,KAE/C,OADAf,EAAMC,QAAQ,GAAGtM,EAAaC,OAAUkB,EAAeiM,EAAS/L,EAAMA,aAAOmM,MACtEnB,CAAK,EAEhBoB,cAAe,EAAG1H,MAAQqH,UAASnN,YAC/B,MAAMuN,EAAMhM,KAAKI,MAAM4H,EAAkBvB,EAAQzH,UAAW,UAAY4M,EAAU,KAClF,MAAO,CAAC,GAAGpN,EAAaC,OAAUkB,EAAeiM,EAAS/L,EAAMA,aAAOmM,KAAO,EAElFE,gBAAiB,EAAG3H,MAAQqH,UAASnN,YACjC,MAAMsN,EAAS/D,EAAkBvB,EAAQzH,UAAW,UAC9C6L,EAAQ,GACRzD,EAAYoC,EAAe/C,EAAQzH,UAAW,aACpD,GAAIoI,EAAU7J,OAAQ,CACdsC,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAK,GAAGrJ,EAAa,IAAV0M,EAAiBG,EAAS,aAAc7M,EAAG0M,UAAgB1M,EAAG6M,2BACnF,IAAIjC,EAAa,IACjB,IAAK,MAAMP,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAWqI,EAAW,CACjD,MAAMqC,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAC5Ca,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACjK8K,GAAcL,CACjB,CACDmC,GAAW9B,EAAa,GAC3B,CACD,IAAIkC,EAAMhM,KAAKI,MAAe,IAAT2L,EAAgBH,EAAU,KAE/C,OADAf,EAAMC,QAAQ,GAAGtM,EAAaC,OAAUkB,EAAeiM,EAAS/L,EAAMA,aAAOmM,MACtEnB,CAAK,EAEhBsB,OAAQ,EAAG5H,MAAQ6H,iBAAgB3B,YAAWhM,QAAQ4N,qBAClD,MAAMxB,EAAQ,GACRyB,EAAQtE,EAAkBvB,EAAQzH,UAAW,SACnD,IAAIuN,EAASH,EAAiB3B,EAAY4B,EAAiBC,EAAQ7F,EAAQ+F,YACvE3M,EAAAA,OAAOyJ,4BACPuB,EAAMtC,KAAK,GAAGrJ,EAAGqN,WAAgBrN,EAAGkN,sBAAmClN,EAAGoN,cAAkBD,wBAAqC5F,EAAQ+F,4BACxH,GAAb/B,GACAI,EAAMtC,KAAK,KAAKkC,WAExB,MAAMgC,EAAYzE,EAAkBvB,EAAQzH,UAAW,aACjD0N,EAAW1E,EAAkBvB,EAAQzH,UAAW,YAChD2N,EAAa3M,KAAKG,IAAI,KAAQsM,EAAY,KAAQ,GAAK,IAAM,GAC7DG,EAAa,IAAMF,EAAW,GAAK,IACnCG,EAAkBN,EAASI,GAAcC,EAAa,GAC5DL,GAAUM,EACNhN,EAAAA,OAAOyJ,2BACPuB,EAAMtC,KAAK,IAAIrJ,EAAG2N,OAAqB3N,EAAGyN,GAAcC,EAAa,GAAK,eAAe1N,EAAgB,IAAbyN,uBAAsCzN,EAAgB,IAAb0N,uBAAsC1N,EAAGuN,oBAA4BvN,EAAGwN,gBAEjN,MAAMtF,EAAYoC,EAAe/C,EAAQzH,UAAW,UACpD,GAAIoI,EAAU7J,OAAQ,CAClB,IAAIuM,EAAa,IACjB,IAAK,MAAMP,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAWqI,EAAW,CACjD,MAAMqC,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAC5Ca,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACjK8K,GAAcL,CACjB,CACD8C,GAAUzC,EAAa,GAC1B,CACD,MAAMgD,EAAQrC,EAAY,EAAI,IAAIA,MAAgB,GAElD,OADAI,EAAMC,QAAQ,GAAGtM,EAAaC,KAAQqO,MAAU9M,KAAKI,MAAMmM,MACpD1B,CAAK,EAEhBkC,KAAM,EAAGxI,MAAQ9F,YACb,MAAMoM,EAAQ,GACd,GAAI9D,GAAwBtI,IAASA,EAAKP,SAAS,SAAWO,EAAKP,SAAS,SACrEO,EAAKP,SAAS,aAAc,CAC/B,MAAMkJ,EAAYoC,EAAe/C,EAAQzH,UAAW,QACpD,GAAIoI,EAAU7J,OAAQ,CACdsC,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAK,GAAGrJ,EAAG2H,EAAe,uBACpC,IAAIiD,EAAa,IACjB,IAAK,MAAMP,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAWqI,EAAW,CACjD,MAAMqC,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAC5Ca,EAAMA,OAACyJ,2BACPuB,EAAMtC,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACjK8K,GAAcL,CACjB,CACD5C,GAAgBiD,EAAa,GAChC,CACJ,CACD,MAAMkD,EAAuB,KAAhBnG,EAAuB,UAAY,SAEhD,OADAgE,EAAMC,QAAQ,GAAGtM,EAAaC,OAAUkB,EAAekH,EAAe,IAAMhH,EAAAA,WAAWmN,KAChFnC,CAAK,EAEhBoC,WAAY,EAAG1I,UACJ,CAAC,GAAG/F,EAAa+F,EAAK9F,UAAU6B,EAAUiE,EAAK2I,eAE1DC,cAAe,EAAG5I,UACP,CAAC,GAAG/F,EAAa+F,EAAK9F,UAAU6B,EAAUiE,EAAK6I,kBAE1DC,eAAgB,EAAG9I,UACR,CAAC,QAAQjE,EAAUiE,EAAK0G,oCAAoC3K,EAAUiE,EAAKgF,YAAYhF,EAAKqH,YAEvG0B,OAAQ,EAAG/I,UACA,CAAC/F,EAAa+F,EAAK9F,OAE9B8O,aAAc,EAAGhJ,OAAMC,WACnB,IAAIC,EAAS1C,EAASmB,QAAQZ,OAAOwF,IAAIvD,EAAKE,QACzCA,GACD5C,QAAQsC,MAAM,4CAA6CI,EAAKE,OAAQ,uCAC5EA,EAASA,GAAU0G,EACnBzE,EAAWjC,EAAOkC,MAAQD,EACrBlC,GACD3C,QAAQsC,MAAM,0CAA2CI,EAAKC,KAAM,uCACxEA,EAAOA,GAAQ2G,EACf,IAAIrE,SAAEA,EAAQoB,YAAEA,EAAWzJ,KAAEA,GAAS8F,EACtC,MAAMiJ,EAAU,GAChB,IAAItG,GACHL,EAAcK,GAAYsB,EAAU1B,EAAUtC,EAAMgJ,GACrD,IAAIpC,EAAkBnE,EAAwBzC,EAAMD,EAAMsC,EAAcK,GACpEkE,IACAA,EAAkB,KAAKA,KAE3B,MAAMC,EAAUxE,EAAe,EAAI,IAAIlH,EAAekH,EAAe,IAAMhH,EAAMA,YAAQ,GACnF4N,EAAO,CAAC3Q,EAAO,WAAY4Q,EAAiBlJ,EAAKmC,KAAMuB,GAAcpL,EAAO,OAAQqB,EAAS,GAAGK,EAAaC,IAAS+F,EAAK8G,YAAc9G,EAAKwF,QAAQqB,IAAUD,QAEtK,OADAqC,EAAKlF,QAAQiF,GACNC,CAAI,EAEfE,kBAAmB,EAAGpJ,OAAMC,WACxB,IAAIC,EAAS1C,EAASmB,QAAQZ,OAAOwF,IAAIvD,EAAKE,QAS9C,OARKA,GACD5C,QAAQsC,MAAM,4CAA6CI,EAAKE,OAAQ,uCAC5EA,EAASA,GAAU0G,EACnBzE,EAAWjC,EAAOkC,MAAQD,EACrBlC,GACD3C,QAAQsC,MAAM,0CAA2CI,EAAKC,KAAM,uCAGjE,CADI1H,EAAO,WAAYe,GAD9B2G,EAAOA,GAAQ2G,GAC2BxE,MAAO7J,EAAO,OAAQ,GAAG0B,EAAa+F,EAAK9F,OAAS+F,EAAK8G,YAAc9G,EAAKwF,SACzG,EAEjB4D,MAAO,EAAGrJ,MAAQpE,MAAK0N,UACZ,CAAC,UAAU1N,EAAM,GAAGA,OAAS0N,IAAQA,KAEhDC,UAAW,IACA,CAAC,gBAIVC,EAAO,CAAExJ,OAAMC,KADRzC,EAASmB,QAAQZ,OAAOwF,IAAIvD,EAAKC,MAAQ,GAC3B6H,eAAgB7F,IACpCwH,KAAcC,GAAmB7D,EAAc7F,EAAKhE,MAAMwN,GAC3DG,EAAUpR,EAAO,YACnByH,EAAK4J,gBACLD,EAAQ1Q,UAAUC,IAAI,0BAE1B,IAAI2Q,EAAgB,EACpB,GAAIrH,EAAsB,CACtB,IAAIsH,EAAwBxH,GAAgB,IACxCyH,EAAc,GACdzH,EAAe,KAAQtC,EAAK9F,OAAS8F,EAAK9F,KAAKP,SAAS,SAAWqG,EAAK9F,KAAKP,SAAS,SAAWqG,EAAK9F,KAAKP,SAAS,UAAYqG,EAAK9F,KAAKP,SAAS,eACnJmQ,EAAwB,IACxBC,EAAc,2BAEgB,KAAzBD,IACLC,EAAc,KAAK/J,EAAKyC,qBAE5BoH,EAAgBrH,EAAuBsH,EAAwB,IAC/DJ,EAAgB1F,KAAKzL,EAAO,sCAAuC,mBAAmBsC,EAAgBgP,EAAe,KAAKE,KAC7H,CACD,GAAI/J,EAAK4J,eAAgB,CACrB,MAAMI,EAAc/N,EAAa+D,EAAK4J,eAAexN,KAAIiD,IAAQ,IAAI0G,EAAI,MAAO,0CAAqF,QAA1CA,EAAKvI,EAASmB,QAAQT,OAAOqF,IAAIlE,UAAwB,IAAP0G,OAAgB,EAASA,EAAGN,OAASpG,WAAY,KAC9NqK,EAAgBnD,QAAQ3M,EAAS,wBAAwBoG,EAAKiK,UAAY,aAAe,4BAA0D,GAA9BjK,EAAK4J,eAAe5Q,OAAc,GAAK,OAAOgR,YACtK,CAGD,OAFAL,EAAQxQ,OAAOgQ,EAAiBhH,EAAUE,IAC1CsH,EAAQxQ,OAAOZ,EAAO,MAAOA,EAAO,OAA4B,iBAAbkR,GAAyBA,EAAU9P,SAAS,KAAOC,EAAS6P,GAAaA,MAAeC,EAAgBtN,KAAI8N,GAAiB,iBAALA,EAAgB3R,EAAO,cAAe2R,GAAKA,MAC/M,CAAEP,UAASlH,eAAgBoH,EACtC,CACO,SAASV,EAAiB/G,EAAM+H,EAAY,GAC/C,MAAMzQ,EAAMJ,EAAO8I,GACnB,GAAiB,GAAb+H,EACA,OAAOzQ,EAEN,CACD,MAAM0Q,EAAO7R,EAAO,gBAAiBmB,GAErC,OADA0Q,EAAKC,aAAa,QAASC,OAAOH,IAC3BC,CACV,CACL,CDxWA5M,EAASmB,QAAU,CACfZ,OAAQ,IAAIsF,IACZpF,MAAO,IAAIoF,IACXnF,OAAQ,IAAImF,IACZlF,KAAM,IAAIkF,IACV,cAAe,IAAIA,IACnBjF,gBAAiB,IAAIiF,IACrBhF,UAAW,IAAIgF,KAGnBkH,OAAO/M,SAAWA,EC+VX,MAAMoJ,EAAe,CACxBvH,GAAI,EACJoG,KAAM,eACN1B,YAAa,2CACbyG,WAAY,GAAIpK,SAAU,GAAIyC,UAAW,IAEhC4H,EAAgB,CACzBpL,GAAI,EACJoG,KAAM,gBACN1B,YAAa,4CACbyG,WAAY,GAAIpK,SAAU,GAAIyC,UAAW,ICtetC,SAAS6H,EAAiBC,EAAOzH,EAAO,GAC3C,MAAM0H,EAAWD,EAAME,qBAAqB,aAC5C,IAAK,MAAMC,KAAQC,EAASxM,UAAW,CACnC,MAAMyM,EAAkBnM,MAAMC,KAAK8L,GAAUxL,QAAO6L,KAAOX,OAAOW,EAAEC,aAAa,gBAAkB,IAAMJ,EAAK,KAC1GE,EAAgBhS,QAChBmS,KAAkBL,EAAME,EAAiB9H,EAChD,CACD,MAAMkI,EAAkBvM,MAAMC,KAAK8L,GAAUxL,QAAO6L,KAAOX,OAAOW,EAAEC,aAAa,gBAAkB,IAAMH,EAAS/R,SAC9GoS,EAAgBpS,QAChBsE,QAAQC,KAAK,kDAAmDoN,EAAO,4BAA6BS,EAE5G,CAIA,SAASD,EAAeE,EAAcC,EAAeV,EAAU1H,GAC3D,IAAI6C,EAAIwF,EAAIC,EAAIC,EAChB,MAAMC,EAAS,CAAA,EACf,IAAK,MAAMC,KAAWf,EAAU,CAC5B,IAAIvL,EACJ,GAAqC,SAAjCsM,EAAQT,aAAa,WAAwB7L,GAAMiL,OAAOqB,EAAQT,aAAa,WAC/E,SACJ,MAAMU,EAAOpO,EAASmB,QAAQV,MAAMsF,IAAIlE,GACxC,IAAKuM,KAAU,YAAaA,KAAW,CAAC,OAAQ,YAAYjS,SAASiS,EAAKC,SACtE,SACJ,IAAIC,EAAc,EAClB,GAAoB,YAAhBF,EAAKC,QAAuB,CAC5B,KAAMC,GAAexB,OAAOqB,EAAQT,aAAa,YACzC5P,EAAAA,OAAOyQ,sBACPD,EAAcE,EAAyBL,IAClCG,GACD,SAGZ,IAAKA,EAAa,CACdxO,QAAQC,KAAK,yFAA0FoO,EAAS,yDAChH,QACH,CACJ,KACkC,OAA1BL,EAAcnI,UAAqC,QAAhByI,EAAKC,UAC7CC,EAAc,GAElBJ,EAAOE,EAAKvM,KAAOqM,EAAOE,EAAKvM,KAAO,GAAKyM,CAC9C,CACD,OAAQ5I,GACJ,KAAK,EACDoI,EAAc7Q,UAAUwR,cAAgBP,EACxC,MACJ,KAAK,EACDJ,EAAc7Q,UAAUwR,cAAgBpO,OAAOC,OAAOwN,EAAc7Q,UAAUwR,cAAeP,GAC7F,MACJ,KAAK,EAEOnB,OAAO2B,8BAA8BrN,MACrCyM,EAAc7Q,UAAUwR,cAAgBpO,OAAOC,OAAO4N,EAAqE,QAA5D3F,EAAKwE,OAAO2B,mBAAmBb,GAAc5Q,iBAA8B,IAAPsL,OAAgB,EAASA,EAAGkG,eAE1J1B,OAAO2B,mBACZZ,EAAc7Q,UAAUwR,cAAgBpO,OAAOC,OAAO4N,EAAuD,QAA9CH,EAAKhB,OAAO2B,mBAAmBzR,iBAA8B,IAAP8Q,OAAgB,EAASA,EAAGU,eAGjJX,EAAc7Q,UAAUwR,cAAgBP,EAGhD,MACJ,KAAK,EAEOnB,OAAO2B,8BAA8BrN,MACrCyM,EAAc7Q,UAAUwR,cAAgBpO,OAAOC,OAAO,CAAA,EAAiE,QAA5D0N,EAAKjB,OAAO2B,mBAAmBb,GAAc5Q,iBAA8B,IAAP+Q,OAAgB,EAASA,EAAGS,cAAeP,GAErKnB,OAAO2B,mBACZZ,EAAc7Q,UAAUwR,cAAgBpO,OAAOC,OAAO,GAAmD,QAA9C2N,EAAKlB,OAAO2B,mBAAmBzR,iBAA8B,IAAPgR,OAAgB,EAASA,EAAGQ,cAAeP,GAG5JJ,EAAc7Q,UAAUwR,cAAgBP,EAK5D,CACO,SAASS,EAAexB,EAAOzH,EAAO,GACzC,MAAM0H,EAAWD,EAAME,qBAAqB,aAC5C,IAAK,MAAMQ,KAAgBN,EAASqB,OAAQ,CACxC,MAAMpB,EAAkBnM,MAAMC,KAAK8L,GAAUxL,QAAO6L,KAAOX,OAAOW,EAAEC,aAAa,gBAAkB,IAAMG,IACrGL,EAAgBhS,QAChBqT,EAAahB,EAAcN,EAAUC,EAAiB9H,EAC7D,CACD,MAAMkI,EAAkBvM,MAAMC,KAAK8L,GAAUxL,QAAO6L,KAAOX,OAAOW,EAAEC,aAAa,gBAAkB,IAAMH,EAAS/R,SAC9GoS,EAAgBpS,QAChBsE,QAAQC,KAAK,kDAAmDoN,EAAO,4BAA6BS,EAE5G,CAIA,SAASiB,EAAahB,EAAcN,EAAUH,EAAU1H,GACpD,IAAI6C,EAAIwF,EAAIC,EAAIC,EAAIa,EAAIC,EAAIC,EAAIC,EAChC,MAAMvK,EAAU6I,EAASM,GACnB1F,EAAU+G,gBAAgBC,GAAgBlS,UAAUmH,MAAM+D,SAC1DiH,EAAmB,GACzB,IAAIC,EAAW,CAAA,EACf,IAAK,MAAMlB,KAAWf,EAAU,CAC5B,IAAIvL,EAAIrD,EAAO2P,EAAQT,aAAa,QACpC,KAAM7L,GAAMiL,OAAOqB,EAAQT,aAAa,WACpC,SACJ,IACI4B,EAAgBlB,EAAMmB,EAAYC,EADlClB,EAAc,EAElB,GAAY,QAAR9P,EAAgB,CAEhB,GADA4P,EAAOpO,EAASmB,QAAQV,MAAMsF,IAAIlE,IAC7BuM,KAAU,YAAaA,GACxB,SACJ,GAAkB,qBAAdA,EAAK5P,MAA6C,eAAd4P,EAAK5P,KAAuB,CAChE,IAAIiR,EAAa,EAKjB,GAJqB,SAAjBrB,EAAKC,SAAsBD,EAAKlI,MAAM/J,SAAS,SAC/CsT,EAAa,GAEjBF,EAAaF,EAASjB,EAAKvM,KAAOwN,EAASjB,EAAKvM,KAAO,GAAK4N,EACvC,SAAjBrB,EAAKC,QAAoB,CAEzB,GADAmB,GAAmB,EACfD,EAAa,EAAG,CACX7K,EAAQzH,UAAUwR,cAAcL,EAAKvM,KACtC/B,QAAQC,KAAK,oGAAqGoO,GACtH,QACH,CAEGmB,EADAlB,EAAKlI,MAAM/J,SAAS,OACHiS,EAAKsB,MAEL,CAACtB,EAAKsB,MAAMH,EAAa,GACjD,KACI,CACD,GAAoB,YAAhBnB,EAAKC,SAAyC,cAAhBD,EAAKC,QAAyB,CAC5D,KAAMC,GAAexB,OAAOqB,EAAQT,aAAa,YACzC5P,EAAAA,OAAOyQ,sBACPD,EAAcE,EAAyBL,IAClCG,GACD,SAGZ,IAAKA,EAAa,CACdxO,QAAQC,KAAK,yFAA0FoO,EAAS,yDAChH,QACH,CACJ,MACI,GAAqB,UAAjBC,EAAKC,SAAuBkB,EAAa,EAAG,CAC7CA,EAAa,GACbzP,QAAQC,KAAK,sGAAuGoO,GACxH,QACH,CACDmB,EAAiBlB,EAAKsB,KACzB,CACJ,CACJ,MACI,GAAY,cAARlR,IACL4P,EAAOpO,EAASmB,QAAQ,eAAe4E,IAAIlE,IACtCuM,GACD,SAER,IAAIuB,EAAevB,GAAQwB,EAAwBxB,GAAOtB,OAAOqB,EAAQT,aAAa,gBAAamC,GAWnG,GAVIF,IACAL,EAAiB,CAAC,CACVjK,UAAWsK,EAAaG,WAAWlR,KAAImR,IAAM,CACzCC,yBAA0BD,EAAEnH,UAC5B7E,YAAagM,EAAEE,WAAa7B,EAAK8B,eAAiBH,EAAEI,QACpDrM,QAAS,YACToC,MAAO,GAAIrE,IAAK,EAAGmC,eAAgB,EAAGE,eAAgB,EAAGqC,YAAa,UAIlF6H,GAAQ,YAAaA,EAAM,CAC3B,MAAMgC,EAAkC,iBAAhBhC,EAAKgC,QACvBhC,EAAKgC,QACLC,GAAYpS,KAAKG,IAAI,IAAMgQ,EAAKgC,QAAQ,GAAK1L,EAAQzH,UAAUkH,QAAWiK,EAAKgC,QAAQ,GAC7Fd,EAAe,GAAGjK,UAAUmB,KAAK,CAC7BwJ,yBAA0B,QAC1BjM,YAAaqM,EACbtM,QAAS,YACToC,MAAO,GAAIrE,IAAK,EAAGmC,eAAgB,EAAGE,eAAgB,EAAGqC,YAAa,IAE7E,CACD,IAAI+J,EAAgBnI,EACpB,MAAMoI,GAAezD,OAAOqB,EAAQT,aAAa,cAIjD,GAHK8C,MAAMD,KACPD,EAAgBlB,EAAiBmB,KAAiBnB,EAAiBmB,GAAerB,gBAAgBC,GAAgBlS,UAAUmH,MAAM+D,WAElImH,EACA,IAAK,MAAOxS,EAAG2T,KAASnB,EAAevO,UACnC,GAAI0P,EAAKpL,UACL,IAAK,MAAMqC,KAAO+I,EAAKpL,UAAW,CAC9B,IAAKqC,EAAIsI,0BAA6BtI,EAAIhC,MAAQgC,EAAIhC,OAAShB,EAAQiB,UAAc+B,EAAIjC,YAAcf,EAAQzH,UAAUyD,OAAOvE,SAASuL,EAAIjC,WACzI,SACJ,IAAI+B,EAASkJ,GAAetC,EAAM1J,EAASiL,OAAcE,GAAY,GACjEL,IACAhI,EAAS,GAAGA,WAA0C,IAA1B8H,EAAe9T,OAAe+T,EAAazS,EAAI,aAE9EwT,EAAc5I,EAAIsI,4BAA8BM,EAAc5I,EAAIsI,0BAA4B,KAC1FxJ,KAAK,CAAEhB,SAAUkC,EAAKF,SAAQxK,MAAOsR,GAC7C,CAEhB,CACD,MAAMrR,EAAYyH,EAAQzH,UACpB0T,EAA6B,KAC/B,IAAK,MAAO7T,EAAGqL,KAAYiH,EAAiBrO,UAAW,CACnD,MAAMmI,EAASjM,EAAU2T,iBAAiB9T,GACtCoM,EACAA,EAAOf,QAAUA,EAEjBlL,EAAU2T,iBAAiB9T,GAAK,CAAEqL,UAAS5G,OAAQlB,OAAOC,OAAO,CAAA,EAAI6O,GAAgBlS,UAAU2T,iBAAiB,GAAGrP,QAC1H,GAEL,OAAQmE,GACJ,KAAK,EACDzI,EAAUmH,MAAM+D,QAAUA,EAC1BwI,IACA,MACJ,KAAK,EAEG,IAAK,MAAOE,EAAGtP,KAAWlB,OAAOU,QAAQoH,IACpClL,EAAUmH,MAAM+D,QAAQ0I,KAAO5T,EAAUmH,MAAM+D,QAAQ0I,GAAK,KACxDrK,QAAQjF,GAEjB,IAAK,MAAOzE,EAAGqL,KAAYiH,EAAiBrO,UAAW,CACnD,MAAMmI,EAASjM,EAAU2T,iBAAiB9T,GAC1C,GAAIoM,EACA,IAAK,MAAO2H,EAAGtP,KAAWlB,OAAOU,QAAQoH,IACpCe,EAAOf,QAAQ0I,KAAO3H,EAAOf,QAAQ0I,GAAK,KACtCrK,QAAQjF,QAIjBtE,EAAU2T,iBAAiB9T,GAAK,CAAEqL,UAAS5G,OAAQlB,OAAOC,OAAO,CAAA,EAAI6O,GAAgBlS,UAAU2T,iBAAiB,GAAGrP,QAC1H,CAEL,MACJ,KAAK,EAEOwL,OAAO2B,8BAA8BrN,OACrCpE,EAAUmH,MAAM+D,QAAU9H,OAAOC,OAAO6H,EAA2H,QAAjH4F,EAAkE,QAA5DxF,EAAKwE,OAAO2B,mBAAmBb,GAAc5Q,iBAA8B,IAAPsL,OAAgB,EAASA,EAAGnE,aAA0B,IAAP2J,OAAgB,EAASA,EAAG5F,SACvMrI,QAAQgR,QAAO,IAEV/D,OAAO2B,oBACZzR,EAAUmH,MAAM+D,QAAU9H,OAAOC,OAAO6H,EAA6G,QAAnG8F,EAAoD,QAA9CD,EAAKjB,OAAO2B,mBAAmBzR,iBAA8B,IAAP+Q,OAAgB,EAASA,EAAG5J,aAA0B,IAAP6J,OAAgB,EAASA,EAAG9F,SACzLrI,QAAQgR,QAAO,KAGf7T,EAAUmH,MAAM+D,QAAUA,EAC1BwI,KAGR,MACJ,KAAK,EAEO5D,OAAO2B,8BAA8BrN,OACrCpE,EAAUmH,MAAM+D,QAAU9H,OAAOC,OAAO,CAAA,EAAsH,QAAjHyO,EAAkE,QAA5DD,EAAK/B,OAAO2B,mBAAmBb,GAAc5Q,iBAA8B,IAAP6R,OAAgB,EAASA,EAAG1K,aAA0B,IAAP2K,OAAgB,EAASA,EAAG5G,QAASA,GAC3MrI,QAAQgR,QAAO,IAEV/D,OAAO2B,oBACZzR,EAAUmH,MAAM+D,QAAU9H,OAAOC,OAAO,CAAE,EAAsG,QAAnG2O,EAAoD,QAA9CD,EAAKjC,OAAO2B,mBAAmBzR,iBAA8B,IAAP+R,OAAgB,EAASA,EAAG5K,aAA0B,IAAP6K,OAAgB,EAASA,EAAG9G,QAASA,GAC7LrI,QAAQgR,QAAO,KAGf7T,EAAUmH,MAAM+D,QAAUA,EAC1BwI,KAKpB,CACA,SAASnC,EAAyBL,GAC9B,IAAI5F,EAAIwF,EACR,MAAMgD,EAAW1P,MAAM2P,UAAUC,QAAQC,KAAK/C,EAAQgD,cAAcC,SAAUjD,GACxEkD,EAAWlD,EAAQgD,cAAcG,uBAAuB,UAAUP,GACxE,IAAKM,EAED,YADAvR,QAAQC,KAAK,gGAAiGoO,EAAS,wEAG3H,MAAMG,GAAexB,OAAmG,QAA3FiB,EAAqC,QAA/BxF,EAAK8I,EAASE,mBAAgC,IAAPhJ,OAAgB,EAASA,EAAGiJ,MAAM,cAA2B,IAAPzD,OAAgB,EAASA,EAAG,IAC5J,GAAKO,EAAL,CAIA,KAAIA,EAAc,GAAKA,EAAc,IAIrC,OAAOA,EAHHxO,QAAQC,KAAK,iEAAkEsR,EAAU,yBAA0BlD,EAAS,4BAA6BG,EAAa,8HAFzK,MAFGxO,QAAQC,KAAK,iEAAkEsR,EAAU,yBAA0BlD,EAAS,4FAQpI,CACO,SAASsD,EAAUtE,EAAOzH,EAAO,GACpC,MAAM0H,EAAWD,EAAMuE,iBAAiB,uDACxC,IAAK,MAAMpE,KAAQC,EAASxM,UAAW,CACnC,MAAMyM,EAAkBnM,MAAMC,KAAK8L,GAAUxL,QAAO6L,KAAOX,OAAOW,EAAEC,aAAa,gBAAkB,IAAMJ,EAAK,KAC1GE,EAAgBhS,QAChBmW,KAAWrE,EAAME,EAAiB9H,EACzC,CACD,MAAMkI,EAAkBvM,MAAMC,KAAK8L,GAAUxL,QAAO6L,KAAOX,OAAOW,EAAEC,aAAa,gBAAkB,IAAMH,EAAS/R,SAC9GoS,EAAgBpS,QAChBsE,QAAQC,KAAK,kDAAmDoN,EAAO,4BAA6BS,EAE5G,CAIA,SAAS+D,EAAQ9D,EAAcC,EAAeV,EAAU1H,GACpD,IAAI6C,EAAIwF,EACR,MAAMrN,EAAS,GACf,IAAK,MAAMkD,KAAkBwJ,EAAU,CACnC,MAAMwE,EAAoB9E,OAAOlJ,EAAe8J,aAAa,oBAAoBtS,MAAM,KAAKwD,KAAI9B,IAAMA,IAAG8E,QAAO9E,IAAM0T,MAAM1T,IAAM,GAAKA,GAAKA,GAAK,IACjJ,GAAgC,GAA5B8U,EAAkBpW,OAItB,IAAK,MAAO8B,EAAGuU,KAAMD,EAAkB7Q,UAAW,CAC9C,CACI,MAAM+Q,EAAUlO,EAAewN,SAAS,EAAQ,EAAJ9T,GAAO8T,SAASS,GAC5D,IAAIhQ,EACJ,IAAKiQ,KAAajQ,GAAMiL,OAAOgF,EAAQpE,aAAa,WAAY,CAC5D5N,QAAQC,KAAK,yCAA0C+R,EAAS,6JAChE,QACH,CACDpR,EAAO8F,KAAK3E,EACf,CACD,CACI,MAAMiQ,EAAUlO,EAAewN,SAAa,EAAJ9T,GACxC,IAAIuE,EACJ,KAAMA,GAAMiL,OAAOgF,EAAQpE,aAAa,WAAY,CAChD5N,QAAQC,KAAK,+CAAgD+R,EAAS,2HACtE,QACH,CACDpR,EAAO8F,KAAK3E,EACf,CACJ,MAtBG/B,QAAQC,KAAK,kDAAmD6D,EAAgB,oOAuBvF,CACD,OAAQ8B,GACJ,KAAK,EACL,KAAK,EACDoI,EAAc7Q,UAAUyD,OAASA,EACjC,MACJ,KAAK,EACL,KAAK,EAEG,GAAIqM,OAAO2B,8BAA8BrN,MAAO,CAC5C,MAAMa,EAAM,IAAI1B,IAAiE,QAA5D+H,EAAKwE,OAAO2B,mBAAmBb,GAAc5Q,iBAA8B,IAAPsL,OAAgB,EAASA,EAAG7H,QACrHA,EAAOqR,SAAQC,GAAK9P,EAAIxG,IAAIsW,KAC5BlE,EAAc7Q,UAAUyD,OAASW,MAAMC,KAAKY,EAC/C,MACI,GAAI6K,OAAO2B,mBAAoB,CAChC,MAAMxM,EAAM,IAAI1B,IAAmD,QAA9CuN,EAAKhB,OAAO2B,mBAAmBzR,iBAA8B,IAAP8Q,OAAgB,EAASA,EAAGrN,QACvGA,EAAOqR,SAAQC,GAAK9P,EAAIxG,IAAIsW,KAC5BlE,EAAc7Q,UAAUyD,OAASW,MAAMC,KAAKY,EAC/C,MAEG4L,EAAc7Q,UAAUyD,OAASA,EAKrD,CClWO,SAASuR,EAAmBC,EAAWlG,GAC1C,GAAIkG,EAAUC,kBAAoB,EAC9B,OACJ,MAAMC,EAAWrX,EAAO,IAAKe,EAAOkQ,EAAKpH,UAAMiL,EAAW7D,EAAK/D,OAG/D,GAFAmK,EAASC,KAAO,sDAAwD5V,EAAauP,EAAK/D,MAAMrL,WAAW,WAAY,IACvHwV,EAASlJ,OAAS,SACdgJ,EAAUzW,UAAU6W,SAAS,oBAAsBJ,EAAUzW,UAAU6W,SAAS,YAAa,CAC7F,MAAMC,EAAY9V,EAAauP,EAAK/D,MAAMrL,WAAW,WAAY,IACjEwV,EAASzW,OAAO4W,EACnB,CACDL,EAAUvW,OAAOyW,EACrB,CACO,SAASI,EAAaN,EAAWO,GACpC,MAAMC,GAAc5F,OAAOoF,EAAUxE,aAAa,gBAAkB,EAC9DhJ,EAAUiO,GAAmCpF,EAASmF,GAAaR,GACzE,GAAIA,EAAUzW,UAAU6W,SAAS,kBAAmB,CAChD,MAAMM,EAAmBC,EAAoBJ,EAAO/N,GAChDkO,IACAV,EAAUrF,aAAa,QAASC,OAAO8F,EAAiB/Q,KACxD4Q,EAAQG,EAEf,CACDX,EAAmBC,EAAWO,EAClC,CACO,SAASK,EAAYZ,EAAW9D,GACnC,GAAI8D,EAAUC,kBAAoB,EAC9B,OACJ,MAAMxF,GAAaG,OAAOoF,EAAUxE,aAAa,WAAa,EACxDhJ,EAAU6I,GAAUT,OAAOoF,EAAUxE,aAAa,gBAAkB,GACpE0E,EAAWrX,EAAO,IAAKe,EAAOsS,EAAKxJ,UAAMiL,EAAWzB,EAAKnG,OAC/DmK,EAASC,KAAO,sDAAwD5V,EAAa2R,EAAKnG,MAAMrL,WAAW,WAAY,IACvHwV,EAASlJ,OAAS,SACdgJ,EAAUzW,UAAU6W,SAAS,mBAC7BF,EAASzW,OAAO+U,GAAetC,EAAM1J,OAASmL,OAAWA,EAAWlD,IACxEuF,EAAUvW,OAAOyW,EACrB,CACO,SAASW,EAAsBb,EAAWlX,GAC7C,GAAIkX,EAAUzW,UAAU6W,SAAS,kBAC7BL,EAAmBC,EAAWlX,OAE7B,CACDkX,EAAUc,MAAMC,gBAAkB,OAAOjY,EAAKkY,WAAW/W,SAAS,KAAOnB,EAAKkY,WAAatX,EAAYZ,EAAKkY,cAC5GhB,EAAUiB,QAAQC,MAAQpY,EAAKiN,KAC/B,MAAM2J,EAAoB9E,OAAOoF,EAAUxE,aAAa,oBAAoBtS,MAAM,KAAKwD,KAAI9B,IAAMA,IAAG8E,QAAO9E,IAAM0T,MAAM1T,IAAM,GAAKA,GAAKA,GAAK,IAC5I,GAAgC,GAA5B8U,EAAkBpW,OAElB,YADAsE,QAAQC,KAAK,mDAAoDmS,EAAW,+KAGhF,IAAK,MAAO5U,EAAGuU,KAAMD,EAAkB7Q,UAAW,CAC9C,MAAMsS,EAASnB,EAAUd,SAAS,EAAQ,EAAJ9T,GACtC,GAAK+V,EAIL,IAAK,MAAOvW,EAAGgV,KAAYzQ,MAAM2P,UAAUjQ,QAAQmQ,KAAKmC,EAAOjC,UAC3DU,EAAQrW,UAAU6X,OAAO,mBAAoBxW,IAAM+U,QAJnD/R,QAAQC,KAAK,0EAA2EzC,EAAG,8BAA+B4U,EAAW,wHAM5I,CACJ,CACL,CACO,SAASqB,EAAiBrB,EAAWtJ,GACxC,MACM/K,EAAQoI,EADEsH,GAAUT,OAAOoF,EAAUxE,aAAa,gBAAkB,GAClCzQ,UAAW2L,GAC7C4K,EAAK,CACPnP,MAAO,CAAC,MAAO,IACfoP,UAAW,CAAC,OAAQ,IACpBC,SAAU,CAAC,OAAQ,IACnBC,UAAW,CAAC,OAAQ,IACpBC,SAAU,CAAC,OAAQ,IACnBtP,gBAAiB,CAAC,OAAQ,IAC1BuP,UAAW,CAAC,OAAQ,IACpBC,cAAe,CAAC,OAAQ,IACxBvP,aAAc,CAAC,OAAQ,IACvBwP,gBAAiB,CAAC,OAAQ,IAC1BC,OAAQ,CAAC,OAAQ,IACjBC,MAAO,CAAC,OAAQ,IAChBC,kBAAmB,CAAC,OAAQ,KAC5BC,aAAc,CAAC,OAAQ,KACvBC,WAAY,CAAC,OAAQ,KACrBC,WAAY,CAAC,OAAQ,KACrBC,UAAW,CAAC,OAAQ,MACtB1L,GACF,IAAI1M,EAAKqY,EAAS,GACdf,GACCtX,EAAKqY,GAAUf,EAEhB1T,QAAQC,KAAK,gDAAgD6I,gBAAyBsJ,GAE1F,MAAMtK,EAAa2M,EAAS,IAAM,EAClC,IAAIC,EAASjW,EAAUqK,GACN,cAAbA,IACA4L,EAAS,mCAEb,MAAMpC,EAAWrX,EAAO,IAAKe,EAAOI,IACpCkW,EAASC,KAAO,sDAAsDmC,IACtEpC,EAASlJ,OAAS,SACdgJ,EAAUzW,UAAU6W,SAAS,yBACfzC,IAAVhS,EACAuU,EAASzW,OAAO0B,EAAgBQ,EAAQ+J,EAAY,GAAK2M,GAGzDnC,EAASzW,OAAO,MAAQ4Y,IAGhCrC,EAAUuC,gBAAgBrC,EAC9B,CACO,SAASsC,EAAqCxC,EAAWyC,GAC5D,MAAM1M,EAAO6E,OAAOoF,EAAUxE,aAAa,UAC3C,IAAI7L,EAAK,CACL+S,WAAY,MACZC,UAAW,MACXC,UAAW,KACXC,WAAY,KACZC,WAAY,MACZC,cAAe,KACfC,cAAe,KACfC,MAAO,IACPC,SAAU,MACVC,KAAM,IACNC,MAAO,IACPC,WAAY,IACZC,UAAW,KACXC,aAAc,IACdC,WAAY,MACZC,WAAY,IACZC,UAAW,KACXC,UAAW,IACXC,MAAO,IACPC,SAAU,IACVC,QAAS,IACTC,QAAS,IACTC,MAAO,IACPC,QAAS,IACTC,UAAW,IACXC,SAAU,IACVC,KAAM,IACNC,WAAY,IACZC,OAAQ,IACRC,KAAM,MACNC,MAAO,MACPC,QAAS,MACTC,cAAe,IACfC,SAAU,IACVC,KAAM,IACNC,KAAM,IACNC,MAAO,MACPC,gBAAiB,MACjBC,SAAU,IACVC,QAAS,MACTC,WAAY,KACZC,YAAa,MACbC,OAAQ,MACRC,mBAAoB,MACpBC,iBAAkB,MAClBC,wBAAyB,MACzBC,YAAa,MACbC,YAAa,MACbC,iBAAkB,MAClBC,YAAa,MACbC,kBAAmB,MACnBC,WAAY,MACZC,YAAa,MACbC,sBAAuB,MACvBC,iBAAkB,MAClBC,oBAAqB,MACrBC,gBAAiB,MACjBC,QAAS,MACTC,sBAAuB,MACvBC,QAAS,MACTC,mBAAoB,KACpBC,OAAQ,MACRC,aAAc,MACdC,SAAU,MACVC,sBAAuB,MACvBC,KAAM,MACNC,eAAgB,MAChBC,kBAAmB,MACnBC,cAAe,MACfC,kBAAmB,MACnBC,iBAAkB,KAClBC,gBAAiB,MACjBC,kBAAmB,MACnBC,qBAAsB,MACtBC,eAAgB,MAChBC,cAAe,MACfC,kBAAmB,MACnBC,kBAAmB,MACnBC,sBAAuB,MACvBC,iBAAkB,MAClBC,gBAAiB,MACjBC,iBAAkB,MAClBC,cAAe,OACjB7R,GACF,IAAKpG,EAAI,CACL,MAAMkY,EAAY,CACdC,QAAS,CACLnY,GAAI,EACJoG,KAAM,UACNrD,KAAMqV,GAAMC,QACZ3T,YAAa,6YACbjB,kBAAmB,sEACnB0H,WAAY,GAAIpK,SAAU,IAE9BuX,UAAW,CACPtY,GAAI,EACJoG,KAAM,aACN1B,YAAa,wCACb3B,KAAMqV,GAAMG,WACZpN,WAAY,GAAIpK,SAAU,IAE9ByX,UAAW,CACPxY,GAAI,EACJoG,KAAM,YACN1B,YAAa,qFACb3B,KAAMqV,GAAMK,UACZtN,WAAY,GAAIpK,SAAU,IAE9B2X,KAAM,CACF1Y,GAAI,EACJoG,KAAM,OACN1B,YAAa,8GACb3B,KAAMqV,GAAMO,KACZxN,WAAY,GAAIpK,SAAU,IAE9B6X,UAAW,CACP5Y,GAAI,EACJoG,KAAM,YACN1B,YAAa,uGACb3B,KAAMqV,GAAMS,UACZ1N,WAAY,GAAIpK,SAAU,IAE9B+X,OAAQ,CACJ9Y,GAAI,EACJoG,KAAM,SACN1B,YAAa,qIACb3B,KAAMqV,GAAMW,OACZ5N,WAAY,GAAIpK,SAAU,IAE9BiY,MAAO,CACHhZ,GAAI,EACJoG,KAAM,QACN1B,YAAa,qIACb3B,KAAMqV,GAAMa,MACZ9N,WAAY,GAAIpK,SAAU,IAE9BmY,KAAM,CACFlZ,GAAI,EACJoG,KAAM,OACN1B,YAAa,kDACb3B,KAAMqV,GAAMe,KACZhO,WAAY,GAAIpK,SAAU,KAEhCqF,GACE8R,IACAlY,EAAKkY,EAAUlY,GACf7B,EAASmB,QAAQZ,OAAO2B,IAAIL,EAAIkY,GAEvC,CACD,OAAIlY,GACAqQ,EAAUrF,aAAa,OAAQ,SAC/BqF,EAAUrF,aAAa,QAASC,OAAOjL,IAChCA,IAGPqQ,EAAU+I,UAAYhT,EACtBiK,EAAUgJ,MAAQ,+BAA+BjT,MACjDiK,EAAUc,MAAMmI,OAAS,OACzBjJ,EAAUzW,UAAUC,IAAI,SACxBiZ,EAAYjZ,IAAIuM,GACT,EAEf,CC/QA,IAAImT,EACAC,EAEAC,EACAC,EAFAC,EAAW,EAGF,MAAAjO,EAAW,GAyFxB,SAASkO,EAAmBC,GACxB,MAAMC,EAAWP,EAAQhK,SACzB,IAAK,IAAIwK,EAAQ,EAAGA,EAAQD,EAASngB,OAAQogB,IACpCD,EAASC,GAAOngB,UAAU6W,SAAS,oBACpCqJ,EAASC,GAAOngB,UAAU6X,OAAO,SAAUsI,IAAUF,EAEjE,CACA,SAASG,EAAyBH,EAAcI,GAAU,GACtD,MAAMH,EAAWP,EAAQhK,SAASsK,GAClCN,EAAQpI,MAAM+I,WAAaD,EAAU,kBAAoB,GACzDV,EAAQpI,MAAMgJ,UAAY,iBAAiBL,EAASM,UAAYN,EAASO,iBAC7E,CACA,SAASC,EAAgBL,GAAU,GAC/B,MAAMM,EAAa9gB,SAAS+gB,eAAe,cACrCC,EAAeF,EAAaA,EAAWF,aAAe,EAKtDK,EAAoBnB,EAAQhK,SAASoK,GAC3C,IAAIgB,EAAclB,EAHF,EAIZkB,EAAcpB,EAAQqB,YAAcnhB,SAASohB,gBAAgBC,YANjD,KAOZH,EAAclhB,SAASohB,gBAAgBC,aAAevB,EAAQqB,YAPlD,KAShB,IAAIG,EAAcrB,EANF,EAOZqB,EAAcL,EAAkBL,aAAe5gB,SAASohB,gBAAgBG,UAAYP,EATxE,KAURR,IACAV,EAAQpI,MAAM+I,YAAc,cAC5Be,YAAW,IAAM1B,EAAQpI,MAAM+I,WAAa,IAAI,MAEpDa,EAActhB,SAASohB,gBAAgBG,UAAYP,EAdvC,GAcgEC,EAAkBL,cAElGd,EAAQpI,MAAM+J,KAAO,GAAGP,MACxBpB,EAAQpI,MAAMgK,IAAM,GAAGJ,KAC3B,CACOK,eAAeC,EAAa/P,EAAOgQ,GACtC,MAAMC,EAAe,CACjB7c,OAAQ,IAAIsF,IACZnF,OAAQ,IAAImF,IACZpF,MAAO,IAAIoF,IACXjF,gBAAiB,IAAIiF,IACrBlF,KAAM,IAAIkF,IACV,cAAe,IAAIA,IACnBiK,WAAY,IAAIjK,KAEdwX,EAAa,IAAI7c,IACjB8c,EAA2B,IAAI9c,IACrC,IAAK,MAAM0R,KAAa/E,EAAME,qBAAqB,aAAc,CAC7D,MAAMjJ,GAAS0I,OAAOoF,EAAUxE,aAAa,UACxC8C,MAAMpM,IACPiZ,EAAW3hB,IAAI0I,GACnB,IAAImZ,EAAYrL,EAAUxE,aAAa,SACnClP,GAAQ0T,EAAUxE,aAAa,SAAW,SAAW,IACzD,GAAa,eAATlP,GACA,GAAyB,iBAAd+e,EAAwB,CAC/B,MAAMC,EAAqBJ,EAAatN,WAAW/J,IAAIwX,GACnDC,EACAA,EAAmBhX,KAAK0L,GAExBkL,EAAatN,WAAW5N,IAAIqb,EAAW,CAACrL,GAC/C,MAEA,CACD,IAAIuL,GAAS3Q,OAAOyQ,GACpB,GAAa,YAAT/e,EAAoB,CACpB,IAAIV,EAAAA,OAAOyQ,oBAKP,SAJA/P,EAAO,SACPif,EAAQ/I,EAAqCxC,EAAWoL,EAK/D,CACD,GAAK9M,MAAMiN,MAAUjf,KAAQ4e,GAQzB,SARuC,CACvC,MAAMI,EAAqBJ,EAAa5e,GAAMuH,IAAI0X,GAC9CD,EACAA,EAAmBhX,KAAK0L,GAExBkL,EAAa5e,GAAM0D,IAAIub,EAAO,CAACvL,GACtC,CAIJ,CACDA,EAAUwL,iBAAiB,cAAejQ,GAAMkQ,EAAelQ,EAAEvE,UACjEgJ,EAAUwL,iBAAiB,cAAc,KACrCtC,EAAQpI,MAAM4K,QAAU,OACxBxC,EAAQpI,MAAMgJ,UAAY,EAAE,GAEnC,CAoCD,OAnCIsB,EAAyBtc,MACzBlB,QAAQsC,MAAM,oFAAqFf,MAAMC,KAAKgc,IAE9GD,EAAWrc,KAAO,GAClBhB,EAASC,gBAAgB,YAAaod,EAAW9b,gBAC/Csc,QAAQC,IAAIzd,OAAOU,QAAQqc,GAC5Bxb,QAAO,EAAEmc,EAAKlhB,KAAc,cAAPkhB,IACrBnf,KAAIqe,OAAQc,EAAKxc,MAClB,GAAmB,GAAfA,EAAOP,KACP,OACJ,IAAIgd,EACJ,OAAQD,GACJ,IAAK,SACDC,EAAWxL,EACX,MACJ,IAAK,QACDwL,EAAWlL,EACX,MACJ,IAAK,kBACDkL,EAAWjL,EACX,MACJ,QACIiL,EAAW/L,EAGnB,MAAMgM,EAAQje,EAASmB,QAAQ4c,SACzB/d,EAASC,gBAAgB8d,EAAKxc,EAAOqN,QAC3C,IAAK,MAAO/M,EAAIqc,KAAY3c,EAAQ,CAChC,MAAMyK,EAAOiS,EAAMlY,IAAIlE,GACvB,GAAKqc,GAAYlS,EAEjB,IAAK,MAAMkG,KAAagM,EACpBF,EAAS9L,EAAWlG,EAC3B,MAEEoR,CACX,CACA,SAASO,EAAezL,EAAWiM,EAAe,GAC9C,MAAM3f,GAAS0T,EAAUxE,aAAa,SAAW,SAAW,IACtD+P,EAAQvL,EAAUxE,aAAa,SACrC,IAAIhJ,EAAU6I,GAAUT,OAAOoF,EAAUxE,aAAa,gBAAkB,GACxE,MAAM0Q,GAAatR,OAAOoF,EAAUxE,aAAa,gBAAamC,EACxDlD,GAAaG,OAAOoF,EAAUxE,aAAa,gBAAamC,EAC9D,GAAY,mBAARrR,GAAqC,WAARA,EAC7B,OAEJ,GADA6c,EAAoBnJ,EACR,cAAR1T,EAAsB,CACtB,GAAIif,EAAO,CACPjC,EAAW2C,EACX/C,EAAQ3G,gBAugBpB,SAAkC7L,EAAWlE,GACzC,MAAO7G,EAAOwgB,GAASC,EAAyB1V,EAAWlE,GAAS,GACpE,GAAI,CAAC,oBAAqB,gBAAgBvI,SAASyM,GAAY,CAC3D,MAAM2V,EAA4B,sBAAd3V,EAAoC,YAAc,OAChE4V,EAAkBtP,gBAAgBxK,EAAQzH,UAAUmH,MAAM+D,SAChE,IAAK,MAAO4V,EAAKU,KAASpe,OAAOU,QAAQ2D,EAAQzH,UAAU2T,iBAAiBlM,EAAQzH,UAAUyhB,mBAAmBvW,SACzGqI,OAAOuN,KAEVS,EAAgBT,KAASS,EAAgBT,GAAO,KAAKvX,QAAQiY,GAElE,MAAME,EAA2E,KAAjEtX,EAAwBuB,EAAWlE,EAAQzH,WAAW4J,IAAM,GAC5E,IAAK,MAAO+X,EAAWzW,KAAY9H,OAAOU,QAAQyd,GAAkB,CAChE,GAAIhO,OAAOoO,GACP,SACJ,MAAMC,EAAS7e,EAASmB,QAAQZ,OAAOwF,KAAK6Y,GAC5C,IAAKC,EAAQ,CACT/e,QAAQsC,MAAM,2CAA2Cwc,0BACzD,QACH,CACD,GAAIC,EAAO5X,YAAcsX,EACrB,SACJ,IAAIO,EAAsB,IAARjhB,EACdkhB,EAAgB,GACpB,IAAK,MAAMvX,OAAEA,EAAMhC,SAAEA,EAAQxI,MAAEA,KAAWmL,EAAS,CAC/C,MAAMT,EAAM7D,EAAkB2B,EAAUd,EAAQzH,WAChD8hB,EAAcvY,KAAKzL,EAAO,cAAe,GAAG2M,EAAM,EAAI,IAAM,KAAKvK,EAAGuK,YAAc1K,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmByK,EAAQxK,EAAO0H,EAAQzH,cACrK6hB,GAAepX,CAClB,CACD,MAAMM,EAAc8W,EACpBA,EAAc7gB,KAAKG,IAAI0gB,EAAaH,GAChC3W,GAAe8W,GACfC,EAAcvY,KAAKzL,EAAO,qBAAsB,eAAeoC,EAAG2hB,gCAA0C3hB,EAAG6K,SAEnHqW,EAAM7X,KAAKzL,EAAO,WAAYe,EAAO+iB,EAAOja,MAAO7J,EAAO,MAAOA,EAAO,OAAQ,GAAG8jB,EAAO5W,UAAU9K,EAAG2hB,UAAqBC,IAC/H,CACJ,CACD,OAAOhkB,EAAO,6BAA8BsjB,EAChD,CA5iBoCW,CAAyBvB,EAAO/Y,IACxD0W,EAAQpI,MAAM4K,QAAU,GACxB,IAAK,MAAMqB,KAAM7D,EAAQhK,SACrB6N,EAAGxjB,UAAUC,IAAI,UACrBmgB,EAAyBL,EAC5B,CACD,MACH,CACD,MAAMxP,EAAOhM,EAASmB,QAAQ3C,GAAMuH,KAAK+G,OAAO2Q,IAChD,GAAIzR,EAAM,CAKN,GAJAwP,EAAW2C,EACXzZ,EAAUiO,GAAmCjO,EAASwN,GACtDkJ,EAAQ3G,mBA2OhB,SAA6ByK,EAAkBhN,EAAWxN,EAAS0Z,EAAWzR,GAC1E,MAAMwS,EAAc,GACdC,EAAwBlN,EAAUzW,UAAU6W,SAAS,kBACrD+M,EAAqBC,IACvB,IAAIC,GAAW,EACf,GAAI,aAAcD,EAAY,CAC1B,GAAIF,EAAuB,CACvB,MAAMxM,EAAmBC,EAAoByM,EAAY5a,GACrDkO,IACA0M,EAAa1M,EACpB,CACDuM,EAAY3Y,KAAK,CAAEzE,IAAKud,EAAYE,gBAAgB,IACpD,MAAM7c,EAAU2c,EAAW1c,SAAS6c,MAAKC,GAAKC,GAAqBxjB,SAASujB,EAAElhB,QAC9E,GAAImE,EACA,IAAK,MAAME,KAAQF,EAAQG,MACvB,GAAID,EAAKG,YAAcH,EAAKE,WAAY,CACpC,MAAM6c,EAAmB5f,EAASmB,QAAQZ,OAAOwF,IAAIlD,EAAKG,YACtD4c,IACAL,GAAW,EACXF,EAAkBO,GAEzB,CAEZ,MAEGT,EAAY3Y,KAAK,CAAEzE,IAAKud,EAAYE,gBAAgB,IAExD,IAAKD,GAAY,mBAAoBD,EAAY,CAC7C,MAAM9gB,EAAO0T,EAAUxE,aAAa,SAAW,QAC/C,IAAK,MAAMjK,KAAc6b,EAAWlc,eAAgB,CAChD,MAAMyc,EAAkB7f,EAASmB,QAAQZ,OAAOwF,IAAItC,GAChDoc,IAA6B,SAARrhB,GAAoBqhB,EAAgBjd,SAASd,MAAKa,GAAWgd,GAAqBxjB,SAASwG,EAAQnE,UACxH2gB,EAAY3Y,KAAK,CAAEzE,IAAK8d,EAAiBL,gBAAgB,GAEhE,CACJ,CACD,GAAI,WAAYF,EACZ,IAAK,MAAMQ,KAAcR,EAAW/e,OAAQ,CACxC,IAAIwf,EAAW/f,EAASmB,QAAQZ,OAAOwF,IAAI+Z,GACtCC,IACDjgB,QAAQC,KAAK,6BAA6B+f,wDAAkE5N,GAC5G6N,EAAW9S,GAEfkS,EAAY3Y,KAAK,CAAEzE,IAAKge,EAAUP,gBAAgB,GACrD,GAETH,EAAkBH,GAClB,IAAIc,GAAalT,OAAOoF,EAAUxE,aAAa,cAC3C8C,MAAMwP,KACNA,OAAYnQ,GAChB,MAAMoQ,EAAed,EAAYvgB,KAAI,EAAGmD,MAAKyd,oBAAuB,SAAUzd,EA4BlF,SAA6BqM,EAAM1J,EAASwE,EAAQkV,EAAWzR,EAAY,GACvE,IAAIpE,EACJ,IACI2X,EADAC,EAAUvQ,EAAwBxB,EAAMgQ,GAExC,UAAWhQ,IACX8R,EAAyD,QAAzC3X,EAAKW,EAAOwE,aAAa,kBAA+B,IAAPnF,OAAgB,EAASA,EAAGnN,MAAM,KAAKwD,KAAIiD,GAAM7B,EAASmB,QAAQV,MAAMsF,KAAK+G,OAAOjL,IAAO,KAAID,QAAO9E,GAAKA,GAAK,YAAaA,KAElM,MAAMsjB,EAAczT,EAAY,EAAIA,EAAY,IAAM,GAChD0T,GAAqBH,aAAmD,EAASA,EAAaT,MAAK3iB,IAAM,CAAC,WAAY,cAAcX,SAASW,EAAEuR,cAAe6R,aAAmD,EAASA,EAAa,IACvOjY,EAAOmY,EAAc1P,GAAetC,EAAM1J,EAASyb,EAASE,EAAmB1T,GAC/E0R,EAAQ,CAACtjB,EAAO,YAAae,EAAOsS,EAAKxJ,MAAO7J,EAAO,wBAA0BqT,EAAKkS,OAAOC,cAAetY,GAAOlN,EAAO,sBAChI,GAAI,YAAaqT,GAAQA,EAAKgC,QAAS,CACnC,MAAMA,EAAkC,iBAAhBhC,EAAKgC,QACvBhC,EAAKgC,QACLC,GAAYpS,KAAKG,IAAI,IAAMgQ,EAAKgC,QAAQ,GAAK1L,EAAQzH,UAAUkH,QAAWiK,EAAKgC,QAAQ,GAC7FiO,EAAM7X,KAAKzL,EAAO,KAAMA,EAAO,MAAO,YAAaA,EAAO,4BAA6B+R,OAAOsD,MACjG,CACD,GAAI,UAAWhC,EAAM,CACjB,IAAI7D,EACJ,GAAI,QAAS6D,EAAK7D,MAAO,CACrB,IAAIiW,EAAYC,GAAOC,UACnB,CAAC,yBAA0B,cAAcvkB,SAASiS,EAAK7D,MAAM4F,WACzDzL,EAAQzH,UAAUkH,MAAQ,GAC1Bqc,EAAYC,GAAOE,OACdjc,EAAQzH,UAAUkH,MAAQ,GAC/Bqc,EAAYC,GAAOG,SACdlc,EAAQzH,UAAUkH,MAAQ,GAC/Bqc,EAAYC,GAAOI,KACdnc,EAAQzH,UAAUkH,MAAQ,KAC/Bqc,EAAYC,GAAOK,SAE3B,MAAMR,EAASriB,KAAKG,IAAIqiB,GAAOrS,EAAKkS,QAASE,GAC7C,IAAI5E,EAAQmF,GAAWT,GAClBlS,EAAK7D,MAAM4F,QAGZyL,GAASlX,EAAQzH,UAAUkH,MAF3ByX,GAASxN,EAAKjK,MAIlB,MAAM6c,GAAOtc,EAAQzH,UAAUgkB,SAAWC,GAAmBC,IAAmBljB,KAAKG,IAAI,IAAKwd,IAAUxN,EAAK7D,MAAM6W,IAAMC,GAAef,GAClIgB,EAASN,EAAM5S,EAAK7D,MAAM+W,OAChC/W,EAAQ,CAACtM,KAAKsjB,KAAKP,EAAMM,GAASrjB,KAAKsjB,KAAKP,EAAMM,GACrD,MAEG/W,EAAQ6D,EAAK7D,MAEjB,MAAMiX,EAAOzmB,EAAO,MAAO,oBAAqBA,EAAO,4BAA6B,GAAGwP,EAAM,QAAQA,EAAM,OACvG6D,EAAKqT,aACLD,EAAK7lB,OAAO,KAAKyS,EAAKqT,gBAC1BpD,EAAM7X,KAAKzL,EAAO,KAAMymB,GAC3B,CACG,UAAWpT,GACXiQ,EAAM7X,KAAKkb,EAAyBtT,EAAM1J,IAE1Cyb,GAAW,mBAAoB/R,GAC/BiQ,EAAM7X,QAAQ2Z,EAAQrQ,WAAWlR,KAAI,EAAGgK,YAAWqH,aAAYE,aAEpDpV,EAAO,KAAMA,EAAO,2BAA4B,IADjCkD,KAAKI,MAAM4R,EAAa7B,EAAK8B,eAAiBC,MACQ5R,EAAUqK,UAG1F,UAAWwF,GACXiQ,EAAM7X,KAAKzL,EAAO,qBAAsBqT,EAAKtL,MAAMlE,KAAI+iB,IACnD,IAAIC,GAAkB,EACtB,GAAI1B,EACA,OAAQyB,GACJ,IAAK,UACDC,EAAiB1B,EAAa2B,WAAU/kB,GAAK,CAAC,OAAQ,QAAS,OAAOX,SAASW,EAAEuR,WACjF,MACJ,IAAK,WACDuT,EAAiB1B,EAAa2B,WAAU/kB,GAAkB,YAAbA,EAAEuR,UAC/C,MACJ,IAAK,aACDuT,EAAiB1B,EAAa2B,WAAU/kB,GAAkB,cAAbA,EAAEuR,UAI3D,GAAIuT,GAAkB,EAAG,CACrB,MAAME,EAAc5B,EAAa6B,OAAOH,EAAgB,GAAG,GACrDI,EAAQN,EAAyBI,EAAapd,GAC9CuD,EAAOyI,GAAeoR,EAAapd,EAASyb,GAElD,OADA6B,EAAMC,QAAQlnB,EAAO,MAAOe,EAAOgmB,EAAYld,KAAM,aAAc7J,EAAO,wBAA0B+mB,EAAYxB,OAAQrY,GAAOlN,EAAO,sBAC/HinB,CACV,CAEG,OAAOjnB,EAAO,KAAMe,EAAOme,GAAM,QAAU0H,GAAI,aAAc,SAASA,SACzE,MAGT,MAAMO,EAAWnnB,EAAO,cACP,SAAbqT,EAAK5P,MAAgC,UAAb4P,EAAK5P,MAAkC,WAAb4P,EAAK5P,OAAsB4P,EAAKlI,MAAM/J,SAAS,UACjG+lB,EAASvmB,OAAOZ,EAAO,yBAA2BqT,EAAKkS,OAAQlS,EAAKkS,SAChE,WAAYlS,GACZ8T,EAASvmB,OAAOZ,EAAO,OAAQqT,EAAK+T,SACxCD,EAASvmB,OAAOZ,EAAO,OAAQ,GAAGqT,EAAK5P,SAAS4P,EAAKC,YACpC,UAAbD,EAAK5P,MA4UjB,SAAqBA,GACjB,OAAQA,GACJ,IAAK,MACL,IAAK,SACL,IAAK,OACL,IAAK,SACL,IAAK,UACL,IAAK,QACL,IAAK,QACL,IAAK,WACL,IAAK,QACL,IAAK,SACL,IAAK,UACL,IAAK,MACL,IAAK,eACL,IAAK,cAAe,OAAO,EAC3B,IAAK,SACL,IAAK,UACL,IAAK,aACL,IAAK,UACL,IAAK,QACL,IAAK,QACL,IAAK,cACL,IAAK,QACL,IAAK,WACL,IAAK,UAAW,OAAO,EAE/B,CAvWqC4jB,CAAYhU,EAAKC,UAC1C6T,EAASvmB,OAAOZ,EAAO,6BAA8B,iBACrDqT,EAAKiU,gBACLH,EAASvmB,OAAOZ,EAAO,OAAQ,mBAAqBqT,EAAKiU,kBAE7DjU,EAAK7H,aACL2b,EAASvmB,OAAOZ,EAAO,OAAQqB,EAASK,EAAa2R,EAAK7H,gBACzD6H,EAAKlI,MAAM/J,SAAS,SACjBiS,EAAKlI,MAAM/J,SAAS,WACpB+lB,EAASvmB,OAAOZ,EAAO,OAAQ,WAC/BqT,EAAKlI,MAAM/J,SAAS,iBACpB+lB,EAASvmB,OAAOZ,EAAO,OAAQ,kBAC/BqT,EAAKlI,MAAM/J,SAAS,iBACpB+lB,EAASvmB,OAAOZ,EAAO,OAAQ,qBAC1BqT,EAAKlI,MAAM/J,SAAS,sBACzB+lB,EAASvmB,OAAOZ,EAAO,OAAQ,0BAEvC,IAAKqT,EAAKlI,MAAM/J,SAAS,aAAc,CACnC,MAAMmmB,EAAiB,CAAc,cAAblU,EAAK5P,MAAwC,QAAhB4P,EAAKC,QAChD,UACe,YAAfD,EAAKkS,OAAuB,WAAa,YAE/ClS,EAAKlI,MAAM/J,SAAS,oBACpBmmB,EAAe9b,KAAK,YACpB8b,EAAe9mB,QACf0mB,EAASvmB,OAAOZ,EAAO,OAAQ,YAAcunB,EAAevjB,KAAK,OACxE,CACD,GAAIqP,EAAKmU,aAAc,CACnB,IAAItnB,EAAQ,CAAC,iBAAkBunB,GAAYpU,EAAKmU,aAAe5V,IAC3DA,EAAY,GACZ1R,EAAMuL,KAAK,KAAMgc,GAAYpU,EAAKmU,cAAe,MAAM5V,MAC3DuV,EAASvmB,OAAOZ,EAAO,UAAWE,GACrC,CACDojB,EAAM7X,KAAK0b,GACX,MAAM9G,EAAUrgB,EAAO,6BAA8BsjB,GAErD,OADAjD,EAAQjI,QAAQtR,GAAKiL,OAAOsB,EAAKvM,IAC1BuZ,CACX,CA9JyFqH,CAAoB1gB,EAAK2C,EAASwN,EAAWkM,EAAWzR,GAxOjJ,SAAyB+V,EAAWlD,EAAgB9a,EAASsb,GACzD,IAAIzX,EACJ,MAAMoa,EAAiB,CAAC7mB,EAAO4mB,EAAU9d,MAAO7J,EAAO,MAAO0B,EAAaimB,EAAUza,MAAMrL,WAAW,MAAO,KAAM7B,EAAO,qBACpH6nB,EAA4BC,EAA0BH,EAAWhe,GAIvE,GAAIke,EAA0BE,WAAY,CACtC,MAAMjlB,EAAQD,EAAeglB,EAA0BE,WAAa,IAAMhlB,EAAAA,QAC7D,KAATD,GACA8kB,EAAenc,KAAKzL,EAAO,MAAO8C,EAAO/B,EAAOme,GAAM8I,WAAY,cAEzE,CACGH,EAA0BI,eAC1BL,EAAenc,KAAKzL,EAAO,MAAO+R,OAAO8V,EAA0BI,eAAgBlnB,EAAuC,YAAhC4I,EAAQzH,UAAU8F,WAA2BkX,GAAMgJ,aAAehJ,GAAMiJ,eAAgB,eAElLN,EAA0BO,gBAC1BR,EAAenc,KAAKzL,EAAO,MAAO+R,OAAO7O,KAAKI,MAAMukB,EAA0BO,iBAAkBrnB,EAAOme,GAAMmJ,eAAgB,eAE7HR,EAA0BS,aAC1BV,EAAenc,KAAKzL,EAAO,MAAO+R,OAAO8V,EAA0BS,aAAcvnB,EAAOme,GAAMqJ,YAAa,eAE/G,GAAIV,EAA0BW,SAAU,CACpC,MAAM1lB,EAAQD,EAAeglB,EAA0BW,SAAW,IAAMzlB,EAAAA,QAC3D,KAATD,GACA8kB,EAAenc,KAAKzL,EAAO,MAAO8C,EAAO/B,EAAOme,GAAMuJ,SAAU,cAEvE,CACGZ,EAA0Ba,aAC1Bd,EAAenc,KAAKzL,EAAO,MAAO+R,OAAO8V,EAA0Ba,aAAc3nB,EAAOme,GAAMyJ,YAAa,eAE/G,MAAMC,EAAkB,GACxB,CACI,IAAIC,EAAY,SAAUlB,GAAaA,EAAU7f,MAAU,aAAc6f,GAxEjF,SAAqBjQ,GACjB,IAAIoR,EACJ,IAAK,MAAMlhB,KAAW8P,EAAM7P,SACxB,IAAK,MAAMC,KAAQF,EAAQG,MACvB,OAAQH,EAAQnE,MACZ,IAAK,YACL,IAAK,UACGmE,EAAQmhB,aAA+B,UAAhBnhB,EAAQnE,QAC/BqlB,EAAYhhB,EAAKA,KAAKkhB,QAAQ,sBAAsB,CAAClnB,EAAGmnB,EAAMC,KAC9C,WAARD,IACAC,EAAkB,MAAVA,EAAgB,IAAM,KAE3B,GAAGthB,EAAQmhB,YAAcvlB,EAAUoE,EAAQmhB,aAAe,YAAYG,QAGrF,MACJ,IAAK,WACiB,aAAdphB,EAAKA,OACLghB,EAAY,WAEhB,MACJ,IAAK,OACL,IAAK,WACL,IAAK,QACDA,EAAYlhB,EAAQnE,KACpB,MACJ,IAAK,MACL,IAAK,aACDqlB,EAAYhhB,EAAKA,KAAKkhB,QAAQ,iBAAkB,iBAChD,MACJ,IAAK,UACD,MACJ,QACIjkB,QAAQsC,MAAM,yDAAyDO,EAAQnE,oBAAoBiU,EAAMxK,SAIzH,OAAO4b,CACX,CAkC8FK,CAAYxB,GAC9F,mBAAoBA,IACpBkB,IAAuF,QAAzErb,EAAKvI,EAASmB,QAAQP,gBAAgBmF,IAAI2c,EAAU9e,uBAAoC,IAAP2E,OAAgB,EAASA,EAAGN,OAASya,EAAU9e,gBAAkB,MAAQggB,GACxKA,GACAD,EAAgBnd,KAAKzL,EAAO,MAAO,KAAK6oB,aAC1B/T,IAAdmQ,GACA2D,EAAgBnd,KAAKzL,EAAO,MAAO,gBAAgBilB,EAAY,OACtE,CAED,GADA2D,EAAgBnd,KAAKzL,EAAO,qBACxB,oBAAqB2nB,GAAaA,EAAUnf,gBAAiB,CAC7D,MAAM4gB,EAAc,IAAI3jB,IAAI,CAAC,MAAO,MAAO,QAC3C,IAAK,MAAM4jB,KAAY1B,EAAUnf,gBAC7B,IAAK,MAAMmB,KAAW0f,EAAS1f,QAC3Byf,EAAYE,OAAO3f,GAG3B,MAAM4f,EAAS,CAACjjB,MAAMC,KAAK6iB,MAAiBzB,EAAUnf,gBAAgB3E,KAAI2lB,GAAKA,EAAE7f,WAC3E8f,EAAc,GACpB,IAAK,MAAM9e,IAAQ,CAAC,MAAO,MAAO,OAAQ,CACtC,IAAItK,EACJ,IAAK,IAAI0B,EAAI,EAAGA,EAAIwnB,EAAO9oB,OAAQsB,IAC/B,GAAIwnB,EAAOxnB,GAAGX,SAASuJ,GAAO,CAC1BtK,EAAQkpB,EAAOvC,OAAOjlB,EAAG,GAAG,GAC5B,KACH,CAEL,IAAK1B,EACD,SACJ,MAAMsB,EAAOtB,EAAM2D,KAAK,KACpB3D,EAAMe,SAASuI,EAAQiB,UACvB6e,EAAYhe,KAAK,oEAAoE9J,YAErF8nB,EAAYhe,KAAK9J,EACxB,CACDinB,EAAgBnd,KAAKzL,EAAO,MAAO,KAAMqB,EAASooB,EAAYzlB,KAAK,QAAS,MAC/E,CACD,MAAMsf,EAAQ,CAACtjB,EAAO,eAAgB4nB,IAClCgB,EAAgBnoB,OAAS,GACzB6iB,EAAM7X,KAAKzL,EAAO,gBAAiB4oB,IACnC,gBAAiBjB,GAAaA,EAAUnc,aACxC8X,EAAM7X,KAAKzL,EAAO,gBAAiBqB,EAASK,EAAaimB,EAAUnc,gBAEvE,GAAIqc,EAA0Btf,OAAQ,CAClC,IAAIgH,EAAiB,MACrB,GAAI,aAAcoY,GAAaA,EAAU9f,SAASpH,OAAQ,CACtD,MAAMipB,EAAW/f,EAAQzH,UAAU8F,WAC3B4e,GAAMA,EAAE5e,aAAe2B,EAAQzH,UAAU8F,WACzC4e,GAAMA,EAAE5e,WACV2hB,EAAkBhC,EAAU9f,SAAS6c,MAAKC,GAAKA,EAAE5c,MAAMhB,KAAK2iB,KAC9DC,IACApa,EAkEhB,UAA2BwZ,YAAEA,EAAatlB,KAAMmmB,IAC5C,OAAKb,EAOM,CACHc,YAAa,EACbC,SAAU,MACVC,MAAO,IACPC,OAAQ,IACRC,MAAO,IACPC,QAAS,IACTC,WAAY,KACZC,OAAQ,KACRC,MAAO,KACPC,QAAS,KACTC,MAAO,KACPC,SAAU,IACVC,IAAK,IACLC,MAAO,IACPC,OAAQ,IACRC,OAAQ,IACRC,QAAS,IACTC,KAAM,IACNC,MAAO,IACPC,SAAU,IACVC,QAAS,KACXlC,GA5BmB,WAAjBa,EACO,MAEJ,KA2Bf,CAlGiCsB,CAAkBvB,GAE1C,CACDrG,EAAM7X,QHrWP,SAAuBlD,EAAQgH,EAAgB5F,GAClD,MAAOwhB,KAAeC,GAAmB7iB,EACzC,IAAI8iB,EAAqB,EACzB,MAAMC,EAAoB9jB,GAAYA,EAAaA,EAC9C+jB,MAAK,CAACvW,EAAGwW,IAAMxW,EAAEyW,MAAQD,EAAEC,QAC3B5nB,KAAI4D,IACL,MAAM2J,QAAEA,EAAOlH,eAAEA,GAAmBT,EAAahC,EAAM8H,EAAgB5F,GAEvE,OADA0hB,GAAsBnhB,EACfkH,CAAO,IAEbvK,QAAO8K,GAAKA,IAP6B,GAQxCU,EAAW,GACjB,IAAK,MAAM/J,KAAS8iB,EAAiB,CACjC,MAAMha,EAAUpR,EAAO,kBACvB,GAAIsI,EAAMojB,mBAAoB,CAC1B,MAAMja,EAAc/N,EAAa4E,EAAMojB,mBAAmB7nB,KAAIiD,IAAQ,IAAI0G,EAAI,MAAO,0CAAqF,QAA1CA,EAAKvI,EAASmB,QAAQT,OAAOqF,IAAIlE,UAAwB,IAAP0G,OAAgB,EAASA,EAAGN,OAASpG,WAAY,KACnOsK,EAAQxQ,OAAOS,EAAS,qDAAwF,GAAnCiH,EAAMojB,mBAAmBjrB,OAAc,GAAK,OAAOgR,YACnI,CACGnJ,EAAMkD,aACN4F,EAAQxQ,OAAOZ,EAAO,gBAAiBqB,EAASK,EAAa4G,EAAMkD,gBACvE,MAAMmgB,EAAaL,EAAiBhjB,EAAMd,OAC1C4J,EAAQxQ,UAAU+qB,GAClBtZ,EAAS5G,KAAK2F,EACjB,CAGD,GAFI+Z,GACA9Y,EAAS5G,QAAQ6f,EAAiBH,EAAW3jB,QAC7C6jB,EAAqB,EAAG,CACxB,MAAMO,EAAe5rB,EAAO,WAAYe,EAAOme,GAAM2M,eAAgB,WAAY7rB,EAAO,8BAA+B,mBAAmBsC,EAAgB+oB,EAAoB,OAC9KhZ,EAAS5G,KAAKmgB,EACjB,CACD,OAAOvZ,CACX,CGsUsByZ,CAAcjE,EAA0Btf,OAAQgH,EAAgB5F,GACjF,CACD,MAAM0W,EAAUrgB,EAAO,iBAAkBsjB,GACrCmB,GACApE,EAAQ3f,UAAUC,IAAI,mBAE1B,OADA0f,EAAQjI,QAAQtR,GAAKiL,OAAO4V,EAAU7gB,IAC/BuZ,CACX,CA2I8J0L,CAAgB/kB,EAAKyd,EAAgB9a,EAASsb,KAExM,OADA5E,EAAQzf,UAAUskB,GACXA,CACX,CAhSmC8G,CAAoB/a,EAAMkG,EAAWxN,EAAS0Z,EAAWzR,IACpFyO,EAAQpI,MAAM4K,QAAU,GACpBvc,MAAMC,KAAK8Z,EAAQhK,UAAUxP,QAAOqd,IAAOA,EAAGxjB,UAAU6W,SAAS,qBAAoB9W,OAAS,EAC9F0W,EAAUzW,UAAUC,IAAI,UACxBwW,EAAUgJ,MAAQ,wCAClBO,EAAmBD,QAGnB,IAAK,MAAMyD,KAAM7D,EAAQhK,SACrB6N,EAAGxjB,UAAUC,IAAI,UAEzBmgB,EAAyBL,EAC5B,CACL,CAsIO,SAASqH,EAA0BH,EAAWhe,GACjD,IAAI6D,EAAIwF,EAAIC,EAAIC,EAChB,IAAImW,EAAgD,QAApC7b,EAAKma,EAAUnf,uBAAoC,IAAPgF,OAAgB,EAASA,EAAGkX,MAAKuH,GAAKA,EAAEtiB,QAAQvI,SAASuI,EAAQiB,YACzHshB,EAAS5mB,OAAOC,OAAO,CAAA,EAAIoiB,EAAW0B,GAE1C,GADA6C,EAAO3jB,OAAS4L,gBAAgBwT,EAAUpf,QACtC2jB,EAAO3jB,SAAW8gB,aAA2C,EAASA,EAAS9gB,QAAS,CACxF,MAAM4jB,EAAMjpB,KAAK6N,IAAI4W,EAAUpf,OAAO9H,OAAQ4oB,EAAS9gB,OAAO9H,QAC9D,IAAK,IAAI2rB,EAAU,EAAGA,EAAUD,EAAKC,IAAW,CAC5C,MAAMC,EAAY1E,EAAUpf,OAAO6jB,GAC7BE,EAAgBjD,EAAS9gB,OAAO6jB,GACtC,IAAKC,GAAaC,EACdJ,EAAO3jB,OAAO6jB,GAAWjY,gBAAgBmY,QAExC,GAAIA,EAAe,CACpB,IAAKA,EAAc9kB,MACf,SACJ,IAAK6kB,EAAU7kB,MAAO,CAClB0kB,EAAO3jB,OAAO6jB,GAAS5kB,MAAQ8kB,EAAc9kB,MAAM5E,QACnD,QACH,CACD,MAAM4E,EAAQ0kB,EAAO3jB,OAAO6jB,GAAS5kB,MAAQ6kB,EAAU7kB,MAAM5E,QAC7D,IAAK,MAAM6E,KAAQ6kB,EAAc9kB,OACM,QAA9BwL,EAAKvL,EAAK4J,sBAAmC,IAAP2B,OAAgB,EAASA,EAAGjM,MAAKkQ,IAAMtN,EAAQzH,UAAUyD,OAAOvE,SAAS6V,aAEzFnC,IAAvBrN,EAAK8kB,cACL/kB,EAAMwf,OAAOvf,EAAK8kB,cAAe,EAAG9kB,GAEpCD,EAAMiE,KAAKhE,GAEtB,CACJ,CACJ,CACD,GAAIykB,EAAO3jB,OAAQ,CACf,MAAMikB,EAAc,GACpB,IAAK,MAAMlkB,KAAS4jB,EAAO3jB,OACvB,KAAwC,QAAnC0K,EAAK3K,EAAMojB,0BAAuC,IAAPzY,OAAgB,EAASA,EAAGlM,MAAKkQ,IAAMtN,EAAQzH,UAAUyD,OAAOvE,SAAS6V,MAAzH,CAEA,GAAI3O,EAAMd,MAAO,CACb,MAAMilB,EAAa,GACnB,IAAK,IAAI1qB,EAAI,EAAGA,EAAIuG,EAAMd,MAAM/G,OAAQsB,IAAK,CACzC,MAAM0F,EAAOa,EAAMd,MAAMzF,IACU,QAA9BmR,EAAKzL,EAAK4J,sBAAmC,IAAP6B,OAAgB,EAASA,EAAGnM,MAAKkQ,IAAMtN,EAAQzH,UAAUyD,OAAOvE,SAAS6V,QAEpHwV,EAAWhhB,KAAKhE,GACZA,EAAKiK,WACL3P,IACP,CACDuG,EAAMd,MAAQilB,CACjB,CACDD,EAAY/gB,KAAKnD,EAbJ,CAejB4jB,EAAO3jB,OAASikB,CACnB,CACD,OAAON,CACX,CAwFO,SAASpU,EAAoBJ,EAAO/N,GACvC,IAAI6D,EACJ,IAAK,MAAM5F,KAAW8P,EAAM7P,SACxB,IAAK,MAAMC,KAAQF,EAAQG,MACvB,GAAID,EAAKI,qBAAsB,CAC3B,MAAMqK,EAAOzK,EAAKI,qBAAqBwc,MAAK,EAAE1P,EAAGlT,KAAO6H,EAAQzH,UAAUyD,OAAOvE,SAAS4T,KAC1F,IAAKzC,EACD,OACJ,MAAOma,EAASC,GAASpa,EACzB,GAAIoa,GAASjV,EAAM5Q,GACf,OACJ,MAAM+Q,EAAmB5S,EAASmB,QAAQZ,OAAOwF,IAAI2hB,GACrD,OAAK9U,GAKD9S,QAAQ2B,KAAK,mCAAmCgR,EAAM5Q,OAAO4Q,EAAMxK,aAAa2K,EAAiB/Q,OAAO+Q,EAAiB3K,4BAA4Bwf,OAA6D,QAA/Clf,EAAKvI,EAASmB,QAAQT,OAAOqF,IAAI0hB,UAA6B,IAAPlf,OAAgB,EAASA,EAAGN,OAAS,8BACxP2K,QALP9S,QAAQsC,MAAM,mCAAmCslB,6BAOxD,CAGb,CAoIO,SAAS9X,EAAwBxB,EAAMgQ,GAC1C,IAAI+B,EACJ,GAAiB,SAAb/R,EAAK5P,MAAgC,WAAb4P,EAAK5P,MAAkC,UAAb4P,EAAK5P,KAEvD,QAAkBqR,KADlBuO,EAAYA,GAAahQ,EAAK5K,eAE1B1D,QAAQC,KAAK,wKAGb,GADAogB,EAAUngB,EAASmB,QAAQN,UAAUkF,IAAIqY,GACpC+B,GAGD,GAAIriB,SAAO6pB,wBAA0BxH,EAAQyH,aAAc,CACvD,MAAMC,EAAe1H,EAAQyH,aAAaxZ,EAAKC,SAC/C,QAAqBwB,IAAjBgY,EAA4B,CAC5B/nB,QAAQ2B,KAAK,uDAAuD2c,SAAiByJ,mCAA8CzZ,EAAKC,YACxI,MAAMyZ,EAAS9nB,EAASmB,QAAQN,UAAUkF,IAAI8hB,GACzCC,EAGD3H,EAAU2H,EAFVhoB,QAAQsC,MAAM,uDAAuDylB,6BAG5E,CACJ,OAZD/nB,QAAQsC,MAAM,6CAA6Cgc,0BAgBvE,OAAO+B,CACX,CACA,SAASuB,EAAyBtT,EAAM1J,GACpC,MAAMsd,EAAQjnB,EAAO,aACrB,IAAK,MAAO+B,EAAG2T,KAASrC,EAAKsB,MAAM3O,UAAW,CAC1C,IAAIgnB,EAAYhtB,EAAO,MACvB,GAAI0V,EAAKlK,YACLwhB,EAAUpsB,OAAOZ,EAAO,OAAQqB,EAASK,EAAagU,EAAKlK,qBAC1D,GAAIkK,EAAKlO,MACV,IAAK,MAAMC,KAAQiO,EAAKlO,MAAO,CAC3B,MAAM4J,QAAEA,GAAY3H,EAAahC,EAAM,KAAMkC,GACzCyH,GACA4b,EAAUpsB,OAAOwQ,EACxB,MAEA,GAAIsE,EAAKpL,UAAW,CACrB0iB,EAAU/U,MAAMgV,cAAgB,SAChC,IAAK,MAAMxiB,KAAYiL,EAAKpL,UAAW,CACnC,IACI3I,EADAurB,EAAgBpkB,EAAkB2B,EAAUd,EAAQzH,WAGpDP,EADA8I,EAASU,MAAM/J,SAAS,iBACjB,IAAI8B,KAAKI,MAAM4pB,OAAmB1pB,EAAUiH,EAASe,eAGrD,IAAItI,KAAKI,MAAM4pB,MAAkB1pB,EAAUiH,EAASe,eAE/DwhB,EAAUpsB,OAAOZ,EAAO,KAAM2B,GACjC,CACJ,CACD,MAAMmC,EAAI9D,EAAO,KAAMgtB,GACvB,GAAoB,QAAhB3Z,EAAKC,QAAmB,CACxB,MAAM6Z,EAAaprB,GAAK4H,EAAQzH,UAAUwR,cAAcL,EAAKvM,KAAO,GAAK,wBAA0B,GACnGhD,EAAEojB,QAAQlnB,EAAO,OAASmtB,EAAY,IAAIprB,EAAI,MACjD,CACDklB,EAAMrmB,OAAOkD,EAChB,CACD,OAAOmjB,CACX,CAuCA,SAAS1D,EAAyB1V,EAAWlE,EAASyjB,GAAe,EAAOnI,GACxE,MAAM5b,EAAQM,EAAQzH,UAAUmH,MAC1BgkB,EAAc1jB,EAAQzH,UAAU2T,iBAAiBoP,QAA6CA,EAAYtb,EAAQzH,UAAUyhB,mBAClI,IAAIxX,cAAEA,EAAaqN,OAAEA,EAAM8T,WAAEA,EAAUC,KAAEA,EAAInhB,IAAEA,EAAGN,IAAEA,GAAQQ,EAAwBuB,EAAWlE,EAAQzH,WACvG,MAAM2K,EAAa2M,EAAS,IAAM,EAClC,IAAkB7X,EAAdmB,EAAQyqB,EACZ,MAAMjK,EAAQ,GACd,GAAKnX,EAIA,CASG,GAPIihB,IACAzrB,EAAO,GAAGS,EAAGmrB,EAAO1gB,GAAc2M,eAC9B+T,IACA5rB,GAAQ,gBAEZ2hB,EAAM7X,KAAKzL,EAAO,aAAc2B,KAEhC2rB,EAAY,CACZ,MAAME,EAAgBnkB,EAAM7C,OAAO2F,GAAiBkhB,EAAY7mB,OAAO2F,GACvE,IAAIshB,EAAYD,EACC,cAAb3f,IACA4f,GAAa,KACjB,MAAMC,EAAYD,EAAYrhB,EAC9BtJ,GAAS4qB,EACLN,GAAgBM,IAChB/rB,EAAO,KAAKS,EAAGsrB,EAAY7gB,GAAc2M,UAAepX,EAAGorB,MAAkBhqB,EAAU2I,KAC5E,GAAPC,IACAzK,GAAQ,MAAMyK,EAAMS,qCACxByW,EAAM7X,KAAKzL,EAAO,aAAc2B,IAEvC,CAEL,MAAMgsB,EAActkB,EAAM+D,QAAQS,GAAW+f,OAAOP,EAAYjgB,QAAQS,IACxE,IAAIggB,EAAW,EACf,IAAK,MAAMphB,KAAUkhB,EAAY9mB,QAAO+f,IAAMA,EAAEnc,SAASU,MAAM/J,SAAS,mBAAmB,CACvF,MAAMuL,EAAM7D,EAAkB2D,EAAOhC,SAAUd,EAAQzH,WAAauK,EAAOxK,MAC3E4rB,GAAYlhB,EACRygB,IACAzrB,EAAO,KAAKS,EAAGuK,WACXF,EAAOxK,MAAQ,IACfN,GAAQ,GAAG8K,EAAOxK,UACtBN,GAAQ8K,EAAOA,OACf6W,EAAM7X,KAAKzL,EAAO,aAAcqB,EAASW,EAAmBL,EAAM8K,EAAOxK,MAAO0H,EAAQzH,cAE/F,CACD,MAAM4rB,EAAuBhrB,EAAQ+qB,EACrC,IAAK,MAAMphB,KAAUkhB,EAAY9mB,QAAO+f,GAAKA,EAAEnc,SAASU,MAAM/J,SAAS,mBAAmB,CACtF,MAAMuL,EAAM7D,EAAkB2D,EAAOhC,SAAUd,EAAQzH,WAAauK,EAAOxK,MAAQ,IAC7E6K,EAAQ0M,EAAS7M,EAAMmhB,EAAuBnhB,EACpDkhB,GAAY/gB,EACRsgB,IACAzrB,EAAO,KAAKS,EAAG0K,EAAQD,KAAc2M,IAChCA,IACD7X,GAAQ,KAAKS,EAAS,IAANuK,QACpBhL,GAAQ,SACJ8K,EAAOxK,MAAQ,IACfN,GAAQ,GAAG8K,EAAOxK,UACtBN,GAAQ8K,EAAOA,OACf6W,EAAM7X,KAAKzL,EAAO,aAAcqB,EAASW,EAAmBL,EAAM8K,EAAOxK,MAAO0H,EAAQzH,cAE/F,CACD,MAAM6rB,EAAgBjrB,EAAQ+qB,EAC9B/qB,EAAQI,KAAKG,IAAI0qB,EAAejiB,EAAM,GAClCshB,IACIW,GAAiBjrB,GACjBwgB,EAAM7X,KAAKzL,EAAO,qBAAsB,cAAcoC,EAAGU,EAAQ+J,KAAc2M,8BAAmCpX,EAAG2rB,EAAgBlhB,KAAc2M,OACvJ8J,EAAMtV,QAAQhO,EAAO,YAAaA,EAAO,MAAO,KAAOoC,EAAGU,EAAQ+J,GAAc2M,EAAS,IAAMhW,EAAUqK,MAEhH,MA/DOuf,GACA9J,EAAM7X,KAAKzL,EAAO,YAAaA,EAAO,MAAO6N,KA+DrD,MAAO,CAAC/K,EAAOwgB,EACnB,CACO,SAAShX,EAAwBuB,EAAW3L,GAC/C,MAAM8rB,EAAUjiB,OAAOC,iBACjBiiB,EAAM,CACR3kB,MAAO,CAAC,QAAS,MAAO,IAAI,EAAO,IAAM,EAAG0kB,GAC5CtV,UAAW,CAAC,YAAa,OAAQ,IAAI,EAAO,IAAM,EAAGsV,GACrDrV,SAAU,CAAC,WAAY,OAAQ,IAAI,EAAO,IAAM,EAAGqV,GACnDpV,UAAW,CAAC,YAAa,OAAQ,IAAI,EAAO,IAAM,EAAGoV,GACrDnV,SAAU,CAAC,WAAY,OAAQ,IAAI,EAAO,EAAG,EAAGmV,GAChDzkB,gBAAiB,CAAC,kBAAmB,OAAQ,IAAI,EAAO,EAAG,EAAGykB,GAC9DlV,UAAW,CAAC,YAAa,OAAQ,IAAI,EAAO,EAAG,EAAGkV,GAClDjV,cAAe,CAAC,gBAAiB,OAAQ,IAAI,EAAO,EAAG,EAAGiV,GAC1DxkB,aAAc,CAAC,eAAgB,OAAQ,IAAI,EAAO,EAAG,EAAGwkB,GACxDhV,gBAAiB,CAAC,kBAAmB,OAAQ,IAAI,EAAO,EAAG,EAAGgV,GAC9D/U,OAAQ,CAAC,WAAY,OAAQ,IAAI,EAAM,EAAG,GAAK+U,GAC/C9U,MAAO,CAAC,YAAa,OAAQ,IAAI,EAAM,EAAG,EAAG8U,GAC7C7U,kBAAmB,CAAC,YAAa,OAAQ,KAAK,EAAM,EAAG,KAAM,GAC7DC,aAAc,CAAC,gBAAiB,OAAQ,KAAK,EAAM,EAAG,KAAM,GAC5DC,WAAY,CAAC,YAAa,OAAQ,KAAK,EAAM,IAAM,KAAM2U,GACzD1U,WAAY,CAAC,WAAY,OAAQ,KAAK,EAAM,IAAK,KAAM0U,IACzDngB,GACF,IAAI1B,EAAehL,EAAkBmsB,EAAb9T,EAAS,GAAgB+T,EAAO,EAAGnhB,EAAM,EAAGN,EAAMkiB,EAK1E,OAJIC,KACC9hB,EAAehL,EAAKqY,EAAQ8T,EAAYC,EAAMnhB,EAAKN,GAAOmiB,GAC9C,UAAbpgB,IACA0f,EAGR,SAAuBrrB,GACnB,OAAQA,EAAU8F,WAEZ,CACEkmB,SAAU,KACVC,MAAO,KACPC,aAAc,KACdC,SAAU,KACVC,OAAQ,KACRC,OAAQ,KACRC,SAAU,KACVC,YAAa,KACbC,QAAS,MACXxsB,EAAU8F,YAXV,GAYV,CAjBe2mB,CAAczsB,IAClB,CAAEiK,gBAAehL,MAAKqY,SAAQ8T,aAAYC,OAAMnhB,MAAKN,MAChE,CAgBA,SAAS8iB,EAA6BjlB,GAClC,MAAMklB,EAAiB,CACnB,QAAS,YAAa,WAAY,YAAa,WAAY,kBAAmB,YAAa,gBAAiB,eAAgB,kBAC5H,SAAU,QAAS,oBAAqB,eAAgB,aAAc,cAE1E,IAAK,MAAOrZ,EAAayP,KAActb,EAAQzH,UAAU2T,iBAAiB7P,UACtE,IAAK,MAAM6H,KAAaghB,EAAgB,CACpC,MAAO/rB,EAAOhB,GAAKyhB,EAAyB1V,EAAWlE,GAAS,EAAO6L,GACvEyP,EAAUze,OAAOqH,GAAa/K,CACjC,CAET,CAOO,SAASoI,EAAkBhJ,EAAW2L,GACzC,OAAO3L,EAAU2T,iBAAiB3T,EAAUyhB,mBAAmBnd,OAAOqH,EAC1E,CACO,SAASnB,EAAexK,EAAW2L,GACtC,MAAO,IAAK3L,EAAUmH,MAAM+D,QAAQS,IAAc,MAAS3L,EAAU2T,iBAAiB3T,EAAUyhB,mBAAmBvW,QAAQS,IAAc,GAC7I,CACO,SAAS8H,GAAetC,EAAM1J,EAASyb,EAAS0J,EAAkBld,EAAY,GACjF,IAAI1E,EAOA6hB,EAAMC,EAAMC,EAAMC,EAmBtB,OAxBIhiB,EADa,cAAbmG,EAAK5P,KACE4P,EAAK8b,MAGL9b,EAAKnG,KAGhB6hB,EAAOC,EAAOC,EAAOC,EAAO,GACvB7b,EAAKlI,MAAM/J,SAAS,eACjBgkB,GAAWA,EAAQlY,OACnB6hB,EAAO3J,EAAQlY,KACf8hB,EAAO,KAGV3b,EAAKlI,MAAM/J,SAAS,eACjB0tB,GAAoBA,EAAiBtV,SACrC0V,EAAOJ,EAAiBtV,OACxByV,EAAO,KAGf/hB,EAAOxL,EAAawL,EAAM6hB,EAAMC,EAAMC,EAAMC,GACxCtd,GAAa,IACb1E,EAAOlL,EAAmBkL,EAAM0E,EAAWjI,EAAQzH,YAClDmR,EAAKlI,MAAM/J,SAAS,SAAWiS,EAAKlI,MAAM/J,SAAS,SAAUiS,EAAKlI,MAAM/J,SAAS,cAClF8L,GAAQ,UACLA,CACX,CACO,SAAS0K,GAAmCjO,EAASwN,GACxD,IAAIiY,EACJ,GAAuC,UAAnCjY,EAAUxE,aAAa,UAAwByc,EAAiBjY,EAAUxE,aAAa,gBAAiB,CACxGhJ,EAAUwK,gBAAgBxK,GAC1B,MAAM0lB,EAAU,GAChB1lB,EAAQzH,UAAUyD,OAASypB,EAAe/uB,MAAM,KAAKwD,KAAIoT,IACrD,MAAM5U,GAAK4U,EAGX,OAFK5U,GACDgtB,EAAQ5jB,KAAKwL,GACV5U,CAAC,IACTwE,QAAOoQ,GAAKA,IACXoY,EAAQ5uB,QACRsE,QAAQC,KAAK,qEAAsEmS,EAAW,6BAA8BkY,EACnI,CACD,OAAO1lB,CACX,CACA,SAAS8d,GAAY6H,GACjB,MAAMhM,EAAQ,CAACvR,OAAO7O,KAAKK,MAAM+rB,EAAS,MAAOvuB,EAAOme,GAAMqQ,YAAa,YAAa,KAKxF,OAJID,EAAS,IACThM,EAAMtV,QAAQ+D,OAAO7O,KAAKK,MAAO+rB,EAAS,IAAO,MAAOvuB,EAAOme,GAAMsQ,YAAa,YAAa,KAC/FF,EAAS,MACThM,EAAMtV,QAAQ+D,OAAO7O,KAAKK,MAAM+rB,EAAS,MAASvuB,EAAOme,GAAMuQ,UAAW,YAAa,KACpFzvB,EAAO,UAAWsjB,EAC7B,CAh9BWvgB,EAAAA,OAAS,KA6+BR,MAACqR,GAAkB,CAC3BxJ,SAAU,MACV8E,YAAa,KACbxN,UAAW,CACPkH,MAAO,GACP8c,UAAU,EACV/jB,IAAK,OACLwD,OAAQ,GACR0D,MAAO,CACH7C,OAAQ,CACJ8C,MAAO,EACPoP,UAAW,EACXC,SAAU,EACVC,UAAW,EACXC,SAAU,EACVtP,gBAAiB,EACjBuP,UAAW,EACXC,cAAe,EACfvP,aAAc,EACdwP,gBAAiB,GAErB5L,QAAS,CACL9D,MAAO,GACPoP,UAAW,GACXC,SAAU,GACVC,UAAW,GACXC,SAAU,GACVtP,gBAAiB,GACjBuP,UAAW,GACXC,cAAe,GACfvP,aAAc,GACdwP,gBAAiB,GACjBE,MAAO,GACP7J,OAAQ,GACRqgB,UAAW,GACXzW,OAAQ,GACR5L,kBAAmB,GACnBsiB,KAAM,GACNxW,kBAAmB,GACnBC,aAAc,GACdC,WAAY,GACZC,WAAY,KAGpBzD,iBAAkB,CAAC,CACXrP,OAAQ,CACJ8C,MAAO,IACPoP,UAAW,IACXC,SAAU,IACVC,UAAW,IACXC,SAAU,EACVtP,gBAAiB,EACjBuP,UAAW,EACXC,cAAe,EACfvP,aAAc,EACdwP,gBAAiB,EACjBC,OAAQ,IACRC,MAAO,IACPG,WAAY,IACZC,WAAY,IACZH,kBAAmB,EACnBC,aAAc,GAElBhM,QAAS,CACL9D,MAAO,GACPoP,UAAW,GACXC,SAAU,GACVC,UAAW,GACXC,SAAU,GACVtP,gBAAiB,GACjBuP,UAAW,GACXC,cAAe,GACfvP,aAAc,GACdwP,gBAAiB,GACjBE,MAAO,GACP7J,OAAQ,GACRqgB,UAAW,GACXzW,OAAQ,GACR5L,kBAAmB,GACnBsiB,KAAM,GACNxW,kBAAmB,GACnBC,aAAc,GACdC,WAAY,GACZC,WAAY,MAGxBqK,kBAAmB,EACnBjQ,cAAe,CAAE,IAGzB,SAASkc,GAAsBC,GAC3B,IAAIriB,EAAIwF,EAAIC,EAAIC,EAAIa,EAAIC,EACO,OAA3B6b,EAAejlB,WAA0D,QAAnC4C,EAAKqiB,EAAe3tB,iBAA8B,IAAPsL,OAAgB,EAASA,EAAGpE,QAA6F,KAA9C,QAAnC4J,EAAK6c,EAAe3tB,iBAA8B,IAAP8Q,OAAgB,EAASA,EAAG5J,QAChMrE,QAAQsC,MAAM,wSAAySwoB,GAE3T,MAAMxmB,EAAQymB,GAA6D,QAAnC7c,EAAK4c,EAAe3tB,iBAA8B,IAAP+Q,OAAgB,EAASA,EAAG5J,OACzGqK,EAAgBpO,OAAOC,OAAO,CAAA,EAAwC,QAAnC2N,EAAK2c,EAAe3tB,iBAA8B,IAAPgR,OAAgB,EAASA,EAAGQ,eAC1G2Z,GAAmH,QAAnGrZ,EAAyC,QAAnCD,EAAK8b,EAAe3tB,iBAA8B,IAAP6R,OAAgB,EAASA,EAAG8B,wBAAqC,IAAP7B,OAAgB,EAASA,EAAGnQ,KAAI+iB,GAAKmJ,GAAqBnJ,OAAQ,CAACmJ,MAC9L7tB,EAAYoD,OAAOC,OAAO,CAAA,EAAI6O,GAAgBlS,UAAW2tB,EAAe3tB,UAAW,CAAEmH,QAAOqK,gBAAe2Z,gBACjH,OAAO/nB,OAAOC,OAAO,CAAE,EAAE6O,GAAiByb,EAAgB,CAAE3tB,aAChE,CACO,SAAS4tB,GAAyBE,EAAgB,IAGrD,MAAO,CAAExpB,OAFMlB,OAAOC,OAAO,GAAI6O,GAAgBlS,UAAUmH,MAAM7C,OAAQwpB,EAAcxpB,QAEtE4G,QADD9H,OAAOC,OAAO,CAAA,EAAI4O,gBAAgBC,GAAgBlS,UAAUmH,MAAM+D,SAAU4iB,EAAc5iB,SAE9G,CACO,SAAS2iB,GAAqBC,EAAgB,IAGjD,MAAO,CAAExpB,OAFMlB,OAAOC,OAAO,CAAA,EAAI6O,GAAgBlS,UAAU2T,iBAAiB,GAAGrP,OAAQwpB,EAAcxpB,QAEpF4G,QADD9H,OAAOC,OAAO,CAAE,EAAE4O,gBAAgBC,GAAgBlS,UAAU2T,iBAAiB,GAAGzI,SAAU4iB,EAAc5iB,SAE5H,CACA,MAAM6iB,GAAiB,CACnBC,gBAAgB,EAChBC,uBAAuB,EACvBC,wBAAwB,EACxBC,2BAA2B,EAC3BC,kCAAkC,EAClC1D,wBAAwB,EACxB2D,4BAA4B,EAC5BC,+BAA+B,EAC/Bhd,qBAAqB,EACrBxQ,2BAA2B,EAC3BwJ,2BAA2B,GAElB8I,GAAc,CACvB,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAE1gB6Q,GAAmB,CACrB,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAE5fC,GAAoB,CACtB,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAEnjB,IAAIV,IACJ,SAAWA,GACPA,EAAOA,EAAa,KAAI,GAAK,OAC7BA,EAAOA,EAAc,MAAI,GAAK,QAC9BA,EAAOA,EAAe,OAAI,GAAK,SAC/BA,EAAOA,EAAiB,SAAI,GAAK,WACjCA,EAAOA,EAAa,KAAI,GAAK,OAC7BA,EAAOA,EAAe,OAAI,GAAK,SAC/BA,EAAOA,EAAiB,SAAI,GAAK,WACjCA,EAAOA,EAAkB,UAAI,GAAK,WACrC,CATD,CASGA,KAAWA,GAAS,CAAE,IACzB,MAAMM,GAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GACnCM,GAAiB,CAAC,GAAK,IAAM,GAAK,IAAM,GAAK,EAAK,KAAM,MAIjDpH,GAAQ,CACjBqQ,YAAa,OACbC,YAAa,OACbC,UAAW,OACXgB,aAAc,OACdC,cAAe,OACfC,gBAAiB,OACjBxI,eAAgB,OAChBD,aAAc,OACdK,YAAa,OACbI,YAAa,QACbN,eAAgB,OAChBuI,cAAe,OACfnI,SAAU,OACVT,WAAY,OACZ6I,MAAO,OACPhF,eAAgB,QAChBiF,YAAa,OACb3R,QAAS,QACTE,WAAY,OACZE,UAAW,QACXE,KAAM,QACNE,UAAW,QACXE,OAAQ,QACRE,MAAO,QACPE,KAAM,SAEJ2E,GAAuB,CAAC,SAAU,OAAQ,QAAS,aAAc,WAAY,aAEnF,GA9pCA,WACI,GAAI5S,OAAO2B,8BAA8BrN,MACrC,IAAK,MAAMupB,KAAkB7d,OAAO2B,mBAChCnB,EAAS/G,KAAKmkB,GAAsBC,SAEnC7d,OAAO2B,mBACZnB,EAAS/G,KAAKmkB,GAAsB5d,OAAO2B,qBAG3CnB,EAAS/G,KAAKmkB,GAAsB,CAAA,IAExC7sB,EAAMA,OAAGuC,OAAOC,OAAO,CAAA,EAAI0qB,GAAgBje,OAAO+e,mBAC9ChuB,EAAMA,OAACqC,UACPH,EAASG,QAAUrC,EAAAA,OAAOqC,QAAQ4rB,IACtC3Q,EAAUrgB,EAAO,sBACjBqgB,EAAQpI,MAAM4K,QAAU,OACxBtiB,SAAS0wB,KAAKC,YAAY7Q,GAC1B,MAAM8Q,EAAW,oGAAoGC,KAAKC,UAAUC,UAAU9L,eA6B9I,IAAI+L,EA5BJhxB,SAASoiB,iBAAiB,aAAa6O,IAC/BL,GAAajuB,KAAKC,IAAIquB,EAAMC,MAAQlR,GAAcrd,KAAKC,IAAIquB,EAAME,MAAQlR,GAAc,KACvFH,EAAQpI,MAAM4K,QAAU,QAE5BtC,EAAaiR,EAAMC,MACnBjR,EAAagR,EAAME,MACU,QAAzBrR,EAAQpI,MAAM4K,SACdzB,GAAiB,IAEzB7gB,SAASoiB,iBAAiB,eAAe6O,IACrC,MAAMG,ENmEP,SAA0BC,EAAMC,EAAUC,EAAQ,IACrD,IAAIC,EAAUH,EACd,KAAOG,GAAWD,KAAU,IAAMC,EAAQC,QAAQH,IAC9CE,EAAUA,EAAQ3b,cACtB,OAAa,GAAT0b,EACO,KACJC,CACX,CM1EqBE,CAAiBT,EAAMrjB,OAAQ,aAC5C,GAAKwjB,EAAL,CAEA,GAAIA,EAAKjxB,UAAU6W,SAAS,WAAsC,QAAzB8I,EAAQpI,MAAM4K,QAAmB,CACtE2O,EAAMU,iBACN,GACIzR,GAAYA,EAAW,GAAKJ,EAAQjJ,wBAC/BiJ,EAAQhK,SAASoK,GAAU/f,UAAU6W,SAAS,oBACvDmJ,EAAmBD,GACnBK,EAAyBL,GAAU,GACnCW,GAAgB,EACnB,CACG+P,GAAqC,QAAzB9Q,EAAQpI,MAAM4K,UAC1B2O,EAAMU,iBACNtP,EAAe+O,GACfvQ,IAbO,CAcV,IAGL,MAAM+Q,EAAiBX,IACnB,GAA6B,QAAzBnR,EAAQpI,MAAM4K,QACd,OACJ,MAAMuP,EAAW/R,EAAQhK,SAASoK,GAClC,GAAI2R,EAASC,cAAgBD,EAASE,aAClC,OACJd,EAAMU,iBACN,MAAMK,EAASf,EAAMe,QAAUf,EAAMgB,QAAUhB,EAAMiB,QAAQ,GAAGC,QAAUnB,EAAMmB,QAChFN,EAASO,SAAS,EAAGJ,EAAO,EAE1BK,EAAU,YAAa5gB,QAAS,CAAE4gB,SAAS,GACjD5gB,OAAO2Q,iBAAiB,iBAAkBwP,GAAe,GACzDngB,OAAO2Q,iBAAiB,QAASwP,EAAeS,GAChD5gB,OAAO2Q,iBAAiB,cAAc6O,IAClCD,EAAQC,EAAMiB,QAAQ,EAAE,IAE5BzgB,OAAO2Q,iBAAiB,YAAawP,EAAeS,GACpD5gB,OAAO2Q,iBAAiB,WAAWjQ,IAC3BA,EAAEmgB,SAAWngB,EAAEogB,SACF,KAATpgB,EAAEsQ,KACFtQ,EAAEwf,iBACFnvB,EAAAA,OAAOyJ,2BAA6BzJ,EAAMA,OAACyJ,0BAC3CzH,QAAQguB,IAAI,yDAAyDhwB,EAAAA,OAAOyJ,6BACxE8T,GAA8C,QAAzBD,EAAQpI,MAAM4K,UACnCD,EAAetC,EAAmBG,GAClCW,MAGU,KAAT1O,EAAEsQ,MACPtQ,EAAEwf,iBACFnvB,EAAAA,OAAOC,2BAA6BD,EAAMA,OAACC,0BAC3C+B,QAAQguB,IAAI,yDAAyDhwB,EAAAA,OAAOC,6BACxEsd,GAA8C,QAAzBD,EAAQpI,MAAM4K,UACnCD,EAAetC,EAAmBG,GAClCW,MAGX,GAET,CAukCA4R,GACIjwB,EAAAA,OAAOmtB,eAAgB,CACvB,MAAM+C,EAAa1yB,SAASgW,uBAAuB,qBACnD,GAAIxT,EAAAA,OAAOstB,0BACP,GAAI4C,EAAWxyB,OACX,IAAK,MAAM0N,KAAU8kB,EACjBC,EAAkB/kB,QAEtBpJ,QAAQC,KAAK,iTAGrBmd,EAAa5hB,UACRkE,MAAK0uB,IACN,IAAI3lB,EACJ,GAAIzK,EAAAA,OAAOytB,8BACP,IAAK,MAAM4C,KAAaH,EAAY,CAChC,IAAK,MAAOlxB,EAAGsxB,KAAYD,EAAUzc,iBAAiB,eAAe3Q,UACjE,IAAK,MAAMstB,KAAWD,EAAQ/gB,qBAAqB,aAC/CghB,EAAQxhB,aAAa,YAAaC,OAAOhQ,IAEjD,MAAMwxB,EAAgB,GACtB,IAAK,MAAOxxB,EAAGyxB,KAAkBJ,EAAUzc,iBAAiB,sBAAsB3Q,UAAW,CACzF,MAAMytB,EAAW,GACXC,EAAYhc,IACd+b,EAAShoB,KAAKiM,EAAM5Q,IACpB,IAAI0d,GAAW,EACf,MAAM5c,EAAU8P,EAAM7P,SAAS6c,MAAKC,GAAKC,GAAqBxjB,SAASujB,EAAElhB,QACzE,GAAImE,EACA,IAAK,MAAME,KAAQF,EAAQG,MACvB,GAAID,EAAKG,YAAcH,EAAKE,WAAY,CACpC,MAAM6c,EAAmB5f,EAASmB,QAAQZ,OAAOwF,IAAIlD,EAAKG,YACtD4c,IACAL,GAAW,EACXkP,EAAS7O,GAEhB,CAET,IAAKL,GAAY9M,EAAMrP,eACnB,IAAK,MAAMK,KAAcgP,EAAMrP,eAAgB,CAC3C,MAAMyc,EAAkB7f,EAASmB,QAAQZ,OAAOwF,IAAItC,GAChDoc,GAAmBA,EAAgBjd,SAASd,MAAKa,GAAWgd,GAAqBxjB,SAASwG,EAAQnE,SAClGgwB,EAAShoB,KAAK/C,EACrB,CACJ,EAEL,IAAK,MAAM4qB,KAAWE,EAAcnd,SAAU,CAC1Cid,EAAQxhB,aAAa,YAAaC,OAAOhQ,IACzC,MAAM2V,EAAQzS,EAASmB,QAAQZ,OAAOwF,KAAK+G,OAAOuhB,EAAQ3gB,aAAa,WACnE+E,EACAgc,EAAShc,GAET3S,QAAQC,KAAK,4DAA6DsuB,EAEjF,CACDC,EAAc9nB,KAAKgoB,EACtB,CACD,GAAIF,EAAc9yB,OAAS,IAAM8yB,EAAc,GAAG,IAAMA,EAAc,GAAG,IAAMA,EAAc,GAAGA,EAAc,GAAG9yB,OAAS,IAAM8yB,EAAc,GAAGA,EAAc,GAAG9yB,OAAS,IAAK,CAC5KsE,QAAQ2B,KAAK,wFAAyF6sB,GACtG,MAAMI,EAAwE,QAArDnmB,EAAK4lB,EAAUhd,cAAcwd,0BAAuC,IAAPpmB,OAAgB,EAASA,EAAGomB,mBAClH,GAAID,EACA,IAAK,MAAME,KAAaF,EAAgBhd,iBAAiB,yBAA0B,CAC/E,MAAM7P,GAAMiL,OAAO8hB,EAAUlhB,aAAa,WAAa,EACvD,GAAI7L,EACA,IAAK,MAAO/E,EAAGyD,KAAW+tB,EAAcvtB,UAChCR,EAAOpE,SAAS0F,IAChB+sB,EAAU/hB,aAAa,YAAaC,OAAOhQ,GAE1D,CACR,CACJ,CAEL,GAAIgB,EAAAA,OAAOotB,sBACP,GAAI8C,EAAWxyB,OACX,IAAK,MAAM0N,KAAU8kB,EACjBa,EAAyB3lB,QAE7BpJ,QAAQC,KAAK,2RAGrB,GAAIjC,EAAAA,OAAOqtB,uBACP,GAAI6C,EAAWxyB,OACX,IAAK,MAAM0N,KAAU8kB,EACjBc,EAAuB5lB,QAE3BpJ,QAAQC,KAAK,8SAMrB,GAHIjC,EAAAA,OAAOstB,2BFx5BZ,SAAsB7d,GACzB,IAAK,MAAM7I,KAAW6I,EAClB,IAAK,MAAMka,KAAW/iB,EAAQzH,UAAUyD,OAAQ,CAC5C,MAAMwpB,EAAQlqB,EAASmB,QAAQT,OAAOqF,IAAI0hB,GAC1C,IAAKyC,EAAO,CACRpqB,QAAQsC,MAAM,mCAAmCqlB,yCACjD,QACH,CACD,MAAMsH,EAAgB1pB,IAClB,IAAK,MAAMqC,KAAOrC,GACTqC,EAAIsI,0BAA6BtI,EAAIhC,MAAQgC,EAAIhC,OAAShB,EAAQiB,UAAc+B,EAAIjC,YAAcf,EAAQzH,UAAUyD,OAAOvE,SAASuL,EAAIjC,aAE5If,EAAQzH,UAAUmH,MAAM+D,QAAQT,EAAIsI,4BAA8BtL,EAAQzH,UAAUmH,MAAM+D,QAAQT,EAAIsI,0BAA4B,KAC9HxJ,KAAK,CAAEgB,OAAQ,+CAA+C0iB,EAAMjiB,eAAgBzC,SAAUkC,EAAK1K,MAAO,GAClH,EAEDktB,EAAM7kB,WACN0pB,EAAa7E,EAAM7kB,WACvB,MAAM2pB,EAAmBnM,EAA0BqH,EAAOxlB,GAC1D,GAAIsqB,EAAiB1rB,OACjB,IAAK,MAAMD,KAAS2rB,EAAiB1rB,OACjC,GAAID,EAAMd,MACN,IAAK,MAAMC,KAAQa,EAAMd,MAAO,CAC5B,KAAM,SAAUC,GACZ,SACJ,MAAMC,EAAOzC,EAASmB,QAAQZ,OAAOwF,IAAIvD,EAAKC,MACzCA,EAIDA,EAAK4C,YAAc,CAAC,OAAQ,aAAalJ,SAASsG,EAAKwE,aACvDnH,QAAQ2B,KAAK,4CAA4CyoB,EAAMjiB,gBAAgBxF,EAAKwE,aAAaxE,EAAKwF,SAASxF,EAAK4C,UAAU7J,eAC9HuzB,EAAatsB,EAAK4C,YALlBvF,QAAQsC,MAAM,kCAAkCI,EAAKC,gFAO5D,CAChB,CAET,CEo3BYwsB,CAAqB1hB,GAErBzP,EAAAA,OAAOwtB,2BAA4B,CACnC,MAAM4D,EAAU5zB,SAASoW,iBAAiB,6BACtCwd,EAAQ1zB,ODh/BjB,SAA2B2zB,GAC9B,MAAMC,EAA8B7hB,EAAS3O,KAAIywB,IAC7C,MAAMnhB,EAAS,CAAA,EACf,IAAK,MAAOrM,EAAIytB,KAAMjvB,OAAOU,QAAQsuB,EAAIpyB,UAAUwR,eAAgB,CAC/D,IAAIL,GACCA,EAAOpO,EAASmB,QAAQV,MAAMsF,KAAKlE,KAAQ,YAAauM,GAAwB,YAAhBA,EAAKC,UACtEH,GAAQrM,GAAMytB,EACrB,CACD,OAAOphB,CAAM,IAEXqhB,EAAsBhiB,EAAS3O,KAAIywB,IACrC,IAAK,MAAOxtB,EAAIytB,KAAMjvB,OAAOU,QAAQsuB,EAAIpyB,UAAUwR,eAAgB,CAC/D,IAAIL,EACJ,IAAKA,EAAOpO,EAASmB,QAAQV,MAAMsF,KAAKlE,KAAQ,YAAauM,GAAwB,cAAhBA,EAAKC,QACtE,OAAOxM,CACd,KAEL,IAAK,MAAMsK,KAAWgjB,EAAU,CAC5B,GAAIhjB,EAAQgG,kBAAoB,EAC5B,SACJ,MAAOqd,KAAWC,GAActjB,EAAQiF,SACxC,GAAoC,SAAhCoe,EAAO9hB,aAAa,QACpB,SACJ,MAAMgiB,GAAW5iB,OAAO0iB,EAAO9hB,aAAa,gBAAkB,EACxDiiB,EAAaF,EAAW7tB,QAAOguB,GAAgC,SAA3BA,EAAEliB,aAAa,SAAsBkiB,EAAEliB,aAAa,YACrFZ,OAAO0iB,EAAO9hB,aAAa,gBAAkB,KAAOgiB,IACxD9wB,KAAIgxB,GAAKA,EAAEliB,aAAa,WAC7B,CACI,IAAI7L,EAAIuM,EACR,IAAKvM,GAAMiL,OAAO0iB,EAAO9hB,aAAa,aAAeU,EAAOpO,EAASmB,QAAQV,MAAMsF,IAAIlE,KAAQ,UAAWuM,EACtG,IAAK,MAAMvL,KAAQuL,EAAKtL,MACpB,GAAY,YAARD,EAAoB,CACpB,MAAMgtB,EAAqBT,EAA4BM,GACvD,IAAK,MAAMI,KAAczvB,OAAOuO,KAAKihB,GAAqB,CACtDF,EAAWnpB,KAAKspB,KACVD,EAAmBC,GAAc,UAC5BD,EAAmBC,GAE9B,KACH,CACJ,MACI,GAAY,cAARjtB,EAAsB,CAC3B,MAAMktB,EAAaR,EAAoBG,GACnCK,GACAJ,EAAWnpB,KAAKupB,EACvB,CAGZ,CACD,MAAMC,EAAaL,EAAW5wB,KAAK,KAC/BixB,GACAR,EAAO3iB,aAAa,UAAWmjB,EACtC,CACL,CC47BgBC,CAAkBf,GAElBpvB,QAAQC,KAAK,kNAEpB,CACD,GAAIjC,EAAAA,OAAOutB,iCACP,IAAK,MAAM3mB,KAAW6I,EAClBoc,EAA6BjlB,GAGrC,IAAK,MAAOkE,EAAWwE,KAAa8gB,EAAWpe,WAC3C,IAAK,MAAM3B,KAAWf,EAClBmG,EAAiBpF,EAASvF,EAEjC,GAET"}