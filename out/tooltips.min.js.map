{"version":3,"file":"tooltips.min.js","sources":["../src/TUtilsV2.ts","../src/API.ts","../src/APICache.ts","../src/CharacterAttributes.ts","../src/FactsProcessor.ts","../src/Collect.ts","../src/Inflators.ts","../src/TooltipsV2.ts"],"sourcesContent":["export function newElm(spec, ...inner) {\n    const [tag, ...classes] = spec.split('.');\n    const el = document.createElement(tag);\n    if (classes.length)\n        el.classList.add(...classes);\n    if (inner.length)\n        el.append(...inner);\n    return el;\n}\nexport function formatImageUrl(id) {\n    return `https://assets.gw2dat.com/${id}.png`;\n}\nconst missingImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABuCAIAAACfnGvJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMCSURBVHhe7ZjpkeowEAaJywERD9GQDMGwumyPLj+2XssH+/UPyjMjjVBjUWXf3oJGTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSU51inr8d0u02PVwp/xf/MHQvt9Hm/Be7PlMgIHhyzCjn9hNlpc7ebxe9hhNPp8QifpTdfuz9Oe3thjHH6Cndkfv7DWb0/syNbnN8QJuzkZr5q5K+Xk2C6BtbCTDEAZJDTuIfKi0tUKuZgHhBx89P1Zj5rtK4YQzspL43z6RnltFBR5DMVKVhGFPTy3UYBO6vo0GuIMcxpvs1O2gbhei0tbOazRusvmCe+x6nddDtbBA4/LmEFNfN1o57TOD0F5ZIDGOh0CbL91SrqDYZ07iiQ5etGdrxNpGkz9XowQ53GG2Sa7H5rFc095n1W1nzdqOPUXzbXGMVYp1FqlqlVxMCNXEd9kG806t2n87cw2KE4g53mO/fUKrJgxkzp5Ou5Paf//E4wtNPzUelupki+32k8+cZgMDpQ6V9w6ij+UAeee8/fcLovcsojpzxyyiOnPHLKI6c8csqDOx39MH0B5JRHTnmGO00v2uKLi0B8e7E8ghf+7aP5RimyDrC1ga9HPmIXp2ajy95tvEhwUaHJlpaouUandgD7OF3MpHijbrAlf13MmsOwoulQxruzu9NfGLClvtO6QTF2d87mNISWuWT7ZGtUMwJy2nLVKK2YBcqGx3Mmp+XUomQqGUcf9YpT3afZ2BBUoWFpElqYnm7ooY5P9n8a9QRcDz83lfylFdVcJnGoUAfudAjlD+FopM7CNZy27/aTKr2KU4c93Y6jD/gG13F6HeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklOb9/gEv6oxxwmIw6QAAAABJRU5ErkJggg==';\nexport function newImg(src, className, alt) {\n    const img = document.createElement('img');\n    img.src = src ? formatImageUrl(src) : missingImage;\n    if (className)\n        img.classList.add(className);\n    img.alt = alt ? alt + ' icon' : 'icon';\n    return img;\n}\nexport function fromHTML(html) {\n    const dummy = document.createElement('template');\n    dummy.innerHTML = html;\n    return dummy.content;\n}\nexport const GW2Text2HTML = (text, ...formatArgs) => text\n    ? text\n        .replaceAll(/<c=(#.*?)>(.*?)<\\/c>/g, `<span style=\"color: $1;\">$2</span>`)\n        .replaceAll(/<c=@(.*?)>(.*?)<\\/c>/g, `<span class=\"gw2-color-$1\">$2</span>`)\n        .replaceAll('[lbracket]', '[').replaceAll('[rbracket]', ']')\n        .replaceAll('[null]', '')\n        .replaceAll('\\n', '<br />')\n        .replaceAll(/%str(\\d)%/g, (_, i) => formatArgs[+i - 1] || '')\n        .replaceAll('%%', '%')\n    : '';\nexport const resolveInflections = (text, count, character) => text\n    .replaceAll('[s]', count > 1 ? 's' : '')\n    .replaceAll(/(\\S+)\\[pl:\"(.+?)\"]/g, count > 1 ? '$2' : '$1')\n    .replaceAll(/(\\S+)\\[f:\"(.+?)\"]/g, character.sex == \"Female\" ? '$2' : '$1');\nexport function n3(v) { return withUpToNDigits(v, 3); }\nexport function withUpToNDigits(x, digits) {\n    let str = x.toFixed(digits);\n    while (str.charAt(str.length - 1) === '0')\n        str = str.slice(0, -1);\n    if (str.charAt(str.length - 1) === '.')\n        str = str.slice(0, -1);\n    return str;\n}\nexport function s(v) { return v >= 0 ? '+' + v : v; }\nexport function n3s(v) { return v >= 0 ? '+' + n3(v) : n3(v); }\nexport function n3ss(v) { return v >= 0 ? '+ ' + n3(v) : '- ' + -n3(v); }\nexport function formatFraction(value, config) {\n    if (!config.showPreciseAbilityTimings) {\n        const sign = value < 0 ? '-' : '';\n        value = Math.abs(value);\n        const index = (Math.min(Math.round((value % 1) * 4), 4));\n        let fraction = '';\n        switch (index) {\n            case 0:\n            case 4:\n                {\n                    value = Math.round(value);\n                    break;\n                }\n            case 1: {\n                value = Math.floor(value);\n                fraction = '¼';\n                break;\n            }\n            case 2: {\n                value = Math.floor(value);\n                fraction = '½';\n                break;\n            }\n            case 3: {\n                value = Math.floor(value);\n                fraction = '¾';\n                break;\n            }\n        }\n        if (value == 0 && fraction == '') {\n            return '0';\n        }\n        return `${sign}${value > 0 ? value : ''}${fraction}`;\n    }\n    else {\n        return withUpToNDigits(value, 3);\n    }\n}\nexport function formatDuration(value, config) {\n    value /= 1000;\n    if (value >= 3600)\n        return formatFraction(value / 3600, config) + 'h';\n    else if (value > 60)\n        return formatFraction(value / 60, config) + 'min';\n    else\n        return formatFraction(value, config) + 's';\n}\nexport function localizeInternalName(type) {\n    switch (type) {\n        case 'ConditionDuration': return 'Condition Duration';\n        case 'ConditionDamage': return 'Condition Damage';\n        case 'HealingPower': return 'Healing Power';\n        case 'BowLong': return 'Longbow';\n        case 'BowShort': return 'Shortbow';\n        case 'Projectile20': return 'Projectile (20% Chance)';\n        case 'MagicFind': return 'Magic Find';\n        case 'CritChance': return 'Critical Chance';\n        case 'CritDamage': return 'Critical Damage';\n        case 'BoonDuration': return 'Boon Duration';\n        default: return type;\n    }\n}\nexport function findSelfOrParent(self, selector, depth = 10) {\n    let current = self;\n    while (current && depth-- > 0 && !current.matches(selector))\n        current = current.parentElement;\n    if (depth == 0)\n        return null;\n    return current;\n}\nexport function joinWordList(words, quoteWords = false) {\n    if (quoteWords)\n        words = words.map(w => `'${w}'`);\n    switch (words.length) {\n        case 0: return '';\n        case 1: return words[0];\n        default:\n            const last = words[words.length - 1];\n            return words.slice(0, -1).join(', ') + ' and ' + last;\n    }\n}\nexport function IsDevIcon(ico) {\n    return [2141735, 2141736, 2141737].includes(ico);\n}\n//# sourceMappingURL=TUtilsV2.js.map","export class FakeAPI {\n    constructor() {\n        this.localAPI = new HSAPI('http://localhost:3000');\n        this.fallbackAPI = new HSAPI();\n        this.localApiOffline = false;\n    }\n    async bulkRequest(endpoint, ids) {\n        try {\n            return await (this.localApiOffline ? this.fallbackAPI : this.localAPI).bulkRequest(endpoint, ids);\n        }\n        catch (ex) {\n            if (ex === null || ex === void 0 ? void 0 : ex.message.includes(\"NetworkError\")) {\n                this.localApiOffline = true;\n                console.warn(`[gw2-tooltips] [FakeAPI] Local api seems to be offline, swapping to the real one.\\n${ex}`);\n            }\n            else {\n                console.warn(`[gw2-tooltips] [FakeAPI] Error trying to get ep '${endpoint}' from localhost, will try to use the fallback API.\\n${ex}`);\n            }\n            return await this.fallbackAPI.bulkRequest(endpoint, ids);\n        }\n    }\n}\nexport class HSAPI {\n    constructor(baseUrl = 'https://api-v0.hardstuck.gg') {\n        this.baseUrl = baseUrl;\n    }\n    async bulkRequest(endpoint, ids) {\n        return fetch(`${this.baseUrl}/${endpoint}?ids=${ids.join(',')}`, HSAPI.WORKER_CACHE_INIT).then(r => r.json());\n    }\n}\nHSAPI.WORKER_CACHE_INIT = { headers: { [\"X-TTJS-Worker-Cached\"]: '1' } };\n//# sourceMappingURL=API.js.map","class APICache {\n    static async ensureExistence(endpoint, initialIds, validateResponse) {\n        if (!this.apiImpl) {\n            this.apiImpl = new HSAPI();\n        }\n        let additionalIds = Object.assign({\n            skills: new Set(),\n            items: new Set(),\n            traits: new Set(),\n            pets: new Set(),\n            'pvp/amulets': new Set(),\n            specializations: new Set(),\n            itemstats: new Set(),\n            palettes: new Set(),\n            professions: new Set,\n        }, { [endpoint]: new Set(initialIds) });\n        const findNextRelevantEndpoint = () => {\n            for (const [endpoint, ids] of Object.entries(additionalIds))\n                if (ids.size > 0)\n                    return endpoint;\n            return undefined;\n        };\n        let didCollectPalettes = false;\n        let currentEndpoint = endpoint;\n        let i = 0;\n        do {\n            if (currentEndpoint == 'palettes')\n                didCollectPalettes = true;\n            const storageSet = this.storage[currentEndpoint];\n            const request = Array.from(additionalIds[currentEndpoint].values());\n            additionalIds[currentEndpoint].clear();\n            console.info(`[gw2-tooltips] [API cache] round #${i++} for a ${endpoint} request, currently fetching ${currentEndpoint}. Ids: `, request);\n            try {\n                const response = await this.apiImpl.bulkRequest(currentEndpoint, request);\n                if (validateResponse) {\n                    const unobtainable = request.filter(id => !response.some(obj => obj.id == id));\n                    if (unobtainable.length)\n                        console.warn(`[gw2-tooltips] [API cache] Did not receive all requested ${currentEndpoint} ids. missing: `, unobtainable);\n                }\n                for (const datum of response) {\n                    if (storageSet.has(datum.id))\n                        continue;\n                    storageSet.set(datum.id, datum);\n                    this.collectConnectedIds(datum, additionalIds, didCollectPalettes);\n                }\n            }\n            catch (ex) {\n                console.error(ex);\n            }\n        } while ((currentEndpoint = findNextRelevantEndpoint()) && i < 100);\n    }\n    static collectConnectedIds(datum, connectedIdsStorage, didCollectPalettes) {\n        const addFacts = (facts) => {\n            for (const fact of facts) {\n                if (fact.type == 'Buff' || fact.type == 'BuffBrief') {\n                    if (!this.storage.skills.has(fact.buff))\n                        connectedIdsStorage.skills.add(fact.buff);\n                }\n                if (fact.type === 'PrefixedBuffBrief' || fact.type === 'PrefixedBuff') {\n                    if (!this.storage.skills.has(fact.prefix))\n                        connectedIdsStorage.skills.add(fact.prefix);\n                    if (!this.storage.skills.has(fact.buff))\n                        connectedIdsStorage.skills.add(fact.buff);\n                }\n            }\n        };\n        if (!didCollectPalettes && 'palettes' in datum)\n            for (const palette of datum.palettes) {\n                if (!this.storage.palettes.has(palette))\n                    connectedIdsStorage.palettes.add(palette);\n            }\n        if ('groups' in datum)\n            for (const group of datum.groups) {\n                for (const candidate of group.candidates) {\n                    if (!this.storage.skills.has(candidate.skill))\n                        connectedIdsStorage.skills.add(candidate.skill);\n                }\n            }\n        if ('related_skills' in datum) {\n            for (const subSkill of datum.related_skills)\n                if (!this.storage.skills.has(subSkill))\n                    connectedIdsStorage.skills.add(subSkill);\n        }\n        if ('ambush_skills' in datum) {\n            for (const subSkill of datum.ambush_skills)\n                if (!this.storage.skills.has(subSkill.id))\n                    connectedIdsStorage.skills.add(subSkill.id);\n        }\n        if ('bundle_skills' in datum) {\n            for (const subSkill of datum.bundle_skills)\n                if (!this.storage.skills.has(subSkill))\n                    connectedIdsStorage.skills.add(subSkill);\n        }\n        if ('blocks' in datum)\n            for (const block of datum.blocks) {\n                if (block.facts)\n                    addFacts(block.facts);\n            }\n        if ('override_groups' in datum) {\n            for (const { blocks } of datum.override_groups)\n                if (blocks)\n                    for (const block of blocks)\n                        if (block.facts)\n                            addFacts(block.facts);\n        }\n        if ('attribute_set' in datum) {\n            if (!this.storage.itemstats.has(datum.attribute_set))\n                connectedIdsStorage.itemstats.add(datum.attribute_set);\n        }\n        if ('skills' in datum)\n            for (const subSkillId of datum.skills) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('skills_ai' in datum)\n            for (const subSkillId of datum.skills_ai) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('skills_soulbeast' in datum)\n            for (const subSkillId of datum.skills_soulbeast) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('specialization' in datum) {\n            if (!this.storage.specializations.has(datum.specialization))\n                connectedIdsStorage.specializations.add(datum.specialization);\n        }\n        if ('applies_buff' in datum) {\n            if (!this.storage.skills.has(datum.applies_buff.buff))\n                connectedIdsStorage.skills.add(datum.applies_buff.buff);\n        }\n        if ('facts_from_skill' in datum) {\n            if (!this.storage.skills.has(datum.facts_from_skill))\n                connectedIdsStorage.skills.add(datum.facts_from_skill);\n        }\n    }\n}\nAPICache.storage = {\n    skills: new Map(),\n    items: new Map(),\n    traits: new Map(),\n    pets: new Map(),\n    'pvp/amulets': new Map(),\n    specializations: new Map(),\n    itemstats: new Map(),\n    palettes: new Map(),\n    professions: new Map(),\n};\nexport default APICache;\nimport { HSAPI } from './API';\n//# sourceMappingURL=APICache.js.map","export function recomputeAttributesFromMods(context, weaponSet) {\n    const attributeOrder = [\n        'Power', 'Toughness', 'Vitality', 'Precision', 'Ferocity', 'ConditionDamage', 'Expertise', 'Concentration', 'HealingPower', 'AgonyResistance',\n        'Health', 'Armor', 'ConditionDuration', 'BoonDuration', 'CritChance', 'CritDamage',\n    ];\n    const stats = context.character.statsWithWeapons[weaponSet !== null && weaponSet !== void 0 ? weaponSet : context.character.selectedWeaponSet];\n    const allParts = {};\n    const stage1Attributes = {};\n    const stage2Attributes = {};\n    let fakeAttributes = stage1Attributes;\n    for (const attribute of attributeOrder) {\n        const { baseAttribute, suffix, base, div } = getAttributeInformation(attribute, context.character);\n        let value = base, text;\n        const displayMul = suffix ? 100 : 1;\n        const parts = [];\n        const sources = stats.sources[attribute];\n        allParts[attribute] = { parts, sources };\n        {\n            text = `${n3(base * displayMul) + suffix} base value`;\n            if (base) {\n                text += ' from lvl 80';\n            }\n            parts.push(newElm('div.detail', text));\n            if (baseAttribute) {\n                const baseAttrValue = stage1Attributes[baseAttribute];\n                let attrValue = baseAttrValue;\n                if (attribute == 'CritChance')\n                    attrValue -= 1000;\n                const statBonus = attrValue / div;\n                value += statBonus;\n                if (statBonus) {\n                    text = ` +${n3(statBonus * displayMul) + suffix} from ${n3(baseAttrValue)} ${localizeInternalName(baseAttribute)}`;\n                    if (div != 1)\n                        text += ` / ${div / displayMul} (attrib. specific conv. factor)`;\n                    parts.push(newElm('div.detail', text));\n                }\n            }\n        }\n        let modValue = 0;\n        for (const source of sources.filter(s => !s.modifier.flags.includes('FormatPercent'))) {\n            const mod = calculateModifier(source.modifier, context.character.level, fakeAttributes) * source.count;\n            modValue += mod;\n            text = ` +${n3(mod)} from `;\n            if (source.count > 1)\n                text += `${source.count} `;\n            text += source.source;\n            parts.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n        }\n        value += modValue;\n        stage1Attributes[attribute] = value;\n    }\n    for (const attribute of attributeOrder) {\n        const { parts, sources } = allParts[attribute];\n        let modValue = 0;\n        for (const source of sources.filter(s => s.modifier.flags.includes('FormatPercent') && s.modifier.source_attribute)) {\n            const mod = calculateModifier(source.modifier, context.character.level, fakeAttributes) * source.count;\n            modValue += Math.round(mod);\n            let text = ` +${n3(mod)} (${n3(source.modifier.base_amount)}% of ${source.modifier.source_attribute}) from `;\n            if (source.count > 1)\n                text += `${source.count} `;\n            text += source.source;\n            parts.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n        }\n        stage2Attributes[attribute] = stage1Attributes[attribute] + modValue;\n    }\n    fakeAttributes = stage2Attributes;\n    for (const attribute of attributeOrder) {\n        const { suffix, cap } = getAttributeInformation(attribute, context.character);\n        ;\n        let value = stage2Attributes[attribute], text;\n        const { parts, sources } = allParts[attribute];\n        const displayMul = suffix ? 100 : 1;\n        for (const source of sources.filter(s => s.modifier.flags.includes('FormatPercent') && !s.modifier.source_attribute)) {\n            const mod = calculateModifier(source.modifier, context.character.level, fakeAttributes) * source.count / 100;\n            const toAdd = suffix ? mod : value * mod;\n            value += toAdd;\n            text = ` +${n3(toAdd * displayMul)}${suffix}`;\n            if (!suffix)\n                text += ` (${n3(mod * 100)}%)`;\n            text += ' from ';\n            if (source.count > 1)\n                text += `${source.count} `;\n            text += source.source;\n            parts.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n        }\n        const uncappedValue = value;\n        stage2Attributes[attribute] = value = Math.min(uncappedValue, cap - 1);\n        if (uncappedValue != value)\n            parts.push(newElm('span.detail.capped', `(Capped to ${n3(value * displayMul)}${suffix}! Uncapped value would be ${n3(uncappedValue * displayMul)}${suffix})`));\n        parts.unshift(newElm('tet.title', newElm('teb', ' +' + n3(value * displayMul) + suffix + ' ' + localizeInternalName(attribute))));\n    }\n    for (const attribute of attributeOrder) {\n        stats.values[attribute] = stage2Attributes[attribute];\n        stats.htmlParts[attribute] = allParts[attribute].parts;\n    }\n}\nconst ATTRIBUTE_INFO_LUT = {\n    Power: [undefined, undefined, 66722, '', 1000, 1, Number.MAX_SAFE_INTEGER],\n    Toughness: [undefined, 'Armor', 104162, '', 1000, 1, Number.MAX_SAFE_INTEGER],\n    Vitality: [undefined, 'Health', 104163, '', 1000, 1, Number.MAX_SAFE_INTEGER],\n    Precision: [undefined, 'CritChance', 156609, '', 1000, 1, Number.MAX_SAFE_INTEGER],\n    Ferocity: [undefined, 'CritDamage', 156602, '', 0, 1, Number.MAX_SAFE_INTEGER],\n    ConditionDamage: [undefined, undefined, 156600, '', 0, 1, Number.MAX_SAFE_INTEGER],\n    Expertise: [undefined, 'ConditionDuration', 156601, '', 0, 1, Number.MAX_SAFE_INTEGER],\n    Concentration: [undefined, 'BoonDuration', 156599, '', 0, 1, Number.MAX_SAFE_INTEGER],\n    HealingPower: [undefined, undefined, 156606, '', 0, 1, Number.MAX_SAFE_INTEGER],\n    AgonyResistance: [undefined, undefined, 536049, '', 0, 1, Number.MAX_SAFE_INTEGER],\n    Health: ['Vitality', undefined, 536052, '', 0, 0.1, Number.MAX_SAFE_INTEGER],\n    Armor: ['Toughness', undefined, 536048, '', 0, 1, Number.MAX_SAFE_INTEGER],\n    ConditionDuration: ['Expertise', undefined, 156601, '%', 0, 1500, 2],\n    BoonDuration: ['Concentration', undefined, 156599, '%', 0, 1500, 2],\n    CritChance: ['Precision', undefined, 536051, '%', 0.05, 2100, Number.MAX_SAFE_INTEGER],\n    CritDamage: ['Ferocity', undefined, 784327, '%', 1.5, 1500, Number.MAX_SAFE_INTEGER],\n};\nexport function getAttributeInformation(attribute, character) {\n    const _p2 = ATTRIBUTE_INFO_LUT[attribute];\n    let baseAttribute, computedAttribute, img, suffix = '', base = 0, div = 1, cap = Number.MAX_SAFE_INTEGER;\n    if (_p2)\n        [baseAttribute, computedAttribute, img, suffix, base, div, cap] = _p2;\n    if (attribute == 'Health')\n        base = getBaseHealth(character);\n    return { baseAttribute, computedAttribute, img, suffix, base, div, cap };\n}\nexport function getBaseHealth(character) {\n    return !character.profession\n        ? 1000\n        : {\n            Guardian: 1645,\n            Thief: 1645,\n            Elementalist: 1645,\n            Engineer: 5922,\n            Ranger: 5922,\n            Mesmer: 5922,\n            Revenant: 5922,\n            Necromancer: 9212,\n            Warrior: 9212,\n        }[character.profession];\n}\nfunction calculateConditionDuration(level, expertise) {\n    return expertise / (LUT_CRITICAL_DEFENSE[level] * (15 / LUT_CRITICAL_DEFENSE[80]));\n}\nfunction calculateBoonDuration(level, concentration) {\n    return concentration / (LUT_CRITICAL_DEFENSE[level] * (15 / LUT_CRITICAL_DEFENSE[80]));\n}\nexport function getAttributeValue(character, attribute) {\n    return getActiveAttributes(character)[attribute];\n}\nexport function getActiveAttributes(character) {\n    return character.statsWithWeapons[character.selectedWeaponSet].values;\n}\nexport function getAttributeSources(character, attribute) {\n    return character.statsWithWeapons[character.selectedWeaponSet].sources[attribute] || [];\n}\nexport const LUT_CRITICAL_DEFENSE = [\n    1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3.0, 3.2, 3.4, 3.6, 3.8, 4.0, 4.2, 4.4, 4.6, 4.8, 5.0, 5.2, 5.4, 5.6, 5.8, 6.0, 6.2, 6.4, 6.6, 6.8, 7.0, 7.3, 7.6, 7.9, 8.2, 8.5, 8.8, 9.1, 9.4, 9.7, 10.0, 10.3, 10.6, 10.9, 11.2, 11.5, 11.8, 12.1, 12.4, 12.7, 13.0, 13.4, 13.8, 14.2, 14.6, 15.0, 15.4, 15.8, 16.2, 16.6, 17.0, 17.4, 17.8, 18.2, 18.6, 19.0, 19.4, 19.8, 20.2, 20.6, 21.0, 21.5, 22.0, 22.5, 23.0, 23.5, 24.0, 24.5, 25.0, 25.5, 26.0, 26.5, 27.0, 27.5, 28.0, 28.5, 29.0, 29.5, 30.0, 30.5, 31.0,\n];\nexport const LUT_DEFENSE = [\n    115, 120, 125, 129, 133, 137, 142, 146, 150, 154, 162, 168, 175, 182, 189, 196, 202, 209, 216, 223, 232, 240, 248, 257, 265, 274, 282, 290, 299, 307, 319, 330, 341, 352, 363, 374, 385, 396, 407, 418, 431, 443, 456, 469, 481, 494, 506, 519, 532, 544, 560, 575, 590, 606, 621, 636, 651, 666, 682, 697, 714, 731, 748, 764, 781, 798, 815, 832, 848, 865, 885, 905, 924, 943, 963, 982, 1002, 1021, 1040, 1060, 1081, 1102, 1123, 1144, 1165, 1186, 1207, 1228, 1249, 1270, 1291, 1312, 1333, 1354, 1375, 1396, 1417, 1438, 1459, 1480, 1501,\n];\nexport const LUT_POWER_PLAYER = [\n    170, 173, 176, 179, 182, 185, 188, 191, 194, 197, 202, 207, 212, 217, 222, 227, 232, 237, 242, 247, 253, 259, 265, 271, 277, 283, 289, 295, 301, 307, 315, 323, 331, 339, 347, 355, 363, 371, 379, 387, 396, 405, 414, 423, 432, 441, 450, 459, 468, 477, 488, 499, 510, 521, 532, 543, 554, 565, 576, 587, 599, 611, 623, 635, 647, 659, 671, 683, 695, 707, 721, 735, 749, 763, 777, 791, 805, 819, 833, 847, 862, 877, 892, 907, 922, 937, 952, 967, 982, 997, 1012, 1027, 1042, 1057, 1072, 1087, 1102, 1117, 1132, 1147, 1162,\n];\nexport const LUT_POWER_MONSTER = [\n    162, 179, 197, 214, 231, 249, 267, 286, 303, 322, 344, 367, 389, 394, 402, 412, 439, 454, 469, 483, 500, 517, 556, 575, 593, 612, 622, 632, 672, 684, 728, 744, 761, 778, 820, 839, 885, 905, 924, 943, 991, 1016, 1067, 1093, 1119, 1145, 1193, 1220, 1275, 1304, 1337, 1372, 1427, 1461, 1525, 1562, 1599, 1637, 1692, 1731, 1802, 1848, 1891, 1936, 1999, 2045, 2153, 2201, 2249, 2298, 2368, 2424, 2545, 2604, 2662, 2723, 2792, 2854, 2985, 3047, 3191, 3269, 3348, 3427, 3508, 3589, 3671, 3754, 3838, 3922, 4007, 4093, 4180, 4267, 4356, 4445, 4535, 4625, 4717, 4809, 4902,\n];\nimport { calculateModifier } from \"./FactsProcessor\";\nimport { fromHTML, localizeInternalName, n3, newElm, resolveInflections } from \"./TUtilsV2\";\n//# sourceMappingURL=CharacterAttributes.js.map","export function calculateModifier({ formula, base_amount, formula_param1: level_scaling, formula_param2, source_attribute }, level, stats) {\n    let { Power, ConditionDamage, HealingPower } = stats;\n    if (source_attribute) {\n        return stats[source_attribute] * base_amount / 100;\n    }\n    switch (formula) {\n        case 'BuffLevelLinear':\n            return level * level_scaling + base_amount;\n        case 'ConditionDamage':\n            return level * level_scaling + base_amount + ConditionDamage * formula_param2;\n        case 'ConditionDamageSquared':\n            return level * level * level_scaling + base_amount + ConditionDamage * formula_param2;\n        case 'NoScaling':\n            return base_amount;\n        case 'Regeneration':\n            return level * level_scaling + base_amount + HealingPower * formula_param2;\n        case 'RegenerationSquared':\n            return level * level * level_scaling + base_amount + HealingPower * formula_param2;\n        case 'SpawnScaleLinear':\n        case 'TargetLevelLinear':\n            return level * level_scaling + base_amount;\n        case 'BuffFormulaType11':\n            return level * level_scaling + base_amount - formula_param2;\n        case 'Power':\n            return level * level_scaling + base_amount + Power * formula_param2;\n        case 'PowerSquared':\n            return level * level * level_scaling + base_amount + Power * formula_param2;\n    }\n    console.warn('[gw2-tooltips] [facts processor] Could not find formula #', formula, ', using base amount for now!');\n    return base_amount;\n}\nexport function generateFacts(blocks, weaponStrength, context) {\n    const [looseBlock, ...remainingBlocks] = blocks;\n    let totalDefianceBreak = 0;\n    const makeFactElements = (facts) => (!facts ? [] : facts\n        .sort((a, b) => a.order - b.order)\n        .map(fact => {\n        const { wrapper, defiance_break } = generateFact(fact, weaponStrength, context);\n        totalDefianceBreak += defiance_break;\n        if (wrapper)\n            wrapper.dataset.order = String(fact.order);\n        return wrapper;\n    })\n        .filter(d => d));\n    const elements = [];\n    for (const block of remainingBlocks) {\n        const wrapper = newElm('div.fact-block');\n        if (block.trait_requirements) {\n            const trait_names = joinWordList(block.trait_requirements.map(id => { var _a; return `'<span class=\"gw2-color-traited-fact\">${((_a = APICache.storage.traits.get(id)) === null || _a === void 0 ? void 0 : _a.name) || id}</span>'`; }));\n            wrapper.append(fromHTML(`<span class=\"detail\">Block exists because of trait${block.trait_requirements.length == 1 ? '' : 's'} ${trait_names}</span>`));\n        }\n        if (block.description)\n            wrapper.append(newElm('p.description', fromHTML(GW2Text2HTML(block.description))));\n        const blockFacts = makeFactElements(block.facts);\n        wrapper.append(...blockFacts);\n        elements.push(wrapper);\n    }\n    if (looseBlock)\n        elements.push(...makeFactElements(looseBlock.facts));\n    if (totalDefianceBreak > 0) {\n        const defianceWrap = newElm('div.fact', newImg(ICONS.DEFIANCE_BREAK, 'iconmed'), newElm('div.gw2-color-defiance-fact', `Total Defiance Break: ${withUpToNDigits(totalDefianceBreak, 2)}`));\n        let i = 0;\n        for (; i < elements.length; i++) {\n            const s = elements[i].dataset.order;\n            if (s && parseInt(s) > 1003)\n                break;\n        }\n        elements.splice(i, 0, defianceWrap);\n    }\n    return elements;\n}\nexport function generateFact(fact, weapon_strength, context, itemMode = false) {\n    let iconSlug = fact.icon;\n    let buffStackSize = 1;\n    let buffDuration = fact.duration;\n    let defiance_break_per_s = fact.defiance_break;\n    let activeStats = getActiveAttributes(context.character);\n    const generateBuffDescription = (buff, fact, duration, valueMod) => {\n        let modsArray = [];\n        if (buff.modifiers && !buff.description_brief && !itemMode) {\n            const relevantModifiers = buff.modifiers.filter(modifier => ((!modifier.source_trait_req || context.character.traits.has(modifier.source_trait_req))\n                && (!modifier.mode || modifier.mode === context.gameMode)));\n            let modsMap = new Map();\n            for (let i = 0; i < relevantModifiers.length; i++) {\n                const modifier = relevantModifiers[i];\n                let entry = modsMap.get(modifier.id);\n                if (!entry)\n                    modsMap.set(modifier.id, entry = { modifier: modifier, value: 0 });\n                let value = calculateModifier(modifier, context.character.level, activeStats);\n                if (modifier.source_attribute) {\n                    value *= activeStats[modifier.source_attribute];\n                }\n                entry.value += value;\n                if (modifier.flags.includes('SkipNextEntry')) {\n                    i++;\n                }\n            }\n            for (let { value, modifier } of modsMap.values()) {\n                if (modifier.flags.includes('Subtract')) {\n                    value -= 100;\n                }\n                if (modifier.flags.includes('MulByDuration')) {\n                    let this_duration = duration / 1000;\n                    if (modifier.flags.includes('DivDurationBy3')) {\n                        this_duration /= 3;\n                    }\n                    if (modifier.flags.includes('DivDurationBy10')) {\n                        this_duration /= 10;\n                    }\n                    value *= this_duration || 1;\n                }\n                if (!modifier.flags.includes('NonStacking')) {\n                    value *= fact.apply_count;\n                }\n                if (modifier.formula.includes('Regeneration'))\n                    value *= valueMod;\n                let strValue = modifier.flags.includes('FormatFraction')\n                    ? formatFraction(value, config)\n                    : Math.floor(Math.fround(value)).toString();\n                if (modifier.flags.includes('FormatPercent')) {\n                    if (value > 0) {\n                        strValue = '+ ' + strValue;\n                    }\n                    strValue += '%';\n                }\n                strValue += ' ' + modifier.description;\n                if (typeof modifier.target_attribute_or_skill === 'string') {\n                    const { computedAttribute } = getAttributeInformation(modifier.target_attribute_or_skill, context.character);\n                    if (computedAttribute) {\n                        const { div, suffix } = getAttributeInformation(computedAttribute, context.character);\n                        const displayMul = suffix ? 100 : 1;\n                        strValue += ` <span class=\"detail\">(converts to ${n3(value / div * displayMul)}${suffix} ${localizeInternalName(computedAttribute)})</span>`;\n                    }\n                }\n                modsArray.push(strValue);\n            }\n        }\n        return GW2Text2HTML(buff.description_brief || modsArray.join(', ') || buff.description);\n    };\n    const applyMods = (baseDuration, buff, detailStack) => {\n        let durMod = 1, valueMod = 1, cap = Number.MAX_SAFE_INTEGER;\n        const durationAttr = (buff.buff_type == 'Boon' && 'BoonDuration') || (buff.buff_type == 'Condition' && 'ConditionDuration');\n        if (durationAttr) {\n            const { baseAttribute, div, cap: cap_ } = getAttributeInformation(durationAttr, context.character);\n            cap = cap_;\n            const attribVal = getAttributeValue(context.character, baseAttribute);\n            durMod += attribVal / div;\n            if (attribVal > 0 && config.showFactComputationDetail) {\n                detailStack.push(`base duration: ${n3(baseDuration / 1000)}s`);\n                detailStack.push(`+ ${n3(baseDuration / 1000 * attribVal / div)}s (${n3(attribVal / div * 100)}%) from ${n3(attribVal)} ${baseAttribute}`);\n            }\n            for (const source of getAttributeSources(context.character, durationAttr)) {\n                let mod = calculateModifier(source.modifier, context.character.level, activeStats) * source.count;\n                const innerSuffix = source.modifier.flags.includes('FormatPercent') ? '%' : '';\n                const displayMul = innerSuffix ? 100 : 1;\n                mod /= displayMul;\n                durMod += mod;\n                const toAdd = innerSuffix ? mod * baseDuration : mod;\n                if (config.showFactComputationDetail) {\n                    let text = `+ ${n3(toAdd / 1000)}s`;\n                    if (innerSuffix)\n                        text += ` (${n3(mod * displayMul)}%)`;\n                    text += ' from ';\n                    if (source.count > 1)\n                        text += `${source.count} `;\n                    text += source.source;\n                    detailStack.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n                }\n            }\n        }\n        let durModStack = getAttributeSources(context.character, buff.id);\n        if (durModStack.length) {\n            if (durMod === 1 && config.showFactComputationDetail)\n                detailStack.push(`base duration: ${n3(baseDuration / 1000)}s`);\n            let percentMod = 0;\n            for (const { source, modifier, count } of durModStack) {\n                const mod = calculateModifier(modifier, context.character.level, activeStats);\n                if (config.showFactComputationDetail)\n                    detailStack.push(newElm('span.detail', `${n3ss(baseDuration / 1000 * mod / 100)}s (${n3(mod)}%) from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                percentMod += mod;\n            }\n            durMod += percentMod / 100;\n        }\n        const uncappedMod = durMod;\n        durMod = Math.min(uncappedMod, cap);\n        if (durMod != uncappedMod && config.showFactComputationDetail) {\n            detailStack.push(newElm('span.detail', `(Capped to ${n3(baseDuration / 1000 * cap)}s! Uncapped duration would be ${n3(baseDuration / 1000 * uncappedMod)}s)`));\n        }\n        baseDuration *= durMod;\n        if (buff.name.includes('Regeneration')) {\n            let valueModStack = getAttributeSources(context.character, 'HealEffectiveness');\n            if (valueModStack.length) {\n                if (config.showFactComputationDetail)\n                    detailStack.push('regeneration value mods:');\n                let percentMod = 0;\n                for (const { source, modifier, count } of valueModStack) {\n                    let mod = calculateModifier(modifier, context.character.level, activeStats);\n                    if (modifier.source_attribute)\n                        mod *= 100;\n                    if (config.showFactComputationDetail) {\n                        const conversion = modifier.source_attribute\n                            ? `${n3ss(mod)}% from ${n3(modifier.base_amount)} * ${n3(activeStats[modifier.source_attribute])} ${localizeInternalName(modifier.source_attribute)}`\n                            : `${n3ss(mod)}%`;\n                        detailStack.push(newElm('span.detail', `${conversion} from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    }\n                    percentMod += mod;\n                }\n                valueMod += percentMod / 100;\n            }\n        }\n        return [baseDuration, valueMod];\n    };\n    const factInflators = {\n        AdjustByAttributeAndLevel: ({ fact }) => {\n            var _a;\n            let value = (fact.value + context.character.level ** fact.level_exponent * fact.level_multiplier) * fact.hit_count;\n            let attributeVal = 0;\n            if (fact.attribute) {\n                attributeVal = getAttributeValue(context.character, fact.attribute);\n                value += attributeVal * fact.attribute_multiplier * fact.hit_count;\n            }\n            const lines = [];\n            if (config.showFactComputationDetail) {\n                lines.push(`${n3(fact.value)} base value`);\n                if (fact.level_multiplier)\n                    lines.push(`+ ${n3(context.character.level ** fact.level_exponent * fact.level_multiplier)} from lvl ${context.character.level} ^ ${n3(fact.level_exponent)} lvl exp. * ${n3(fact.level_multiplier)} lvl mul.`);\n                if (fact.attribute)\n                    lines.push(`+ ${n3(attributeVal * fact.attribute_multiplier)} from ${n3(attributeVal)} ${localizeInternalName(fact.attribute)} * ${n3(fact.attribute_multiplier)} attrib. mod.`);\n                if (fact.hit_count != 1)\n                    lines.push(` * ${fact.hit_count} hits`);\n            }\n            if ((_a = fact.text) === null || _a === void 0 ? void 0 : _a.includes('Heal')) {\n                let percentMod = 100;\n                for (const { source, modifier, count } of getAttributeSources(context.character, 'HealEffectiveness')) {\n                    let mod = calculateModifier(modifier, context.character.level, activeStats);\n                    if (modifier.source_attribute)\n                        mod *= 100;\n                    if (config.showFactComputationDetail) {\n                        const conversion = modifier.source_attribute\n                            ? `${n3(mod)}% from ${n3(modifier.base_amount)} * ${n3(activeStats[modifier.source_attribute])} ${localizeInternalName(modifier.source_attribute)}`\n                            : `${n3(mod)}%`;\n                        lines.push(newElm('span.detail', `${n3ss(mod / 100 * value)} (${conversion}) from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    }\n                    percentMod += mod;\n                }\n                value *= percentMod / 100;\n            }\n            lines.unshift(`${GW2Text2HTML(fact.text) || localizeInternalName(fact.attribute)}: ${Math.round(value)}`);\n            return lines;\n        },\n        AttributeAdjust: ({ fact }) => {\n            const value = Math.round((fact.range[1] - fact.range[0]) / (context.character.level / 80) + fact.range[0]);\n            const parts = [`${GW2Text2HTML(fact.text) || localizeInternalName(fact.target)}: ${n3s(value)}`];\n            const { computedAttribute } = getAttributeInformation(fact.target, context.character);\n            if (computedAttribute) {\n                const { div, suffix } = getAttributeInformation(computedAttribute, context.character);\n                const displayMul = suffix ? 100 : 1;\n                parts.push(`(converts to ${n3(value / div * displayMul)}${suffix} ${localizeInternalName(computedAttribute)})`);\n            }\n            return parts;\n        },\n        Buff: ({ fact, buff }) => {\n            if (!buff) {\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n                buff = MISSING_BUFF;\n            }\n            iconSlug = buff.icon || iconSlug;\n            const parts = [];\n            let valueMod;\n            [buffDuration, valueMod] = applyMods(fact.duration, buff, parts);\n            let buffDescription = generateBuffDescription(buff, fact, buffDuration, valueMod);\n            if (buffDescription) {\n                if (itemMode)\n                    buffDescription = `:<div style=\"margin-left: 0.5em;\">${buffDescription}</div>`;\n                else\n                    buffDescription = `: ${buffDescription}`;\n            }\n            const seconds = buffDuration > 0 ? ` (${formatDuration(buffDuration, config)})` : '';\n            parts.unshift(`${GW2Text2HTML(resolveInflections(fact.text || buff.name_brief || buff.name, -1, context.character))}${seconds}${buffDescription}`);\n            buffStackSize = fact.apply_count;\n            return parts;\n        },\n        BuffBrief: ({ fact, buff }) => {\n            if (!buff) {\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n                buff = MISSING_BUFF;\n            }\n            iconSlug = buff.icon || iconSlug;\n            return [`${GW2Text2HTML(fact.text, buff.name)}`];\n        },\n        Distance: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${Math.round(fact.distance)}`];\n        },\n        Number: ({ fact: { text, value } }) => {\n            const lines = [];\n            if (defiance_break_per_s && text && text.includes('Defiance')) {\n                const modifiers = getAttributeSources(context.character, 'Stun');\n                if (modifiers.length) {\n                    if (config.showFactComputationDetail)\n                        lines.push(`${n3(value)} base value`);\n                    let percentMod = 100;\n                    for (const { source, modifier, count } of modifiers) {\n                        const mod = calculateModifier(modifier, context.character.level, activeStats);\n                        if (config.showFactComputationDetail)\n                            lines.push(newElm('span.detail', `${n3ss(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                        percentMod += mod;\n                    }\n                    const mod = percentMod / 100;\n                    value *= mod;\n                    defiance_break_per_s *= mod;\n                }\n            }\n            lines.unshift(`${GW2Text2HTML(text)}: ${formatFraction(value, config)}`);\n            return lines;\n        },\n        Percent: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${formatFraction(fact.percent, config)}%`];\n        },\n        PercentHpSelfDamage: ({ fact }) => {\n            const hpPool = getAttributeValue(context.character, 'Health');\n            return [`${GW2Text2HTML(fact.text)}: ${Math.floor(hpPool * fact.percent / 100)} (${formatFraction(fact.percent, config)}% HP pool)`];\n        },\n        PercentLifeForceCost: ({ fact: { percent, text } }) => {\n            const hpPool = getBaseHealth(context.character);\n            const lines = [];\n            lines.push(`${GW2Text2HTML(text)}: ${n3(Math.round(hpPool * percent * 0.01))}`);\n            if (config.showFactComputationDetail)\n                lines.push(`from ${n3(percent)}% * ${n3(hpPool)} HP base pool`);\n            return lines;\n        },\n        PercentHealth: ({ fact: { percent, text } }) => {\n            const raw = Math.round(getAttributeValue(context.character, 'Health') * percent * 0.01);\n            return [`${GW2Text2HTML(text)}: ${formatFraction(percent, config)}% (${raw} HP)`];\n        },\n        PercentLifeForceGain: ({ fact: { percent, text } }) => {\n            const hpPool = getAttributeValue(context.character, 'Health');\n            const lines = [];\n            if (config.showFactComputationDetail) {\n                lines.push(`${n3(percent * 0.01 * hpPool * 0.69)} from ${n3(percent)}% * (${n3(hpPool)} HP * 0.69) pool (${n3(getBaseHealth(context.character))} base pool modified by ${n3(getAttributeValue(context.character, 'Vitality'))} Vitality)`);\n            }\n            const modifiers = getAttributeSources(context.character, 'LifeForce');\n            if (modifiers.length) {\n                let percentMod = 100;\n                for (const { source, modifier, count } of modifiers) {\n                    const mod = calculateModifier(modifier, context.character.level, activeStats);\n                    if (config.showFactComputationDetail)\n                        lines.push(newElm('span.detail', `${n3ss(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                percent *= percentMod / 100;\n            }\n            lines.unshift(`${GW2Text2HTML(text)}: ${formatFraction(percent, config)}% (${Math.round(hpPool * 0.69 * percent * 0.01)})`);\n            return lines;\n        },\n        Damage: ({ fact: { dmg_multiplier, hit_count, text }, weaponStrength }) => {\n            const lines = [];\n            const power = getAttributeValue(context.character, 'Power');\n            let damage = dmg_multiplier * hit_count * weaponStrength * power / context.targetArmor;\n            if (config.showFactComputationDetail) {\n                lines.push(`${n3(damage)} from ${n3(dmg_multiplier)} internal mod. * ${n3(power)} power * ${weaponStrength} avg. weapon str. / ${context.targetArmor} target armor`);\n                if (hit_count != 1)\n                    lines.push(`* ${hit_count} hits`);\n            }\n            const precision = getAttributeValue(context.character, 'Precision');\n            const ferocity = getAttributeValue(context.character, 'Ferocity');\n            const critChance = Math.min(0.05 + (precision - 1000) / 21 * 0.01, 1);\n            const critDamage = 1.5 + ferocity / 15 * 0.01;\n            const moreDmgFromCrit = damage * critChance * (critDamage - 1);\n            damage += moreDmgFromCrit;\n            if (config.showFactComputationDetail) {\n                lines.push(`+ ${n3(moreDmgFromCrit)} (${n3(critChance * (critDamage - 1) * 100)}%) from ${n3(critChance * 100)}% crit chance and ${n3(critDamage * 100)}% damage on crit (${n3(precision)} precision and ${n3(ferocity)} ferocity)`);\n            }\n            const modifiers = getAttributeSources(context.character, 'Damage');\n            if (modifiers.length) {\n                let percentMod = 100;\n                for (const { source, modifier, count } of modifiers) {\n                    const mod = calculateModifier(modifier, context.character.level, activeStats);\n                    if (config.showFactComputationDetail)\n                        lines.push(newElm('span.detail', `${n3ss(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                damage *= percentMod / 100;\n            }\n            const times = hit_count > 1 ? `(${hit_count}x)` : '';\n            lines.unshift(`${GW2Text2HTML(text)}${times}: ${Math.round(damage)}`);\n            return lines;\n        },\n        Time: ({ fact: { text } }) => {\n            const lines = [];\n            if (defiance_break_per_s && text && (text.includes('Stun') || text.includes('Daze')\n                || text.includes('Defiance'))) {\n                const modifiers = getAttributeSources(context.character, 'Stun');\n                if (modifiers.length) {\n                    if (config.showFactComputationDetail)\n                        lines.push(`${n3(buffDuration / 1000)}s base duration`);\n                    let percentMod = 100;\n                    for (const { source, modifier, count } of modifiers) {\n                        const mod = calculateModifier(modifier, context.character.level, activeStats);\n                        if (config.showFactComputationDetail)\n                            lines.push(newElm('span.detail', `${n3ss(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                        percentMod += mod;\n                    }\n                    buffDuration *= percentMod / 100;\n                }\n            }\n            const time = buffDuration != 1000 ? 'seconds' : 'second';\n            lines.unshift(`${GW2Text2HTML(text)}: ${formatFraction(buffDuration / 1000, config)} ${time}`);\n            return lines;\n        },\n        ComboField: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${localizeInternalName(fact.field_type)}`];\n        },\n        ComboFinisher: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${localizeInternalName(fact.finisher_type)}`];\n        },\n        AttributeConversion: ({ fact }) => {\n            return [`Gain ${localizeInternalName(fact.target)} Based on a Percentage of ${localizeInternalName(fact.source)}: ${fact.percent}%`];\n        },\n        NoData: ({ fact }) => {\n            return [GW2Text2HTML(fact.text)];\n        },\n        PrefixedBuff: ({ fact, buff }) => {\n            let prefix = APICache.storage.skills.get(fact.prefix);\n            if (!prefix) {\n                console.error('[gw2-tooltips] [facts processor] prefix #', fact.prefix, ' is apparently missing in the cache');\n                prefix = MISSING_BUFF;\n            }\n            iconSlug = prefix.icon || iconSlug;\n            if (!buff) {\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n                buff = MISSING_BUFF;\n            }\n            let { duration, apply_count, text } = fact;\n            const parts = [];\n            let valueMod;\n            [buffDuration, valueMod] = applyMods(duration, buff, parts);\n            let buffDescription = generateBuffDescription(buff, fact, buffDuration, valueMod);\n            if (buffDescription) {\n                buffDescription = `: ${buffDescription}`;\n            }\n            const seconds = buffDuration > 0 ? ` (${formatDuration(buffDuration, config)})` : '';\n            parts.unshift(newElm('div.fact', generateBuffIcon(buff.icon, apply_count), newElm('span', fromHTML(`${GW2Text2HTML(text) || buff.name_brief || buff.name}${seconds}${buffDescription}`))));\n            return parts;\n        },\n        PrefixedBuffBrief: ({ fact, buff }) => {\n            let prefix = APICache.storage.skills.get(fact.prefix);\n            if (!prefix) {\n                console.error('[gw2-tooltips] [facts processor] prefix #', fact.prefix, ' is apparently missing in the cache');\n                prefix = MISSING_BUFF;\n            }\n            iconSlug = prefix.icon || iconSlug;\n            if (!buff) {\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n                buff = MISSING_BUFF;\n            }\n            let node = newElm('div.fact', newImg(buff.icon), newElm('span', `${GW2Text2HTML(fact.text) || buff.name_brief || buff.name}`));\n            return [node];\n        },\n        Range: ({ fact: { min, max } }) => {\n            return [`Range: ${min ? `${min} - ${max}` : max}`];\n        },\n        StunBreak: () => {\n            return [\"Breaks Stun\"];\n        },\n    };\n    const buff = APICache.storage.skills.get(fact.buff || 0);\n    const data = { fact, buff, weaponStrength: weapon_strength };\n    const [firstLine, ...remainingDetail] = factInflators[fact.type](data);\n    const wrapper = newElm('div.fact');\n    if (fact.requires_trait) {\n        wrapper.classList.add('gw2-color-traited-fact');\n    }\n    let defianceBreak = 0;\n    if (defiance_break_per_s) {\n        let effectiveBuffDuration = buffDuration || 1000;\n        let breakDetail = '';\n        if (buffDuration < 1000 && fact.text && (fact.text.includes('Stun') || fact.text.includes('Daze') || fact.text.includes('Float') || fact.text.includes('Knockdown'))) {\n            effectiveBuffDuration = 1000;\n            breakDetail = ' (hard CC -> min = 100)';\n        }\n        else if (effectiveBuffDuration != 1000) {\n            breakDetail = ` (${fact.defiance_break}/s)`;\n        }\n        defianceBreak = defiance_break_per_s * effectiveBuffDuration / 1000;\n        remainingDetail.push(newElm('span.detail.gw2-color-defiance-fact', `Defiance Break: ${withUpToNDigits(defianceBreak, 2)}${breakDetail}`));\n    }\n    if (fact.requires_trait) {\n        const trait_names = joinWordList(fact.requires_trait.map(id => { var _a; return `'<span class=\"gw2-color-traited-fact\">${((_a = APICache.storage.traits.get(id)) === null || _a === void 0 ? void 0 : _a.name) || id}</span>'`; }));\n        remainingDetail.unshift(fromHTML(`<span class=\"detail\">${(fact.skip_next && (fact.skip_next > 1 || !fact.__gamemode_override_marker)) ? 'overridden' : 'exists'} because of trait${fact.requires_trait.length == 1 ? '' : 's'} ${trait_names}</span>`));\n    }\n    wrapper.append(generateBuffIcon(iconSlug, buffStackSize));\n    wrapper.append(newElm('div', newElm('span', typeof firstLine == 'string' && firstLine.includes('<') ? fromHTML(firstLine) : firstLine), ...remainingDetail.map(d => typeof d == 'string' ? newElm('span.detail', d) : d)));\n    return { wrapper, defiance_break: defianceBreak };\n}\nexport function generateBuffIcon(icon, stackSize = 1) {\n    const img = newImg(icon);\n    if (stackSize == 1) {\n        return img;\n    }\n    else {\n        const wrap = newElm('span.buff-ico', img);\n        wrap.setAttribute('count', String(stackSize));\n        return wrap;\n    }\n}\nexport const MISSING_BUFF = {\n    id: 0,\n    name: 'Missing Buff',\n    description: '<c=@warning>This Buff failed to load</c>',\n    categories: [], palettes: [], modifiers: [], flags: [],\n};\nexport const MISSING_SKILL = {\n    id: 0,\n    name: 'Missing Skill',\n    description: '<c=@warning>This Skill failed to load</c>',\n    categories: [], palettes: [], modifiers: [], flags: [],\n};\nimport { newElm, newImg, formatFraction, GW2Text2HTML, withUpToNDigits, localizeInternalName, joinWordList, fromHTML, n3, resolveInflections, formatDuration, n3s, n3ss } from './TUtilsV2';\nimport APICache from './APICache';\nimport { ICONS, config } from './TooltipsV2';\nimport { getActiveAttributes, getAttributeInformation, getAttributeValue, getBaseHealth, getAttributeSources } from './CharacterAttributes';\n//# sourceMappingURL=FactsProcessor.js.map","export function allUpgradeCounts(scope, mode = 1) {\n    const elements = scope.getElementsByTagName('gw2object');\n    for (const pair of contexts.entries()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) == pair[0]);\n        if (elsInCorrectCtx.length)\n            _upgradeCounts(...pair, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificUpgradeCounts(contextIndex, targetContext, scope, mode = 1) {\n    _upgradeCounts(contextIndex, targetContext, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _upgradeCounts(contextIndex, targetContext, elements, mode) {\n    const counts = {};\n    for (const element of elements) {\n        let id;\n        if (element.getAttribute('type') !== 'item' || !(id = +String(element.getAttribute('objid'))))\n            continue;\n        const item = APICache.storage.items.get(id);\n        if (!item || !('subtype' in item) || (!['Rune', 'Infusion'].includes(item.subtype)))\n            continue;\n        let amountToAdd = 1;\n        if (item.subtype == \"Infusion\") {\n            if (!(amountToAdd = +String(element.getAttribute('count')))) {\n                if (config.legacyCompatibility) {\n                    amountToAdd = _legacy_getInfusionCount(element);\n                    if (!amountToAdd)\n                        continue;\n                }\n            }\n            if (!amountToAdd) {\n                console.warn(\"[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement \", element, \". Will not assume anything and just ignore the stack.\");\n                continue;\n            }\n        }\n        else if (targetContext.gameMode == \"Pvp\" && item.subtype == 'Rune') {\n            amountToAdd = 6;\n        }\n        counts[item.id] = (counts[item.id] || 0) + amountToAdd;\n    }\n    switch (mode) {\n        case 0:\n            targetContext.character.upgradeCounts = counts;\n            break;\n        case 1:\n            targetContext.character.upgradeCounts = Object.assign(targetContext.character.upgradeCounts, counts);\n            break;\n    }\n}\nexport function allStatSources(scope, mode = 1) {\n    const elements = scope.getElementsByTagName('gw2object');\n    for (const contextIndex of contexts.keys()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) == contextIndex);\n        if (elsInCorrectCtx.length)\n            _statSources(contextIndex, contexts, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificStatSources(contextIndex, scope, mode = 1) {\n    _statSources(contextIndex, contexts, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _statSources(contextIndex, contexts, elements, mode) {\n    const context = contexts[contextIndex];\n    const baseSources = structuredClone(DEFAULT_CONTEXT.character.stats.sources);\n    const weaponSetSources = [];\n    let upgrades = {};\n    const actualInfusionCounts = contexts.map(ctx => {\n        let total = 0;\n        const counts = {};\n        for (let [id, c] of Object.entries(ctx.character.upgradeCounts)) {\n            let item;\n            if ((item = APICache.storage.items.get(+id)) && 'subtype' in item && item.subtype == 'Infusion') {\n                c = Math.min(c, 18);\n                counts[id] = c;\n                total += c;\n            }\n        }\n        let tooMany = Math.max(0, total - 18);\n        for (let stop = 100; tooMany > 0 && stop > 0; stop--) {\n            for (const [id, c] of Object.entries(counts).sort((a, b) => b[1] - a[1])) {\n                if (c > 2) {\n                    const toRemove = (c & 1) ? 1 : 2;\n                    counts[id] -= toRemove;\n                    tooMany -= toRemove;\n                    if (tooMany <= 0)\n                        break;\n                }\n            }\n        }\n        return counts;\n    });\n    for (const element of elements) {\n        let id, type = element.getAttribute('type');\n        if (!(id = +String(element.getAttribute('objid'))))\n            continue;\n        let amountToAdd = 1;\n        let tiersToProcess, item, tierNumber, sourceRuneSuffix;\n        if (type == 'item') {\n            item = APICache.storage.items.get(id);\n            if (!item || !('subtype' in item))\n                continue;\n            if (item.type === 'UpgradeComponent' || item.type === 'Consumable') {\n                let tiersToAdd = 1;\n                if (item.subtype === 'Rune' && item.flags.includes('Pvp')) {\n                    tiersToAdd = 6;\n                }\n                tierNumber = upgrades[item.id] = (upgrades[item.id] || 0) + tiersToAdd;\n                if (item.subtype === 'Rune') {\n                    sourceRuneSuffix = true;\n                    if (tierNumber > 6) {\n                        if (!context.character.upgradeCounts[item.id])\n                            console.warn(\"[gw2-tooltips] [collect] Found more than 6 runes of the same type. Here is the 7th rune element: \", element);\n                        continue;\n                    }\n                    if (item.flags.includes('Pvp'))\n                        tiersToProcess = item.tiers;\n                    else\n                        tiersToProcess = [item.tiers[tierNumber - 1]];\n                }\n                else if ('applies_buff' in item) {\n                    const buff = APICache.storage.skills.get(item.applies_buff.buff);\n                    if (!buff) {\n                        console.warn(`[gw2-tooltips] [collect] Failed to resolve applied buff ${item.applies_buff} for `, element, \". Will not assume anything and just ignore the item.\");\n                        continue;\n                    }\n                    tiersToProcess = [{ modifiers: buff.modifiers }];\n                }\n                else if ('tiers' in item) {\n                    if (item.subtype == 'Infusion' || item.subtype == 'Enrichment') {\n                        if (!(amountToAdd = +String(element.getAttribute('count')))) {\n                            if (config.legacyCompatibility) {\n                                amountToAdd = _legacy_getInfusionCount(element);\n                                if (!amountToAdd)\n                                    continue;\n                            }\n                        }\n                        if (!amountToAdd) {\n                            console.warn(\"[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement \", element, \". Will not assume anything and just ignore the stack.\");\n                            continue;\n                        }\n                    }\n                    else if (item.subtype === 'Sigil' && tierNumber > 1) {\n                        if (tierNumber > 2)\n                            console.warn(\"[gw2-tooltips] [collect] Found more than 2 sigils of the same type. Here is the 3th sigil element: \", element);\n                        continue;\n                    }\n                    tiersToProcess = item.tiers;\n                }\n            }\n        }\n        else if (type == 'pvp/amulet') {\n            item = APICache.storage['pvp/amulets'].get(id);\n            if (!item)\n                continue;\n        }\n        let attributeSet = item && (context.gameMode !== 'Pvp' || (item.type === 'Trinket' && item.subtype === 'Amulet')) && findCorrectAttributeSet(item, +String(element.getAttribute('stats')) || undefined);\n        if (attributeSet) {\n            tiersToProcess = [{\n                    modifiers: attributeSet.attributes.map(a => ({\n                        target_attribute_or_skill: a.attribute,\n                        base_amount: Math.round(a.base_value + item.attribute_base * a.scaling),\n                        formula: \"NoScaling\",\n                        flags: [], id: -1, formula_param1: 0, formula_param2: 0, description: '',\n                    }))\n                }];\n        }\n        if (item && 'defense' in item) {\n            const defense = (typeof item.defense == \"number\")\n                ? item.defense\n                : LUT_DEFENSE[Math.min(100, (item.defense[0] + context.character.level))] * item.defense[1];\n            if (!tiersToProcess)\n                tiersToProcess = [{ modifiers: [] }];\n            tiersToProcess[0].modifiers.push({\n                target_attribute_or_skill: 'Armor',\n                base_amount: Math.ceil(defense),\n                formula: \"NoScaling\",\n                flags: [], id: -1, formula_param1: 0, formula_param2: 0, description: '',\n            });\n        }\n        let targetSources = baseSources;\n        const weaponSetId = +String(element.getAttribute('weaponSet'));\n        if (isNaN(weaponSetId) && item && item.type == \"UpgradeComponent\") {\n            const override = actualInfusionCounts[contextIndex][item.id];\n            if (override) {\n                amountToAdd = override;\n            }\n            else if (amountToAdd > 18) {\n                amountToAdd = 18;\n            }\n        }\n        if (!isNaN(weaponSetId)) {\n            targetSources = weaponSetSources[weaponSetId] || (weaponSetSources[weaponSetId] = structuredClone(DEFAULT_CONTEXT.character.stats.sources));\n        }\n        if (tiersToProcess)\n            for (const [i, tier] of tiersToProcess.entries()) {\n                if (tier.modifiers)\n                    for (const mod of tier.modifiers) {\n                        if (!mod.target_attribute_or_skill || !isModApplicable(mod, context))\n                            continue;\n                        let source = formatItemName(item, context, attributeSet, undefined, -1);\n                        if (sourceRuneSuffix) {\n                            source = `${source} (Tier ${tiersToProcess.length === 1 ? tierNumber : i + 1} Bonus)`;\n                        }\n                        (targetSources[mod.target_attribute_or_skill] || (targetSources[mod.target_attribute_or_skill] = []))\n                            .push({ modifier: mod, source, count: amountToAdd });\n                    }\n            }\n    }\n    const character = context.character;\n    const overwriteWeaponStatSources = () => {\n        for (let [i, specificSources] of weaponSetSources.entries()) {\n            const target = character.statsWithWeapons[i];\n            if (target)\n                target.sources = specificSources;\n            else\n                character.statsWithWeapons[i] = {\n                    sources: specificSources,\n                    values: Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values),\n                    htmlParts: structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].htmlParts),\n                };\n        }\n    };\n    switch (mode) {\n        case 0:\n            character.stats.sources = baseSources;\n            overwriteWeaponStatSources();\n            break;\n        case 1:\n            {\n                mergeSources(character.stats.sources, baseSources);\n                for (const [i, sources] of weaponSetSources.entries()) {\n                    const wTarget = character.statsWithWeapons[i];\n                    if (wTarget) {\n                        mergeSources(wTarget.sources, sources);\n                    }\n                    else {\n                        character.statsWithWeapons[i] = {\n                            sources,\n                            values: Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values),\n                            htmlParts: structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].htmlParts),\n                        };\n                    }\n                }\n            }\n            break;\n    }\n}\nfunction _legacy_getInfusionCount(element) {\n    var _a, _b;\n    const ownIndex = Array.prototype.indexOf.call(element.parentElement.children, element);\n    const amountEl = element.parentElement.getElementsByClassName('amount')[ownIndex];\n    if (!amountEl) {\n        console.warn(\"[gw2-tooltips] [collect] `legacyCompatibility` is active, but no amount element for infusion \", element, \" could be found. Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    const amountToAdd = +String((_b = (_a = amountEl.textContent) === null || _a === void 0 ? void 0 : _a.match(/\\d+/)) === null || _b === void 0 ? void 0 : _b[0]);\n    if (!amountToAdd) {\n        console.warn(\"[gw2-tooltips] [collect] [legacyCompatibility] Amount element \", amountEl, \" for infusion element \", element, \" did not contain any readable amount. Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    if (amountToAdd < 1 || amountToAdd > 20) {\n        console.warn(\"[gw2-tooltips] [collect] [legacyCompatibility] Amount element \", amountEl, \" for infusion element \", element, \" did got interpreted as x\", amountToAdd, \" which is outside of the range of sensible values (amount in [1...20]). Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    return amountToAdd;\n}\nexport function allTraits(scope, mode = 1) {\n    const elements = scope.querySelectorAll('gw2object[type=specialization]:not(.gw2objectembed)');\n    for (const pair of contexts.entries()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) == pair[0]);\n        if (elsInCorrectCtx.length)\n            _traits(...pair, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('contextSet')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificTraits(contextIndex, targetContext, scope, mode = 1) {\n    _traits(contextIndex, targetContext, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _traits(contextIndex, targetContext, elements, mode) {\n    if (mode === 0) {\n        targetContext.character.traits = new Set();\n        targetContext.character.specializations = new Set();\n    }\n    const traits = targetContext.character.traits;\n    const specializations = targetContext.character.specializations;\n    for (const specialization of elements) {\n        const specId = +String(specialization.getAttribute('objid'));\n        if (!isNaN(specId)) {\n            specializations.add(specId);\n        }\n        const selectedPositions = String(specialization.getAttribute('selected_traits')).split(',').map(i => +i).filter(i => !isNaN(i) && 0 <= i && i <= 2);\n        if (selectedPositions.length != 3) {\n            console.warn(\"[gw2-tooltips] [collect] Specialization object \", specialization, \" does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\\\"0,2,1\\\"` where the numbers are 0-2 indicating top, middle or bottom selection. Will not assume anything and just ignore the element.\");\n            continue;\n        }\n        for (const [x, y] of selectedPositions.entries()) {\n            {\n                const traitEl = specialization.children[1 + x * 2].children[y];\n                let id;\n                if (!traitEl || !(id = +String(traitEl.getAttribute('objid')))) {\n                    console.warn(\"[gw2-tooltips] [collect] Trait object \", traitEl, \" is selected but does not exist or does not have an objid set. Add the attribute as `objid=\\\"1234\\\"`. Will not assume anything and just ignore the element.\");\n                    continue;\n                }\n                traits.add(id);\n            }\n            {\n                const traitEl = specialization.children[x * 2];\n                let id;\n                if (!(id = +String(traitEl.getAttribute('objid')))) {\n                    console.warn(\"[gw2-tooltips] [collect] Minor trait object \", traitEl, \" does not have an objid set. Add the attribute as `objid=\\\"1234\\\"`. Will not assume anything and just ignore the element.\");\n                    continue;\n                }\n                traits.add(id);\n            }\n        }\n    }\n}\nexport function traitEffects(contexts) {\n    for (const context of contexts) {\n        for (const traitId of context.character.traits) {\n            const trait = APICache.storage.traits.get(traitId);\n            if (!trait) {\n                console.error(`[gw2-tooltips] [collect] Trait #${traitId} is apparently missing in the cache.`);\n                continue;\n            }\n            const addModifiers = (modifiers) => {\n                for (const mod of modifiers) {\n                    if (!mod.target_attribute_or_skill || !isModApplicable(mod, context))\n                        continue;\n                    (context.character.stats.sources[mod.target_attribute_or_skill] || (context.character.stats.sources[mod.target_attribute_or_skill] = []))\n                        .push({ source: `trait '<span class=\"gw2-color-traited-fact\">${trait.name}</span>'`, modifier: mod, count: 1 });\n                }\n            };\n            if (trait.modifiers)\n                addModifiers(trait.modifiers);\n            const contextBoundInfo = resolveTraitsAndOverrides(trait, context);\n            if (contextBoundInfo.blocks)\n                for (const block of contextBoundInfo.blocks)\n                    if (block.facts)\n                        for (const fact of block.facts) {\n                            if (!('buff' in fact))\n                                continue;\n                            const buff = APICache.storage.skills.get(fact.buff);\n                            if (!buff) {\n                                console.error(`[gw2-tooltips] [collect] Buff #${fact.buff} required for trait effect collection is apparently missing in the cache.`);\n                                continue;\n                            }\n                            if (buff.modifiers && !['Boon', 'Condition'].includes(buff.buff_type)) {\n                                console.info(`[gw2-tooltips] [collect] [trait-effects] ${trait.name} applies ${buff.buff_type} ${buff.name}: ${buff.modifiers.length} mods`);\n                                addModifiers(buff.modifiers);\n                            }\n                        }\n        }\n    }\n}\nexport function hoistGeneralSources(character) {\n    for (const specializedStats of character.statsWithWeapons) {\n        mergeSources(specializedStats.sources, character.stats.sources, true);\n    }\n}\nfunction mergeSources(prependOnto, copySource, prepend = false) {\n    for (const [k, v] of Object.entries(copySource)) {\n        let t = prependOnto[k];\n        if (t !== undefined) {\n            if (prepend)\n                t.splice(0, 0, ...v);\n            else\n                t.push(...v);\n        }\n        else\n            prependOnto[k] = v.slice();\n    }\n}\nfunction isModApplicable(mod, context) {\n    return (!mod.mode || mod.mode === context.gameMode) && (!mod.source_trait_req || context.character.traits.has(mod.source_trait_req)) && (!mod.target_trait_req || context.character.traits.has(mod.target_trait_req));\n}\nimport APICache from \"./APICache\";\nimport { LUT_DEFENSE } from \"./CharacterAttributes\";\nimport { resolveTraitsAndOverrides, config, formatItemName, contexts, findCorrectAttributeSet, DEFAULT_CONTEXT } from './TooltipsV2';\n//# sourceMappingURL=Collect.js.map","export function inflateGenericIcon(gw2Object, data, force = false) {\n    if (!force && gw2Object.childElementCount > 0)\n        return;\n    const wikiLink = newElm('a', newImg(data.icon, undefined, data.name));\n    wikiLink.href = 'https://wiki-en.guildwars2.com/wiki/Special:Search/' + resolveInflections(GW2Text2HTML(data.name), 1, { sex: \"Male\" });\n    wikiLink.target = '_blank';\n    if (gw2Object.classList.contains('gw2objectembed') && !gw2Object.classList.contains('icononly')) {\n        const stackSize = +String(gw2Object.getAttribute('count')) || 1;\n        const context = contexts[+String(gw2Object.getAttribute('contextSet')) || 0];\n        wikiLink.append(resolveInflections(GW2Text2HTML(data.name), stackSize, context.character));\n    }\n    gw2Object.replaceChildren(wikiLink);\n}\nexport function inflateSkill(gw2Object, skill) {\n    const contextSet = +String(gw2Object.getAttribute('contextSet')) || 0;\n    const context = specializeContextFromInlineAttribs(contexts[contextSet], gw2Object);\n    let force = false;\n    if (gw2Object.classList.contains('auto-transform')) {\n        const replacementSkill = findTraitedOverride(skill, context);\n        if (replacementSkill) {\n            gw2Object.setAttribute('og-objid', String(skill.id));\n            gw2Object.setAttribute('objid', String(replacementSkill.id));\n            skill = replacementSkill;\n            force = true;\n        }\n    }\n    inflateGenericIcon(gw2Object, skill, force);\n}\nexport function inflateItem(gw2Object, item) {\n    if (gw2Object.childElementCount > 0)\n        return;\n    const stackSize = +String(gw2Object.getAttribute('count')) || 1;\n    const context = contexts[+String(gw2Object.getAttribute('contextSet')) || 0];\n    const wikiLink = newElm('a', newImg(item.icon, undefined, item.name));\n    wikiLink.href = 'https://wiki-en.guildwars2.com/wiki/Special:Search/' + GW2Text2HTML(item.name).replaceAll(/\\[.*?\\]/g, '');\n    wikiLink.target = '_blank';\n    if (gw2Object.classList.contains('gw2objectembed'))\n        wikiLink.append(formatItemName(item, context, undefined, undefined, stackSize));\n    gw2Object.append(wikiLink);\n}\nexport function inflateSpecialization(gw2Object, spec) {\n    if (gw2Object.classList.contains('gw2objectembed')) {\n        inflateGenericIcon(gw2Object, spec);\n    }\n    else {\n        gw2Object.style.backgroundImage = `url(${formatImageUrl(spec.background)})`;\n        gw2Object.dataset.label = spec.name;\n        const selectedPositions = String(gw2Object.getAttribute('selected_traits')).split(',').map(i => +i).filter(i => !isNaN(i) && 0 <= i && i <= 2);\n        if (selectedPositions.length != 3) {\n            console.warn(\"[gw2-tooltips] [inflator] Specialization object \", gw2Object, \" does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\\\"0,2,1\\\"` where the numbers are 0-2 indicating top, middle or bottom selection.\");\n            return;\n        }\n        for (const [x, y] of selectedPositions.entries()) {\n            const column = gw2Object.children[1 + x * 2];\n            if (!column) {\n                console.warn(\"[gw2-tooltips] [inflator] Cannot mark selected trait object in column #\", x, \" for specialization object \", gw2Object, \" because the column doesn't seem to exist. Either mark the specialization object as inline or add the missing column.\");\n                continue;\n            }\n            for (const [i, traitEl] of Array.prototype.entries.call(column.children)) {\n                traitEl.classList.toggle('trait_unselected', i !== y);\n            }\n        }\n    }\n}\nexport function inflateAttribute(gw2Object, attribute) {\n    const context = contexts[+String(gw2Object.getAttribute('contextSet')) || 0];\n    const value = getAttributeValue(context.character, attribute);\n    const _p = {\n        Power: [66722, ''],\n        Toughness: [104162, ''],\n        Vitality: [104163, ''],\n        Precision: [156609, ''],\n        Ferocity: [156602, ''],\n        ConditionDamage: [156600, ''],\n        Expertise: [156601, ''],\n        Concentration: [156599, ''],\n        HealingPower: [156606, ''],\n        AgonyResistance: [536049, ''],\n        Health: [536052, ''],\n        Armor: [536048, ''],\n        ConditionDuration: [156601, '%'],\n        BoonDuration: [156599, '%'],\n        CritChance: [536051, '%'],\n        CritDamage: [784327, '%'],\n        MagicFind: [536054, '%'],\n    }[attribute];\n    let img, suffix = '';\n    if (_p)\n        [img, suffix] = _p;\n    else {\n        console.warn(`[gw2-tooltips] [inflator] Unknown attribute '${attribute}' on object `, gw2Object);\n    }\n    const displayMul = suffix ? 100 : 1;\n    let search = localizeInternalName(attribute);\n    if (attribute == 'Profession') {\n        search = \"Attribute#Profession_Attributes\";\n    }\n    const wikiLink = newElm('a', newImg(img));\n    wikiLink.href = `https://wiki-en.guildwars2.com/wiki/Special:Search/${search}`;\n    wikiLink.target = '_blank';\n    if (gw2Object.classList.contains('gw2objectembed')) {\n        if (value !== undefined) {\n            wikiLink.append(withUpToNDigits(value * displayMul, 1) + suffix);\n        }\n        else {\n            wikiLink.append('???' + suffix);\n        }\n    }\n    gw2Object.replaceChildren(wikiLink);\n}\nexport function inflateProfession(gw2Object, profession) {\n    if (gw2Object.childElementCount > 0)\n        return;\n    const wikiLink = newElm('a', newImg(profession.icon_big, undefined, profession.name));\n    wikiLink.href = 'https://wiki-en.guildwars2.com/wiki/Special:Search/' + profession.name;\n    wikiLink.target = '_blank';\n    if (gw2Object.classList.contains('gw2objectembed'))\n        wikiLink.append(profession.name);\n    gw2Object.append(wikiLink);\n}\nexport function _legacy_transformEffectToSkillObject(gw2Object, error_store) {\n    const name = String(gw2Object.getAttribute('objId'));\n    let id = {\n        chaos_aura: 10332,\n        dark_aura: 39978,\n        fire_aura: 5677,\n        frost_aura: 5579,\n        light_aura: 25518,\n        magnetic_aura: 5684,\n        shocking_aura: 5577,\n        aegis: 743,\n        alacrity: 30328,\n        fury: 725,\n        might: 740,\n        protection: 717,\n        quickness: 1187,\n        regeneration: 718,\n        resistance: 26980,\n        resolution: 873,\n        stability: 1122,\n        swiftness: 719,\n        vigor: 726,\n        bleeding: 736,\n        blinded: 720,\n        burning: 737,\n        chill: 722,\n        chilled: 722,\n        confusion: 861,\n        crippled: 721,\n        fear: 896,\n        immobilize: 727,\n        poison: 723,\n        slow: 26766,\n        taunt: 27705,\n        torment: 19426,\n        vulnerability: 738,\n        weakness: 742,\n        daze: 833,\n        stun: 872,\n        agony: 15773,\n        invulnerability: 56227,\n        revealed: 890,\n        stealth: 58026,\n        superspeed: 5974,\n        unblockable: 18843,\n        blight: 62653,\n        bloodstone_blessed: 34917,\n        blue_pylon_power: 31413,\n        champion_of_the_legions: 20845,\n        compromised: 35096,\n        crowd_favor: 36173,\n        curse_of_frailty: 53723,\n        debilitated: 67972,\n        debilitating_void: 64967,\n        defense_up: 28482,\n        derangement: 34965,\n        elemental_empowerment: 62733,\n        empowering_auras: 62939,\n        equalization_matrix: 67047,\n        expose_weakness: 26660,\n        exposed: 28778,\n        extreme_vulnerability: 65662,\n        fixated: 47434,\n        growing_rage_ashym: 3362,\n        ignite: 16259,\n        intervention: 35061,\n        necrosis: 47414,\n        not_sticking_together: 54378,\n        nova: 39193,\n        ooze_pheromone: 21538,\n        photon_saturation: 67872,\n        positive_flow: 66665,\n        power_of_the_void: 65601,\n        reinforced_armor: 9283,\n        relentless_fire: 62805,\n        retaliation_ashym: 24646,\n        sentinel_retribution: 16350,\n        shattering_ice: 62909,\n        shell_shocked: 33361,\n        spectral_darkness: 31498,\n        sticking_together: 54604,\n        synchronized_vitality: 63840,\n        unnatural_signet: 38224,\n        use_soul_binder: 55630,\n        void_empowerment: 68083,\n        xeras_embrace: 34979,\n    }[name];\n    if (!id) {\n        const hardCoded = {\n            barrier: {\n                id: Number.MAX_SAFE_INTEGER - 1,\n                name: 'Barrier',\n                icon: ICONS.BARRIER,\n                description: \"Creates a health barrier that takes damage prior to the health bar. Barrier disappears 5s after being applied. Applying a barrier while one is already active will add to it, but the previously-existing barrier will still disappear 5s after it was originally applied. The amount of barrier generated is based on the source's healing power, and is capped at 50% of the recipient's maximum health.\",\n                description_brief: \"Creates a health barrier that takes damage prior to the health bar.\",\n                categories: [], palettes: [], flags: [],\n            },\n            stunbreak: {\n                id: Number.MAX_SAFE_INTEGER - 2,\n                name: 'Stun Break',\n                description: 'Cancel control effects such as stuns.',\n                icon: ICONS.STUN_BREAK,\n                categories: [], palettes: [], flags: [],\n            },\n            knockdown: {\n                id: Number.MAX_SAFE_INTEGER - 3,\n                name: 'Knockdown',\n                description: 'Knocks the target on ground, preventing movement and actions for a short duration.',\n                icon: ICONS.KNOCKDOWN,\n                categories: [], palettes: [], flags: [],\n            },\n            pull: {\n                id: Number.MAX_SAFE_INTEGER - 4,\n                name: 'Pull',\n                description: 'Pulls the caster to the target or the target to a specific location and disables them for a short duration.',\n                icon: ICONS.PULL,\n                categories: [], palettes: [], flags: [],\n            },\n            knockback: {\n                id: Number.MAX_SAFE_INTEGER - 5,\n                name: 'Knockback',\n                description: 'Knocks back the target away and on the ground, preventing movement and actions for a short duration.',\n                icon: ICONS.KNOCKBACK,\n                categories: [], palettes: [], flags: [],\n            },\n            launch: {\n                id: Number.MAX_SAFE_INTEGER - 6,\n                name: 'Launch',\n                description: 'Throws the target in the air over a short distance, preventing movement and actions for a short duration. Can move Downed targets.',\n                icon: ICONS.LAUNCH,\n                categories: [], palettes: [], flags: [],\n            },\n            float: {\n                id: Number.MAX_SAFE_INTEGER - 7,\n                name: 'Float',\n                description: 'Causes the target to float in the air, preventing movement and actions for a short duration. Causes underwater targets to move up.',\n                icon: ICONS.FLOAT,\n                categories: [], palettes: [], flags: [],\n            },\n            sink: {\n                id: Number.MAX_SAFE_INTEGER - 8,\n                name: 'Sink',\n                description: 'Causes the underwater target to move downwards.',\n                icon: ICONS.SINK,\n                categories: [], palettes: [], flags: [],\n            },\n        }[name];\n        if (hardCoded) {\n            id = hardCoded.id;\n            APICache.storage.skills.set(id, hardCoded);\n        }\n    }\n    if (id) {\n        gw2Object.setAttribute('type', 'skill');\n        gw2Object.setAttribute('objId', String(id));\n        return id;\n    }\n    else {\n        gw2Object.innerText = name;\n        gw2Object.title = `Failed to translate effect '${name}'.`;\n        gw2Object.style.cursor = \"help\";\n        gw2Object.classList.add('error');\n        error_store.add(name);\n        return 0;\n    }\n}\nexport function inferItemUpgrades(wrappers) {\n    const remainingInfusionsByContext = contexts.map(ctx => {\n        const counts = {};\n        for (const [id, c] of Object.entries(ctx.character.upgradeCounts)) {\n            let item;\n            if ((item = APICache.storage.items.get(+id)) && 'subtype' in item && item.subtype == 'Infusion')\n                counts[+id] = c;\n        }\n        return counts;\n    });\n    const enrichmentByContext = contexts.map(ctx => {\n        for (const [id, c] of Object.entries(ctx.character.upgradeCounts)) {\n            let item;\n            if ((item = APICache.storage.items.get(+id)) && 'subtype' in item && item.subtype == 'Enrichment')\n                return id;\n        }\n    });\n    for (const wrapper of wrappers) {\n        if (wrapper.childElementCount < 2)\n            continue;\n        const [itemEl, ...upgradeEls] = wrapper.children;\n        if (itemEl.getAttribute('type') !== 'item')\n            continue;\n        const itemCtx = +String(itemEl.getAttribute('contextSet')) || 0;\n        const upgradeIds = upgradeEls.filter(u => u.getAttribute('type') === 'item' && u.getAttribute('objid')\n            && (+String(itemEl.getAttribute('contextSet')) || 0) === itemCtx)\n            .map(u => u.getAttribute('objid'));\n        {\n            let id, item;\n            if ((id = +String(itemEl.getAttribute('objid'))) && (item = APICache.storage.items.get(id)) && 'slots' in item) {\n                for (const slot of item.slots) {\n                    if (slot == 'Infusion') {\n                        const remainingInfusions = remainingInfusionsByContext[itemCtx];\n                        for (const infusionId of Object.keys(remainingInfusions)) {\n                            upgradeIds.push(infusionId);\n                            if (--remainingInfusions[infusionId] < 1) {\n                                delete remainingInfusions[infusionId];\n                            }\n                            break;\n                        }\n                    }\n                    else if (slot == 'Enrichment') {\n                        const enrichment = enrichmentByContext[itemCtx];\n                        if (enrichment)\n                            upgradeIds.push(enrichment);\n                    }\n                }\n            }\n        }\n        const attrString = upgradeIds.join(',');\n        if (attrString)\n            itemEl.setAttribute('slotted', attrString);\n    }\n}\nimport APICache from \"./APICache\";\nimport { getAttributeValue } from \"./CharacterAttributes\";\nimport { GW2Text2HTML, formatImageUrl, localizeInternalName, newElm, newImg, resolveInflections, withUpToNDigits } from \"./TUtilsV2\";\nimport { ICONS, contexts, findTraitedOverride, formatItemName, specializeContextFromInlineAttribs } from \"./TooltipsV2\";\n//# sourceMappingURL=Inflators.js.map","let tooltip;\nlet lastTooltipTarget;\nlet cyclePos = 0;\nlet lastMouseX;\nlet lastMouseY;\nexport const contexts = [];\nexport let config = null;\nconst PROFESSIONS = ['Guardian', 'Warrior', 'Engineer', 'Ranger', 'Thief', 'Elementalist', 'Mesmer', 'Necromancer', 'Revenant'];\nfunction activateSubTooltip(tooltipIndex) {\n    const tooltips = tooltip.children;\n    for (let index = 0; index < tooltips.length; index++) {\n        tooltips[index].classList.toggle('active', index === tooltipIndex);\n    }\n}\nfunction scrollSubTooltipIntoView(tooltipIndex, animate = false) {\n    const tooltips = tooltip.children[tooltipIndex];\n    tooltip.style.transition = animate ? 'transform 0.25s' : '';\n    tooltip.style.transform = `translate(0, -${tooltips.offsetTop + tooltips.offsetHeight}px)`;\n}\nfunction positionTooltip(animate = false) {\n    const wpadminbar = document.getElementById('wpadminbar');\n    const topBarHeight = wpadminbar ? wpadminbar.offsetHeight : 0;\n    const marginX = 22;\n    const marginY = 13;\n    const offsetX = 6;\n    const offsetY = 6;\n    const currentSubTooltip = tooltip.children[cyclePos];\n    let tooltipXpos = lastMouseX + offsetX;\n    if (tooltipXpos + tooltip.offsetWidth > document.documentElement.clientWidth - marginX) {\n        tooltipXpos = document.documentElement.clientWidth - (tooltip.offsetWidth + marginX);\n    }\n    let tooltipYpos = lastMouseY - offsetY;\n    if (tooltipYpos - currentSubTooltip.offsetHeight < document.documentElement.scrollTop + topBarHeight + marginY) {\n        if (animate) {\n            tooltip.style.transition += ', top 0.25s';\n            setTimeout(() => tooltip.style.transition = '', 250);\n        }\n        tooltipYpos = document.documentElement.scrollTop + topBarHeight + marginY + currentSubTooltip.offsetHeight;\n    }\n    tooltip.style.left = `${tooltipXpos}px`;\n    tooltip.style.top = `${tooltipYpos}px`;\n}\nexport async function hookDocument(scope, _unused) {\n    const objectsToGet = {\n        skills: new Map(),\n        traits: new Map(),\n        items: new Map(),\n        specializations: new Map(),\n        pets: new Map(),\n        'pvp/amulets': new Map(),\n        attributes: new Map(),\n        professions: new Map(),\n    };\n    const statsToGet = new Set();\n    const _legacy_effectErrorStore = new Set();\n    for (const gw2Object of scope.getElementsByTagName('gw2object')) {\n        const stats = +String(gw2Object.getAttribute('stats'));\n        if (!isNaN(stats))\n            statsToGet.add(stats);\n        let objIdRaw = gw2Object.getAttribute('objId');\n        if (objIdRaw == null)\n            continue;\n        let type = (gw2Object.getAttribute('type') || 'skill') + 's';\n        if (type === 'attributes') {\n            if (objIdRaw != null) {\n                const elementsWithThisId = objectsToGet.attributes.get(objIdRaw);\n                if (elementsWithThisId)\n                    elementsWithThisId.push(gw2Object);\n                else\n                    objectsToGet.attributes.set(objIdRaw, [gw2Object]);\n            }\n        }\n        else {\n            let objId = +objIdRaw;\n            if (type === 'effects') {\n                if (config.legacyCompatibility) {\n                    type = 'skills';\n                    objId = _legacy_transformEffectToSkillObject(gw2Object, _legacy_effectErrorStore);\n                }\n                else {\n                    continue;\n                }\n            }\n            if ((!isNaN(objId) && type in objectsToGet) || (type == 'professions' && (objId = objIdRaw[0].toUpperCase() + objIdRaw.slice(1)), PROFESSIONS.includes(objId))) {\n                const map = objectsToGet[type];\n                const elementsWithThisId = map.get(objId);\n                if (elementsWithThisId)\n                    elementsWithThisId.push(gw2Object);\n                else\n                    map.set(objId, [gw2Object]);\n                const inlineTraits = gw2Object.getAttribute('with-traits');\n                if (inlineTraits) {\n                    for (const traitStr of inlineTraits.split(',')) {\n                        const traitId = +traitStr;\n                        if (!traitId)\n                            continue;\n                        const elementsWithThisId = objectsToGet.traits.get(traitId);\n                        if (!elementsWithThisId)\n                            objectsToGet.traits.set(traitId, []);\n                    }\n                }\n            }\n            else {\n                continue;\n            }\n        }\n        attachMouseListeners(gw2Object);\n    }\n    if (_legacy_effectErrorStore.size) {\n        console.error(\"[gw2-tooltips] [legacy-compat] Some effects could not be translated into skills: \", Array.from(_legacy_effectErrorStore));\n    }\n    if (statsToGet.size > 0)\n        APICache.ensureExistence('itemstats', statsToGet.values(), config.validateApiResponses);\n    await Promise.all(Object.entries(objectsToGet)\n        .filter(([key, _]) => key != 'attributes')\n        .map(async ([key, values]) => {\n        if (values.size == 0)\n            return;\n        let inflator;\n        switch (key) {\n            case 'skills':\n                inflator = inflateSkill;\n                break;\n            case 'items':\n                inflator = inflateItem;\n                break;\n            case 'specializations':\n                inflator = inflateSpecialization;\n                break;\n            case 'professions':\n                inflator = inflateProfession;\n                break;\n            default:\n                inflator = inflateGenericIcon;\n                break;\n        }\n        const cache = APICache.storage[key];\n        await APICache.ensureExistence(key, values.keys(), config.validateApiResponses);\n        for (const [id, objects] of values) {\n            const data = cache.get(id);\n            if (!objects || !data)\n                continue;\n            for (const gw2Object of objects)\n                inflator(gw2Object, data);\n        }\n    }));\n    return objectsToGet;\n}\nexport function attachMouseListeners(target) {\n    target.addEventListener('mouseenter', (e) => showTooltipFor(e.target));\n    target.addEventListener('mouseleave', () => {\n        tooltip.style.display = 'none';\n        tooltip.style.transform = '';\n    });\n}\nfunction showTooltipFor(gw2Object, visibleIndex = 0) {\n    const type = ((gw2Object.getAttribute('type') || 'skill') + 's');\n    const objIdRaw = gw2Object.getAttribute('objId');\n    let context = contexts[+String(gw2Object.getAttribute('contextSet')) || 0];\n    const statSetId = +String(gw2Object.getAttribute('stats')) || undefined;\n    const stackSize = +String(gw2Object.getAttribute('count')) || undefined;\n    if (type == 'specializations' || type == 'effects' || type == 'professions')\n        return;\n    lastTooltipTarget = gw2Object;\n    if (type == 'attributes') {\n        if (objIdRaw) {\n            cyclePos = visibleIndex;\n            tooltip.replaceChildren(generateAttributeTooltip(objIdRaw, context));\n            tooltip.style.display = '';\n            for (const tt of tooltip.children)\n                tt.classList.add('active');\n            scrollSubTooltipIntoView(cyclePos);\n        }\n        return;\n    }\n    const data = APICache.storage[type].get(+String(objIdRaw));\n    if (data) {\n        context = specializeContextFromInlineAttribs(context, gw2Object);\n        if ('palettes' in data) {\n            if (context.underwater) {\n                if (!data.flags.includes('UsableUnderWater') && data.flags.includes('UsableLand')) {\n                    if (!context.cloned)\n                        context = Object.assign({}, context);\n                    context.underwater = false;\n                }\n            }\n            else if (!context.underwater) {\n                if (!data.flags.includes('UsableLand') && data.flags.includes('UsableUnderWater')) {\n                    if (!context.cloned)\n                        context = Object.assign({}, context);\n                    context.underwater = true;\n                }\n            }\n        }\n        const [innerTooltips, initialActiveIndex] = generateToolTipList(data, gw2Object, context, statSetId, stackSize);\n        cyclePos = visibleIndex > 0 ? visibleIndex : initialActiveIndex;\n        tooltip.replaceChildren(...innerTooltips);\n        tooltip.style.display = '';\n        if (tooltip.childElementCount > 1) {\n            gw2Object.classList.add('cycler');\n            gw2Object.title = 'Right-click to cycle through tooltips';\n            activateSubTooltip(cyclePos);\n        }\n        else if (tooltip.firstElementChild) {\n            tooltip.firstElementChild.classList.add('active');\n        }\n        scrollSubTooltipIntoView(cyclePos);\n    }\n}\nfunction generateToolTip(apiObject, slotName, iconMode, context, weaponSet) {\n    const headerElements = [];\n    if (iconMode == 1 || (iconMode == 2 && !IsDevIcon(apiObject.icon)))\n        headerElements.push(newImg(apiObject.icon));\n    headerElements.push(newElm('teb', fromHTML(GW2Text2HTML(resolveInflections(apiObject.name, 1, context.character)))), newElm('div.flexbox-fill'));\n    const currentContextInformation = resolveTraitsAndOverrides(apiObject, context);\n    pushCostAndRestrictionLabels(headerElements, apiObject, currentContextInformation, context);\n    const secondHeaderRow = [];\n    if (slotName)\n        secondHeaderRow.push(newElm('tes', `( ${slotName} )`));\n    if (weaponSet !== undefined)\n        secondHeaderRow.push(newElm('tes', `( Weapon Set ${weaponSet + 1} )`));\n    secondHeaderRow.push(newElm('div.flexbox-fill'));\n    pushGamemodeSplitLabels(secondHeaderRow, apiObject, context);\n    const parts = [newElm('tet.title', ...headerElements)];\n    if (secondHeaderRow.length > 1)\n        parts.push(newElm('tet.detail', ...secondHeaderRow));\n    if ('description' in apiObject && apiObject.description) {\n        parts.push(newElm('p.description', fromHTML(GW2Text2HTML(apiObject.description))));\n    }\n    pushFacts(parts, apiObject, currentContextInformation, context);\n    const tooltip = newElm('div.tooltip', ...parts);\n    tooltip.dataset.id = String(apiObject.id);\n    return tooltip;\n}\nfunction pushCostAndRestrictionLabels(destinationArray, sourceObject, specializedContextInformation, context) {\n    if ('flags' in sourceObject && sourceObject.flags.includes('DisallowUnderwater')) {\n        destinationArray.push(newImg(ICONS.NO_UNDERWATER, 'iconsmall'));\n    }\n    if (specializedContextInformation.activation) {\n        const value = formatFraction(specializedContextInformation.activation / 1000, config);\n        if (value != '0') {\n            destinationArray.push(newElm('ter', value, newImg(ICONS.ACTIVATION, 'iconsmall')));\n        }\n    }\n    if (specializedContextInformation.resource_cost) {\n        destinationArray.push(newElm('ter', String(specializedContextInformation.resource_cost), newImg(context.character.profession == 'Revenant' ? ICONS.RESOURCE_REV : ICONS.RESOURCE_THIEF, 'iconsmall')));\n    }\n    if (specializedContextInformation.endurance_cost) {\n        destinationArray.push(newElm('ter', String(Math.round(specializedContextInformation.endurance_cost)), newImg(ICONS.ENDURANCE_COST, 'iconsmall')));\n    }\n    if (specializedContextInformation.upkeep_cost) {\n        destinationArray.push(newElm('ter', String(specializedContextInformation.upkeep_cost), newImg(ICONS.UPKEEP_COST, 'iconsmall')));\n    }\n    if (specializedContextInformation.recharge) {\n        const value = formatFraction(specializedContextInformation.recharge / 1000, config);\n        if (value != '0') {\n            destinationArray.push(newElm('ter', value, newImg(ICONS.RECHARGE, 'iconsmall')));\n        }\n    }\n    if (specializedContextInformation.supply_cost) {\n        destinationArray.push(newElm('ter', String(specializedContextInformation.supply_cost), newImg(ICONS.SUPPLY_COST, 'iconsmall')));\n    }\n}\nfunction pushGamemodeSplitLabels(destinationArray, SourceObject, context) {\n    if ('override_groups' in SourceObject && SourceObject.override_groups) {\n        const baseContext = new Set(['Pve', 'Pvp', 'Wvw']);\n        for (const override of SourceObject.override_groups) {\n            for (const context of override.context) {\n                baseContext.delete(context);\n            }\n        }\n        const splits = [Array.from(baseContext), ...SourceObject.override_groups.map(o => o.context)];\n        const splits_html = [];\n        for (const mode of ['Pve', 'Pvp', 'Wvw']) {\n            let split;\n            for (let i = 0; i < splits.length; i++) {\n                if (splits[i].includes(mode)) {\n                    split = splits.splice(i, 1)[0];\n                    break;\n                }\n            }\n            if (!split)\n                continue;\n            const text = split.join('/');\n            if (split.includes(context.gameMode))\n                splits_html.push(`<span style=\"color: var(--gw2-tt-color-text-accent) !important;\">${text}</span>`);\n            else\n                splits_html.push(text);\n        }\n        destinationArray.push(newElm('tes', '( ', fromHTML(splits_html.join(' | ')), ' )'));\n    }\n}\nfunction pushFacts(destinationArray, sourceObject, specializedContextInformation, context) {\n    if (specializedContextInformation.blocks) {\n        let weaponStrength = 690.5;\n        if ('palettes' in sourceObject)\n            for (const pid of sourceObject.palettes) {\n                const palette = APICache.storage.palettes.get(pid);\n                if (!palette)\n                    continue;\n                const criteria = context.character.profession\n                    ? ((s) => s.profession === context.character.profession)\n                    : ((s) => s.profession);\n                if (palette.groups.some(criteria)) {\n                    weaponStrength = getWeaponStrength(palette);\n                    break;\n                }\n            }\n        destinationArray.push(...generateFacts(specializedContextInformation.blocks, weaponStrength, context));\n    }\n}\nexport function resolveTraitsAndOverrides(apiObject, context) {\n    var _a, _b, _c, _d, _e;\n    let override = (_a = apiObject.override_groups) === null || _a === void 0 ? void 0 : _a.find(g => g.context.includes(context.gameMode));\n    let result = Object.assign({}, apiObject, override);\n    result.blocks = structuredClone(apiObject.blocks);\n    if (!result.blocks)\n        return result;\n    if (override === null || override === void 0 ? void 0 : override.blocks) {\n        const end = Math.max(result.blocks.length, override.blocks.length);\n        for (let blockId = 0; blockId < end; blockId++) {\n            let baseBlock = result.blocks[blockId];\n            const overrideBlock = override.blocks[blockId];\n            if (overrideBlock) {\n                if (!baseBlock) {\n                    baseBlock = result.blocks[blockId] = {\n                        description: overrideBlock.description,\n                        trait_requirements: overrideBlock.trait_requirements,\n                    };\n                }\n                if (!overrideBlock.facts)\n                    continue;\n                const facts = result.blocks[blockId].facts = (_b = baseBlock.facts) !== null && _b !== void 0 ? _b : [];\n                for (const fact of overrideBlock.facts) {\n                    if ((_c = fact.requires_trait) === null || _c === void 0 ? void 0 : _c.some(t => !context.character.traits.has(t)))\n                        continue;\n                    if (fact.insert_before !== undefined) {\n                        if (fact.skip_next)\n                            fact.__gamemode_override_marker = true;\n                        facts.splice(fact.insert_before, 0, fact);\n                    }\n                    else\n                        facts.push(fact);\n                }\n            }\n        }\n    }\n    const finalBlocks = [];\n    for (const block of result.blocks) {\n        if ((_d = block.trait_requirements) === null || _d === void 0 ? void 0 : _d.some(t => !context.character.traits.has(t)))\n            continue;\n        if (block.facts) {\n            const finalFacts = [];\n            let to_skip = 0;\n            for (let i = 0; i < block.facts.length; i++) {\n                const fact = block.facts[i];\n                if ((_e = fact.requires_trait) === null || _e === void 0 ? void 0 : _e.some(t => !context.character.traits.has(t)))\n                    continue;\n                if (to_skip-- > 0)\n                    continue;\n                finalFacts.push(fact);\n                to_skip = fact.skip_next || 0;\n            }\n            block.facts = finalFacts;\n        }\n        finalBlocks.push(block);\n    }\n    result.blocks = finalBlocks;\n    return result;\n}\nfunction getWeaponStrength({ weapon_type, type: palette_type }) {\n    if (!weapon_type) {\n        if (palette_type === 'Bundle') {\n            return 922.5;\n        }\n        return 690.5;\n    }\n    else {\n        return {\n            BundleLarge: 0,\n            Standard: 690.5,\n            Focus: 900,\n            Shield: 900,\n            Torch: 900,\n            Warhorn: 900,\n            Greatsword: 1100,\n            Hammer: 1100,\n            Staff: 1100,\n            BowLong: 1050,\n            Rifle: 1150,\n            BowShort: 1000,\n            Axe: 1000,\n            Sword: 1000,\n            Dagger: 1000,\n            Pistol: 1000,\n            Scepter: 1000,\n            Mace: 1000,\n            Spear: 1000,\n            Speargun: 1000,\n            Trident: 1000,\n        }[weapon_type];\n    }\n}\nfunction generateToolTipList(initialAPIObject, gw2Object, context, statSetId, stackSize) {\n    var _a;\n    let subiconRenderMode = 1;\n    if (String(gw2Object.getAttribute('type')) === 'trait')\n        subiconRenderMode = 2;\n    else if (initialAPIObject.type === 'Relic')\n        subiconRenderMode = 0;\n    let initialActiveIndex = 0;\n    const tooltipChain = [];\n    const adjustTraitedSkillIds = gw2Object.classList.contains('auto-transform');\n    let weaponSet = +String(gw2Object.getAttribute('weaponSet'));\n    if (isNaN(weaponSet))\n        weaponSet = undefined;\n    let palette, group, slot = undefined;\n    if ('palettes' in initialAPIObject) {\n        if (adjustTraitedSkillIds) {\n            const replacementSkill = findTraitedOverride(initialAPIObject, context);\n            if (replacementSkill)\n                initialAPIObject = replacementSkill;\n        }\n        let i;\n        [palette, group, i, context] = guessGroupAndContext(initialAPIObject, context);\n        if (group) {\n            slot = refineSlotName(palette, group.slot);\n            let candidate = group.candidates[i];\n            const insertAtIndex = tooltipChain.length;\n            while (candidate.previous_chain_skill_index) {\n                const otherCandidate = group.candidates[candidate.previous_chain_skill_index];\n                if (!canBeSelected(otherCandidate, context))\n                    break;\n                let skill = APICache.storage.skills.get(otherCandidate.skill);\n                if (!skill) {\n                    console.warn(`[gw2-tooltips] Chain skill #${otherCandidate.skill} is missing from the cache. The query was caused by `, gw2Object);\n                    skill = MISSING_SKILL;\n                }\n                tooltipChain.splice(insertAtIndex, 0, generateToolTip(skill, slot, 1, context, weaponSet));\n                candidate = otherCandidate;\n            }\n        }\n        tooltipChain.push(generateToolTip(initialAPIObject, slot, 1, context, weaponSet));\n        for (let j = 0; j < i; j++) {\n            const otherCandidate = group.candidates[j];\n            if (otherCandidate.previous_chain_skill_index != i)\n                continue;\n            if (!canBeSelected(otherCandidate, context))\n                continue;\n            let skill = APICache.storage.skills.get(otherCandidate.skill);\n            if (!skill) {\n                console.warn(`[gw2-tooltips] Chain skill #${otherCandidate.skill} is missing from the cache. The query was caused by `, gw2Object);\n                skill = MISSING_SKILL;\n            }\n            tooltipChain.push(generateToolTip(skill, slot, 1, context, weaponSet));\n            i = j;\n            j = -1;\n        }\n    }\n    else {\n        if ('type' in initialAPIObject) {\n            tooltipChain.push(generateItemTooltip(initialAPIObject, context, gw2Object, statSetId, stackSize));\n        }\n        else {\n            let slotName = undefined;\n            if ('slot' in initialAPIObject) {\n                slotName = initialAPIObject.slot;\n                if ('specialization' in initialAPIObject)\n                    (((_a = APICache.storage.specializations.get(initialAPIObject.specialization)) === null || _a === void 0 ? void 0 : _a.name) || initialAPIObject.specialization) + ' - ' + slotName;\n            }\n            tooltipChain.push(generateToolTip(initialAPIObject, slotName, 1, context, weaponSet));\n        }\n    }\n    if ('bundle_skills' in initialAPIObject) {\n        for (const subSkillId of initialAPIObject.bundle_skills) {\n            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n            if (subSkillInChain && canBeUsedOnCurrentTerrain(subSkillInChain, context)) {\n                const [palette, group] = guessGroupAndContext(subSkillInChain, context);\n                tooltipChain.push(generateToolTip(subSkillInChain, refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot), 1, context, weaponSet));\n            }\n        }\n    }\n    if ('related_skills' in initialAPIObject) {\n        const type = gw2Object.getAttribute('type') || 'skill';\n        for (const subSkillId of initialAPIObject.related_skills) {\n            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n            if (subSkillInChain && canBeUsedOnCurrentTerrain(subSkillInChain, context) && ((type != 'skill') || subSkillInChain.palettes.some(pid => {\n                const palette = APICache.storage.palettes.get(pid);\n                return palette && VALID_CHAIN_PALETTES.includes(palette.type);\n            }))) {\n                const [palette, group] = guessGroupAndContext(subSkillInChain, context);\n                tooltipChain.push(generateToolTip(subSkillInChain, refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot), subiconRenderMode, context, weaponSet));\n            }\n        }\n    }\n    if ('ambush_skills' in initialAPIObject) {\n        for (const { id: subSkillId, spec } of initialAPIObject.ambush_skills) {\n            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n            if (subSkillInChain && canBeUsedOnCurrentTerrain(subSkillInChain, context) && (!spec || context.character.specializations.has(spec))) {\n                if (!slot) {\n                    [palette, group] = guessGroupAndContext(subSkillInChain, context);\n                    slot = refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot);\n                }\n                tooltipChain.push(generateToolTip(subSkillInChain, slot, subiconRenderMode, context, weaponSet));\n                break;\n            }\n        }\n    }\n    if ('skills' in initialAPIObject)\n        for (const petSkillId of initialAPIObject.skills) {\n            initialActiveIndex = 1;\n            let petSkill = APICache.storage.skills.get(petSkillId);\n            if (!petSkill) {\n                console.warn(`[gw2-tooltips] pet skill #${petSkillId} is missing from the cache. The query was caused by `, gw2Object);\n                petSkill = MISSING_SKILL;\n            }\n            const [palette, group] = guessGroupAndContext(petSkill, context);\n            tooltipChain.push(generateToolTip(petSkill, refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot), subiconRenderMode, context, weaponSet));\n        }\n    if ('skills_ai' in initialAPIObject)\n        for (const petSkillId of initialAPIObject.skills_ai) {\n            let petSkill = APICache.storage.skills.get(petSkillId);\n            if (!petSkill) {\n                console.warn(`[gw2-tooltips] pet skill #${petSkillId} is missing from the cache. The query was caused by `, gw2Object);\n                petSkill = MISSING_SKILL;\n            }\n            const [palette, group] = guessGroupAndContext(petSkill, context);\n            let slot_name = refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot);\n            if (slot_name)\n                slot_name = 'ai ' + slot_name;\n            tooltipChain.push(generateToolTip(petSkill, slot_name, subiconRenderMode, context, weaponSet));\n        }\n    if (context.character.specializations.has(55) && 'skills_soulbeast' in initialAPIObject)\n        for (const petSkillId of initialAPIObject.skills_soulbeast) {\n            let petSkill = APICache.storage.skills.get(petSkillId);\n            if (!petSkill) {\n                console.warn(`[gw2-tooltips] pet skill #${petSkillId} is missing from the cache. The query was caused by `, gw2Object);\n                petSkill = MISSING_SKILL;\n            }\n            const [palette, group] = guessGroupAndContext(petSkill, context);\n            tooltipChain.push(generateToolTip(petSkill, refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot), subiconRenderMode, context, weaponSet));\n        }\n    tooltip.append(...tooltipChain);\n    return [tooltipChain, initialActiveIndex];\n}\nfunction refineSlotName(palette, slot) {\n    if (!slot)\n        return undefined;\n    if (palette.type == 'Bundle' && slot.includes('_')) {\n        return 'Bundle ' + slot.substring(slot.lastIndexOf('_') + 1);\n    }\n    if (slot.startsWith('Weapon') && palette.weapon_type) {\n        return localizeInternalName(palette.weapon_type) + ' ' + slot.substring(slot.lastIndexOf('_') + 1);\n    }\n    return slot.replace(/(\\S+?)_(\\d)/, \"$1 $2\");\n}\nfunction guessGroupAndContext(skill, context) {\n    let fallback = undefined;\n    for (const pid of skill.palettes) {\n        const palette = APICache.storage.palettes.get(pid);\n        if (!palette) {\n            console.warn(`[gw2-tooltips] Palette #${pid} is missing from the cache. The query was caused by `, skill);\n            continue;\n        }\n        if (!VALID_CHAIN_PALETTES.includes(palette.type))\n            continue;\n        for (const group of palette.groups) {\n            if (context.character.profession && group.profession && group.profession != context.character.profession)\n                continue;\n            for (const [i, candidate] of group.candidates.entries()) {\n                if (candidate.skill != skill.id)\n                    continue;\n                if (!fallback)\n                    fallback = [palette, group, i, context];\n                if (canBeSelected(candidate, context))\n                    return [palette, group, i, context];\n            }\n        }\n    }\n    if (fallback) {\n        fallback[3] = transmuteContext(fallback[1].candidates[fallback[2]], context);\n        return fallback;\n    }\n    for (const pid of skill.palettes) {\n        const palette = APICache.storage.palettes.get(pid);\n        if (!palette)\n            continue;\n        if (!VALID_CHAIN_PALETTES.includes(palette.type))\n            continue;\n        for (const group of palette.groups) {\n            for (const [i, candidate] of group.candidates.entries()) {\n                if (candidate.skill == skill.id)\n                    return [palette, group, i, transmuteContext(candidate, context)];\n            }\n        }\n    }\n    for (const pid of skill.palettes) {\n        const palette = APICache.storage.palettes.get(pid);\n        if (!palette)\n            continue;\n        for (const group of palette.groups) {\n            for (const [i, candidate] of group.candidates.entries()) {\n                if (candidate.skill == skill.id)\n                    return [palette, group, i, transmuteContext(candidate, context)];\n            }\n        }\n    }\n    return [undefined, undefined, -1, context];\n}\nfunction transmuteContext(targetCandidate, context, clone = true) {\n    if (clone) {\n        const character = Object.assign({}, context.character, { specializations: structuredClone(context.character.specializations), traits: structuredClone(context.character.traits) });\n        context = Object.assign({}, context, { character });\n    }\n    if (targetCandidate.specialization)\n        context.character.specializations.add(targetCandidate.specialization);\n    if (targetCandidate.trait)\n        context.character.traits.add(targetCandidate.trait);\n    return context;\n}\n;\nfunction canBeSelected(info, context) {\n    return (info.specialization === undefined || context.character.specializations.has(info.specialization)) &&\n        (info.trait === undefined || context.character.traits.has(info.trait)) &&\n        (context.underwater ? info.usability.includes('UsableUnderWater') : info.usability.includes('UsableLand')) &&\n        (context.character.level >= (info.min_level || 0));\n}\nfunction canBeUsedOnCurrentTerrain(skill, context) {\n    return context.underwater ? skill.flags.includes('UsableUnderWater') : skill.flags.includes('UsableLand');\n}\nexport function findTraitedOverride(skill, context) {\n    var _a;\n    for (const pid of skill.palettes) {\n        const palette = APICache.storage.palettes.get(pid);\n        if (!palette) {\n            console.warn(`[gw2-tooltips] Palette #${pid} is missing from the cache. The query was caused by `, skill);\n            continue;\n        }\n        for (const group of palette.groups) {\n            if (context.character.profession && group.profession && group.profession != context.character.profession)\n                continue;\n            const end = group.candidates.findIndex(c => c.skill == skill.id);\n            if (end == -1)\n                continue;\n            for (let i = 0; i < end; i++) {\n                const candidate = group.candidates[i];\n                if (candidate.trait) {\n                    if (!context.character.traits.has(candidate.trait))\n                        continue;\n                    const replacementSkill = APICache.storage.skills.get(candidate.skill);\n                    if (!replacementSkill) {\n                        console.error(`[gw2-tooltips] Corrected skill #${candidate.skill} is missing in the cache.`);\n                        return;\n                    }\n                    else {\n                        console.info(`[gw2-tooltips] Corrected skill #${skill.id} (${skill.name}) to #${replacementSkill.id} (${replacementSkill.name}) because the trait #${candidate.trait} (${((_a = APICache.storage.traits.get(candidate.trait)) === null || _a === void 0 ? void 0 : _a.name) || '<not cached>'}) is active.`);\n                        return replacementSkill;\n                    }\n                }\n            }\n        }\n    }\n    return;\n}\nfunction generateItemTooltip(item, context, target, statSetId, stackSize = 1) {\n    var _a;\n    let statSet = (context.gameMode !== 'Pvp' || (item.type === 'Trinket' && item.subtype === 'Amulet')) && findCorrectAttributeSet(item, statSetId);\n    let slottedItems;\n    if ('slots' in item) {\n        slottedItems = (_a = target.getAttribute('slotted')) === null || _a === void 0 ? void 0 : _a.split(',').map(id => APICache.storage.items.get(+String(id) || 0)).filter(i => i && 'subtype' in i);\n    }\n    const countPrefix = stackSize > 1 ? stackSize + ' ' : '';\n    const upgradeNameSource = (slottedItems === null || slottedItems === void 0 ? void 0 : slottedItems.find(i => !['Infusion', 'Enrichment'].includes(i.subtype))) || (slottedItems === null || slottedItems === void 0 ? void 0 : slottedItems[0]);\n    const name = countPrefix + formatItemName(item, context, statSet, upgradeNameSource, stackSize);\n    const parts = [newElm('tet.title', newImg(item.icon), newElm('teb.gw2-color-rarity-' + item.rarity, name), newElm('div.flexbox-fill'))];\n    if ('defense' in item && item.defense) {\n        const defense = (typeof item.defense == \"number\")\n            ? item.defense\n            : LUT_DEFENSE[Math.min(100, (item.defense[0] + context.character.level))] * item.defense[1];\n        parts.push(newElm('te', newElm('tem', 'Defense: ', newElm('span.gw2-color-stat-green', String(Math.ceil(defense))))));\n    }\n    if ('power' in item) {\n        let power;\n        if ('mul' in item.power) {\n            let maxRarity = Rarity.Legendary;\n            if (['PlayerLevelScaleRarity', 'ItemScale4'].includes(item.power.scaling)) {\n                if (context.character.level < 14)\n                    maxRarity = Rarity.Common;\n                else if (context.character.level < 30)\n                    maxRarity = Rarity.Uncommon;\n                else if (context.character.level < 60)\n                    maxRarity = Rarity.Rare;\n                else if (context.character.level < 80)\n                    maxRarity = Rarity.Exotic;\n            }\n            const rarity = Math.min(Rarity[item.rarity], maxRarity);\n            let index = LUT_RARITY[rarity];\n            if (!item.power.scaling)\n                index += item.level;\n            else {\n                index += context.character.level;\n            }\n            const avg = (context.character.isPlayer ? LUT_POWER_PLAYER : LUT_POWER_MONSTER)[Math.min(100, index)] * item.power.mul * LUT_RARITY_MUL[rarity];\n            const spread = avg * item.power.spread;\n            power = [Math.ceil(avg - spread), Math.ceil(avg + spread)];\n        }\n        else {\n            power = item.power;\n        }\n        const line = newElm('tem', 'Weapon Strength: ', newElm('span.gw2-color-stat-green', `${power[0]} - ${power[1]}`));\n        if (item.damage_type)\n            line.append(` (${item.damage_type})`);\n        parts.push(newElm('te', line));\n    }\n    if ('tiers' in item) {\n        parts.push(generateUpgradeItemGroup(item, context));\n    }\n    if (statSet && 'attribute_base' in item) {\n        parts.push(...statSet.attributes.map(({ attribute, base_value, scaling }) => {\n            const computedValue = Math.round(base_value + item.attribute_base * scaling);\n            return newElm('te', newElm('tem.gw2-color-stat-green', `+${computedValue} ${localizeInternalName(attribute)}`));\n        }));\n    }\n    if ('slots' in item) {\n        parts.push(newElm('div.group.slots', ...item.slots.map(s => {\n            let slottedItemIdx = -1;\n            if (slottedItems) {\n                switch (s) {\n                    case 'Upgrade':\n                        slottedItemIdx = slottedItems.findIndex(i => ['Rune', 'Sigil', 'Gem'].includes(i.subtype));\n                        break;\n                    case 'Infusion':\n                        slottedItemIdx = slottedItems.findIndex(i => i.subtype == 'Infusion');\n                        break;\n                    case 'Enrichment':\n                        slottedItemIdx = slottedItems.findIndex(i => i.subtype == 'Enrichment');\n                        break;\n                }\n            }\n            if (slottedItemIdx > -1) {\n                const slottedItem = slottedItems.splice(slottedItemIdx, 1)[0];\n                const group = generateUpgradeItemGroup(slottedItem, context);\n                const name = formatItemName(slottedItem, context);\n                group.prepend(newElm('tet', newImg(slottedItem.icon, 'iconsmall'), newElm('teb.gw2-color-rarity-' + slottedItem.rarity, name), newElm('div.flexbox-fill')));\n                return group;\n            }\n            else {\n                return newElm('te', newImg(ICONS['SLOT_' + s], 'iconsmall'), `Empty ${s} Slot`);\n            }\n        })));\n    }\n    let descriptionAlreadyShown = false;\n    if ('applies_buff' in item) {\n        parts.push(newElm('span', fromHTML(GW2Text2HTML(item.description))));\n        parts.push(newElm('div.group', generateFact(item.applies_buff, -1, context, true).wrapper));\n        descriptionAlreadyShown = true;\n    }\n    if ('facts_from_skill' in item) {\n        let factsSkill = APICache.storage.skills.get(item.facts_from_skill);\n        if (!factsSkill) {\n            console.warn(`[gw2-tooltips] Relic facts skill #${item.facts_from_skill} is missing from the cache. The query was caused by `, item, target);\n            factsSkill = MISSING_SKILL;\n        }\n        const contextInfo = resolveTraitsAndOverrides(factsSkill, context);\n        const headerElements = [];\n        pushGamemodeSplitLabels(headerElements, factsSkill, context);\n        headerElements.push(newElm('div.flexbox-fill'));\n        pushCostAndRestrictionLabels(headerElements, factsSkill, contextInfo, context);\n        const innerParts = [newElm('tet.title', ...headerElements)];\n        pushFacts(innerParts, factsSkill, contextInfo, context);\n        parts.push(newElm('span', fromHTML(GW2Text2HTML(item.description))));\n        parts.push(newElm('div.group', ...innerParts));\n        descriptionAlreadyShown = true;\n    }\n    const metaInfo = newElm('div.group');\n    if (item.type == \"Armor\" || item.type == \"Weapon\" || (item.type == \"Trinket\" && !item.flags.includes('Pvp'))) {\n        metaInfo.append(newElm('span.gw2-color-rarity-' + item.rarity, item.rarity));\n        if ('weight' in item)\n            metaInfo.append(newElm('span', item.weight));\n        metaInfo.append(newElm('span', `${item.type}: ${item.subtype}`));\n        if (item.type == \"Weapon\" && isTwoHanded(item.subtype))\n            metaInfo.append(newElm('span.gw2-color-rarity-Junk', `(Two-Handed)`));\n        if (item.required_level)\n            metaInfo.append(newElm('span', 'Required Level: ' + item.required_level));\n    }\n    if (item.description && !descriptionAlreadyShown)\n        metaInfo.append(newElm('span', fromHTML(GW2Text2HTML(item.description))));\n    if (!item.flags.includes('Pvp')) {\n        if (item.flags.includes('Unique'))\n            metaInfo.append(newElm('span', 'Unique'));\n        if (item.flags.includes('AccountBound'))\n            metaInfo.append(newElm('span', 'Account Bound'));\n        if (item.flags.includes('SoulBindOnUse'))\n            metaInfo.append(newElm('span', 'Soulbound on Use'));\n        else if (item.flags.includes('SoulBindOnAcquire'))\n            metaInfo.append(newElm('span', 'Soulbound on Acquire'));\n    }\n    if (!item.flags.includes('NoSalvage')) {\n        const salvageOptions = [item.type == 'Consumable' && item.subtype == 'Food'\n                ? 'Compost'\n                : item.rarity == 'Ascended' ? 'Ascended' : 'Standard'\n        ];\n        if (item.flags.includes('SalvageResearch'))\n            salvageOptions.push('Research');\n        if (salvageOptions.length)\n            metaInfo.append(newElm('span', 'Salvage: ' + salvageOptions.join(', ')));\n    }\n    if (item.vendor_value) {\n        let inner = ['Vendor Value: ', formatCoins(item.vendor_value * stackSize)];\n        if (stackSize > 1)\n            inner.push(' (', formatCoins(item.vendor_value), ` x ${stackSize})`);\n        metaInfo.append(newElm('span', ...inner));\n    }\n    parts.push(metaInfo);\n    const tooltip = newElm('div.tooltip.item.active', ...parts);\n    tooltip.dataset.id = String(item.id);\n    return tooltip;\n}\nexport function findCorrectAttributeSet(item, statSetId) {\n    let statSet = undefined;\n    if (item.type == \"Armor\" || item.type == \"Trinket\" || item.type == \"Weapon\") {\n        statSetId = statSetId || item.attribute_set;\n        if (statSetId === undefined)\n            console.warn(`[gw2-tooltips] [tooltip engine] Resolving stats for item without specified or innate attributes. Specify the stats by adding 'stats=\"<stat_set_id>\" to the html element.' `);\n        else {\n            statSet = APICache.storage.itemstats.get(statSetId);\n            if (!statSet)\n                console.error(`[gw2-tooltips] [tooltip engine] itemstat #${statSetId} is missing in cache.`);\n            else {\n                if (config.adjustIncorrectStatIds && statSet.similar_sets) {\n                    const correctSetId = statSet.similar_sets[item.subtype];\n                    if (correctSetId !== undefined) {\n                        console.info(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${statSetId} to #${correctSetId} because the target is of type ${item.subtype}.`);\n                        const newSet = APICache.storage.itemstats.get(correctSetId);\n                        if (!newSet)\n                            console.error(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${correctSetId} is missing in the cache.`);\n                        else\n                            statSet = newSet;\n                    }\n                }\n            }\n        }\n    }\n    return statSet;\n}\nfunction generateUpgradeItemGroup(item, context) {\n    const group = newElm('div.group');\n    for (const [i, tier] of item.tiers.entries()) {\n        let tier_wrap = newElm('te');\n        if (tier.description)\n            tier_wrap.append(newElm('span', fromHTML(GW2Text2HTML(tier.description))));\n        else if (tier.facts) {\n            for (const fact of tier.facts) {\n                const { wrapper } = generateFact(fact, null, context);\n                if (wrapper)\n                    tier_wrap.append(wrapper);\n            }\n        }\n        else if (tier.modifiers) {\n            tier_wrap.style.flexDirection = \"column\";\n            const activeAttributes = getActiveAttributes(context.character);\n            for (const modifier of tier.modifiers) {\n                let modifierValue = calculateModifier(modifier, context.character.level, activeAttributes);\n                let text;\n                if (modifier.flags.includes('FormatPercent')) {\n                    text = `+${Math.round(modifierValue)}% ${localizeInternalName(modifier.description)}`;\n                }\n                else {\n                    text = `+${Math.round(modifierValue)} ${localizeInternalName(modifier.description)}`;\n                }\n                tier_wrap.append(newElm('te', text));\n            }\n        }\n        const w = newElm('te', tier_wrap);\n        if (item.subtype == \"Rune\") {\n            const colorClass = i < (context.character.upgradeCounts[item.id] || 0) ? '.gw2-color-stat-green' : '';\n            w.prepend(newElm('span' + colorClass, `(${i + 1})`));\n        }\n        group.append(w);\n    }\n    return group;\n}\nfunction generateAttributeTooltip(attribute, context) {\n    const weaponStats = context.character.statsWithWeapons[context.character.selectedWeaponSet];\n    const value = weaponStats.values[attribute];\n    let parts = weaponStats.htmlParts[attribute];\n    if (['ConditionDuration', 'BoonDuration'].includes(attribute)) {\n        parts = parts.slice();\n        const targetType = attribute === 'ConditionDuration' ? 'Condition' : 'Boon';\n        const modCap = (getAttributeInformation(attribute, context.character).cap - 1) * 100;\n        const activeAttributes = getActiveAttributes(context.character);\n        for (const [effectId, sources] of Object.entries(weaponStats.sources)) {\n            if (isNaN(+effectId))\n                continue;\n            const effect = APICache.storage.skills.get(+effectId);\n            if (!effect) {\n                console.error(`[gw2-tooltips] [tooltip engine] effect #${effectId} is missing in cache.`);\n                continue;\n            }\n            if (effect.buff_type !== targetType)\n                continue;\n            let specificMod = value * 100;\n            let specificParts = [];\n            for (const { source, modifier, count } of sources) {\n                const mod = calculateModifier(modifier, context.character.level, activeAttributes);\n                specificParts.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                specificMod += mod;\n            }\n            const uncappedMod = specificMod;\n            specificMod = Math.min(specificMod, modCap);\n            if (uncappedMod != specificMod) {\n                specificParts.push(newElm('span.detail.capped', `(Capped to +${n3(specificMod)}%! Uncapped value would be ${n3(uncappedMod)}%)`));\n            }\n            parts.push(newElm('div.fact', newImg(effect.icon), newElm('div', newElm('span', `${effect.name}: +${n3(specificMod)}%`), ...specificParts)));\n        }\n    }\n    return newElm('div.tooltip.item.active', ...parts);\n}\nexport function formatItemName(item, context, statSet, upgradeComponent, stackSize = 1) {\n    let name;\n    if (item.type == 'TraitGuide') {\n        name = item.trait;\n    }\n    else {\n        name = item.name;\n    }\n    let arg1, arg2, arg3, arg4;\n    arg1 = arg2 = arg3 = arg4 = '';\n    if (!item.flags.includes('HidePrefix')) {\n        if (statSet && statSet.name) {\n            arg1 = statSet.name;\n            arg2 = \" \";\n        }\n    }\n    if (!item.flags.includes('HideSuffix')) {\n        if (upgradeComponent && upgradeComponent.suffix) {\n            arg4 = upgradeComponent.suffix;\n            arg3 = \" \";\n        }\n    }\n    name = GW2Text2HTML(name, arg1, arg2, arg3, arg4);\n    if (stackSize > -1)\n        name = resolveInflections(name, stackSize, context.character);\n    if (!item.flags.includes('Pve') && (item.flags.includes('Pvp') || item.flags.includes('PvpLobby')))\n        name += \" (PvP)\";\n    return name;\n}\nexport function specializeContextFromInlineAttribs(context, gw2Object) {\n    let traitOverrides = gw2Object.getAttribute('with-traits');\n    if (traitOverrides) {\n        context = Object.assign({}, context);\n        context.cloned = true;\n        context.character = Object.assign({}, context.character);\n        const invalid = [];\n        context.character.traits = new Set(traitOverrides.split(',').map(t => {\n            const v = +t;\n            if (!v)\n                invalid.push(t);\n            return v;\n        }).filter(t => t));\n        if (invalid.length)\n            console.warn(\"[gw2-tooltips] [tooltip engine] Inline trait-override for element \", gw2Object, \" has misformed overrides: \", invalid);\n    }\n    return context;\n}\nfunction formatCoins(amount) {\n    const parts = [String(Math.floor(amount % 100)), newImg(ICONS.COIN_COPPER, 'iconsmall', '')];\n    if (amount > 99)\n        parts.unshift(String(Math.floor((amount / 100) % 100)), newImg(ICONS.COIN_SILVER, 'iconsmall', ''));\n    if (amount > 9999)\n        parts.unshift(String(Math.floor(amount / 10000)), newImg(ICONS.COIN_GOLD, 'iconsmall', ''));\n    return newElm('span', ...parts);\n}\nfunction isTwoHanded(type) {\n    switch (type) {\n        case 'Axe': return false;\n        case 'Dagger': return false;\n        case 'Mace': return false;\n        case 'Pistol': return false;\n        case 'Scepter': return false;\n        case 'Focus': return false;\n        case 'Sword': return false;\n        case 'BowShort': return false;\n        case 'Torch': return false;\n        case 'Shield': return false;\n        case 'Warhorn': return false;\n        case 'Toy': return false;\n        case 'ToyTwoHanded': return false;\n        case 'BundleSmall': return false;\n        case 'Hammer': return true;\n        case 'BowLong': return true;\n        case 'Greatsword': return true;\n        case 'Polearm': return true;\n        case 'Rifle': return true;\n        case 'Staff': return true;\n        case 'BundleLarge': return true;\n        case 'Spear': return true;\n        case 'Speargun': return true;\n        case 'Trident': return true;\n    }\n}\nexport const DEFAULT_CONTEXT = {\n    gameMode: 'Pve',\n    underwater: false,\n    targetArmor: 2597,\n    character: {\n        level: 80,\n        isPlayer: true,\n        sex: \"Male\",\n        traits: new Set(),\n        specializations: new Set(),\n        stats: {\n            values: {\n                Power: 0,\n                Toughness: 0,\n                Vitality: 0,\n                Precision: 0,\n                Ferocity: 0,\n                ConditionDamage: 0,\n                Expertise: 0,\n                Concentration: 0,\n                HealingPower: 0,\n                AgonyResistance: 0,\n            },\n            sources: {\n                Power: [],\n                Toughness: [],\n                Vitality: [],\n                Precision: [],\n                Ferocity: [],\n                ConditionDamage: [],\n                Expertise: [],\n                Concentration: [],\n                HealingPower: [],\n                AgonyResistance: [],\n                Armor: [],\n                Damage: [],\n                LifeForce: [],\n                Health: [],\n                HealEffectiveness: [],\n                Stun: [],\n                ConditionDuration: [],\n                BoonDuration: [],\n                CritChance: [],\n                CritDamage: [],\n            },\n        },\n        statsWithWeapons: [{\n                values: {\n                    Power: 1000,\n                    Toughness: 1000,\n                    Vitality: 1000,\n                    Precision: 1000,\n                    Ferocity: 0,\n                    ConditionDamage: 0,\n                    Expertise: 0,\n                    Concentration: 0,\n                    HealingPower: 0,\n                    AgonyResistance: 0,\n                    Health: 10000,\n                    Armor: 1000,\n                    CritChance: 0.05,\n                    CritDamage: 1.5,\n                    ConditionDuration: 0,\n                    BoonDuration: 0,\n                },\n                sources: {\n                    Power: [],\n                    Toughness: [],\n                    Vitality: [],\n                    Precision: [],\n                    Ferocity: [],\n                    ConditionDamage: [],\n                    Expertise: [],\n                    Concentration: [],\n                    HealingPower: [],\n                    AgonyResistance: [],\n                    Armor: [],\n                    Damage: [],\n                    LifeForce: [],\n                    Health: [],\n                    HealEffectiveness: [],\n                    Stun: [],\n                    ConditionDuration: [],\n                    BoonDuration: [],\n                    CritChance: [],\n                    CritDamage: [],\n                },\n                htmlParts: {\n                    Power: [],\n                    Toughness: [],\n                    Vitality: [],\n                    Precision: [],\n                    Ferocity: [],\n                    ConditionDamage: [],\n                    Expertise: [],\n                    Concentration: [],\n                    HealingPower: [],\n                    AgonyResistance: [],\n                    Armor: [],\n                    Health: [],\n                    ConditionDuration: [],\n                    BoonDuration: [],\n                    CritChance: [],\n                    CritDamage: [],\n                },\n            }],\n        selectedWeaponSet: 0,\n        upgradeCounts: {},\n    },\n};\nfunction createCompleteContext(partialContext) {\n    var _a, _b, _c, _d, _e, _f;\n    if (partialContext.gameMode == \"Pvp\" && ((_a = partialContext.character) === null || _a === void 0 ? void 0 : _a.level) && ((_b = partialContext.character) === null || _b === void 0 ? void 0 : _b.level) != 80) {\n        console.error('[gw2-tooltips] [init] supplied (partial) context has its gamemode set to pvp, but has a character level specified thats other than 80. In pvp you are always level 80. This will lead to unexpected results; Remove the explicit level or change the gamemode. The (partial) context in question is: ', partialContext);\n    }\n    const stats = createCompletedBaseStats((_c = partialContext.character) === null || _c === void 0 ? void 0 : _c.stats);\n    const upgradeCounts = Object.assign({}, (_d = partialContext.character) === null || _d === void 0 ? void 0 : _d.upgradeCounts);\n    const statsWithWeapons = ((_f = (_e = partialContext.character) === null || _e === void 0 ? void 0 : _e.statsWithWeapons) === null || _f === void 0 ? void 0 : _f.map(s => createCompletedStats(s))) || [createCompletedStats()];\n    const character = Object.assign({}, DEFAULT_CONTEXT.character, { traits: new Set(), specializations: new Set() }, partialContext.character, { stats, upgradeCounts, statsWithWeapons });\n    return Object.assign({}, DEFAULT_CONTEXT, partialContext, { character });\n}\nexport function createCompletedBaseStats(partialSource = {}) {\n    const values = Object.assign({}, DEFAULT_CONTEXT.character.stats.values, partialSource.values);\n    const sources = Object.assign({}, structuredClone(DEFAULT_CONTEXT.character.stats.sources), partialSource.sources);\n    return { values, sources };\n}\nexport function createCompletedStats(partialSource = {}) {\n    const values = Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values, partialSource.values);\n    const sources = Object.assign({}, structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].sources), partialSource.sources);\n    const htmlParts = Object.assign({}, structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].htmlParts), partialSource.htmlParts);\n    return { values, sources, htmlParts };\n}\nconst DEFAULT_CONFIG = {\n    autoInitialize: true,\n    autoCollectRuneCounts: true,\n    autoCollectStatSources: true,\n    autoCollectSelectedTraits: true,\n    autoRecomputeCharacterAttributes: true,\n    adjustIncorrectStatIds: true,\n    autoInferEquipmentUpgrades: true,\n    autoInferWeaponSetAssociation: true,\n    legacyCompatibility: true,\n    showPreciseAbilityTimings: false,\n    showFactComputationDetail: false,\n    validateApiResponses: true,\n};\nvar Rarity;\n(function (Rarity) {\n    Rarity[Rarity[\"Junk\"] = 0] = \"Junk\";\n    Rarity[Rarity[\"Basic\"] = 1] = \"Basic\";\n    Rarity[Rarity[\"Common\"] = 2] = \"Common\";\n    Rarity[Rarity[\"Uncommon\"] = 3] = \"Uncommon\";\n    Rarity[Rarity[\"Rare\"] = 4] = \"Rare\";\n    Rarity[Rarity[\"Exotic\"] = 5] = \"Exotic\";\n    Rarity[Rarity[\"Ascended\"] = 6] = \"Ascended\";\n    Rarity[Rarity[\"Legendary\"] = 7] = \"Legendary\";\n})(Rarity || (Rarity = {}));\nconst LUT_RARITY = [0, 0, 1, 2, 3, 4, 4, 4];\nconst LUT_RARITY_MUL = [0.5, 0.65, 0.8, 0.85, 0.9, 1.0, 1.05, 1.05];\nexport const ICONS = {\n    COIN_COPPER: 156902,\n    COIN_SILVER: 156907,\n    COIN_GOLD: 156904,\n    SLOT_Upgrade: 517197,\n    SLOT_Infusion: 517202,\n    SLOT_Enrichment: 517204,\n    RESOURCE_THIEF: 156649,\n    RESOURCE_REV: 156647,\n    UPKEEP_COST: 156058,\n    SUPPLY_COST: 2111003,\n    ENDURANCE_COST: 156649,\n    NO_UNDERWATER: 358417,\n    RECHARGE: 156651,\n    ACTIVATION: 496252,\n    RANGE: 156666,\n    DEFIANCE_BREAK: 1938788,\n    WEAPON_SWAP: 156583,\n    BARRIER: 1770209,\n    STUN_BREAK: 156654,\n    KNOCKDOWN: 2440716,\n    PULL: 2440717,\n    KNOCKBACK: 2440715,\n    LAUNCH: 2440712,\n    FLOAT: 2440713,\n    SINK: 2440714,\n};\nconst VALID_CHAIN_PALETTES = ['Bundle', 'Heal', 'Elite', 'Profession', 'Standard', 'Equipment'];\n{\n    if (window.GW2TooltipsContext instanceof Array) {\n        for (const partialContext of window.GW2TooltipsContext)\n            contexts.push(createCompleteContext(partialContext));\n    }\n    else if (window.GW2TooltipsContext) {\n        contexts.push(createCompleteContext(window.GW2TooltipsContext));\n    }\n    else {\n        contexts.push(createCompleteContext({}));\n    }\n    config = Object.assign({}, DEFAULT_CONFIG, window.GW2TooltipsConfig);\n    if (config.apiImpl)\n        APICache.apiImpl = config.apiImpl(APIs);\n    if (\"serviceWorker\" in navigator && config.workerPath) {\n        navigator.serviceWorker.register(config.workerPath, { scope: '/' }).then((s) => console.log('[gw2-tooltips] [worker] APICache ServiceWorker registered.', s), (e) => console.error(`[gw2-tooltips] [worker] Failed to register APICache ServiceWorker: ${e}`));\n    }\n    tooltip = newElm('div.tooltipWrapper');\n    tooltip.style.display = 'none';\n    if (document.body)\n        document.body.appendChild(tooltip);\n    else\n        document.addEventListener('DOMContentLoaded', () => document.body.appendChild(tooltip));\n    const isMobile = /android|webos|iphone|ipad|ipod|blackberry|bb|playbook|mobile|windows phone|kindle|silk|opera mini/.test(navigator.userAgent.toLowerCase());\n    document.addEventListener('mousemove', event => {\n        if (isMobile && (Math.abs(event.pageX - lastMouseX) + Math.abs(event.pageY - lastMouseY) > 20)) {\n            tooltip.style.display = 'none';\n        }\n        lastMouseX = event.pageX;\n        lastMouseY = event.pageY;\n        if (tooltip.style.display != 'none')\n            positionTooltip();\n    });\n    document.addEventListener('contextmenu', event => {\n        const node = findSelfOrParent(event.target, 'gw2object');\n        if (!node)\n            return;\n        if (node.classList.contains('cycler') && tooltip.style.display != 'none') {\n            event.preventDefault();\n            cyclePos = (cyclePos + 1) % tooltip.childElementCount;\n            activateSubTooltip(cyclePos);\n            scrollSubTooltipIntoView(cyclePos, true);\n            positionTooltip(true);\n        }\n        if (isMobile && tooltip.style.display == 'none') {\n            event.preventDefault();\n            showTooltipFor(node);\n            positionTooltip();\n        }\n    });\n    let touch;\n    const scrollHandler = (event) => {\n        if (tooltip.style.display == 'none')\n            return;\n        const activeTT = tooltip.children[cyclePos];\n        if (activeTT.scrollHeight == activeTT.clientHeight)\n            return;\n        event.preventDefault();\n        const deltaY = event.deltaY || event.detail || event.touches[0].clientY - touch.clientY;\n        activeTT.scrollBy(0, deltaY);\n    };\n    const passive = 'onwheel' in window ? { passive: false } : false;\n    window.addEventListener('DOMMouseScroll', scrollHandler, false);\n    window.addEventListener('wheel', scrollHandler, passive);\n    window.addEventListener('touchstart', event => {\n        touch = event.touches[0];\n    });\n    window.addEventListener('touchmove', scrollHandler, passive);\n    window.addEventListener('keydown', e => {\n        if (e.ctrlKey && e.altKey) {\n            if (e.key == 'd') {\n                e.preventDefault();\n                config.showFactComputationDetail = !config.showFactComputationDetail;\n                console.log(`[gw2-tooltips] [cfg] showFactComputationDetail is now ${config.showFactComputationDetail}`);\n                if (lastTooltipTarget && tooltip.style.display != 'none') {\n                    showTooltipFor(lastTooltipTarget, cyclePos);\n                    positionTooltip();\n                }\n            }\n            else if (e.key == 't') {\n                e.preventDefault();\n                config.showPreciseAbilityTimings = !config.showPreciseAbilityTimings;\n                console.log(`[gw2-tooltips] [cfg] showPreciseAbilityTimings is now ${config.showPreciseAbilityTimings}`);\n                if (lastTooltipTarget && tooltip.style.display != 'none') {\n                    showTooltipFor(lastTooltipTarget, cyclePos);\n                    positionTooltip();\n                }\n            }\n        }\n    });\n}\nif (config.autoInitialize) {\n    const buildNodes = document.getElementsByClassName('gw2-build-wrapper');\n    if (config.autoCollectSelectedTraits) {\n        if (buildNodes.length)\n            for (const target of buildNodes)\n                Collect.allTraits(target);\n        else {\n            console.warn(\"[gw2-tooltips] [collect] `config.autoCollectSelectedTraits` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.\");\n        }\n    }\n    hookDocument(document)\n        .then(gw2Objects => {\n        var _a;\n        if (config.autoInferWeaponSetAssociation) {\n            for (const buildNode of buildNodes) {\n                for (const [i, setNode] of buildNode.querySelectorAll('.weapon-set').entries()) {\n                    for (const objNode of setNode.getElementsByTagName('GW2OBJECT'))\n                        objNode.setAttribute('weaponSet', String(i));\n                }\n                const skillIdsBySet = [];\n                for (const [i, setSkillsNode] of buildNode.querySelectorAll('.skills-weapon-set').entries()) {\n                    const skillIds = [];\n                    const chainIds = (skill, context, adjustTraitedSkillIds) => {\n                        if (adjustTraitedSkillIds) {\n                            const replacementSkill = findTraitedOverride(skill, context);\n                            if (replacementSkill)\n                                skill = replacementSkill;\n                        }\n                        skillIds.push(skill.id);\n                        let palette, group, i;\n                        [palette, group, i, context] = guessGroupAndContext(skill, context);\n                        if (group) {\n                            let candidate = group.candidates[i];\n                            while (candidate.previous_chain_skill_index) {\n                                const otherCandidate = group.candidates[candidate.previous_chain_skill_index];\n                                if (!canBeSelected(otherCandidate, context))\n                                    break;\n                                skillIds.push(otherCandidate.skill);\n                                candidate = otherCandidate;\n                            }\n                            for (let j = 0; j < i; j++) {\n                                const otherCandidate = group.candidates[j];\n                                if (otherCandidate.previous_chain_skill_index != i)\n                                    continue;\n                                if (!canBeSelected(otherCandidate, context))\n                                    continue;\n                                skillIds.push(otherCandidate.skill);\n                                i = j;\n                                j = -1;\n                            }\n                        }\n                        if (skill.bundle_skills)\n                            for (const subSkillId of skill.bundle_skills) {\n                                const subSkillInChain = APICache.storage.skills.get(subSkillId);\n                                if (subSkillInChain)\n                                    skillIds.push(subSkillId);\n                            }\n                        if (skill.related_skills)\n                            for (const subSkillId of skill.related_skills) {\n                                const subSkillInChain = APICache.storage.skills.get(subSkillId);\n                                if (subSkillInChain && subSkillInChain.palettes.some(pid => {\n                                    const palette = APICache.storage.palettes.get(pid);\n                                    return palette && VALID_CHAIN_PALETTES.includes(palette.type);\n                                })) {\n                                    skillIds.push(subSkillId);\n                                }\n                            }\n                        if (skill.ambush_skills)\n                            for (const { id: subSkillId } of skill.ambush_skills) {\n                                const subSkillInChain = APICache.storage.skills.get(subSkillId);\n                                if (subSkillInChain)\n                                    skillIds.push(subSkillId);\n                            }\n                    };\n                    for (const objNode of setSkillsNode.children) {\n                        objNode.setAttribute('weaponSet', String(i));\n                        const skill = APICache.storage.skills.get(+String(objNode.getAttribute('objid')));\n                        const context = contexts[+String(objNode.getAttribute('contextSet')) || 0];\n                        const adjustTraitedSkillIds = objNode.classList.contains('auto-transform');\n                        if (skill)\n                            chainIds(skill, context, adjustTraitedSkillIds);\n                        else {\n                            console.warn(\"[gw2-tooltips] [collect] failed to find skill for object \", objNode);\n                        }\n                    }\n                    skillIdsBySet.push(skillIds);\n                }\n                if (skillIdsBySet.length > 1 && (skillIdsBySet[0][0] != skillIdsBySet[1][0] || skillIdsBySet[0][skillIdsBySet[0].length - 1] != skillIdsBySet[1][skillIdsBySet[1].length - 1])) {\n                    console.info(\"[gw2-tooltips] [collect] Will mark the following skills as belonging to weapon sets: \", skillIdsBySet);\n                    const descriptionNode = (_a = buildNode.parentElement.nextElementSibling) === null || _a === void 0 ? void 0 : _a.nextElementSibling;\n                    if (descriptionNode)\n                        for (const skillNode of descriptionNode.querySelectorAll('gw2object[type=skill]')) {\n                            const id = +String(skillNode.getAttribute('objid')) || 0;\n                            if (id)\n                                for (const [i, skills] of skillIdsBySet.entries()) {\n                                    if (skills.includes(id))\n                                        skillNode.setAttribute('weaponSet', String(i));\n                                }\n                        }\n                }\n            }\n        }\n        if (config.autoCollectRuneCounts) {\n            if (buildNodes.length)\n                for (const target of buildNodes)\n                    Collect.allUpgradeCounts(target);\n            else {\n                console.warn(\"[gw2-tooltips] [collect] `config.autoCollectRuneCounts` is active, but no element with class `gw2-build` could be found to use as source. Upgrades will not be collected as there is no way to tell which upgrades belongs to the build and which ones are just in some arbitrary text.\");\n            }\n        }\n        if (config.autoCollectStatSources) {\n            if (buildNodes.length)\n                for (const target of buildNodes)\n                    Collect.allStatSources(target);\n            else {\n                console.warn(\"[gw2-tooltips] [collect] `config.autoCollectStatSources` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.\");\n            }\n        }\n        if (config.autoCollectSelectedTraits) {\n            Collect.traitEffects(contexts);\n        }\n        if (config.autoInferEquipmentUpgrades) {\n            const targets = document.querySelectorAll('.weapon, .armor, .trinket');\n            if (targets.length)\n                inferItemUpgrades(targets);\n            else {\n                console.warn(\"[gw2-tooltips] [collect] `config.autoInferEquipmentUpgrades` is active, but no wrapper elements element with class `'weapon`, `armor` or `trinket` could be found to use as source. No elements will be updated\");\n            }\n        }\n        for (const { character } of contexts) {\n            Collect.hoistGeneralSources(character);\n        }\n        if (config.autoRecomputeCharacterAttributes) {\n            for (const context of contexts) {\n                for (const weaponSetId of context.character.statsWithWeapons.keys()) {\n                    recomputeAttributesFromMods(context, weaponSetId);\n                }\n            }\n        }\n        for (const [attribute, elements] of gw2Objects.attributes) {\n            for (const element of elements) {\n                inflateAttribute(element, attribute);\n            }\n        }\n    });\n}\nimport { newElm, newImg, GW2Text2HTML, localizeInternalName, formatFraction, fromHTML, findSelfOrParent, n3, resolveInflections, IsDevIcon } from './TUtilsV2';\nimport * as APIs from './API';\nimport APICache from './APICache';\nexport { APICache };\nimport { MISSING_SKILL, calculateModifier, generateFact, generateFacts } from './FactsProcessor';\nimport * as Collect from './Collect';\nimport { _legacy_transformEffectToSkillObject, inferItemUpgrades, inflateAttribute, inflateGenericIcon, inflateItem, inflateProfession, inflateSkill, inflateSpecialization } from './Inflators';\nimport { LUT_DEFENSE, LUT_POWER_MONSTER, LUT_POWER_PLAYER, getActiveAttributes, getAttributeInformation, recomputeAttributesFromMods } from './CharacterAttributes';\n//# sourceMappingURL=TooltipsV2.js.map"],"names":["newElm","spec","inner","tag","classes","split","el","document","createElement","length","classList","add","append","formatImageUrl","id","missingImage","newImg","src","className","alt","img","fromHTML","html","dummy","innerHTML","content","GW2Text2HTML","text","formatArgs","replaceAll","_","i","resolveInflections","count","character","sex","n3","v","withUpToNDigits","x","digits","str","toFixed","charAt","slice","n3ss","formatFraction","value","config","showPreciseAbilityTimings","sign","Math","abs","fraction","min","round","floor","formatDuration","localizeInternalName","type","joinWordList","words","quoteWords","map","w","last","join","HSAPI","constructor","baseUrl","this","bulkRequest","endpoint","ids","fetch","WORKER_CACHE_INIT","then","r","json","headers","localAPI","fallbackAPI","localApiOffline","ex","message","includes","console","warn","APICache","ensureExistence","initialIds","validateResponse","apiImpl","additionalIds","Object","assign","skills","Set","items","traits","pets","specializations","itemstats","palettes","professions","findNextRelevantEndpoint","entries","size","didCollectPalettes","currentEndpoint","storageSet","storage","request","Array","from","values","clear","info","response","unobtainable","filter","some","obj","datum","has","set","collectConnectedIds","error","connectedIdsStorage","addFacts","facts","fact","buff","prefix","palette","group","groups","candidate","candidates","skill","subSkill","related_skills","ambush_skills","bundle_skills","block","blocks","override_groups","attribute_set","subSkillId","skills_ai","skills_soulbeast","specialization","applies_buff","facts_from_skill","recomputeAttributesFromMods","context","weaponSet","attributeOrder","stats","statsWithWeapons","selectedWeaponSet","allParts","stage1Attributes","stage2Attributes","fakeAttributes","attribute","baseAttribute","suffix","base","div","getAttributeInformation","displayMul","parts","sources","push","baseAttrValue","attrValue","statBonus","modValue","source","s","modifier","flags","mod","calculateModifier","level","source_attribute","base_amount","cap","toAdd","uncappedValue","unshift","htmlParts","Map","ATTRIBUTE_INFO_LUT","Power","undefined","Number","MAX_SAFE_INTEGER","Toughness","Vitality","Precision","Ferocity","ConditionDamage","Expertise","Concentration","HealingPower","AgonyResistance","Health","Armor","ConditionDuration","BoonDuration","CritChance","CritDamage","_p2","computedAttribute","getBaseHealth","profession","Guardian","Thief","Elementalist","Engineer","Ranger","Mesmer","Revenant","Necromancer","Warrior","getAttributeValue","getActiveAttributes","getAttributeSources","LUT_DEFENSE","LUT_POWER_PLAYER","LUT_POWER_MONSTER","formula","formula_param1","level_scaling","formula_param2","generateFact","weapon_strength","itemMode","iconSlug","icon","buffStackSize","buffDuration","duration","defiance_break_per_s","defiance_break","activeStats","generateBuffDescription","valueMod","modsArray","modifiers","description_brief","relevantModifiers","source_trait_req","mode","gameMode","modsMap","entry","get","this_duration","apply_count","strValue","fround","toString","description","target_attribute_or_skill","applyMods","baseDuration","detailStack","durMod","durationAttr","buff_type","cap_","attribVal","showFactComputationDetail","innerSuffix","durModStack","percentMod","uncappedMod","name","valueModStack","conversion","factInflators","AdjustByAttributeAndLevel","_a","level_exponent","level_multiplier","hit_count","attributeVal","attribute_multiplier","lines","AttributeAdjust","range","target","Buff","MISSING_BUFF","buffDescription","seconds","name_brief","BuffBrief","Distance","distance","Percent","percent","PercentHpSelfDamage","hpPool","PercentLifeForceCost","PercentHealth","raw","PercentLifeForceGain","Damage","dmg_multiplier","weaponStrength","power","damage","targetArmor","precision","ferocity","critChance","critDamage","moreDmgFromCrit","times","Time","time","ComboField","field_type","ComboFinisher","finisher_type","AttributeConversion","NoData","PrefixedBuff","generateBuffIcon","PrefixedBuffBrief","Range","max","StunBreak","data","firstLine","remainingDetail","wrapper","requires_trait","defianceBreak","effectiveBuffDuration","breakDetail","trait_names","skip_next","__gamemode_override_marker","d","stackSize","wrap","setAttribute","String","categories","MISSING_SKILL","allUpgradeCounts","scope","elements","getElementsByTagName","pair","contexts","elsInCorrectCtx","e","getAttribute","_upgradeCounts","elsWithWrongCtx","contextIndex","targetContext","counts","element","item","subtype","amountToAdd","legacyCompatibility","_legacy_getInfusionCount","upgradeCounts","allStatSources","keys","_statSources","baseSources","structuredClone","DEFAULT_CONTEXT","weaponSetSources","upgrades","actualInfusionCounts","ctx","total","c","tooMany","stop","sort","a","b","toRemove","tiersToProcess","tierNumber","sourceRuneSuffix","tiersToAdd","tiers","attributeSet","findCorrectAttributeSet","attributes","base_value","attribute_base","scaling","defense","ceil","targetSources","weaponSetId","isNaN","override","tier","isModApplicable","formatItemName","specificSources","overwriteWeaponStatSources","mergeSources","wTarget","_b","ownIndex","prototype","indexOf","call","parentElement","children","amountEl","getElementsByClassName","textContent","match","allTraits","querySelectorAll","_traits","specId","selectedPositions","y","traitEl","hoistGeneralSources","specializedStats","prependOnto","copySource","prepend","k","t","splice","target_trait_req","inflateGenericIcon","gw2Object","force","childElementCount","wikiLink","href","contains","replaceChildren","inflateSkill","contextSet","specializeContextFromInlineAttribs","replacementSkill","findTraitedOverride","inflateItem","inflateSpecialization","style","backgroundImage","background","dataset","label","column","toggle","inflateAttribute","_p","MagicFind","search","inflateProfession","icon_big","_legacy_transformEffectToSkillObject","error_store","chaos_aura","dark_aura","fire_aura","frost_aura","light_aura","magnetic_aura","shocking_aura","aegis","alacrity","fury","might","protection","quickness","regeneration","resistance","resolution","stability","swiftness","vigor","bleeding","blinded","burning","chill","chilled","confusion","crippled","fear","immobilize","poison","slow","taunt","torment","vulnerability","weakness","daze","stun","agony","invulnerability","revealed","stealth","superspeed","unblockable","blight","bloodstone_blessed","blue_pylon_power","champion_of_the_legions","compromised","crowd_favor","curse_of_frailty","debilitated","debilitating_void","defense_up","derangement","elemental_empowerment","empowering_auras","equalization_matrix","expose_weakness","exposed","extreme_vulnerability","fixated","growing_rage_ashym","ignite","intervention","necrosis","not_sticking_together","nova","ooze_pheromone","photon_saturation","positive_flow","power_of_the_void","reinforced_armor","relentless_fire","retaliation_ashym","sentinel_retribution","shattering_ice","shell_shocked","spectral_darkness","sticking_together","synchronized_vitality","unnatural_signet","use_soul_binder","void_empowerment","xeras_embrace","hardCoded","barrier","ICONS","BARRIER","stunbreak","STUN_BREAK","knockdown","KNOCKDOWN","pull","PULL","knockback","KNOCKBACK","launch","LAUNCH","float","FLOAT","sink","SINK","innerText","title","cursor","tooltip","lastTooltipTarget","lastMouseX","lastMouseY","cyclePos","PROFESSIONS","activateSubTooltip","tooltipIndex","tooltips","index","scrollSubTooltipIntoView","animate","transition","transform","offsetTop","offsetHeight","positionTooltip","wpadminbar","getElementById","topBarHeight","currentSubTooltip","tooltipXpos","offsetWidth","documentElement","clientWidth","tooltipYpos","scrollTop","setTimeout","left","top","async","hookDocument","_unused","objectsToGet","statsToGet","_legacy_effectErrorStore","objIdRaw","elementsWithThisId","objId","toUpperCase","inlineTraits","traitStr","traitId","attachMouseListeners","validateApiResponses","Promise","all","key","inflator","cache","objects","addEventListener","showTooltipFor","display","visibleIndex","statSetId","weaponStats","targetType","modCap","activeAttributes","effectId","effect","specificMod","specificParts","generateAttributeTooltip","tt","underwater","cloned","innerTooltips","initialActiveIndex","initialAPIObject","subiconRenderMode","tooltipChain","adjustTraitedSkillIds","slot","guessGroupAndContext","refineSlotName","insertAtIndex","previous_chain_skill_index","otherCandidate","canBeSelected","generateToolTip","j","slottedItems","statSet","countPrefix","upgradeNameSource","find","rarity","maxRarity","Rarity","Legendary","Common","Uncommon","Rare","Exotic","LUT_RARITY","avg","isPlayer","mul","LUT_RARITY_MUL","spread","line","damage_type","generateUpgradeItemGroup","slots","slottedItemIdx","findIndex","slottedItem","descriptionAlreadyShown","factsSkill","contextInfo","resolveTraitsAndOverrides","headerElements","pushGamemodeSplitLabels","pushCostAndRestrictionLabels","innerParts","pushFacts","metaInfo","weight","isTwoHanded","required_level","salvageOptions","vendor_value","formatCoins","generateItemTooltip","slotName","subSkillInChain","canBeUsedOnCurrentTerrain","pid","VALID_CHAIN_PALETTES","petSkillId","petSkill","slot_name","generateToolTipList","firstElementChild","apiObject","iconMode","ico","currentContextInformation","secondHeaderRow","destinationArray","sourceObject","specializedContextInformation","NO_UNDERWATER","activation","ACTIVATION","resource_cost","RESOURCE_REV","RESOURCE_THIEF","endurance_cost","ENDURANCE_COST","upkeep_cost","UPKEEP_COST","recharge","RECHARGE","supply_cost","SUPPLY_COST","SourceObject","baseContext","delete","splits","o","splits_html","criteria","getWeaponStrength","looseBlock","remainingBlocks","totalDefianceBreak","makeFactElements","order","trait_requirements","blockFacts","defianceWrap","DEFIANCE_BREAK","parseInt","generateFacts","_c","_d","_e","g","result","end","blockId","baseBlock","overrideBlock","insert_before","finalBlocks","finalFacts","to_skip","weapon_type","palette_type","BundleLarge","Standard","Focus","Shield","Torch","Warhorn","Greatsword","Hammer","Staff","BowLong","Rifle","BowShort","Axe","Sword","Dagger","Pistol","Scepter","Mace","Spear","Speargun","Trident","substring","lastIndexOf","startsWith","replace","fallback","transmuteContext","targetCandidate","clone","trait","usability","min_level","adjustIncorrectStatIds","similar_sets","correctSetId","newSet","tier_wrap","flexDirection","modifierValue","colorClass","upgradeComponent","arg1","arg2","arg3","arg4","traitOverrides","invalid","amount","COIN_COPPER","COIN_SILVER","COIN_GOLD","LifeForce","HealEffectiveness","Stun","createCompleteContext","partialContext","_f","createCompletedBaseStats","createCompletedStats","partialSource","DEFAULT_CONFIG","autoInitialize","autoCollectRuneCounts","autoCollectStatSources","autoCollectSelectedTraits","autoRecomputeCharacterAttributes","autoInferEquipmentUpgrades","autoInferWeaponSetAssociation","SLOT_Upgrade","SLOT_Infusion","SLOT_Enrichment","RANGE","WEAPON_SWAP","window","GW2TooltipsContext","GW2TooltipsConfig","APIs","navigator","workerPath","serviceWorker","register","log","body","appendChild","isMobile","test","userAgent","toLowerCase","touch","event","pageX","pageY","node","self","selector","depth","current","matches","findSelfOrParent","preventDefault","scrollHandler","activeTT","scrollHeight","clientHeight","deltaY","detail","touches","clientY","scrollBy","passive","ctrlKey","altKey","buildNodes","Collect.allTraits","gw2Objects","buildNode","setNode","objNode","skillIdsBySet","setSkillsNode","skillIds","chainIds","descriptionNode","nextElementSibling","skillNode","Collect.allUpgradeCounts","Collect.allStatSources","addModifiers","contextBoundInfo","Collect.traitEffects","targets","wrappers","remainingInfusionsByContext","enrichmentByContext","itemEl","upgradeEls","itemCtx","upgradeIds","u","remainingInfusions","infusionId","enrichment","attrString","inferItemUpgrades","Collect.hoistGeneralSources"],"mappings":"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,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAEngBC,EAAmB,CAC5B,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAErfC,EAAoB,CAC7B,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MCnK5iB,SAAShD,GAAkBiD,QAAEA,EAAO9C,YAAEA,EAAa+C,eAAgBC,EAAaC,eAAEA,EAAclD,iBAAEA,GAAoBD,EAAO3B,GAChI,IAAIqC,MAAEA,EAAKQ,gBAAEA,EAAeG,aAAEA,GAAiBhD,EAC/C,GAAI4B,EACA,OAAO5B,EAAM4B,GAAoBC,EAAc,IAEnD,OAAQ8C,GACJ,IAAK,kBAYL,IAAK,mBACL,IAAK,oBACD,OAAOhD,EAAQkD,EAAgBhD,EAZnC,IAAK,kBACD,OAAOF,EAAQkD,EAAgBhD,EAAcgB,EAAkBiC,EACnE,IAAK,yBACD,OAAOnD,EAAQA,EAAQkD,EAAgBhD,EAAcgB,EAAkBiC,EAC3E,IAAK,YACD,OAAOjD,EACX,IAAK,eACD,OAAOF,EAAQkD,EAAgBhD,EAAcmB,EAAe8B,EAChE,IAAK,sBACD,OAAOnD,EAAQA,EAAQkD,EAAgBhD,EAAcmB,EAAe8B,EAIxE,IAAK,oBACD,OAAOnD,EAAQkD,EAAgBhD,EAAciD,EACjD,IAAK,QACD,OAAOnD,EAAQkD,EAAgBhD,EAAcQ,EAAQyC,EACzD,IAAK,eACD,OAAOnD,EAAQA,EAAQkD,EAAgBhD,EAAcQ,EAAQyC,EAGrE,OADAtJ,QAAQC,KAAK,4DAA6DkJ,EAAS,gCAC5E9C,CACX,CAyCO,SAASkD,EAAa1G,EAAM2G,EAAiBnF,EAASoF,GAAW,GACpE,IAAIC,EAAW7G,EAAK8G,KAChBC,EAAgB,EAChBC,EAAehH,EAAKiH,SACpBC,EAAuBlH,EAAKmH,eAC5BC,EAAcnB,EAAoBzE,EAAQzH,WAC9C,MAAMsN,EAA0B,CAACpH,EAAMD,EAAMiH,EAAUK,KACnD,IAAIC,EAAY,GAChB,GAAItH,EAAKuH,YAAcvH,EAAKwH,oBAAsBb,EAAU,CACxD,MAAMc,EAAoBzH,EAAKuH,UAAUnI,QAAO6D,KAAeA,EAASyE,kBAAoBnG,EAAQzH,UAAUiE,OAAOyB,IAAIyD,EAASyE,sBACzHzE,EAAS0E,MAAQ1E,EAAS0E,OAASpG,EAAQqG,YACpD,IAAIC,EAAU,IAAIhE,IAClB,IAAK,IAAIlK,EAAI,EAAGA,EAAI8N,EAAkBpP,OAAQsB,IAAK,CAC/C,MAAMsJ,EAAWwE,EAAkB9N,GACnC,IAAImO,EAAQD,EAAQE,IAAI9E,EAASvK,IAC5BoP,GACDD,EAAQpI,IAAIwD,EAASvK,GAAIoP,EAAQ,CAAE7E,SAAUA,EAAUtI,MAAO,IAClE,IAAIA,EAAQyI,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAC7DlE,EAASK,mBACT3I,GAASwM,EAAYlE,EAASK,mBAElCwE,EAAMnN,OAASA,EACXsI,EAASC,MAAMjG,SAAS,kBACxBtD,GAEP,CACD,IAAK,IAAIgB,MAAEA,EAAKsI,SAAEA,KAAc4E,EAAQ9I,SAAU,CAI9C,GAHIkE,EAASC,MAAMjG,SAAS,cACxBtC,GAAS,KAETsI,EAASC,MAAMjG,SAAS,iBAAkB,CAC1C,IAAI+K,EAAgBhB,EAAW,IAC3B/D,EAASC,MAAMjG,SAAS,oBACxB+K,GAAiB,GAEjB/E,EAASC,MAAMjG,SAAS,qBACxB+K,GAAiB,IAErBrN,GAASqN,GAAiB,CAC7B,CACI/E,EAASC,MAAMjG,SAAS,iBACzBtC,GAASoF,EAAKkI,aAEdhF,EAASoD,QAAQpJ,SAAS,kBAC1BtC,GAAS0M,GACb,IAAIa,EAAWjF,EAASC,MAAMjG,SAAS,kBACjCvC,EAAeC,EAAOC,UACtBG,KAAKK,MAAML,KAAKoN,OAAOxN,IAAQyN,WAQrC,GAPInF,EAASC,MAAMjG,SAAS,mBACpBtC,EAAQ,IACRuN,EAAW,KAAOA,GAEtBA,GAAY,KAEhBA,GAAY,IAAMjF,EAASoF,YACuB,iBAAvCpF,EAASqF,0BAAwC,CACxD,MAAMnD,kBAAEA,GAAsB7C,EAAwBW,EAASqF,0BAA2B/G,EAAQzH,WAClG,GAAIqL,EAAmB,CACnB,MAAM9C,IAAEA,EAAGF,OAAEA,GAAWG,EAAwB6C,EAAmB5D,EAAQzH,WAE3EoO,GAAY,sCAAsClO,EAAGW,EAAQ0H,GAD1CF,EAAS,IAAM,MAC+CA,KAAU7G,EAAqB6J,YACnH,CACJ,CACDmC,EAAU5E,KAAKwF,EAClB,CACJ,CACD,OAAO5O,EAAa0G,EAAKwH,mBAAqBF,EAAUxL,KAAK,OAASkE,EAAKqI,YAAY,EAErFE,EAAY,CAACC,EAAcxI,EAAMyI,KACnC,IAAIC,EAAS,EAAGrB,EAAW,EAAG7D,EAAMS,OAAOC,iBAC3C,MAAMyE,EAAkC,QAAlB3I,EAAK4I,UAAuB,eAAsC,aAAlB5I,EAAK4I,WAA4B,oBACvG,GAAID,EAAc,CACd,MAAMzG,cAAEA,EAAaG,IAAEA,EAAKmB,IAAKqF,GAASvG,EAAwBqG,EAAcpH,EAAQzH,WACxF0J,EAAMqF,EACN,MAAMC,EAAY/C,EAAkBxE,EAAQzH,UAAWoI,GACvDwG,GAAUI,EAAYzG,EAClByG,EAAY,GAAKlO,EAAMA,OAACmO,4BACxBN,EAAY/F,KAAK,kBAAkB1I,EAAGwO,EAAe,SACrDC,EAAY/F,KAAK,KAAK1I,EAAGwO,EAAe,IAAOM,EAAYzG,QAAUrI,EAAG8O,EAAYzG,EAAM,eAAerI,EAAG8O,MAAc5G,MAE9H,IAAK,MAAMa,KAAUkD,EAAoB1E,EAAQzH,UAAW6O,GAAe,CACvE,IAAIxF,EAAMC,EAAkBL,EAAOE,SAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAAepE,EAAOlJ,MAC5F,MAAMmP,EAAcjG,EAAOE,SAASC,MAAMjG,SAAS,iBAAmB,IAAM,GACtEsF,EAAayG,EAAc,IAAM,EACvC7F,GAAOZ,EACPmG,GAAUvF,EACV,MAAMM,EAAQuF,EAAc7F,EAAMqF,EAAerF,EACjD,GAAIvI,EAAAA,OAAOmO,0BAA2B,CAClC,IAAIxP,EAAO,KAAKS,EAAGyJ,EAAQ,QACvBuF,IACAzP,GAAQ,KAAKS,EAAGmJ,EAAMZ,QAC1BhJ,GAAQ,SACJwJ,EAAOlJ,MAAQ,IACfN,GAAQ,GAAGwJ,EAAOlJ,UACtBN,GAAQwJ,EAAOA,OACf0F,EAAY/F,KAAK9K,EAAO,aAAcqB,EAASW,EAAmBL,EAAMwJ,EAAOlJ,MAAO0H,EAAQzH,aACjG,CACJ,CACJ,CACD,IAAImP,EAAchD,EAAoB1E,EAAQzH,UAAWkG,EAAKtH,IAC9D,GAAIuQ,EAAY5Q,OAAQ,CACL,IAAXqQ,GAAgB9N,EAAAA,OAAOmO,2BACvBN,EAAY/F,KAAK,kBAAkB1I,EAAGwO,EAAe,SACzD,IAAIU,EAAa,EACjB,IAAK,MAAMnG,OAAEA,EAAME,SAAEA,EAAQpJ,MAAEA,KAAWoP,EAAa,CACnD,MAAM9F,EAAMC,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAC7DvM,EAAMA,OAACmO,2BACPN,EAAY/F,KAAK9K,EAAO,cAAe,GAAG6C,EAAK+N,EAAe,IAAOrF,EAAM,UAAUnJ,EAAGmJ,aAAetJ,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmBmJ,EAAQlJ,EAAO0H,EAAQzH,cAC9LoP,GAAc/F,CACjB,CACDuF,GAAUQ,EAAa,GAC1B,CACD,MAAMC,EAAcT,EAMpB,GALAA,EAAS3N,KAAKG,IAAIiO,EAAa3F,GAC3BkF,GAAUS,GAAevO,EAAMA,OAACmO,2BAChCN,EAAY/F,KAAK9K,EAAO,cAAe,cAAcoC,EAAGwO,EAAe,IAAOhF,mCAAqCxJ,EAAGwO,EAAe,IAAOW,SAEhJX,GAAgBE,EACZ1I,EAAKoJ,KAAKnM,SAAS,gBAAiB,CACpC,IAAIoM,EAAgBpD,EAAoB1E,EAAQzH,UAAW,qBAC3D,GAAIuP,EAAchR,OAAQ,CAClBuC,EAAMA,OAACmO,2BACPN,EAAY/F,KAAK,4BACrB,IAAIwG,EAAa,EACjB,IAAK,MAAMnG,OAAEA,EAAME,SAAEA,EAAQpJ,MAAEA,KAAWwP,EAAe,CACrD,IAAIlG,EAAMC,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAG/D,GAFIlE,EAASK,mBACTH,GAAO,KACPvI,EAAAA,OAAOmO,0BAA2B,CAClC,MAAMO,EAAarG,EAASK,iBACtB,GAAG7I,EAAK0I,YAAcnJ,EAAGiJ,EAASM,kBAAkBvJ,EAAGmN,EAAYlE,EAASK,sBAAsBhI,EAAqB2H,EAASK,oBAChI,GAAG7I,EAAK0I,MACdsF,EAAY/F,KAAK9K,EAAO,cAAe,GAAG0R,UAAmBzP,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmBmJ,EAAQlJ,EAAO0H,EAAQzH,aACnJ,CACDoP,GAAc/F,CACjB,CACDkE,GAAY6B,EAAa,GAC5B,CACJ,CACD,MAAO,CAACV,EAAcnB,EAAS,EAE7BkC,EAAgB,CAClBC,0BAA2B,EAAGzJ,WAC1B,IAAI0J,EACJ,IAAI9O,GAASoF,EAAKpF,MAAQ4G,EAAQzH,UAAUuJ,OAAStD,EAAK2J,eAAiB3J,EAAK4J,kBAAoB5J,EAAK6J,UACrGC,EAAe,EACf9J,EAAKkC,YACL4H,EAAe9D,EAAkBxE,EAAQzH,UAAWiG,EAAKkC,WACzDtH,GAASkP,EAAe9J,EAAK+J,qBAAuB/J,EAAK6J,WAE7D,MAAMG,EAAQ,GAUd,GATInP,EAAAA,OAAOmO,4BACPgB,EAAMrH,KAAK,GAAG1I,EAAG+F,EAAKpF,qBAClBoF,EAAK4J,kBACLI,EAAMrH,KAAK,KAAK1I,EAAGuH,EAAQzH,UAAUuJ,OAAStD,EAAK2J,eAAiB3J,EAAK4J,8BAA8BpI,EAAQzH,UAAUuJ,WAAWrJ,EAAG+F,EAAK2J,8BAA8B1P,EAAG+F,EAAK4J,8BAClL5J,EAAKkC,WACL8H,EAAMrH,KAAK,KAAK1I,EAAG6P,EAAe9J,EAAK+J,8BAA8B9P,EAAG6P,MAAiBvO,EAAqByE,EAAKkC,gBAAgBjI,EAAG+F,EAAK+J,sCACzH,GAAlB/J,EAAK6J,WACLG,EAAMrH,KAAK,MAAM3C,EAAK6J,mBAEL,QAApBH,EAAK1J,EAAKxG,YAAyB,IAAPkQ,OAAgB,EAASA,EAAGxM,SAAS,QAAS,CAC3E,IAAIiM,EAAa,IACjB,IAAK,MAAMnG,OAAEA,EAAME,SAAEA,EAAQpJ,MAAEA,KAAWoM,EAAoB1E,EAAQzH,UAAW,qBAAsB,CACnG,IAAIqJ,EAAMC,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAG/D,GAFIlE,EAASK,mBACTH,GAAO,KACPvI,EAAAA,OAAOmO,0BAA2B,CAClC,MAAMO,EAAarG,EAASK,iBACtB,GAAGtJ,EAAGmJ,YAAcnJ,EAAGiJ,EAASM,kBAAkBvJ,EAAGmN,EAAYlE,EAASK,sBAAsBhI,EAAqB2H,EAASK,oBAC9H,GAAGtJ,EAAGmJ,MACZ4G,EAAMrH,KAAK9K,EAAO,cAAe,GAAG6C,EAAK0I,EAAM,IAAMxI,OAAW2O,WAAoBzP,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmBmJ,EAAQlJ,EAAO0H,EAAQzH,aAC1K,CACDoP,GAAc/F,CACjB,CACDxI,GAASuO,EAAa,GACzB,CAED,OADAa,EAAMpG,QAAQ,GAAGrK,EAAayG,EAAKxG,OAAS+B,EAAqByE,EAAKkC,eAAelH,KAAKI,MAAMR,MACzFoP,CAAK,EAEhBC,gBAAiB,EAAGjK,WAChB,MAAMpF,EAAQI,KAAKI,OAAO4E,EAAKkK,MAAM,GAAKlK,EAAKkK,MAAM,KAAO1I,EAAQzH,UAAUuJ,MAAQ,IAAMtD,EAAKkK,MAAM,IACjGzH,EAAQ,CAAC,GAAGlJ,EAAayG,EAAKxG,OAAS+B,EAAqByE,EAAKmK,YJ1M/DjQ,EI0M+EU,EJ1MnEV,GAAK,EAAI,IAAMD,EAAGC,GAAKD,EAAGC,MAAnD,IAAaA,EI2MR,MAAMkL,kBAAEA,GAAsB7C,EAAwBvC,EAAKmK,OAAQ3I,EAAQzH,WAC3E,GAAIqL,EAAmB,CACnB,MAAM9C,IAAEA,EAAGF,OAAEA,GAAWG,EAAwB6C,EAAmB5D,EAAQzH,WACrEyI,EAAaJ,EAAS,IAAM,EAClCK,EAAME,KAAK,gBAAgB1I,EAAGW,EAAQ0H,EAAME,KAAcJ,KAAU7G,EAAqB6J,MAC5F,CACD,OAAO3C,CAAK,EAEhB2H,KAAM,EAAGpK,OAAMC,WACNA,IACD9C,QAAQyC,MAAM,0CAA2CI,EAAKC,KAAM,uCACpEA,EAAOoK,GAEXxD,EAAW5G,EAAK6G,MAAQD,EACxB,MAAMpE,EAAQ,GACd,IAAI6E,GACHN,EAAcM,GAAYkB,EAAUxI,EAAKiH,SAAUhH,EAAMwC,GAC1D,IAAI6H,EAAkBjD,EAAwBpH,EAAMD,EAAMgH,EAAcM,GACpEgD,IAEIA,EADA1D,EACkB,qCAAqC0D,UAErC,KAAKA,KAE/B,MAAMC,EAAUvD,EAAe,EAAI,KAAK1L,EAAe0L,EAAcnM,EAAMA,WAAO,GAGlF,OAFA4H,EAAMmB,QAAQ,GAAGrK,EAAaM,EAAmBmG,EAAKxG,MAAQyG,EAAKuK,YAAcvK,EAAKoJ,MAAO,EAAG7H,EAAQzH,cAAcwQ,IAAUD,KAChIvD,EAAgB/G,EAAKkI,YACdzF,CAAK,EAEhBgI,UAAW,EAAGzK,OAAMC,WACXA,IACD9C,QAAQyC,MAAM,0CAA2CI,EAAKC,KAAM,uCACpEA,EAAOoK,GAEXxD,EAAW5G,EAAK6G,MAAQD,EACjB,CAAC,GAAGtN,EAAayG,EAAKxG,KAAMyG,EAAKoJ,UAE5CqB,SAAU,EAAG1K,UACF,CAAC,GAAGzG,EAAayG,EAAKxG,UAAUwB,KAAKI,MAAM4E,EAAK2K,aAE3DzG,OAAQ,EAAGlE,MAAQxG,OAAMoB,aACrB,MAAMoP,EAAQ,GACd,GAAI9C,GAAwB1N,GAAQA,EAAK0D,SAAS,YAAa,CAC3D,MAAMsK,EAAYtB,EAAoB1E,EAAQzH,UAAW,QACzD,GAAIyN,EAAUlP,OAAQ,CACduC,EAAMA,OAACmO,2BACPgB,EAAMrH,KAAK,GAAG1I,EAAGW,iBACrB,IAAIuO,EAAa,IACjB,IAAK,MAAMnG,OAAEA,EAAME,SAAEA,EAAQpJ,MAAEA,KAAW0N,EAAW,CACjD,MAAMpE,EAAMC,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAC7DvM,EAAMA,OAACmO,2BACPgB,EAAMrH,KAAK9K,EAAO,cAAe,GAAG6C,EAAK0I,YAActJ,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmBmJ,EAAQlJ,EAAO0H,EAAQzH,cAC9IoP,GAAc/F,CACjB,CACD,MAAMA,EAAM+F,EAAa,IACzBvO,GAASwI,EACT8D,GAAwB9D,CAC3B,CACJ,CAED,OADA4G,EAAMpG,QAAQ,GAAGrK,EAAaC,OAAUmB,EAAeC,EAAOC,aACvDmP,CAAK,EAEhBY,QAAS,EAAG5K,UACD,CAAC,GAAGzG,EAAayG,EAAKxG,UAAUmB,EAAeqF,EAAK6K,QAAShQ,EAAMA,YAE9EiQ,oBAAqB,EAAG9K,WACpB,MAAM+K,EAAS/E,EAAkBxE,EAAQzH,UAAW,UACpD,MAAO,CAAC,GAAGR,EAAayG,EAAKxG,UAAUwB,KAAKK,MAAM0P,EAAS/K,EAAK6K,QAAU,SAASlQ,EAAeqF,EAAK6K,QAAShQ,EAAMA,oBAAc,EAExImQ,qBAAsB,EAAGhL,MAAQ6K,UAASrR,YACtC,MAAMuR,EAAS1F,EAAc7D,EAAQzH,WAC/BiQ,EAAQ,GAId,OAHAA,EAAMrH,KAAK,GAAGpJ,EAAaC,OAAUS,EAAGe,KAAKI,MAAM2P,EAASF,EAAU,SAClEhQ,EAAMA,OAACmO,2BACPgB,EAAMrH,KAAK,QAAQ1I,EAAG4Q,SAAe5Q,EAAG8Q,mBACrCf,CAAK,EAEhBiB,cAAe,EAAGjL,MAAQ6K,UAASrR,YAC/B,MAAM0R,EAAMlQ,KAAKI,MAAM4K,EAAkBxE,EAAQzH,UAAW,UAAY8Q,EAAU,KAClF,MAAO,CAAC,GAAGtR,EAAaC,OAAUmB,EAAekQ,EAAShQ,EAAMA,aAAOqQ,QAAU,EAErFC,qBAAsB,EAAGnL,MAAQ6K,UAASrR,YACtC,MAAMuR,EAAS/E,EAAkBxE,EAAQzH,UAAW,UAC9CiQ,EAAQ,GACVnP,EAAAA,OAAOmO,2BACPgB,EAAMrH,KAAK,GAAG1I,EAAa,IAAV4Q,EAAiBE,EAAS,aAAc9Q,EAAG4Q,UAAgB5Q,EAAG8Q,uBAA4B9Q,EAAGoL,EAAc7D,EAAQzH,qCAAqCE,EAAG+L,EAAkBxE,EAAQzH,UAAW,0BAErN,MAAMyN,EAAYtB,EAAoB1E,EAAQzH,UAAW,aACzD,GAAIyN,EAAUlP,OAAQ,CAClB,IAAI6Q,EAAa,IACjB,IAAK,MAAMnG,OAAEA,EAAME,SAAEA,EAAQpJ,MAAEA,KAAW0N,EAAW,CACjD,MAAMpE,EAAMC,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAC7DvM,EAAMA,OAACmO,2BACPgB,EAAMrH,KAAK9K,EAAO,cAAe,GAAG6C,EAAK0I,YAActJ,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmBmJ,EAAQlJ,EAAO0H,EAAQzH,cAC9IoP,GAAc/F,CACjB,CACDyH,GAAW1B,EAAa,GAC3B,CAED,OADAa,EAAMpG,QAAQ,GAAGrK,EAAaC,OAAUmB,EAAekQ,EAAShQ,EAAMA,aAAOG,KAAKI,MAAe,IAAT2P,EAAgBF,EAAU,SAC3Gb,CAAK,EAEhBoB,OAAQ,EAAGpL,MAAQqL,iBAAgBxB,YAAWrQ,QAAQ8R,qBAClD,MAAMtB,EAAQ,GACRuB,EAAQvF,EAAkBxE,EAAQzH,UAAW,SACnD,IAAIyR,EAASH,EAAiBxB,EAAYyB,EAAiBC,EAAQ/J,EAAQiK,YACvE5Q,EAAAA,OAAOmO,4BACPgB,EAAMrH,KAAK,GAAG1I,EAAGuR,WAAgBvR,EAAGoR,sBAAmCpR,EAAGsR,cAAkBD,wBAAqC9J,EAAQiK,4BACxH,GAAb5B,GACAG,EAAMrH,KAAK,KAAKkH,WAExB,MAAM6B,EAAY1F,EAAkBxE,EAAQzH,UAAW,aACjD4R,EAAW3F,EAAkBxE,EAAQzH,UAAW,YAChD6R,EAAa5Q,KAAKG,IAAI,KAAQuQ,EAAY,KAAQ,GAAK,IAAM,GAC7DG,EAAa,IAAMF,EAAW,GAAK,IACnCG,EAAkBN,EAASI,GAAcC,EAAa,GAC5DL,GAAUM,EACNjR,EAAAA,OAAOmO,2BACPgB,EAAMrH,KAAK,KAAK1I,EAAG6R,OAAqB7R,EAAG2R,GAAcC,EAAa,GAAK,eAAe5R,EAAgB,IAAb2R,uBAAsC3R,EAAgB,IAAb4R,uBAAsC5R,EAAGyR,oBAA4BzR,EAAG0R,gBAElN,MAAMnE,EAAYtB,EAAoB1E,EAAQzH,UAAW,UACzD,GAAIyN,EAAUlP,OAAQ,CAClB,IAAI6Q,EAAa,IACjB,IAAK,MAAMnG,OAAEA,EAAME,SAAEA,EAAQpJ,MAAEA,KAAW0N,EAAW,CACjD,MAAMpE,EAAMC,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAC7DvM,EAAMA,OAACmO,2BACPgB,EAAMrH,KAAK9K,EAAO,cAAe,GAAG6C,EAAK0I,YAActJ,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmBmJ,EAAQlJ,EAAO0H,EAAQzH,cAC9IoP,GAAc/F,CACjB,CACDoI,GAAUrC,EAAa,GAC1B,CACD,MAAM4C,EAAQlC,EAAY,EAAI,IAAIA,MAAgB,GAElD,OADAG,EAAMpG,QAAQ,GAAGrK,EAAaC,KAAQuS,MAAU/Q,KAAKI,MAAMoQ,MACpDxB,CAAK,EAEhBgC,KAAM,EAAGhM,MAAQxG,YACb,MAAMwQ,EAAQ,GACd,GAAI9C,GAAwB1N,IAASA,EAAK0D,SAAS,SAAW1D,EAAK0D,SAAS,SACrE1D,EAAK0D,SAAS,aAAc,CAC/B,MAAMsK,EAAYtB,EAAoB1E,EAAQzH,UAAW,QACzD,GAAIyN,EAAUlP,OAAQ,CACduC,EAAMA,OAACmO,2BACPgB,EAAMrH,KAAK,GAAG1I,EAAG+M,EAAe,uBACpC,IAAImC,EAAa,IACjB,IAAK,MAAMnG,OAAEA,EAAME,SAAEA,EAAQpJ,MAAEA,KAAW0N,EAAW,CACjD,MAAMpE,EAAMC,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAO8D,GAC7DvM,EAAMA,OAACmO,2BACPgB,EAAMrH,KAAK9K,EAAO,cAAe,GAAG6C,EAAK0I,YAActJ,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmBmJ,EAAQlJ,EAAO0H,EAAQzH,cAC9IoP,GAAc/F,CACjB,CACD4D,GAAgBmC,EAAa,GAChC,CACJ,CACD,MAAM8C,EAAuB,KAAhBjF,EAAuB,UAAY,SAEhD,OADAgD,EAAMpG,QAAQ,GAAGrK,EAAaC,OAAUmB,EAAeqM,EAAe,IAAMnM,EAAAA,WAAWoR,KAChFjC,CAAK,EAEhBkC,WAAY,EAAGlM,UACJ,CAAC,GAAGzG,EAAayG,EAAKxG,UAAU+B,EAAqByE,EAAKmM,eAErEC,cAAe,EAAGpM,UACP,CAAC,GAAGzG,EAAayG,EAAKxG,UAAU+B,EAAqByE,EAAKqM,kBAErEC,oBAAqB,EAAGtM,UACb,CAAC,QAAQzE,EAAqByE,EAAKmK,oCAAoC5O,EAAqByE,EAAKgD,YAAYhD,EAAK6K,YAE7H0B,OAAQ,EAAGvM,UACA,CAACzG,EAAayG,EAAKxG,OAE9BgT,aAAc,EAAGxM,OAAMC,WACnB,IAAIC,EAAS7C,EAASuB,QAAQf,OAAOmK,IAAIhI,EAAKE,QACzCA,IACD/C,QAAQyC,MAAM,4CAA6CI,EAAKE,OAAQ,uCACxEA,EAASmK,GAEbxD,EAAW3G,EAAO4G,MAAQD,EACrB5G,IACD9C,QAAQyC,MAAM,0CAA2CI,EAAKC,KAAM,uCACpEA,EAAOoK,GAEX,IAAIpD,SAAEA,EAAQiB,YAAEA,EAAW1O,KAAEA,GAASwG,EACtC,MAAMyC,EAAQ,GACd,IAAI6E,GACHN,EAAcM,GAAYkB,EAAUvB,EAAUhH,EAAMwC,GACrD,IAAI6H,EAAkBjD,EAAwBpH,EAAMD,EAAMgH,EAAcM,GACpEgD,IACAA,EAAkB,KAAKA,KAE3B,MAAMC,EAAUvD,EAAe,EAAI,KAAK1L,EAAe0L,EAAcnM,EAAMA,WAAO,GAElF,OADA4H,EAAMmB,QAAQ/L,EAAO,WAAY4U,EAAiBxM,EAAK6G,KAAMoB,GAAcrQ,EAAO,OAAQqB,EAAS,GAAGK,EAAaC,IAASyG,EAAKuK,YAAcvK,EAAKoJ,OAAOkB,IAAUD,QAC9J7H,CAAK,EAEhBiK,kBAAmB,EAAG1M,OAAMC,WACxB,IAAIC,EAAS7C,EAASuB,QAAQf,OAAOmK,IAAIhI,EAAKE,QAW9C,OAVKA,IACD/C,QAAQyC,MAAM,4CAA6CI,EAAKE,OAAQ,uCACxEA,EAASmK,GAEbxD,EAAW3G,EAAO4G,MAAQD,EACrB5G,IACD9C,QAAQyC,MAAM,0CAA2CI,EAAKC,KAAM,uCACpEA,EAAOoK,GAGJ,CADIxS,EAAO,WAAYgB,EAAOoH,EAAK6G,MAAOjP,EAAO,OAAQ,GAAG0B,EAAayG,EAAKxG,OAASyG,EAAKuK,YAAcvK,EAAKoJ,SACzG,EAEjBsD,MAAO,EAAG3M,MAAQ7E,MAAKyR,UACZ,CAAC,UAAUzR,EAAM,GAAGA,OAASyR,IAAQA,KAEhDC,UAAW,IACA,CAAC,gBAIVC,EAAO,CAAE9M,OAAMC,KADR5C,EAASuB,QAAQf,OAAOmK,IAAIhI,EAAKC,MAAQ,GAC3BqL,eAAgB3E,IACpCoG,KAAcC,GAAmBxD,EAAcxJ,EAAKxE,MAAMsR,GAC3DG,EAAUpV,EAAO,YACnBmI,EAAKkN,gBACLD,EAAQ1U,UAAUC,IAAI,0BAE1B,IAAI2U,EAAgB,EACpB,GAAIjG,EAAsB,CACtB,IAAIkG,EAAwBpG,GAAgB,IACxCqG,EAAc,GACdrG,EAAe,KAAQhH,EAAKxG,OAASwG,EAAKxG,KAAK0D,SAAS,SAAW8C,EAAKxG,KAAK0D,SAAS,SAAW8C,EAAKxG,KAAK0D,SAAS,UAAY8C,EAAKxG,KAAK0D,SAAS,eACnJkQ,EAAwB,IACxBC,EAAc,2BAEgB,KAAzBD,IACLC,EAAc,KAAKrN,EAAKmH,qBAE5BgG,EAAgBjG,EAAuBkG,EAAwB,IAC/DJ,EAAgBrK,KAAK9K,EAAO,sCAAuC,mBAAmBsC,EAAgBgT,EAAe,KAAKE,KAC7H,CACD,GAAIrN,EAAKkN,eAAgB,CACrB,MAAMI,EAAc7R,EAAauE,EAAKkN,eAAetR,KAAIjD,IAAQ,IAAI+Q,EAAI,MAAO,0CAAqF,QAA1CA,EAAKrM,EAASuB,QAAQZ,OAAOgK,IAAIrP,UAAwB,IAAP+Q,OAAgB,EAASA,EAAGL,OAAS1Q,WAAY,KAC9NqU,EAAgBpJ,QAAQ1K,EAAS,wBAAyB8G,EAAKuN,YAAcvN,EAAKuN,UAAY,IAAMvN,EAAKwN,4BAA+B,aAAe,4BAA0D,GAA9BxN,EAAKkN,eAAe5U,OAAc,GAAK,OAAOgV,YACpO,CAGD,OAFAL,EAAQxU,OAAOgU,EAAiB5F,EAAUE,IAC1CkG,EAAQxU,OAAOZ,EAAO,MAAOA,EAAO,OAA4B,iBAAbkV,GAAyBA,EAAU7P,SAAS,KAAOhE,EAAS6T,GAAaA,MAAeC,EAAgBpR,KAAI6R,GAAiB,iBAALA,EAAgB5V,EAAO,cAAe4V,GAAKA,MAC/M,CAAER,UAAS9F,eAAgBgG,EACtC,CACO,SAASV,EAAiB3F,EAAM4G,EAAY,GAC/C,MAAMzU,EAAMJ,EAAOiO,GACnB,GAAiB,GAAb4G,EACA,OAAOzU,EAEN,CACD,MAAM0U,EAAO9V,EAAO,gBAAiBoB,GAErC,OADA0U,EAAKC,aAAa,QAASC,OAAOH,IAC3BC,CACV,CACL,CACO,MAAMtD,EAAe,CACxB1R,GAAI,EACJ0Q,KAAM,eACNf,YAAa,2CACbwF,WAAY,GAAI1P,SAAU,GAAIoJ,UAAW,GAAIrE,MAAO,IAE3C4K,EAAgB,CACzBpV,GAAI,EACJ0Q,KAAM,gBACNf,YAAa,4CACbwF,WAAY,GAAI1P,SAAU,GAAIoJ,UAAW,GAAIrE,MAAO,ICngBjD,SAAS6K,EAAiBC,EAAOrG,EAAO,GAC3C,MAAMsG,EAAWD,EAAME,qBAAqB,aAC5C,IAAK,MAAMC,KAAQC,GAAS9P,UAAW,CACnC,MAAM+P,EAAkBxP,MAAMC,KAAKmP,GAAU7O,QAAOkP,KAAOV,OAAOU,EAAEC,aAAa,gBAAkB,IAAMJ,EAAK,KAC1GE,EAAgBhW,QAChBmW,KAAkBL,EAAME,EAAiB1G,EAChD,CACD,MAAM8G,EAAkB5P,MAAMC,KAAKmP,GAAU7O,QAAOkP,KAAOV,OAAOU,EAAEC,aAAa,gBAAkB,IAAMH,GAAS/V,SAC9GoW,EAAgBpW,QAChB6E,QAAQC,KAAK,kDAAmD6Q,EAAO,4BAA6BS,EAE5G,CAIA,SAASD,EAAeE,EAAcC,EAAeV,EAAUtG,GAC3D,MAAMiH,EAAS,CAAA,EACf,IAAK,MAAMC,KAAWZ,EAAU,CAC5B,IAAIvV,EACJ,GAAqC,SAAjCmW,EAAQN,aAAa,WAAwB7V,GAAMkV,OAAOiB,EAAQN,aAAa,WAC/E,SACJ,MAAMO,EAAO1R,EAASuB,QAAQb,MAAMiK,IAAIrP,GACxC,IAAKoW,KAAU,YAAaA,KAAW,CAAC,OAAQ,YAAY7R,SAAS6R,EAAKC,SACtE,SACJ,IAAIC,EAAc,EAClB,GAAoB,YAAhBF,EAAKC,QAAuB,CAC5B,KAAMC,GAAepB,OAAOiB,EAAQN,aAAa,YACzC3T,EAAAA,OAAOqU,sBACPD,EAAcE,EAAyBL,IAClCG,GACD,SAGZ,IAAKA,EAAa,CACd9R,QAAQC,KAAK,yFAA0F0R,EAAS,yDAChH,QACH,CACJ,KACkC,OAA1BF,EAAc/G,UAAqC,QAAhBkH,EAAKC,UAC7CC,EAAc,GAElBJ,EAAOE,EAAKpW,KAAOkW,EAAOE,EAAKpW,KAAO,GAAKsW,CAC9C,CACD,OAAQrH,GACJ,KAAK,EACDgH,EAAc7U,UAAUqV,cAAgBP,EACxC,MACJ,KAAK,EACDD,EAAc7U,UAAUqV,cAAgBzR,OAAOC,OAAOgR,EAAc7U,UAAUqV,cAAeP,GAGzG,CACO,SAASQ,EAAepB,EAAOrG,EAAO,GACzC,MAAMsG,EAAWD,EAAME,qBAAqB,aAC5C,IAAK,MAAMQ,KAAgBN,GAASiB,OAAQ,CACxC,MAAMhB,EAAkBxP,MAAMC,KAAKmP,GAAU7O,QAAOkP,KAAOV,OAAOU,EAAEC,aAAa,gBAAkB,IAAMG,IACrGL,EAAgBhW,QAChBiX,EAAaZ,EAAcN,GAAUC,EAAiB1G,EAC7D,CACD,MAAM8G,EAAkB5P,MAAMC,KAAKmP,GAAU7O,QAAOkP,KAAOV,OAAOU,EAAEC,aAAa,gBAAkB,IAAMH,GAAS/V,SAC9GoW,EAAgBpW,QAChB6E,QAAQC,KAAK,kDAAmD6Q,EAAO,4BAA6BS,EAE5G,CAIA,SAASa,EAAaZ,EAAcN,EAAUH,EAAUtG,GACpD,MAAMpG,EAAU6M,EAASM,GACnBa,EAAcC,gBAAgBC,GAAgB3V,UAAU4H,MAAMe,SAC9DiN,EAAmB,GACzB,IAAIC,EAAW,CAAA,EACf,MAAMC,EAAuBxB,EAASzS,KAAIkU,IACtC,IAAIC,EAAQ,EACZ,MAAMlB,EAAS,CAAA,EACf,IAAK,IAAKlW,EAAIqX,KAAMrS,OAAOY,QAAQuR,EAAI/V,UAAUqV,eAAgB,CAC7D,IAAIL,GACCA,EAAO1R,EAASuB,QAAQb,MAAMiK,KAAKrP,KAAQ,YAAaoW,GAAwB,YAAhBA,EAAKC,UACtEgB,EAAIhV,KAAKG,IAAI6U,EAAG,IAChBnB,EAAOlW,GAAMqX,EACbD,GAASC,EAEhB,CACD,IAAIC,EAAUjV,KAAK4R,IAAI,EAAGmD,EAAQ,IAClC,IAAK,IAAIG,EAAO,IAAKD,EAAU,GAAKC,EAAO,EAAGA,IAC1C,IAAK,MAAOvX,EAAIqX,KAAMrS,OAAOY,QAAQsQ,GAAQsB,MAAK,CAACC,EAAGC,IAAMA,EAAE,GAAKD,EAAE,KACjE,GAAIJ,EAAI,EAAG,CACP,MAAMM,EAAgB,EAAJN,EAAS,EAAI,EAG/B,GAFAnB,EAAOlW,IAAO2X,EACdL,GAAWK,EACPL,GAAW,EACX,KACP,CAGT,OAAOpB,CAAM,IAEjB,IAAK,MAAMC,KAAWZ,EAAU,CAC5B,IAAIvV,EAAI6C,EAAOsT,EAAQN,aAAa,QACpC,KAAM7V,GAAMkV,OAAOiB,EAAQN,aAAa,WACpC,SACJ,IACI+B,EAAgBxB,EAAMyB,EAAYC,EADlCxB,EAAc,EAElB,GAAY,QAARzT,EAAgB,CAEhB,GADAuT,EAAO1R,EAASuB,QAAQb,MAAMiK,IAAIrP,IAC7BoW,KAAU,YAAaA,GACxB,SACJ,GAAkB,qBAAdA,EAAKvT,MAA6C,eAAduT,EAAKvT,KAAuB,CAChE,IAAIkV,EAAa,EAKjB,GAJqB,SAAjB3B,EAAKC,SAAsBD,EAAK5L,MAAMjG,SAAS,SAC/CwT,EAAa,GAEjBF,EAAaZ,EAASb,EAAKpW,KAAOiX,EAASb,EAAKpW,KAAO,GAAK+X,EACvC,SAAjB3B,EAAKC,QAAoB,CAEzB,GADAyB,GAAmB,EACfD,EAAa,EAAG,CACXhP,EAAQzH,UAAUqV,cAAcL,EAAKpW,KACtCwE,QAAQC,KAAK,oGAAqG0R,GACtH,QACH,CAEGyB,EADAxB,EAAK5L,MAAMjG,SAAS,OACH6R,EAAK4B,MAEL,CAAC5B,EAAK4B,MAAMH,EAAa,GACjD,MACI,GAAI,iBAAkBzB,EAAM,CAC7B,MAAM9O,EAAO5C,EAASuB,QAAQf,OAAOmK,IAAI+G,EAAK1N,aAAapB,MAC3D,IAAKA,EAAM,CACP9C,QAAQC,KAAK,2DAA2D2R,EAAK1N,oBAAqByN,EAAS,wDAC3G,QACH,CACDyB,EAAiB,CAAC,CAAE/I,UAAWvH,EAAKuH,WACvC,MACI,GAAI,UAAWuH,EAAM,CACtB,GAAoB,YAAhBA,EAAKC,SAAyC,cAAhBD,EAAKC,QAAyB,CAC5D,KAAMC,GAAepB,OAAOiB,EAAQN,aAAa,YACzC3T,EAAAA,OAAOqU,sBACPD,EAAcE,EAAyBL,IAClCG,GACD,SAGZ,IAAKA,EAAa,CACd9R,QAAQC,KAAK,yFAA0F0R,EAAS,yDAChH,QACH,CACJ,MACI,GAAqB,UAAjBC,EAAKC,SAAuBwB,EAAa,EAAG,CAC7CA,EAAa,GACbrT,QAAQC,KAAK,sGAAuG0R,GACxH,QACH,CACDyB,EAAiBxB,EAAK4B,KACzB,CACJ,CACJ,MACI,GAAY,cAARnV,IACLuT,EAAO1R,EAASuB,QAAQ,eAAeoJ,IAAIrP,IACtCoW,GACD,SAER,IAAI6B,EAAe7B,IAA8B,QAArBvN,EAAQqG,UAAqC,YAAdkH,EAAKvT,MAAuC,WAAjBuT,EAAKC,UAA0B6B,GAAwB9B,GAAOlB,OAAOiB,EAAQN,aAAa,gBAAavK,GAW7L,GAVI2M,IACAL,EAAiB,CAAC,CACV/I,UAAWoJ,EAAaE,WAAWlV,KAAIwU,IAAM,CACzC7H,0BAA2B6H,EAAElO,UAC7BsB,YAAaxI,KAAKI,MAAMgV,EAAEW,WAAahC,EAAKiC,eAAiBZ,EAAEa,SAC/D3K,QAAS,YACTnD,MAAO,GAAIxK,IAAK,EAAG4N,eAAgB,EAAGE,eAAgB,EAAG6B,YAAa,UAIlFyG,GAAQ,YAAaA,EAAM,CAC3B,MAAMmC,EAAkC,iBAAhBnC,EAAKmC,QACvBnC,EAAKmC,QACL/K,EAAYnL,KAAKG,IAAI,IAAM4T,EAAKmC,QAAQ,GAAK1P,EAAQzH,UAAUuJ,QAAWyL,EAAKmC,QAAQ,GACxFX,IACDA,EAAiB,CAAC,CAAE/I,UAAW,MACnC+I,EAAe,GAAG/I,UAAU7E,KAAK,CAC7B4F,0BAA2B,QAC3B/E,YAAaxI,KAAKmW,KAAKD,GACvB5K,QAAS,YACTnD,MAAO,GAAIxK,IAAK,EAAG4N,eAAgB,EAAGE,eAAgB,EAAG6B,YAAa,IAE7E,CACD,IAAI8I,EAAgB5B,EACpB,MAAM6B,GAAexD,OAAOiB,EAAQN,aAAa,cACjD,GAAI8C,MAAMD,IAAgBtC,GAAqB,oBAAbA,EAAKvT,KAA4B,CAC/D,MAAM+V,EAAW1B,EAAqBlB,GAAcI,EAAKpW,IACrD4Y,EACAtC,EAAcsC,EAETtC,EAAc,KACnBA,EAAc,GAErB,CAID,GAHKqC,MAAMD,KACPD,EAAgBzB,EAAiB0B,KAAiB1B,EAAiB0B,GAAe5B,gBAAgBC,GAAgB3V,UAAU4H,MAAMe,WAElI6N,EACA,IAAK,MAAO3W,EAAG4X,KAASjB,EAAehS,UACnC,GAAIiT,EAAKhK,UACL,IAAK,MAAMpE,KAAOoO,EAAKhK,UAAW,CAC9B,IAAKpE,EAAImF,4BAA8BkJ,EAAgBrO,EAAK5B,GACxD,SACJ,IAAIwB,EAAS0O,GAAe3C,EAAMvN,EAASoP,OAAc3M,GAAY,GACjEwM,IACAzN,EAAS,GAAGA,WAA0C,IAA1BuN,EAAejY,OAAekY,EAAa5W,EAAI,aAE9EwX,EAAchO,EAAImF,6BAA+B6I,EAAchO,EAAImF,2BAA6B,KAC5F5F,KAAK,CAAEO,SAAUE,EAAKJ,SAAQlJ,MAAOmV,GAC7C,CAEhB,CACD,MAAMlV,EAAYyH,EAAQzH,UAc1B,OAAQ6N,GACJ,KAAK,EACD7N,EAAU4H,MAAMe,QAAU8M,EAfC,MAC/B,IAAK,IAAK5V,EAAG+X,KAAoBhC,EAAiBpR,UAAW,CACzD,MAAM4L,EAASpQ,EAAU6H,iBAAiBhI,GACtCuQ,EACAA,EAAOzH,QAAUiP,EAEjB5X,EAAU6H,iBAAiBhI,GAAK,CAC5B8I,QAASiP,EACT3S,OAAQrB,OAAOC,OAAO,GAAI8R,GAAgB3V,UAAU6H,iBAAiB,GAAG5C,QACxE6E,UAAW4L,gBAAgBC,GAAgB3V,UAAU6H,iBAAiB,GAAGiC,WAEpF,GAKG+N,GACA,MACJ,KAAK,EAEGC,EAAa9X,EAAU4H,MAAMe,QAAS8M,GACtC,IAAK,MAAO5V,EAAG8I,KAAYiN,EAAiBpR,UAAW,CACnD,MAAMuT,EAAU/X,EAAU6H,iBAAiBhI,GACvCkY,EACAD,EAAaC,EAAQpP,QAASA,GAG9B3I,EAAU6H,iBAAiBhI,GAAK,CAC5B8I,UACA1D,OAAQrB,OAAOC,OAAO,GAAI8R,GAAgB3V,UAAU6H,iBAAiB,GAAG5C,QACxE6E,UAAW4L,gBAAgBC,GAAgB3V,UAAU6H,iBAAiB,GAAGiC,WAGpF,EAIjB,CACA,SAASsL,EAAyBL,GAC9B,IAAIpF,EAAIqI,EACR,MAAMC,EAAWlT,MAAMmT,UAAUC,QAAQC,KAAKrD,EAAQsD,cAAcC,SAAUvD,GACxEwD,EAAWxD,EAAQsD,cAAcG,uBAAuB,UAAUP,GACxE,IAAKM,EAED,YADAnV,QAAQC,KAAK,gGAAiG0R,EAAS,wEAG3H,MAAMG,GAAepB,OAAmG,QAA3FkE,EAAqC,QAA/BrI,EAAK4I,EAASE,mBAAgC,IAAP9I,OAAgB,EAASA,EAAG+I,MAAM,cAA2B,IAAPV,OAAgB,EAASA,EAAG,IAC5J,GAAK9C,EAAL,CAIA,KAAIA,EAAc,GAAKA,EAAc,IAIrC,OAAOA,EAHH9R,QAAQC,KAAK,iEAAkEkV,EAAU,yBAA0BxD,EAAS,4BAA6BG,EAAa,8HAFzK,MAFG9R,QAAQC,KAAK,iEAAkEkV,EAAU,yBAA0BxD,EAAS,4FAQpI,CACO,SAAS4D,EAAUzE,EAAOrG,EAAO,GACpC,MAAMsG,EAAWD,EAAM0E,iBAAiB,uDACxC,IAAK,MAAMvE,KAAQC,GAAS9P,UAAW,CACnC,MAAM+P,EAAkBxP,MAAMC,KAAKmP,GAAU7O,QAAOkP,KAAOV,OAAOU,EAAEC,aAAa,gBAAkB,IAAMJ,EAAK,KAC1GE,EAAgBhW,QAChBsa,KAAWxE,EAAME,EAAiB1G,EACzC,CACD,MAAM8G,EAAkB5P,MAAMC,KAAKmP,GAAU7O,QAAOkP,KAAOV,OAAOU,EAAEC,aAAa,gBAAkB,IAAMH,GAAS/V,SAC9GoW,EAAgBpW,QAChB6E,QAAQC,KAAK,kDAAmD6Q,EAAO,4BAA6BS,EAE5G,CAIA,SAASkE,EAAQjE,EAAcC,EAAeV,EAAUtG,GACvC,IAATA,IACAgH,EAAc7U,UAAUiE,OAAS,IAAIF,IACrC8Q,EAAc7U,UAAUmE,gBAAkB,IAAIJ,KAElD,MAAME,EAAS4Q,EAAc7U,UAAUiE,OACjCE,EAAkB0Q,EAAc7U,UAAUmE,gBAChD,IAAK,MAAMkD,KAAkB8M,EAAU,CACnC,MAAM2E,GAAUhF,OAAOzM,EAAeoN,aAAa,UAC9C8C,MAAMuB,IACP3U,EAAgB1F,IAAIqa,GAExB,MAAMC,EAAoBjF,OAAOzM,EAAeoN,aAAa,oBAAoBtW,MAAM,KAAK0D,KAAIhC,IAAMA,IAAGyF,QAAOzF,IAAM0X,MAAM1X,IAAM,GAAKA,GAAKA,GAAK,IACjJ,GAAgC,GAA5BkZ,EAAkBxa,OAItB,IAAK,MAAO8B,EAAG2Y,KAAMD,EAAkBvU,UAAW,CAC9C,CACI,MAAMyU,EAAU5R,EAAeiR,SAAS,EAAQ,EAAJjY,GAAOiY,SAASU,GAC5D,IAAIpa,EACJ,IAAKqa,KAAara,GAAMkV,OAAOmF,EAAQxE,aAAa,WAAY,CAC5DrR,QAAQC,KAAK,yCAA0C4V,EAAS,6JAChE,QACH,CACDhV,EAAOxF,IAAIG,EACd,CACD,CACI,MAAMqa,EAAU5R,EAAeiR,SAAa,EAAJjY,GACxC,IAAIzB,EACJ,KAAMA,GAAMkV,OAAOmF,EAAQxE,aAAa,WAAY,CAChDrR,QAAQC,KAAK,+CAAgD4V,EAAS,2HACtE,QACH,CACDhV,EAAOxF,IAAIG,EACd,CACJ,MAtBGwE,QAAQC,KAAK,kDAAmDgE,EAAgB,oOAuBvF,CACL,CAuCO,SAAS6R,EAAoBlZ,GAChC,IAAK,MAAMmZ,KAAoBnZ,EAAU6H,iBACrCiQ,EAAaqB,EAAiBxQ,QAAS3I,EAAU4H,MAAMe,SAAS,EAExE,CACA,SAASmP,EAAasB,EAAaC,EAAYC,GAAU,GACrD,IAAK,MAAOC,EAAGpZ,KAAMyD,OAAOY,QAAQ6U,GAAa,CAC7C,IAAIG,EAAIJ,EAAYG,QACVrP,IAANsP,EACIF,EACAE,EAAEC,OAAO,EAAG,KAAMtZ,GAElBqZ,EAAE5Q,QAAQzI,GAGdiZ,EAAYG,GAAKpZ,EAAEO,OAC1B,CACL,CACA,SAASgX,EAAgBrO,EAAK5B,GAC1B,QAAS4B,EAAIwE,MAAQxE,EAAIwE,OAASpG,EAAQqG,aAAezE,EAAIuE,kBAAoBnG,EAAQzH,UAAUiE,OAAOyB,IAAI2D,EAAIuE,sBAAwBvE,EAAIqQ,kBAAoBjS,EAAQzH,UAAUiE,OAAOyB,IAAI2D,EAAIqQ,kBACvM,CChYO,SAASC,EAAmBC,EAAW7G,EAAM8G,GAAQ,GACxD,IAAKA,GAASD,EAAUE,kBAAoB,EACxC,OACJ,MAAMC,EAAWjc,EAAO,IAAKgB,EAAOiU,EAAKhG,UAAM7C,EAAW6I,EAAKzD,OAG/D,GAFAyK,EAASC,KAAO,sDAAwDla,EAAmBN,EAAauT,EAAKzD,MAAO,EAAG,CAAErP,IAAK,SAC9H8Z,EAAS3J,OAAS,SACdwJ,EAAUpb,UAAUyb,SAAS,oBAAsBL,EAAUpb,UAAUyb,SAAS,YAAa,CAC7F,MAAMtG,GAAaG,OAAO8F,EAAUnF,aAAa,WAAa,EACxDhN,EAAU6M,IAAUR,OAAO8F,EAAUnF,aAAa,gBAAkB,GAC1EsF,EAASrb,OAAOoB,EAAmBN,EAAauT,EAAKzD,MAAOqE,EAAWlM,EAAQzH,WAClF,CACD4Z,EAAUM,gBAAgBH,EAC9B,CACO,SAASI,EAAaP,EAAWnT,GACpC,MAAM2T,GAActG,OAAO8F,EAAUnF,aAAa,gBAAkB,EAC9DhN,EAAU4S,GAAmC/F,GAAS8F,GAAaR,GACzE,IAAIC,GAAQ,EACZ,GAAID,EAAUpb,UAAUyb,SAAS,kBAAmB,CAChD,MAAMK,EAAmBC,GAAoB9T,EAAOgB,GAChD6S,IACAV,EAAU/F,aAAa,WAAYC,OAAOrN,EAAM7H,KAChDgb,EAAU/F,aAAa,QAASC,OAAOwG,EAAiB1b,KACxD6H,EAAQ6T,EACRT,GAAQ,EAEf,CACDF,EAAmBC,EAAWnT,EAAOoT,EACzC,CACO,SAASW,EAAYZ,EAAW5E,GACnC,GAAI4E,EAAUE,kBAAoB,EAC9B,OACJ,MAAMnG,GAAaG,OAAO8F,EAAUnF,aAAa,WAAa,EACxDhN,EAAU6M,IAAUR,OAAO8F,EAAUnF,aAAa,gBAAkB,GACpEsF,EAAWjc,EAAO,IAAKgB,EAAOkW,EAAKjI,UAAM7C,EAAW8K,EAAK1F,OAC/DyK,EAASC,KAAO,sDAAwDxa,EAAawV,EAAK1F,MAAM3P,WAAW,WAAY,IACvHoa,EAAS3J,OAAS,SACdwJ,EAAUpb,UAAUyb,SAAS,mBAC7BF,EAASrb,OAAOiZ,GAAe3C,EAAMvN,OAASyC,OAAWA,EAAWyJ,IACxEiG,EAAUlb,OAAOqb,EACrB,CACO,SAASU,EAAsBb,EAAW7b,GAC7C,GAAI6b,EAAUpb,UAAUyb,SAAS,kBAC7BN,EAAmBC,EAAW7b,OAE7B,CACD6b,EAAUc,MAAMC,gBAAkB,OAAOhc,EAAeZ,EAAK6c,eAC7DhB,EAAUiB,QAAQC,MAAQ/c,EAAKuR,KAC/B,MAAMyJ,EAAoBjF,OAAO8F,EAAUnF,aAAa,oBAAoBtW,MAAM,KAAK0D,KAAIhC,IAAMA,IAAGyF,QAAOzF,IAAM0X,MAAM1X,IAAM,GAAKA,GAAKA,GAAK,IAC5I,GAAgC,GAA5BkZ,EAAkBxa,OAElB,YADA6E,QAAQC,KAAK,mDAAoDuW,EAAW,+KAGhF,IAAK,MAAOvZ,EAAG2Y,KAAMD,EAAkBvU,UAAW,CAC9C,MAAMuW,EAASnB,EAAUtB,SAAS,EAAQ,EAAJjY,GACtC,GAAK0a,EAIL,IAAK,MAAOlb,EAAGoZ,KAAYlU,MAAMmT,UAAU1T,QAAQ4T,KAAK2C,EAAOzC,UAC3DW,EAAQza,UAAUwc,OAAO,mBAAoBnb,IAAMmZ,QAJnD5V,QAAQC,KAAK,0EAA2EhD,EAAG,8BAA+BuZ,EAAW,wHAM5I,CACJ,CACL,CACO,SAASqB,EAAiBrB,EAAWzR,GACxC,MACMtH,EAAQoL,EADEqI,IAAUR,OAAO8F,EAAUnF,aAAa,gBAAkB,GAClCzU,UAAWmI,GAC7C+S,EAAK,CACPjR,MAAO,CAAC,MAAO,IACfI,UAAW,CAAC,OAAQ,IACpBC,SAAU,CAAC,OAAQ,IACnBC,UAAW,CAAC,OAAQ,IACpBC,SAAU,CAAC,OAAQ,IACnBC,gBAAiB,CAAC,OAAQ,IAC1BC,UAAW,CAAC,OAAQ,IACpBC,cAAe,CAAC,OAAQ,IACxBC,aAAc,CAAC,OAAQ,IACvBC,gBAAiB,CAAC,OAAQ,IAC1BC,OAAQ,CAAC,OAAQ,IACjBC,MAAO,CAAC,OAAQ,IAChBC,kBAAmB,CAAC,OAAQ,KAC5BC,aAAc,CAAC,OAAQ,KACvBC,WAAY,CAAC,OAAQ,KACrBC,WAAY,CAAC,OAAQ,KACrBgQ,UAAW,CAAC,OAAQ,MACtBhT,GACF,IAAIjJ,EAAKmJ,EAAS,GACd6S,GACChc,EAAKmJ,GAAU6S,EAEhB9X,QAAQC,KAAK,gDAAgD8E,gBAAyByR,GAE1F,MAAMnR,EAAaJ,EAAS,IAAM,EAClC,IAAI+S,EAAS5Z,EAAqB2G,GACjB,cAAbA,IACAiT,EAAS,mCAEb,MAAMrB,EAAWjc,EAAO,IAAKgB,EAAOI,IACpC6a,EAASC,KAAO,sDAAsDoB,IACtErB,EAAS3J,OAAS,SACdwJ,EAAUpb,UAAUyb,SAAS,yBACf/P,IAAVrJ,EACAkZ,EAASrb,OAAO0B,EAAgBS,EAAQ4H,EAAY,GAAKJ,GAGzD0R,EAASrb,OAAO,MAAQ2J,IAGhCuR,EAAUM,gBAAgBH,EAC9B,CACO,SAASsB,EAAkBzB,EAAWrO,GACzC,GAAIqO,EAAUE,kBAAoB,EAC9B,OACJ,MAAMC,EAAWjc,EAAO,IAAKgB,EAAOyM,EAAW+P,cAAUpR,EAAWqB,EAAW+D,OAC/EyK,EAASC,KAAO,sDAAwDzO,EAAW+D,KACnFyK,EAAS3J,OAAS,SACdwJ,EAAUpb,UAAUyb,SAAS,mBAC7BF,EAASrb,OAAO6M,EAAW+D,MAC/BsK,EAAUlb,OAAOqb,EACrB,CACO,SAASwB,EAAqC3B,EAAW4B,GAC5D,MAAMlM,EAAOwE,OAAO8F,EAAUnF,aAAa,UAC3C,IAAI7V,EAAK,CACL6c,WAAY,MACZC,UAAW,MACXC,UAAW,KACXC,WAAY,KACZC,WAAY,MACZC,cAAe,KACfC,cAAe,KACfC,MAAO,IACPC,SAAU,MACVC,KAAM,IACNC,MAAO,IACPC,WAAY,IACZC,UAAW,KACXC,aAAc,IACdC,WAAY,MACZC,WAAY,IACZC,UAAW,KACXC,UAAW,IACXC,MAAO,IACPC,SAAU,IACVC,QAAS,IACTC,QAAS,IACTC,MAAO,IACPC,QAAS,IACTC,UAAW,IACXC,SAAU,IACVC,KAAM,IACNC,WAAY,IACZC,OAAQ,IACRC,KAAM,MACNC,MAAO,MACPC,QAAS,MACTC,cAAe,IACfC,SAAU,IACVC,KAAM,IACNC,KAAM,IACNC,MAAO,MACPC,gBAAiB,MACjBC,SAAU,IACVC,QAAS,MACTC,WAAY,KACZC,YAAa,MACbC,OAAQ,MACRC,mBAAoB,MACpBC,iBAAkB,MAClBC,wBAAyB,MACzBC,YAAa,MACbC,YAAa,MACbC,iBAAkB,MAClBC,YAAa,MACbC,kBAAmB,MACnBC,WAAY,MACZC,YAAa,MACbC,sBAAuB,MACvBC,iBAAkB,MAClBC,oBAAqB,MACrBC,gBAAiB,MACjBC,QAAS,MACTC,sBAAuB,MACvBC,QAAS,MACTC,mBAAoB,KACpBC,OAAQ,MACRC,aAAc,MACdC,SAAU,MACVC,sBAAuB,MACvBC,KAAM,MACNC,eAAgB,MAChBC,kBAAmB,MACnBC,cAAe,MACfC,kBAAmB,MACnBC,iBAAkB,KAClBC,gBAAiB,MACjBC,kBAAmB,MACnBC,qBAAsB,MACtBC,eAAgB,MAChBC,cAAe,MACfC,kBAAmB,MACnBC,kBAAmB,MACnBC,sBAAuB,MACvBC,iBAAkB,MAClBC,gBAAiB,MACjBC,iBAAkB,MAClBC,cAAe,OACjBrR,GACF,IAAK1Q,EAAI,CACL,MAAMgiB,EAAY,CACdC,QAAS,CACLjiB,GAAIuL,OAAOC,iBAAmB,EAC9BkF,KAAM,UACNvC,KAAM+T,GAAMC,QACZxS,YAAa,6YACbb,kBAAmB,sEACnBqG,WAAY,GAAI1P,SAAU,GAAI+E,MAAO,IAEzC4X,UAAW,CACPpiB,GAAIuL,OAAOC,iBAAmB,EAC9BkF,KAAM,aACNf,YAAa,wCACbxB,KAAM+T,GAAMG,WACZlN,WAAY,GAAI1P,SAAU,GAAI+E,MAAO,IAEzC8X,UAAW,CACPtiB,GAAIuL,OAAOC,iBAAmB,EAC9BkF,KAAM,YACNf,YAAa,qFACbxB,KAAM+T,GAAMK,UACZpN,WAAY,GAAI1P,SAAU,GAAI+E,MAAO,IAEzCgY,KAAM,CACFxiB,GAAIuL,OAAOC,iBAAmB,EAC9BkF,KAAM,OACNf,YAAa,8GACbxB,KAAM+T,GAAMO,KACZtN,WAAY,GAAI1P,SAAU,GAAI+E,MAAO,IAEzCkY,UAAW,CACP1iB,GAAIuL,OAAOC,iBAAmB,EAC9BkF,KAAM,YACNf,YAAa,uGACbxB,KAAM+T,GAAMS,UACZxN,WAAY,GAAI1P,SAAU,GAAI+E,MAAO,IAEzCoY,OAAQ,CACJ5iB,GAAIuL,OAAOC,iBAAmB,EAC9BkF,KAAM,SACNf,YAAa,qIACbxB,KAAM+T,GAAMW,OACZ1N,WAAY,GAAI1P,SAAU,GAAI+E,MAAO,IAEzCsY,MAAO,CACH9iB,GAAIuL,OAAOC,iBAAmB,EAC9BkF,KAAM,QACNf,YAAa,qIACbxB,KAAM+T,GAAMa,MACZ5N,WAAY,GAAI1P,SAAU,GAAI+E,MAAO,IAEzCwY,KAAM,CACFhjB,GAAIuL,OAAOC,iBAAmB,EAC9BkF,KAAM,OACNf,YAAa,kDACbxB,KAAM+T,GAAMe,KACZ9N,WAAY,GAAI1P,SAAU,GAAI+E,MAAO,KAE3CkG,GACEsR,IACAhiB,EAAKgiB,EAAUhiB,GACf0E,EAASuB,QAAQf,OAAO6B,IAAI/G,EAAIgiB,GAEvC,CACD,OAAIhiB,GACAgb,EAAU/F,aAAa,OAAQ,SAC/B+F,EAAU/F,aAAa,QAASC,OAAOlV,IAChCA,IAGPgb,EAAUkI,UAAYxS,EACtBsK,EAAUmI,MAAQ,+BAA+BzS,MACjDsK,EAAUc,MAAMsH,OAAS,OACzBpI,EAAUpb,UAAUC,IAAI,SACxB+c,EAAY/c,IAAI6Q,GACT,EAEf,CC7RA,IAAI2S,EACAC,EAEAC,EACAC,EAFAC,GAAW,EAGF,MAAA/N,GAAW,GACbxT,EAAAA,OAAS,KACpB,MAAMwhB,GAAc,CAAC,WAAY,UAAW,WAAY,SAAU,QAAS,eAAgB,SAAU,cAAe,YACpH,SAASC,GAAmBC,GACxB,MAAMC,EAAWR,EAAQ3J,SACzB,IAAK,IAAIoK,EAAQ,EAAGA,EAAQD,EAASlkB,OAAQmkB,IACzCD,EAASC,GAAOlkB,UAAUwc,OAAO,SAAU0H,IAAUF,EAE7D,CACA,SAASG,GAAyBH,EAAcI,GAAU,GACtD,MAAMH,EAAWR,EAAQ3J,SAASkK,GAClCP,EAAQvH,MAAMmI,WAAaD,EAAU,kBAAoB,GACzDX,EAAQvH,MAAMoI,UAAY,iBAAiBL,EAASM,UAAYN,EAASO,iBAC7E,CACA,SAASC,GAAgBL,GAAU,GAC/B,MAAMM,EAAa7kB,SAAS8kB,eAAe,cACrCC,EAAeF,EAAaA,EAAWF,aAAe,EAKtDK,EAAoBpB,EAAQ3J,SAAS+J,IAC3C,IAAIiB,EAAcnB,EAHF,EAIZmB,EAAcrB,EAAQsB,YAAcllB,SAASmlB,gBAAgBC,YANjD,KAOZH,EAAcjlB,SAASmlB,gBAAgBC,aAAexB,EAAQsB,YAPlD,KAShB,IAAIG,EAActB,EANF,EAOZsB,EAAcL,EAAkBL,aAAe3kB,SAASmlB,gBAAgBG,UAAYP,EATxE,KAURR,IACAX,EAAQvH,MAAMmI,YAAc,cAC5Be,YAAW,IAAM3B,EAAQvH,MAAMmI,WAAa,IAAI,MAEpDa,EAAcrlB,SAASmlB,gBAAgBG,UAAYP,EAdvC,GAcgEC,EAAkBL,cAElGf,EAAQvH,MAAMmJ,KAAO,GAAGP,MACxBrB,EAAQvH,MAAMoJ,IAAM,GAAGJ,KAC3B,CACOK,eAAeC,GAAa9P,EAAO+P,GACtC,MAAMC,EAAe,CACjBpgB,OAAQ,IAAIiG,IACZ9F,OAAQ,IAAI8F,IACZ/F,MAAO,IAAI+F,IACX5F,gBAAiB,IAAI4F,IACrB7F,KAAM,IAAI6F,IACV,cAAe,IAAIA,IACnBgN,WAAY,IAAIhN,IAChBzF,YAAa,IAAIyF,KAEfoa,EAAa,IAAIpgB,IACjBqgB,EAA2B,IAAIrgB,IACrC,IAAK,MAAM6V,KAAa1F,EAAME,qBAAqB,aAAc,CAC7D,MAAMxM,GAASkM,OAAO8F,EAAUnF,aAAa,UACxC8C,MAAM3P,IACPuc,EAAW1lB,IAAImJ,GACnB,IAAIyc,EAAWzK,EAAUnF,aAAa,SACtC,GAAgB,MAAZ4P,EACA,SACJ,IAAI5iB,GAAQmY,EAAUnF,aAAa,SAAW,SAAW,IACzD,GAAa,eAAThT,GACA,GAAgB,MAAZ4iB,EAAkB,CAClB,MAAMC,EAAqBJ,EAAanN,WAAW9I,IAAIoW,GACnDC,EACAA,EAAmB1b,KAAKgR,GAExBsK,EAAanN,WAAWpR,IAAI0e,EAAU,CAACzK,GAC9C,MAEA,CACD,IAAI2K,GAASF,EACb,GAAa,YAAT5iB,EAAoB,CACpB,IAAIX,EAAAA,OAAOqU,oBAKP,SAJA1T,EAAO,SACP8iB,EAAQhJ,EAAqC3B,EAAWwK,EAK/D,CACD,MAAM7M,MAAMgN,IAAU9iB,KAAQyiB,IAA0B,eAARziB,IAA0B8iB,EAAQF,EAAS,GAAGG,cAAgBH,EAAS3jB,MAAM,IAAK4hB,GAAYnf,SAASohB,KAoBnJ,SApB4J,CAC5J,MAAM1iB,EAAMqiB,EAAaziB,GACnB6iB,EAAqBziB,EAAIoM,IAAIsW,GAC/BD,EACAA,EAAmB1b,KAAKgR,GAExB/X,EAAI8D,IAAI4e,EAAO,CAAC3K,IACpB,MAAM6K,EAAe7K,EAAUnF,aAAa,eAC5C,GAAIgQ,EACA,IAAK,MAAMC,KAAYD,EAAatmB,MAAM,KAAM,CAC5C,MAAMwmB,GAAWD,EACjB,IAAKC,EACD,SACuBT,EAAajgB,OAAOgK,IAAI0W,IAE/CT,EAAajgB,OAAO0B,IAAIgf,EAAS,GACxC,CAER,CAIJ,CACDC,GAAqBhL,EACxB,CAuCD,OAtCIwK,EAAyB3f,MACzBrB,QAAQyC,MAAM,oFAAqFd,MAAMC,KAAKof,IAE9GD,EAAW1f,KAAO,GAClBnB,EAASC,gBAAgB,YAAa4gB,EAAWlf,SAAUnE,EAAAA,OAAO+jB,4BAChEC,QAAQC,IAAInhB,OAAOY,QAAQ0f,GAC5B5e,QAAO,EAAE0f,EAAKplB,KAAc,cAAPolB,IACrBnjB,KAAIkiB,OAAQiB,EAAK/f,MAClB,GAAmB,GAAfA,EAAOR,KACP,OACJ,IAAIwgB,EACJ,OAAQD,GACJ,IAAK,SACDC,EAAW9K,EACX,MACJ,IAAK,QACD8K,EAAWzK,EACX,MACJ,IAAK,kBACDyK,EAAWxK,EACX,MACJ,IAAK,cACDwK,EAAW5J,EACX,MACJ,QACI4J,EAAWtL,EAGnB,MAAMuL,EAAQ5hB,EAASuB,QAAQmgB,SACzB1hB,EAASC,gBAAgByhB,EAAK/f,EAAOsQ,OAAQzU,EAAAA,OAAO+jB,sBAC1D,IAAK,MAAOjmB,EAAIumB,KAAYlgB,EAAQ,CAChC,MAAM8N,EAAOmS,EAAMjX,IAAIrP,GACvB,GAAKumB,GAAYpS,EAEjB,IAAK,MAAM6G,KAAauL,EACpBF,EAASrL,EAAW7G,EAC3B,MAEEmR,CACX,CACO,SAASU,GAAqBxU,GACjCA,EAAOgV,iBAAiB,cAAe5Q,GAAM6Q,GAAe7Q,EAAEpE,UAC9DA,EAAOgV,iBAAiB,cAAc,KAClCnD,EAAQvH,MAAM4K,QAAU,OACxBrD,EAAQvH,MAAMoI,UAAY,EAAE,GAEpC,CACA,SAASuC,GAAezL,EAAW2L,EAAe,GAC9C,MAAM9jB,GAASmY,EAAUnF,aAAa,SAAW,SAAW,IACtD4P,EAAWzK,EAAUnF,aAAa,SACxC,IAAIhN,EAAU6M,IAAUR,OAAO8F,EAAUnF,aAAa,gBAAkB,GACxE,MAAM+Q,GAAa1R,OAAO8F,EAAUnF,aAAa,gBAAavK,EACxDyJ,GAAaG,OAAO8F,EAAUnF,aAAa,gBAAavK,EAC9D,GAAY,mBAARzI,GAAqC,WAARA,GAA6B,eAARA,EAClD,OAEJ,GADAygB,EAAoBtI,EACR,cAARnY,EAAsB,CACtB,GAAI4iB,EAAU,CACVhC,GAAWkD,EACXtD,EAAQ/H,gBA2sBpB,SAAkC/R,EAAWV,GACzC,MAAMge,EAAche,EAAQzH,UAAU6H,iBAAiBJ,EAAQzH,UAAU8H,mBACnEjH,EAAQ4kB,EAAYxgB,OAAOkD,GACjC,IAAIO,EAAQ+c,EAAY3b,UAAU3B,GAClC,GAAI,CAAC,oBAAqB,gBAAgBhF,SAASgF,GAAY,CAC3DO,EAAQA,EAAMhI,QACd,MAAMglB,EAA2B,sBAAdvd,EAAoC,YAAc,OAC/Dwd,EAA2E,KAAjEnd,EAAwBL,EAAWV,EAAQzH,WAAW0J,IAAM,GACtEkc,EAAmB1Z,EAAoBzE,EAAQzH,WACrD,IAAK,MAAO6lB,EAAUld,KAAY/E,OAAOY,QAAQihB,EAAY9c,SAAU,CACnE,GAAI4O,OAAOsO,GACP,SACJ,MAAMC,EAASxiB,EAASuB,QAAQf,OAAOmK,KAAK4X,GAC5C,IAAKC,EAAQ,CACT1iB,QAAQyC,MAAM,2CAA2CggB,0BACzD,QACH,CACD,GAAIC,EAAOhX,YAAc4W,EACrB,SACJ,IAAIK,EAAsB,IAARllB,EACdmlB,EAAgB,GACpB,IAAK,MAAM/c,OAAEA,EAAME,SAAEA,EAAQpJ,MAAEA,KAAW4I,EAAS,CAC/C,MAAMU,EAAMC,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAOqc,GACjEI,EAAcpd,KAAK9K,EAAO,cAAe,GAAGuL,EAAM,EAAI,IAAM,KAAKnJ,EAAGmJ,YAActJ,EAAQ,EAAI,GAAGA,KAAW,KAAMZ,EAASW,EAAmBmJ,EAAQlJ,EAAO0H,EAAQzH,cACrK+lB,GAAe1c,CAClB,CACD,MAAMgG,EAAc0W,EACpBA,EAAc9kB,KAAKG,IAAI2kB,EAAaJ,GAChCtW,GAAe0W,GACfC,EAAcpd,KAAK9K,EAAO,qBAAsB,eAAeoC,EAAG6lB,gCAA0C7lB,EAAGmP,SAEnH3G,EAAME,KAAK9K,EAAO,WAAYgB,EAAOgnB,EAAO/Y,MAAOjP,EAAO,MAAOA,EAAO,OAAQ,GAAGgoB,EAAOxW,UAAUpP,EAAG6lB,UAAqBC,IAC/H,CACJ,CACD,OAAOloB,EAAO,6BAA8B4K,EAChD,CA9uBoCud,CAAyB5B,EAAU5c,IAC3Dwa,EAAQvH,MAAM4K,QAAU,GACxB,IAAK,MAAMY,KAAMjE,EAAQ3J,SACrB4N,EAAG1nB,UAAUC,IAAI,UACrBkkB,GAAyBN,GAC5B,CACD,MACH,CACD,MAAMtP,EAAOzP,EAASuB,QAAQpD,GAAMwM,KAAK6F,OAAOuQ,IAChD,GAAItR,EAAM,CACNtL,EAAU4S,GAAmC5S,EAASmS,GAClD,aAAc7G,IACVtL,EAAQ0e,YACHpT,EAAK3J,MAAMjG,SAAS,qBAAuB4P,EAAK3J,MAAMjG,SAAS,gBAC3DsE,EAAQ2e,SACT3e,EAAU7D,OAAOC,OAAO,CAAE,EAAE4D,IAChCA,EAAQ0e,YAAa,GAGnB1e,EAAQ0e,aACTpT,EAAK3J,MAAMjG,SAAS,eAAiB4P,EAAK3J,MAAMjG,SAAS,sBACrDsE,EAAQ2e,SACT3e,EAAU7D,OAAOC,OAAO,CAAE,EAAE4D,IAChCA,EAAQ0e,YAAa,IAIjC,MAAOE,EAAeC,GAiN9B,SAA6BC,EAAkB3M,EAAWnS,EAAS+d,EAAW7R,GAC1E,IAAIhE,EACJ,IAAI6W,EAAoB,EACuB,UAA3C1S,OAAO8F,EAAUnF,aAAa,SAC9B+R,EAAoB,EACW,UAA1BD,EAAiB9kB,OACtB+kB,EAAoB,GACxB,IAAIF,EAAqB,EACzB,MAAMG,EAAe,GACfC,EAAwB9M,EAAUpb,UAAUyb,SAAS,kBAC3D,IAAIvS,GAAaoM,OAAO8F,EAAUnF,aAAa,cAC3C8C,MAAM7P,KACNA,OAAYwC,GAChB,IAAI9D,EAASC,EAAOsgB,EACpB,GAAI,aAAcJ,EAAkB,CAChC,GAAIG,EAAuB,CACvB,MAAMpM,EAAmBC,GAAoBgM,EAAkB9e,GAC3D6S,IACAiM,EAAmBjM,EAC1B,CACD,IAAIza,EAEJ,IADCuG,EAASC,EAAOxG,EAAG4H,GAAWmf,GAAqBL,EAAkB9e,GAClEpB,EAAO,CACPsgB,EAAOE,GAAezgB,EAASC,EAAMsgB,MACrC,IAAIpgB,EAAYF,EAAMG,WAAW3G,GACjC,MAAMinB,EAAgBL,EAAaloB,OACnC,KAAOgI,EAAUwgB,4BAA4B,CACzC,MAAMC,EAAiB3gB,EAAMG,WAAWD,EAAUwgB,4BAClD,IAAKE,GAAcD,EAAgBvf,GAC/B,MACJ,IAAIhB,EAAQnD,EAASuB,QAAQf,OAAOmK,IAAI+Y,EAAevgB,OAClDA,IACDrD,QAAQC,KAAK,+BAA+B2jB,EAAevgB,4DAA6DmT,GACxHnT,EAAQuN,GAEZyS,EAAahN,OAAOqN,EAAe,EAAGI,GAAgBzgB,EAAOkgB,EAAM,EAAGlf,EAASC,IAC/EnB,EAAYygB,CACf,CACJ,CACDP,EAAa7d,KAAKse,GAAgBX,EAAkBI,EAAM,EAAGlf,EAASC,IACtE,IAAK,IAAIyf,EAAI,EAAGA,EAAItnB,EAAGsnB,IAAK,CACxB,MAAMH,EAAiB3gB,EAAMG,WAAW2gB,GACxC,GAAIH,EAAeD,4BAA8BlnB,EAC7C,SACJ,IAAKonB,GAAcD,EAAgBvf,GAC/B,SACJ,IAAIhB,EAAQnD,EAASuB,QAAQf,OAAOmK,IAAI+Y,EAAevgB,OAClDA,IACDrD,QAAQC,KAAK,+BAA+B2jB,EAAevgB,4DAA6DmT,GACxHnT,EAAQuN,GAEZyS,EAAa7d,KAAKse,GAAgBzgB,EAAOkgB,EAAM,EAAGlf,EAASC,IAC3D7H,EAAIsnB,EACJA,GAAK,CACR,CACJ,MAEG,GAAI,SAAUZ,EACVE,EAAa7d,KA2MzB,SAA6BoM,EAAMvN,EAAS2I,EAAQoV,EAAW7R,EAAY,GACvE,IAAIhE,EACJ,IACIyX,EADAC,GAAgC,QAArB5f,EAAQqG,UAAqC,YAAdkH,EAAKvT,MAAuC,WAAjBuT,EAAKC,UAA0B6B,GAAwB9B,EAAMwQ,GAElI,UAAWxQ,IACXoS,EAAyD,QAAzCzX,EAAKS,EAAOqE,aAAa,kBAA+B,IAAP9E,OAAgB,EAASA,EAAGxR,MAAM,KAAK0D,KAAIjD,GAAM0E,EAASuB,QAAQb,MAAMiK,KAAK6F,OAAOlV,IAAO,KAAI0G,QAAOzF,GAAKA,GAAK,YAAaA,KAElM,MAAMynB,EAAc3T,EAAY,EAAIA,EAAY,IAAM,GAChD4T,GAAqBH,aAAmD,EAASA,EAAaI,MAAK3nB,IAAM,CAAC,WAAY,cAAcsD,SAAStD,EAAEoV,cAAemS,aAAmD,EAASA,EAAa,IACvO9X,EAAOgY,EAAc3P,GAAe3C,EAAMvN,EAAS4f,EAASE,EAAmB5T,GAC/EjL,EAAQ,CAAC5K,EAAO,YAAagB,EAAOkW,EAAKjI,MAAOjP,EAAO,wBAA0BkX,EAAKyS,OAAQnY,GAAOxR,EAAO,sBAClH,GAAI,YAAakX,GAAQA,EAAKmC,QAAS,CACnC,MAAMA,EAAkC,iBAAhBnC,EAAKmC,QACvBnC,EAAKmC,QACL/K,EAAYnL,KAAKG,IAAI,IAAM4T,EAAKmC,QAAQ,GAAK1P,EAAQzH,UAAUuJ,QAAWyL,EAAKmC,QAAQ,GAC7FzO,EAAME,KAAK9K,EAAO,KAAMA,EAAO,MAAO,YAAaA,EAAO,4BAA6BgW,OAAO7S,KAAKmW,KAAKD,OAC3G,CACD,GAAI,UAAWnC,EAAM,CACjB,IAAIxD,EACJ,GAAI,QAASwD,EAAKxD,MAAO,CACrB,IAAIkW,EAAYC,GAAOC,UACnB,CAAC,yBAA0B,cAAczkB,SAAS6R,EAAKxD,MAAM0F,WACzDzP,EAAQzH,UAAUuJ,MAAQ,GAC1Bme,EAAYC,GAAOE,OACdpgB,EAAQzH,UAAUuJ,MAAQ,GAC/Bme,EAAYC,GAAOG,SACdrgB,EAAQzH,UAAUuJ,MAAQ,GAC/Bme,EAAYC,GAAOI,KACdtgB,EAAQzH,UAAUuJ,MAAQ,KAC/Bme,EAAYC,GAAOK,SAE3B,MAAMP,EAASxmB,KAAKG,IAAIumB,GAAO3S,EAAKyS,QAASC,GAC7C,IAAIhF,EAAQuF,GAAWR,GAClBzS,EAAKxD,MAAM0F,QAGZwL,GAASjb,EAAQzH,UAAUuJ,MAF3BmZ,GAAS1N,EAAKzL,MAIlB,MAAM2e,GAAOzgB,EAAQzH,UAAUmoB,SAAW9b,EAAmBC,GAAmBrL,KAAKG,IAAI,IAAKshB,IAAU1N,EAAKxD,MAAM4W,IAAMC,GAAeZ,GAClIa,EAASJ,EAAMlT,EAAKxD,MAAM8W,OAChC9W,EAAQ,CAACvQ,KAAKmW,KAAK8Q,EAAMI,GAASrnB,KAAKmW,KAAK8Q,EAAMI,GACrD,MAEG9W,EAAQwD,EAAKxD,MAEjB,MAAM+W,EAAOzqB,EAAO,MAAO,oBAAqBA,EAAO,4BAA6B,GAAG0T,EAAM,QAAQA,EAAM,OACvGwD,EAAKwT,aACLD,EAAK7pB,OAAO,KAAKsW,EAAKwT,gBAC1B9f,EAAME,KAAK9K,EAAO,KAAMyqB,GAC3B,CACG,UAAWvT,GACXtM,EAAME,KAAK6f,GAAyBzT,EAAMvN,IAE1C4f,GAAW,mBAAoBrS,GAC/BtM,EAAME,QAAQye,EAAQtQ,WAAWlV,KAAI,EAAGsG,YAAW6O,aAAYE,aAEpDpZ,EAAO,KAAMA,EAAO,2BAA4B,IADjCmD,KAAKI,MAAM2V,EAAahC,EAAKiC,eAAiBC,MACQ1V,EAAqB2G,UAGrG,UAAW6M,GACXtM,EAAME,KAAK9K,EAAO,qBAAsBkX,EAAK0T,MAAM7mB,KAAIqH,IACnD,IAAIyf,GAAkB,EACtB,GAAIvB,EACA,OAAQle,GACJ,IAAK,UACDyf,EAAiBvB,EAAawB,WAAU/oB,GAAK,CAAC,OAAQ,QAAS,OAAOsD,SAAStD,EAAEoV,WACjF,MACJ,IAAK,WACD0T,EAAiBvB,EAAawB,WAAU/oB,GAAkB,YAAbA,EAAEoV,UAC/C,MACJ,IAAK,aACD0T,EAAiBvB,EAAawB,WAAU/oB,GAAkB,cAAbA,EAAEoV,UAI3D,GAAI0T,GAAkB,EAAG,CACrB,MAAME,EAAczB,EAAa3N,OAAOkP,EAAgB,GAAG,GACrDtiB,EAAQoiB,GAAyBI,EAAaphB,GAC9C6H,EAAOqI,GAAekR,EAAaphB,GAEzC,OADApB,EAAMiT,QAAQxb,EAAO,MAAOgB,EAAO+pB,EAAY9b,KAAM,aAAcjP,EAAO,wBAA0B+qB,EAAYpB,OAAQnY,GAAOxR,EAAO,sBAC/HuI,CACV,CAEG,OAAOvI,EAAO,KAAMgB,EAAOgiB,GAAM,QAAU5X,GAAI,aAAc,SAASA,SACzE,MAGT,IAAI4f,GAA0B,EAC1B,iBAAkB9T,IAClBtM,EAAME,KAAK9K,EAAO,OAAQqB,EAASK,EAAawV,EAAKzG,gBACrD7F,EAAME,KAAK9K,EAAO,YAAa6O,EAAaqI,EAAK1N,cAAe,EAAGG,GAAS,GAAMyL,UAClF4V,GAA0B,GAE9B,GAAI,qBAAsB9T,EAAM,CAC5B,IAAI+T,EAAazlB,EAASuB,QAAQf,OAAOmK,IAAI+G,EAAKzN,kBAC7CwhB,IACD3lB,QAAQC,KAAK,qCAAqC2R,EAAKzN,uEAAwEyN,EAAM5E,GACrI2Y,EAAa/U,GAEjB,MAAMgV,EAAcC,GAA0BF,EAAYthB,GACpDyhB,EAAiB,GACvBC,GAAwBD,EAAgBH,EAAYthB,GACpDyhB,EAAetgB,KAAK9K,EAAO,qBAC3BsrB,GAA6BF,EAAgBH,EAAYC,EAAavhB,GACtE,MAAM4hB,EAAa,CAACvrB,EAAO,eAAgBorB,IAC3CI,GAAUD,EAAYN,EAAYC,EAAavhB,GAC/CiB,EAAME,KAAK9K,EAAO,OAAQqB,EAASK,EAAawV,EAAKzG,gBACrD7F,EAAME,KAAK9K,EAAO,eAAgBurB,IAClCP,GAA0B,CAC7B,CACD,MAAMS,EAAWzrB,EAAO,cACP,SAAbkX,EAAKvT,MAAgC,UAAbuT,EAAKvT,MAAkC,WAAbuT,EAAKvT,OAAsBuT,EAAK5L,MAAMjG,SAAS,UACjGomB,EAAS7qB,OAAOZ,EAAO,yBAA2BkX,EAAKyS,OAAQzS,EAAKyS,SAChE,WAAYzS,GACZuU,EAAS7qB,OAAOZ,EAAO,OAAQkX,EAAKwU,SACxCD,EAAS7qB,OAAOZ,EAAO,OAAQ,GAAGkX,EAAKvT,SAASuT,EAAKC,YACpC,UAAbD,EAAKvT,MAiMjB,SAAqBA,GACjB,OAAQA,GACJ,IAAK,MACL,IAAK,SACL,IAAK,OACL,IAAK,SACL,IAAK,UACL,IAAK,QACL,IAAK,QACL,IAAK,WACL,IAAK,QACL,IAAK,SACL,IAAK,UACL,IAAK,MACL,IAAK,eACL,IAAK,cAAe,OAAO,EAC3B,IAAK,SACL,IAAK,UACL,IAAK,aACL,IAAK,UACL,IAAK,QACL,IAAK,QACL,IAAK,cACL,IAAK,QACL,IAAK,WACL,IAAK,UAAW,OAAO,EAE/B,CA5NqCgoB,CAAYzU,EAAKC,UAC1CsU,EAAS7qB,OAAOZ,EAAO,6BAA8B,iBACrDkX,EAAK0U,gBACLH,EAAS7qB,OAAOZ,EAAO,OAAQ,mBAAqBkX,EAAK0U,kBAE7D1U,EAAKzG,cAAgBua,GACrBS,EAAS7qB,OAAOZ,EAAO,OAAQqB,EAASK,EAAawV,EAAKzG,gBACzDyG,EAAK5L,MAAMjG,SAAS,SACjB6R,EAAK5L,MAAMjG,SAAS,WACpBomB,EAAS7qB,OAAOZ,EAAO,OAAQ,WAC/BkX,EAAK5L,MAAMjG,SAAS,iBACpBomB,EAAS7qB,OAAOZ,EAAO,OAAQ,kBAC/BkX,EAAK5L,MAAMjG,SAAS,iBACpBomB,EAAS7qB,OAAOZ,EAAO,OAAQ,qBAC1BkX,EAAK5L,MAAMjG,SAAS,sBACzBomB,EAAS7qB,OAAOZ,EAAO,OAAQ,0BAEvC,IAAKkX,EAAK5L,MAAMjG,SAAS,aAAc,CACnC,MAAMwmB,EAAiB,CAAc,cAAb3U,EAAKvT,MAAwC,QAAhBuT,EAAKC,QAChD,UACe,YAAfD,EAAKyS,OAAuB,WAAa,YAE/CzS,EAAK5L,MAAMjG,SAAS,oBACpBwmB,EAAe/gB,KAAK,YACpB+gB,EAAeprB,QACfgrB,EAAS7qB,OAAOZ,EAAO,OAAQ,YAAc6rB,EAAe3nB,KAAK,OACxE,CACD,GAAIgT,EAAK4U,aAAc,CACnB,IAAI5rB,EAAQ,CAAC,iBAAkB6rB,GAAY7U,EAAK4U,aAAejW,IAC3DA,EAAY,GACZ3V,EAAM4K,KAAK,KAAMihB,GAAY7U,EAAK4U,cAAe,MAAMjW,MAC3D4V,EAAS7qB,OAAOZ,EAAO,UAAWE,GACrC,CACD0K,EAAME,KAAK2gB,GACX,MAAMtH,EAAUnkB,EAAO,6BAA8B4K,GAErD,OADAuZ,EAAQpH,QAAQjc,GAAKkV,OAAOkB,EAAKpW,IAC1BqjB,CACX,CApW8B6H,CAAoBvD,EAAkB9e,EAASmS,EAAW4L,EAAW7R,QAEtF,CACD,IAAIoW,EACA,SAAUxD,IACVwD,EAAWxD,EAAiBI,KACxB,mBAAoBJ,KAC+D,QAAhF5W,EAAKrM,EAASuB,QAAQV,gBAAgB8J,IAAIsY,EAAiBlf,uBAAoC,IAAPsI,OAAgB,EAASA,EAAGL,OAASiX,EAAiBlf,iBAEzJof,EAAa7d,KAAKse,GAAgBX,EAAkBwD,EAAU,EAAGtiB,EAASC,GAC7E,CAEL,GAAI,kBAAmB6e,EACnB,IAAK,MAAMrf,KAAcqf,EAAiB1f,cAAe,CACrD,MAAMmjB,EAAkB1mB,EAASuB,QAAQf,OAAOmK,IAAI/G,GACpD,GAAI8iB,GAAmBC,GAA0BD,EAAiBviB,GAAU,CACxE,MAAOrB,EAASC,GAASugB,GAAqBoD,EAAiBviB,GAC/Dgf,EAAa7d,KAAKse,GAAgB8C,EAAiBnD,GAAezgB,EAASC,aAAqC,EAASA,EAAMsgB,MAAO,EAAGlf,EAASC,GACrJ,CACJ,CAEL,GAAI,mBAAoB6e,EAAkB,CACtC,MAAM9kB,EAAOmY,EAAUnF,aAAa,SAAW,QAC/C,IAAK,MAAMvN,KAAcqf,EAAiB5f,eAAgB,CACtD,MAAMqjB,EAAkB1mB,EAASuB,QAAQf,OAAOmK,IAAI/G,GACpD,GAAI8iB,GAAmBC,GAA0BD,EAAiBviB,KAAsB,SAARhG,GAAoBuoB,EAAgB3lB,SAASkB,MAAK2kB,IAC9H,MAAM9jB,EAAU9C,EAASuB,QAAQR,SAAS4J,IAAIic,GAC9C,OAAO9jB,GAAW+jB,GAAqBhnB,SAASiD,EAAQ3E,KAAK,KAC5D,CACD,MAAO2E,EAASC,GAASugB,GAAqBoD,EAAiBviB,GAC/Dgf,EAAa7d,KAAKse,GAAgB8C,EAAiBnD,GAAezgB,EAASC,aAAqC,EAASA,EAAMsgB,MAAOH,EAAmB/e,EAASC,GACrK,CACJ,CACJ,CACD,GAAI,kBAAmB6e,EACnB,IAAK,MAAQ3nB,GAAIsI,EAAUnJ,KAAEA,KAAUwoB,EAAiB3f,cAAe,CACnE,MAAMojB,EAAkB1mB,EAASuB,QAAQf,OAAOmK,IAAI/G,GACpD,GAAI8iB,GAAmBC,GAA0BD,EAAiBviB,MAAc1J,GAAQ0J,EAAQzH,UAAUmE,gBAAgBuB,IAAI3H,IAAQ,CAC7H4oB,KACAvgB,EAASC,GAASugB,GAAqBoD,EAAiBviB,GACzDkf,EAAOE,GAAezgB,EAASC,aAAqC,EAASA,EAAMsgB,OAEvFF,EAAa7d,KAAKse,GAAgB8C,EAAiBrD,EAAMH,EAAmB/e,EAASC,IACrF,KACH,CACJ,CAEL,GAAI,WAAY6e,EACZ,IAAK,MAAM6D,KAAc7D,EAAiBziB,OAAQ,CAC9CwiB,EAAqB,EACrB,IAAI+D,EAAW/mB,EAASuB,QAAQf,OAAOmK,IAAImc,GACtCC,IACDjnB,QAAQC,KAAK,6BAA6B+mB,wDAAkExQ,GAC5GyQ,EAAWrW,GAEf,MAAO5N,EAASC,GAASugB,GAAqByD,EAAU5iB,GACxDgf,EAAa7d,KAAKse,GAAgBmD,EAAUxD,GAAezgB,EAASC,aAAqC,EAASA,EAAMsgB,MAAOH,EAAmB/e,EAASC,GAC9J,CACL,GAAI,cAAe6e,EACf,IAAK,MAAM6D,KAAc7D,EAAiBpf,UAAW,CACjD,IAAIkjB,EAAW/mB,EAASuB,QAAQf,OAAOmK,IAAImc,GACtCC,IACDjnB,QAAQC,KAAK,6BAA6B+mB,wDAAkExQ,GAC5GyQ,EAAWrW,GAEf,MAAO5N,EAASC,GAASugB,GAAqByD,EAAU5iB,GACxD,IAAI6iB,EAAYzD,GAAezgB,EAASC,aAAqC,EAASA,EAAMsgB,MACxF2D,IACAA,EAAY,MAAQA,GACxB7D,EAAa7d,KAAKse,GAAgBmD,EAAUC,EAAW9D,EAAmB/e,EAASC,GACtF,CACL,GAAID,EAAQzH,UAAUmE,gBAAgBuB,IAAI,KAAO,qBAAsB6gB,EACnE,IAAK,MAAM6D,KAAc7D,EAAiBnf,iBAAkB,CACxD,IAAIijB,EAAW/mB,EAASuB,QAAQf,OAAOmK,IAAImc,GACtCC,IACDjnB,QAAQC,KAAK,6BAA6B+mB,wDAAkExQ,GAC5GyQ,EAAWrW,GAEf,MAAO5N,EAASC,GAASugB,GAAqByD,EAAU5iB,GACxDgf,EAAa7d,KAAKse,GAAgBmD,EAAUxD,GAAezgB,EAASC,aAAqC,EAASA,EAAMsgB,MAAOH,EAAmB/e,EAASC,GAC9J,CAEL,OADAua,EAAQvjB,UAAU+nB,GACX,CAACA,EAAcH,EAC1B,CA9VoDiE,CAAoBxX,EAAM6G,EAAWnS,EAAS+d,EAAW7R,GACrG0O,GAAWkD,EAAe,EAAIA,EAAee,EAC7CrE,EAAQ/H,mBAAmBmM,GAC3BpE,EAAQvH,MAAM4K,QAAU,GACpBrD,EAAQnI,kBAAoB,GAC5BF,EAAUpb,UAAUC,IAAI,UACxBmb,EAAUmI,MAAQ,wCAClBQ,GAAmBF,KAEdJ,EAAQuI,mBACbvI,EAAQuI,kBAAkBhsB,UAAUC,IAAI,UAE5CkkB,GAAyBN,GAC5B,CACL,CACA,SAAS6E,GAAgBuD,EAAWV,EAAUW,EAAUjjB,EAASC,GAC7D,MAAMwhB,EAAiB,GP7EpB,IAAmByB,GO8EN,GAAZD,GAA8B,GAAZA,IP9EAC,EO8E4BF,EAAU1d,MP7ErD,CAAC,QAAS,QAAS,SAAS5J,SAASwnB,MO8ExCzB,EAAetgB,KAAK9J,EAAO2rB,EAAU1d,OACzCmc,EAAetgB,KAAK9K,EAAO,MAAOqB,EAASK,EAAaM,EAAmB2qB,EAAUnb,KAAM,EAAG7H,EAAQzH,cAAelC,EAAO,qBAC5H,MAAM8sB,EAA4B3B,GAA0BwB,EAAWhjB,GACvE2hB,GAA6BF,EAAgBuB,EAAWG,EAA2BnjB,GACnF,MAAMojB,EAAkB,GACpBd,GACAc,EAAgBjiB,KAAK9K,EAAO,MAAO,KAAKisB,aAC1B7f,IAAdxC,GACAmjB,EAAgBjiB,KAAK9K,EAAO,MAAO,gBAAgB4J,EAAY,QACnEmjB,EAAgBjiB,KAAK9K,EAAO,qBAC5BqrB,GAAwB0B,EAAiBJ,EAAWhjB,GACpD,MAAMiB,EAAQ,CAAC5K,EAAO,eAAgBorB,IAClC2B,EAAgBtsB,OAAS,GACzBmK,EAAME,KAAK9K,EAAO,gBAAiB+sB,IACnC,gBAAiBJ,GAAaA,EAAUlc,aACxC7F,EAAME,KAAK9K,EAAO,gBAAiBqB,EAASK,EAAairB,EAAUlc,gBAEvE+a,GAAU5gB,EAAO+hB,EAAWG,EAA2BnjB,GACvD,MAAMwa,EAAUnkB,EAAO,iBAAkB4K,GAEzC,OADAuZ,EAAQpH,QAAQjc,GAAKkV,OAAO2W,EAAU7rB,IAC/BqjB,CACX,CACA,SAASmH,GAA6B0B,EAAkBC,EAAcC,EAA+BvjB,GAIjG,GAHI,UAAWsjB,GAAgBA,EAAa3hB,MAAMjG,SAAS,uBACvD2nB,EAAiBliB,KAAK9J,EAAOgiB,GAAMmK,cAAe,cAElDD,EAA8BE,WAAY,CAC1C,MAAMrqB,EAAQD,EAAeoqB,EAA8BE,WAAa,IAAMpqB,EAAAA,QACjE,KAATD,GACAiqB,EAAiBliB,KAAK9K,EAAO,MAAO+C,EAAO/B,EAAOgiB,GAAMqK,WAAY,cAE3E,CAUD,GATIH,EAA8BI,eAC9BN,EAAiBliB,KAAK9K,EAAO,MAAOgW,OAAOkX,EAA8BI,eAAgBtsB,EAAuC,YAAhC2I,EAAQzH,UAAUuL,WAA2BuV,GAAMuK,aAAevK,GAAMwK,eAAgB,eAExLN,EAA8BO,gBAC9BT,EAAiBliB,KAAK9K,EAAO,MAAOgW,OAAO7S,KAAKI,MAAM2pB,EAA8BO,iBAAkBzsB,EAAOgiB,GAAM0K,eAAgB,eAEnIR,EAA8BS,aAC9BX,EAAiBliB,KAAK9K,EAAO,MAAOgW,OAAOkX,EAA8BS,aAAc3sB,EAAOgiB,GAAM4K,YAAa,eAEjHV,EAA8BW,SAAU,CACxC,MAAM9qB,EAAQD,EAAeoqB,EAA8BW,SAAW,IAAM7qB,EAAAA,QAC/D,KAATD,GACAiqB,EAAiBliB,KAAK9K,EAAO,MAAO+C,EAAO/B,EAAOgiB,GAAM8K,SAAU,cAEzE,CACGZ,EAA8Ba,aAC9Bf,EAAiBliB,KAAK9K,EAAO,MAAOgW,OAAOkX,EAA8Ba,aAAc/sB,EAAOgiB,GAAMgL,YAAa,cAEzH,CACA,SAAS3C,GAAwB2B,EAAkBiB,EAActkB,GAC7D,GAAI,oBAAqBskB,GAAgBA,EAAa/kB,gBAAiB,CACnE,MAAMglB,EAAc,IAAIjoB,IAAI,CAAC,MAAO,MAAO,QAC3C,IAAK,MAAMyT,KAAYuU,EAAa/kB,gBAChC,IAAK,MAAMS,KAAW+P,EAAS/P,QAC3BukB,EAAYC,OAAOxkB,GAG3B,MAAMykB,EAAS,CAACnnB,MAAMC,KAAKgnB,MAAiBD,EAAa/kB,gBAAgBnF,KAAIsqB,GAAKA,EAAE1kB,WAC9E2kB,EAAc,GACpB,IAAK,MAAMve,IAAQ,CAAC,MAAO,MAAO,OAAQ,CACtC,IAAI1P,EACJ,IAAK,IAAI0B,EAAI,EAAGA,EAAIqsB,EAAO3tB,OAAQsB,IAC/B,GAAIqsB,EAAOrsB,GAAGsD,SAAS0K,GAAO,CAC1B1P,EAAQ+tB,EAAOzS,OAAO5Z,EAAG,GAAG,GAC5B,KACH,CAEL,IAAK1B,EACD,SACJ,MAAMsB,EAAOtB,EAAM6D,KAAK,KACpB7D,EAAMgF,SAASsE,EAAQqG,UACvBse,EAAYxjB,KAAK,oEAAoEnJ,YAErF2sB,EAAYxjB,KAAKnJ,EACxB,CACDqrB,EAAiBliB,KAAK9K,EAAO,MAAO,KAAMqB,EAASitB,EAAYpqB,KAAK,QAAS,MAChF,CACL,CACA,SAASsnB,GAAUwB,EAAkBC,EAAcC,EAA+BvjB,GAC9E,GAAIujB,EAA8BjkB,OAAQ,CACtC,IAAIwK,EAAiB,MACrB,GAAI,aAAcwZ,EACd,IAAK,MAAMb,KAAOa,EAAa1mB,SAAU,CACrC,MAAM+B,EAAU9C,EAASuB,QAAQR,SAAS4J,IAAIic,GAC9C,IAAK9jB,EACD,SACJ,MAAMimB,EAAW5kB,EAAQzH,UAAUuL,WAC3BrC,GAAMA,EAAEqC,aAAe9D,EAAQzH,UAAUuL,WACzCrC,GAAMA,EAAEqC,WAChB,GAAInF,EAAQE,OAAOf,KAAK8mB,GAAW,CAC/B9a,EAAiB+a,GAAkBlmB,GACnC,KACH,CACJ,CACL0kB,EAAiBliB,QHrRlB,SAAuB7B,EAAQwK,EAAgB9J,GAClD,MAAO8kB,KAAeC,GAAmBzlB,EACzC,IAAI0lB,EAAqB,EACzB,MAAMC,EAAoB1mB,GAAYA,EAAaA,EAC9CoQ,MAAK,CAACC,EAAGC,IAAMD,EAAEsW,MAAQrW,EAAEqW,QAC3B9qB,KAAIoE,IACL,MAAMiN,QAAEA,EAAO9F,eAAEA,GAAmBT,EAAa1G,EAAMsL,EAAgB9J,GAIvE,OAHAglB,GAAsBrf,EAClB8F,IACAA,EAAQ2H,QAAQ8R,MAAQ7Y,OAAO7N,EAAK0mB,QACjCzZ,CAAO,IAEb5N,QAAOoO,GAAKA,IAT6B,GAUxCS,EAAW,GACjB,IAAK,MAAMrN,KAAS0lB,EAAiB,CACjC,MAAMtZ,EAAUpV,EAAO,kBACvB,GAAIgJ,EAAM8lB,mBAAoB,CAC1B,MAAMrZ,EAAc7R,EAAaoF,EAAM8lB,mBAAmB/qB,KAAIjD,IAAQ,IAAI+Q,EAAI,MAAO,0CAAqF,QAA1CA,EAAKrM,EAASuB,QAAQZ,OAAOgK,IAAIrP,UAAwB,IAAP+Q,OAAgB,EAASA,EAAGL,OAAS1Q,WAAY,KACnOsU,EAAQxU,OAAOS,EAAS,qDAAwF,GAAnC2H,EAAM8lB,mBAAmBruB,OAAc,GAAK,OAAOgV,YACnI,CACGzM,EAAMyH,aACN2E,EAAQxU,OAAOZ,EAAO,gBAAiBqB,EAASK,EAAasH,EAAMyH,gBACvE,MAAMse,EAAaH,EAAiB5lB,EAAMd,OAC1CkN,EAAQxU,UAAUmuB,GAClB1Y,EAASvL,KAAKsK,EACjB,CAGD,GAFIqZ,GACApY,EAASvL,QAAQ8jB,EAAiBH,EAAWvmB,QAC7CymB,EAAqB,EAAG,CACxB,MAAMK,EAAehvB,EAAO,WAAYgB,EAAOgiB,GAAMiM,eAAgB,WAAYjvB,EAAO,8BAA+B,yBAAyBsC,EAAgBqsB,EAAoB,OACpL,IAAI5sB,EAAI,EACR,KAAOA,EAAIsU,EAAS5V,OAAQsB,IAAK,CAC7B,MAAMqJ,EAAIiL,EAAStU,GAAGgb,QAAQ8R,MAC9B,GAAIzjB,GAAK8jB,SAAS9jB,GAAK,KACnB,KACP,CACDiL,EAASsF,OAAO5Z,EAAG,EAAGitB,EACzB,CACD,OAAO3Y,CACX,CG8OiC8Y,CAAcjC,EAA8BjkB,OAAQwK,EAAgB9J,GAChG,CACL,CACO,SAASwhB,GAA0BwB,EAAWhjB,GACjD,IAAIkI,EAAIqI,EAAIkV,EAAIC,EAAIC,EACpB,IAAI5V,EAAgD,QAApC7H,EAAK8a,EAAUzjB,uBAAoC,IAAP2I,OAAgB,EAASA,EAAG6X,MAAK6F,GAAKA,EAAE5lB,QAAQtE,SAASsE,EAAQqG,YACzHwf,EAAS1pB,OAAOC,OAAO,CAAA,EAAI4mB,EAAWjT,GAE1C,GADA8V,EAAOvmB,OAAS2O,gBAAgB+U,EAAU1jB,SACrCumB,EAAOvmB,OACR,OAAOumB,EACX,GAAI9V,aAA2C,EAASA,EAASzQ,OAAQ,CACrE,MAAMwmB,EAAMtsB,KAAK4R,IAAIya,EAAOvmB,OAAOxI,OAAQiZ,EAASzQ,OAAOxI,QAC3D,IAAK,IAAIivB,EAAU,EAAGA,EAAUD,EAAKC,IAAW,CAC5C,IAAIC,EAAYH,EAAOvmB,OAAOymB,GAC9B,MAAME,EAAgBlW,EAASzQ,OAAOymB,GACtC,GAAIE,EAAe,CAOf,GANKD,IACDA,EAAYH,EAAOvmB,OAAOymB,GAAW,CACjCjf,YAAamf,EAAcnf,YAC3Bqe,mBAAoBc,EAAcd,sBAGrCc,EAAc1nB,MACf,SACJ,MAAMA,EAAQsnB,EAAOvmB,OAAOymB,GAASxnB,MAAmC,QAA1BgS,EAAKyV,EAAUznB,aAA0B,IAAPgS,EAAgBA,EAAK,GACrG,IAAK,MAAM/R,KAAQynB,EAAc1nB,OACM,QAA9BknB,EAAKjnB,EAAKkN,sBAAmC,IAAP+Z,OAAgB,EAASA,EAAG3nB,MAAKiU,IAAM/R,EAAQzH,UAAUiE,OAAOyB,IAAI8T,aAEpFtP,IAAvBjE,EAAK0nB,eACD1nB,EAAKuN,YACLvN,EAAKwN,4BAA6B,GACtCzN,EAAMyT,OAAOxT,EAAK0nB,cAAe,EAAG1nB,IAGpCD,EAAM4C,KAAK3C,GAEtB,CACJ,CACJ,CACD,MAAM2nB,EAAc,GACpB,IAAK,MAAM9mB,KAASwmB,EAAOvmB,OACvB,KAAwC,QAAnComB,EAAKrmB,EAAM8lB,0BAAuC,IAAPO,OAAgB,EAASA,EAAG5nB,MAAKiU,IAAM/R,EAAQzH,UAAUiE,OAAOyB,IAAI8T,MAApH,CAEA,GAAI1S,EAAMd,MAAO,CACb,MAAM6nB,EAAa,GACnB,IAAIC,EAAU,EACd,IAAK,IAAIjuB,EAAI,EAAGA,EAAIiH,EAAMd,MAAMzH,OAAQsB,IAAK,CACzC,MAAMoG,EAAOa,EAAMd,MAAMnG,IACU,QAA9ButB,EAAKnnB,EAAKkN,sBAAmC,IAAPia,OAAgB,EAASA,EAAG7nB,MAAKiU,IAAM/R,EAAQzH,UAAUiE,OAAOyB,IAAI8T,QAE3GsU,KAAY,IAEhBD,EAAWjlB,KAAK3C,GAChB6nB,EAAU7nB,EAAKuN,WAAa,GAC/B,CACD1M,EAAMd,MAAQ6nB,CACjB,CACDD,EAAYhlB,KAAK9B,EAfJ,CAkBjB,OADAwmB,EAAOvmB,OAAS6mB,EACTN,CACX,CACA,SAAShB,IAAkByB,YAAEA,EAAatsB,KAAMusB,IAC5C,OAAKD,EAOM,CACHE,YAAa,EACbC,SAAU,MACVC,MAAO,IACPC,OAAQ,IACRC,MAAO,IACPC,QAAS,IACTC,WAAY,KACZC,OAAQ,KACRC,MAAO,KACPC,QAAS,KACTC,MAAO,KACPC,SAAU,IACVC,IAAK,IACLC,MAAO,IACPC,OAAQ,IACRC,OAAQ,IACRC,QAAS,IACTC,KAAM,IACNC,MAAO,IACPC,SAAU,IACVC,QAAS,KACXtB,GA5BmB,WAAjBC,EACO,MAEJ,KA2Bf,CA+IA,SAASnH,GAAezgB,EAASugB,GAC7B,GAAKA,EAEL,MAAoB,UAAhBvgB,EAAQ3E,MAAoBklB,EAAKxjB,SAAS,KACnC,UAAYwjB,EAAK2I,UAAU3I,EAAK4I,YAAY,KAAO,GAE1D5I,EAAK6I,WAAW,WAAappB,EAAQ2nB,YAC9BvsB,EAAqB4E,EAAQ2nB,aAAe,IAAMpH,EAAK2I,UAAU3I,EAAK4I,YAAY,KAAO,GAE7F5I,EAAK8I,QAAQ,cAAe,QACvC,CACA,SAAS7I,GAAqBngB,EAAOgB,GACjC,IAAIioB,EACJ,IAAK,MAAMxF,KAAOzjB,EAAMpC,SAAU,CAC9B,MAAM+B,EAAU9C,EAASuB,QAAQR,SAAS4J,IAAIic,GAC9C,GAAK9jB,GAIL,GAAK+jB,GAAqBhnB,SAASiD,EAAQ3E,MAE3C,IAAK,MAAM4E,KAASD,EAAQE,OACxB,IAAImB,EAAQzH,UAAUuL,aAAclF,EAAMkF,YAAclF,EAAMkF,YAAc9D,EAAQzH,UAAUuL,WAE9F,IAAK,MAAO1L,EAAG0G,KAAcF,EAAMG,WAAWhC,UAC1C,GAAI+B,EAAUE,OAASA,EAAM7H,KAExB8wB,IACDA,EAAW,CAACtpB,EAASC,EAAOxG,EAAG4H,IAC/Bwf,GAAc1gB,EAAWkB,IACzB,MAAO,CAACrB,EAASC,EAAOxG,EAAG4H,QAdnCrE,QAAQC,KAAK,2BAA2B6mB,wDAA2DzjB,EAiB1G,CACD,GAAIipB,EAEA,OADAA,EAAS,GAAKC,GAAiBD,EAAS,GAAGlpB,WAAWkpB,EAAS,IAAKjoB,GAC7DioB,EAEX,IAAK,MAAMxF,KAAOzjB,EAAMpC,SAAU,CAC9B,MAAM+B,EAAU9C,EAASuB,QAAQR,SAAS4J,IAAIic,GAC9C,GAAK9jB,GAEA+jB,GAAqBhnB,SAASiD,EAAQ3E,MAE3C,IAAK,MAAM4E,KAASD,EAAQE,OACxB,IAAK,MAAOzG,EAAG0G,KAAcF,EAAMG,WAAWhC,UAC1C,GAAI+B,EAAUE,OAASA,EAAM7H,GACzB,MAAO,CAACwH,EAASC,EAAOxG,EAAG8vB,GAAiBppB,EAAWkB,GAGtE,CACD,IAAK,MAAMyiB,KAAOzjB,EAAMpC,SAAU,CAC9B,MAAM+B,EAAU9C,EAASuB,QAAQR,SAAS4J,IAAIic,GAC9C,GAAK9jB,EAEL,IAAK,MAAMC,KAASD,EAAQE,OACxB,IAAK,MAAOzG,EAAG0G,KAAcF,EAAMG,WAAWhC,UAC1C,GAAI+B,EAAUE,OAASA,EAAM7H,GACzB,MAAO,CAACwH,EAASC,EAAOxG,EAAG8vB,GAAiBppB,EAAWkB,GAGtE,CACD,MAAO,MAACyC,OAAWA,GAAY,EAAGzC,EACtC,CACA,SAASkoB,GAAiBC,EAAiBnoB,EAASooB,GAAQ,GACxD,GAAIA,EAAO,CACP,MAAM7vB,EAAY4D,OAAOC,OAAO,CAAA,EAAI4D,EAAQzH,UAAW,CAAEmE,gBAAiBuR,gBAAgBjO,EAAQzH,UAAUmE,iBAAkBF,OAAQyR,gBAAgBjO,EAAQzH,UAAUiE,UACxKwD,EAAU7D,OAAOC,OAAO,CAAA,EAAI4D,EAAS,CAAEzH,aAC1C,CAKD,OAJI4vB,EAAgBvoB,gBAChBI,EAAQzH,UAAUmE,gBAAgB1F,IAAImxB,EAAgBvoB,gBACtDuoB,EAAgBE,OAChBroB,EAAQzH,UAAUiE,OAAOxF,IAAImxB,EAAgBE,OAC1CroB,CACX,CAEA,SAASwf,GAAc9hB,EAAMsC,GACzB,YAAgCyC,IAAxB/E,EAAKkC,gBAAgCI,EAAQzH,UAAUmE,gBAAgBuB,IAAIP,EAAKkC,wBACpE6C,IAAf/E,EAAK2qB,OAAuBroB,EAAQzH,UAAUiE,OAAOyB,IAAIP,EAAK2qB,UAC9DroB,EAAQ0e,WAAahhB,EAAK4qB,UAAU5sB,SAAS,oBAAsBgC,EAAK4qB,UAAU5sB,SAAS,gBAC3FsE,EAAQzH,UAAUuJ,QAAUpE,EAAK6qB,WAAa,EACvD,CACA,SAAS/F,GAA0BxjB,EAAOgB,GACtC,OAAOA,EAAQ0e,WAAa1f,EAAM2C,MAAMjG,SAAS,oBAAsBsD,EAAM2C,MAAMjG,SAAS,aAChG,CACO,SAASoX,GAAoB9T,EAAOgB,GACvC,IAAIkI,EACJ,IAAK,MAAMua,KAAOzjB,EAAMpC,SAAU,CAC9B,MAAM+B,EAAU9C,EAASuB,QAAQR,SAAS4J,IAAIic,GAC9C,GAAK9jB,EAIL,IAAK,MAAMC,KAASD,EAAQE,OAAQ,CAChC,GAAImB,EAAQzH,UAAUuL,YAAclF,EAAMkF,YAAclF,EAAMkF,YAAc9D,EAAQzH,UAAUuL,WAC1F,SACJ,MAAMgiB,EAAMlnB,EAAMG,WAAWoiB,WAAU3S,GAAKA,EAAExP,OAASA,EAAM7H,KAC7D,IAAY,GAAR2uB,EAEJ,IAAK,IAAI1tB,EAAI,EAAGA,EAAI0tB,EAAK1tB,IAAK,CAC1B,MAAM0G,EAAYF,EAAMG,WAAW3G,GACnC,GAAI0G,EAAUupB,MAAO,CACjB,IAAKroB,EAAQzH,UAAUiE,OAAOyB,IAAIa,EAAUupB,OACxC,SACJ,MAAMxV,EAAmBhX,EAASuB,QAAQf,OAAOmK,IAAI1H,EAAUE,OAC/D,OAAK6T,GAKDlX,QAAQ+B,KAAK,mCAAmCsB,EAAM7H,OAAO6H,EAAM6I,aAAagL,EAAiB1b,OAAO0b,EAAiBhL,4BAA4B/I,EAAUupB,WAAmE,QAAvDngB,EAAKrM,EAASuB,QAAQZ,OAAOgK,IAAI1H,EAAUupB,cAA2B,IAAPngB,OAAgB,EAASA,EAAGL,OAAS,8BACxQgL,QALPlX,QAAQyC,MAAM,mCAAmCU,EAAUE,iCAOlE,CACJ,CACJ,MAzBGrD,QAAQC,KAAK,2BAA2B6mB,wDAA2DzjB,EA0B1G,CAEL,CA2JO,SAASqQ,GAAwB9B,EAAMwQ,GAC1C,IAAI6B,EACJ,GAAiB,SAAbrS,EAAKvT,MAAgC,WAAbuT,EAAKvT,MAAkC,UAAbuT,EAAKvT,KAEvD,QAAkByI,KADlBsb,EAAYA,GAAaxQ,EAAK/N,eAE1B7D,QAAQC,KAAK,qLAGb,GADAgkB,EAAU/jB,EAASuB,QAAQT,UAAU6J,IAAIuX,GACpC6B,GAGD,GAAIvmB,SAAOmvB,wBAA0B5I,EAAQ6I,aAAc,CACvD,MAAMC,EAAe9I,EAAQ6I,aAAalb,EAAKC,SAC/C,QAAqB/K,IAAjBimB,EAA4B,CAC5B/sB,QAAQ+B,KAAK,uDAAuDqgB,SAAiB2K,mCAA8Cnb,EAAKC,YACxI,MAAMmb,EAAS9sB,EAASuB,QAAQT,UAAU6J,IAAIkiB,GACzCC,EAGD/I,EAAU+I,EAFVhtB,QAAQyC,MAAM,uDAAuDsqB,6BAG5E,CACJ,OAZD/sB,QAAQyC,MAAM,6CAA6C2f,0BAgBvE,OAAO6B,CACX,CACA,SAASoB,GAAyBzT,EAAMvN,GACpC,MAAMpB,EAAQvI,EAAO,aACrB,IAAK,MAAO+B,EAAG4X,KAASzC,EAAK4B,MAAMpS,UAAW,CAC1C,IAAI6rB,EAAYvyB,EAAO,MACvB,GAAI2Z,EAAKlJ,YACL8hB,EAAU3xB,OAAOZ,EAAO,OAAQqB,EAASK,EAAaiY,EAAKlJ,qBAC1D,GAAIkJ,EAAKzR,MACV,IAAK,MAAMC,KAAQwR,EAAKzR,MAAO,CAC3B,MAAMkN,QAAEA,GAAYvG,EAAa1G,EAAM,KAAMwB,GACzCyL,GACAmd,EAAU3xB,OAAOwU,EACxB,MAEA,GAAIuE,EAAKhK,UAAW,CACrB4iB,EAAU3V,MAAM4V,cAAgB,SAChC,MAAM1K,EAAmB1Z,EAAoBzE,EAAQzH,WACrD,IAAK,MAAMmJ,KAAYsO,EAAKhK,UAAW,CACnC,IACIhO,EADA8wB,EAAgBjnB,EAAkBH,EAAU1B,EAAQzH,UAAUuJ,MAAOqc,GAGrEnmB,EADA0J,EAASC,MAAMjG,SAAS,iBACjB,IAAIlC,KAAKI,MAAMkvB,OAAmB/uB,EAAqB2H,EAASoF,eAGhE,IAAItN,KAAKI,MAAMkvB,MAAkB/uB,EAAqB2H,EAASoF,eAE1E8hB,EAAU3xB,OAAOZ,EAAO,KAAM2B,GACjC,CACJ,CACD,MAAMqC,EAAIhE,EAAO,KAAMuyB,GACvB,GAAoB,QAAhBrb,EAAKC,QAAmB,CACxB,MAAMub,EAAa3wB,GAAK4H,EAAQzH,UAAUqV,cAAcL,EAAKpW,KAAO,GAAK,wBAA0B,GACnGkD,EAAEwX,QAAQxb,EAAO,OAAS0yB,EAAY,IAAI3wB,EAAI,MACjD,CACDwG,EAAM3H,OAAOoD,EAChB,CACD,OAAOuE,CACX,CAqCO,SAASsR,GAAe3C,EAAMvN,EAAS4f,EAASoJ,EAAkB9c,EAAY,GACjF,IAAIrE,EAOAohB,EAAMC,EAAMC,EAAMC,EAmBtB,OAxBIvhB,EADa,cAAb0F,EAAKvT,KACEuT,EAAK8a,MAGL9a,EAAK1F,KAGhBohB,EAAOC,EAAOC,EAAOC,EAAO,GACvB7b,EAAK5L,MAAMjG,SAAS,eACjBkkB,GAAWA,EAAQ/X,OACnBohB,EAAOrJ,EAAQ/X,KACfqhB,EAAO,KAGV3b,EAAK5L,MAAMjG,SAAS,eACjBstB,GAAoBA,EAAiBpoB,SACrCwoB,EAAOJ,EAAiBpoB,OACxBuoB,EAAO,KAGfthB,EAAO9P,EAAa8P,EAAMohB,EAAMC,EAAMC,EAAMC,GACxCld,GAAa,IACbrE,EAAOxP,EAAmBwP,EAAMqE,EAAWlM,EAAQzH,YAClDgV,EAAK5L,MAAMjG,SAAS,SAAW6R,EAAK5L,MAAMjG,SAAS,SAAU6R,EAAK5L,MAAMjG,SAAS,cAClFmM,GAAQ,UACLA,CACX,CACO,SAAS+K,GAAmC5S,EAASmS,GACxD,IAAIkX,EAAiBlX,EAAUnF,aAAa,eAC5C,GAAIqc,EAAgB,EAChBrpB,EAAU7D,OAAOC,OAAO,CAAE,EAAE4D,IACpB2e,QAAS,EACjB3e,EAAQzH,UAAY4D,OAAOC,OAAO,CAAA,EAAI4D,EAAQzH,WAC9C,MAAM+wB,EAAU,GAChBtpB,EAAQzH,UAAUiE,OAAS,IAAIF,IAAI+sB,EAAe3yB,MAAM,KAAK0D,KAAI2X,IAC7D,MAAMrZ,GAAKqZ,EAGX,OAFKrZ,GACD4wB,EAAQnoB,KAAK4Q,GACVrZ,CAAC,IACTmF,QAAOkU,GAAKA,KACXuX,EAAQxyB,QACR6E,QAAQC,KAAK,qEAAsEuW,EAAW,6BAA8BmX,EACnI,CACD,OAAOtpB,CACX,CACA,SAASoiB,GAAYmH,GACjB,MAAMtoB,EAAQ,CAACoL,OAAO7S,KAAKK,MAAM0vB,EAAS,MAAOlyB,EAAOgiB,GAAMmQ,YAAa,YAAa,KAKxF,OAJID,EAAS,IACTtoB,EAAMmB,QAAQiK,OAAO7S,KAAKK,MAAO0vB,EAAS,IAAO,MAAOlyB,EAAOgiB,GAAMoQ,YAAa,YAAa,KAC/FF,EAAS,MACTtoB,EAAMmB,QAAQiK,OAAO7S,KAAKK,MAAM0vB,EAAS,MAASlyB,EAAOgiB,GAAMqQ,UAAW,YAAa,KACpFrzB,EAAO,UAAW4K,EAC7B,CA6BY,MAACiN,GAAkB,CAC3B7H,SAAU,MACVqY,YAAY,EACZzU,YAAa,KACb1R,UAAW,CACPuJ,MAAO,GACP4e,UAAU,EACVloB,IAAK,OACLgE,OAAQ,IAAIF,IACZI,gBAAiB,IAAIJ,IACrB6D,MAAO,CACH3C,OAAQ,CACJgF,MAAO,EACPI,UAAW,EACXC,SAAU,EACVC,UAAW,EACXC,SAAU,EACVC,gBAAiB,EACjBC,UAAW,EACXC,cAAe,EACfC,aAAc,EACdC,gBAAiB,GAErBlC,QAAS,CACLsB,MAAO,GACPI,UAAW,GACXC,SAAU,GACVC,UAAW,GACXC,SAAU,GACVC,gBAAiB,GACjBC,UAAW,GACXC,cAAe,GACfC,aAAc,GACdC,gBAAiB,GACjBE,MAAO,GACPsG,OAAQ,GACR+f,UAAW,GACXtmB,OAAQ,GACRumB,kBAAmB,GACnBC,KAAM,GACNtmB,kBAAmB,GACnBC,aAAc,GACdC,WAAY,GACZC,WAAY,KAGpBtD,iBAAkB,CAAC,CACX5C,OAAQ,CACJgF,MAAO,IACPI,UAAW,IACXC,SAAU,IACVC,UAAW,IACXC,SAAU,EACVC,gBAAiB,EACjBC,UAAW,EACXC,cAAe,EACfC,aAAc,EACdC,gBAAiB,EACjBC,OAAQ,IACRC,MAAO,IACPG,WAAY,IACZC,WAAY,IACZH,kBAAmB,EACnBC,aAAc,GAElBtC,QAAS,CACLsB,MAAO,GACPI,UAAW,GACXC,SAAU,GACVC,UAAW,GACXC,SAAU,GACVC,gBAAiB,GACjBC,UAAW,GACXC,cAAe,GACfC,aAAc,GACdC,gBAAiB,GACjBE,MAAO,GACPsG,OAAQ,GACR+f,UAAW,GACXtmB,OAAQ,GACRumB,kBAAmB,GACnBC,KAAM,GACNtmB,kBAAmB,GACnBC,aAAc,GACdC,WAAY,GACZC,WAAY,IAEhBrB,UAAW,CACPG,MAAO,GACPI,UAAW,GACXC,SAAU,GACVC,UAAW,GACXC,SAAU,GACVC,gBAAiB,GACjBC,UAAW,GACXC,cAAe,GACfC,aAAc,GACdC,gBAAiB,GACjBE,MAAO,GACPD,OAAQ,GACRE,kBAAmB,GACnBC,aAAc,GACdC,WAAY,GACZC,WAAY,MAGxBrD,kBAAmB,EACnBuN,cAAe,CAAE,IAGzB,SAASkc,GAAsBC,GAC3B,IAAI7hB,EAAIqI,EAAIkV,EAAIC,EAAIC,EAAIqE,EACO,OAA3BD,EAAe1jB,WAA0D,QAAnC6B,EAAK6hB,EAAexxB,iBAA8B,IAAP2P,OAAgB,EAASA,EAAGpG,QAA6F,KAA9C,QAAnCyO,EAAKwZ,EAAexxB,iBAA8B,IAAPgY,OAAgB,EAASA,EAAGzO,QAChMnG,QAAQyC,MAAM,wSAAyS2rB,GAE3T,MAAM5pB,EAAQ8pB,GAA6D,QAAnCxE,EAAKsE,EAAexxB,iBAA8B,IAAPktB,OAAgB,EAASA,EAAGtlB,OACzGyN,EAAgBzR,OAAOC,OAAO,CAAA,EAAwC,QAAnCspB,EAAKqE,EAAexxB,iBAA8B,IAAPmtB,OAAgB,EAASA,EAAG9X,eAC1GxN,GAAwH,QAAnG4pB,EAAyC,QAAnCrE,EAAKoE,EAAexxB,iBAA8B,IAAPotB,OAAgB,EAASA,EAAGvlB,wBAAqC,IAAP4pB,OAAgB,EAASA,EAAG5vB,KAAIqH,GAAKyoB,GAAqBzoB,OAAQ,CAACyoB,MACnM3xB,EAAY4D,OAAOC,OAAO,CAAA,EAAI8R,GAAgB3V,UAAW,CAAEiE,OAAQ,IAAIF,IAAOI,gBAAiB,IAAIJ,KAASytB,EAAexxB,UAAW,CAAE4H,QAAOyN,gBAAexN,qBACpK,OAAOjE,OAAOC,OAAO,CAAE,EAAE8R,GAAiB6b,EAAgB,CAAExxB,aAChE,CACO,SAAS0xB,GAAyBE,EAAgB,IAGrD,MAAO,CAAE3sB,OAFMrB,OAAOC,OAAO,GAAI8R,GAAgB3V,UAAU4H,MAAM3C,OAAQ2sB,EAAc3sB,QAEtE0D,QADD/E,OAAOC,OAAO,CAAA,EAAI6R,gBAAgBC,GAAgB3V,UAAU4H,MAAMe,SAAUipB,EAAcjpB,SAE9G,CACO,SAASgpB,GAAqBC,EAAgB,IAIjD,MAAO,CAAE3sB,OAHMrB,OAAOC,OAAO,CAAA,EAAI8R,GAAgB3V,UAAU6H,iBAAiB,GAAG5C,OAAQ2sB,EAAc3sB,QAGpF0D,QAFD/E,OAAOC,OAAO,CAAE,EAAE6R,gBAAgBC,GAAgB3V,UAAU6H,iBAAiB,GAAGc,SAAUipB,EAAcjpB,SAE9FmB,UADRlG,OAAOC,OAAO,CAAE,EAAE6R,gBAAgBC,GAAgB3V,UAAU6H,iBAAiB,GAAGiC,WAAY8nB,EAAc9nB,WAEhI,CACA,MAAM+nB,GAAiB,CACnBC,gBAAgB,EAChBC,uBAAuB,EACvBC,wBAAwB,EACxBC,2BAA2B,EAC3BC,kCAAkC,EAClCjC,wBAAwB,EACxBkC,4BAA4B,EAC5BC,+BAA+B,EAC/Bjd,qBAAqB,EACrBpU,2BAA2B,EAC3BkO,2BAA2B,EAC3B4V,sBAAsB,GAE1B,IAAI8C,IACJ,SAAWA,GACPA,EAAOA,EAAa,KAAI,GAAK,OAC7BA,EAAOA,EAAc,MAAI,GAAK,QAC9BA,EAAOA,EAAe,OAAI,GAAK,SAC/BA,EAAOA,EAAiB,SAAI,GAAK,WACjCA,EAAOA,EAAa,KAAI,GAAK,OAC7BA,EAAOA,EAAe,OAAI,GAAK,SAC/BA,EAAOA,EAAiB,SAAI,GAAK,WACjCA,EAAOA,EAAkB,UAAI,GAAK,WACrC,CATD,CASGA,KAAWA,GAAS,CAAE,IACzB,MAAMM,GAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GACnCI,GAAiB,CAAC,GAAK,IAAM,GAAK,IAAM,GAAK,EAAK,KAAM,MACjDvH,GAAQ,CACjBmQ,YAAa,OACbC,YAAa,OACbC,UAAW,OACXkB,aAAc,OACdC,cAAe,OACfC,gBAAiB,OACjBjH,eAAgB,OAChBD,aAAc,OACdK,YAAa,OACbI,YAAa,QACbN,eAAgB,OAChBP,cAAe,OACfW,SAAU,OACVT,WAAY,OACZqH,MAAO,OACPzF,eAAgB,QAChB0F,YAAa,OACb1R,QAAS,QACTE,WAAY,OACZE,UAAW,QACXE,KAAM,QACNE,UAAW,QACXE,OAAQ,QACRE,MAAO,QACPE,KAAM,SAEJsI,GAAuB,CAAC,SAAU,OAAQ,QAAS,aAAc,WAAY,aACnF,CACI,GAAIuI,OAAOC,8BAA8B5tB,MACrC,IAAK,MAAMysB,KAAkBkB,OAAOC,mBAChCre,GAAS1L,KAAK2oB,GAAsBC,SAEnCkB,OAAOC,mBACZre,GAAS1L,KAAK2oB,GAAsBmB,OAAOC,qBAG3Cre,GAAS1L,KAAK2oB,GAAsB,CAAA,IAExCzwB,EAAMA,OAAG8C,OAAOC,OAAO,CAAA,EAAIguB,GAAgBa,OAAOE,mBAC9C9xB,EAAMA,OAAC4C,UACPJ,EAASI,QAAU5C,EAAAA,OAAO4C,QAAQmvB,IAClC,kBAAmBC,WAAahyB,EAAMA,OAACiyB,YACvCD,UAAUE,cAAcC,SAASnyB,EAAAA,OAAOiyB,WAAY,CAAE7e,MAAO,MAAOxR,MAAMwG,GAAM9F,QAAQ8vB,IAAI,6DAA8DhqB,KAAKsL,GAAMpR,QAAQyC,MAAM,sEAAsE2O,OAE7PyN,EAAUnkB,EAAO,sBACjBmkB,EAAQvH,MAAM4K,QAAU,OACpBjnB,SAAS80B,KACT90B,SAAS80B,KAAKC,YAAYnR,GAE1B5jB,SAAS+mB,iBAAiB,oBAAoB,IAAM/mB,SAAS80B,KAAKC,YAAYnR,KAClF,MAAMoR,EAAW,oGAAoGC,KAAKR,UAAUS,UAAUC,eA2B9I,IAAIC,EA1BJp1B,SAAS+mB,iBAAiB,aAAasO,IAC/BL,GAAapyB,KAAKC,IAAIwyB,EAAMC,MAAQxR,GAAclhB,KAAKC,IAAIwyB,EAAME,MAAQxR,GAAc,KACvFH,EAAQvH,MAAM4K,QAAU,QAE5BnD,EAAauR,EAAMC,MACnBvR,EAAasR,EAAME,MACU,QAAzB3R,EAAQvH,MAAM4K,SACdrC,IAAiB,IAEzB5kB,SAAS+mB,iBAAiB,eAAesO,IACrC,MAAMG,EPplCP,SAA0BC,EAAMC,EAAUC,EAAQ,IACrD,IAAIC,EAAUH,EACd,KAAOG,GAAWD,KAAU,IAAMC,EAAQC,QAAQH,IAC9CE,EAAUA,EAAQ5b,cACtB,OAAa,GAAT2b,EACO,KACJC,CACX,CO6kCqBE,CAAiBT,EAAMtjB,OAAQ,aACvCyjB,IAEDA,EAAKr1B,UAAUyb,SAAS,WAAsC,QAAzBgI,EAAQvH,MAAM4K,UACnDoO,EAAMU,iBACN/R,IAAYA,GAAW,GAAKJ,EAAQnI,kBACpCyI,GAAmBF,IACnBM,GAAyBN,IAAU,GACnCY,IAAgB,IAEhBoQ,GAAqC,QAAzBpR,EAAQvH,MAAM4K,UAC1BoO,EAAMU,iBACN/O,GAAewO,GACf5Q,MACH,IAGL,MAAMoR,EAAiBX,IACnB,GAA6B,QAAzBzR,EAAQvH,MAAM4K,QACd,OACJ,MAAMgP,EAAWrS,EAAQ3J,SAAS+J,IAClC,GAAIiS,EAASC,cAAgBD,EAASE,aAClC,OACJd,EAAMU,iBACN,MAAMK,EAASf,EAAMe,QAAUf,EAAMgB,QAAUhB,EAAMiB,QAAQ,GAAGC,QAAUnB,EAAMmB,QAChFN,EAASO,SAAS,EAAGJ,EAAO,EAE1BK,EAAU,YAAapC,QAAS,CAAEoC,SAAS,GACjDpC,OAAOtN,iBAAiB,iBAAkBiP,GAAe,GACzD3B,OAAOtN,iBAAiB,QAASiP,EAAeS,GAChDpC,OAAOtN,iBAAiB,cAAcsO,IAClCD,EAAQC,EAAMiB,QAAQ,EAAE,IAE5BjC,OAAOtN,iBAAiB,YAAaiP,EAAeS,GACpDpC,OAAOtN,iBAAiB,WAAW5Q,IAC3BA,EAAEugB,SAAWvgB,EAAEwgB,SACF,KAATxgB,EAAEwQ,KACFxQ,EAAE4f,iBACFtzB,EAAAA,OAAOmO,2BAA6BnO,EAAMA,OAACmO,0BAC3C7L,QAAQ8vB,IAAI,yDAAyDpyB,EAAAA,OAAOmO,6BACxEiT,GAA8C,QAAzBD,EAAQvH,MAAM4K,UACnCD,GAAenD,EAAmBG,IAClCY,OAGU,KAATzO,EAAEwQ,MACPxQ,EAAE4f,iBACFtzB,EAAAA,OAAOC,2BAA6BD,EAAMA,OAACC,0BAC3CqC,QAAQ8vB,IAAI,yDAAyDpyB,EAAAA,OAAOC,6BACxEmhB,GAA8C,QAAzBD,EAAQvH,MAAM4K,UACnCD,GAAenD,EAAmBG,IAClCY,OAGX,GAET,CACA,GAAIniB,EAAAA,OAAOgxB,eAAgB,CACvB,MAAMmD,EAAa52B,SAASma,uBAAuB,qBACnD,GAAI1X,EAAAA,OAAOmxB,0BACP,GAAIgD,EAAW12B,OACX,IAAK,MAAM6R,KAAU6kB,EACjBC,EAAkB9kB,QAEtBhN,QAAQC,KAAK,iTAGrB2gB,GAAa3lB,UACRqE,MAAKyyB,IACN,IAAIxlB,EACJ,GAAI7O,EAAAA,OAAOsxB,8BACP,IAAK,MAAMgD,KAAaH,EAAY,CAChC,IAAK,MAAOp1B,EAAGw1B,KAAYD,EAAUxc,iBAAiB,eAAepU,UACjE,IAAK,MAAM8wB,KAAWD,EAAQjhB,qBAAqB,aAC/CkhB,EAAQzhB,aAAa,YAAaC,OAAOjU,IAEjD,MAAM01B,EAAgB,GACtB,IAAK,MAAO11B,EAAG21B,KAAkBJ,EAAUxc,iBAAiB,sBAAsBpU,UAAW,CACzF,MAAMixB,EAAW,GACXC,EAAW,CAACjvB,EAAOgB,EAASif,KAC9B,GAAIA,EAAuB,CACvB,MAAMpM,EAAmBC,GAAoB9T,EAAOgB,GAChD6S,IACA7T,EAAQ6T,EACf,CAED,IAAIlU,EAASC,EAAOxG,EAEpB,GAHA41B,EAAS7sB,KAAKnC,EAAM7H,KAEnBwH,EAASC,EAAOxG,EAAG4H,GAAWmf,GAAqBngB,EAAOgB,GACvDpB,EAAO,CACP,IAAIE,EAAYF,EAAMG,WAAW3G,GACjC,KAAO0G,EAAUwgB,4BAA4B,CACzC,MAAMC,EAAiB3gB,EAAMG,WAAWD,EAAUwgB,4BAClD,IAAKE,GAAcD,EAAgBvf,GAC/B,MACJguB,EAAS7sB,KAAKoe,EAAevgB,OAC7BF,EAAYygB,CACf,CACD,IAAK,IAAIG,EAAI,EAAGA,EAAItnB,EAAGsnB,IAAK,CACxB,MAAMH,EAAiB3gB,EAAMG,WAAW2gB,GACpCH,EAAeD,4BAA8BlnB,IAE5ConB,GAAcD,EAAgBvf,KAEnCguB,EAAS7sB,KAAKoe,EAAevgB,OAC7B5G,EAAIsnB,EACJA,GAAK,GACR,CACJ,CACD,GAAI1gB,EAAMI,cACN,IAAK,MAAMK,KAAcT,EAAMI,cAAe,CAClBvD,EAASuB,QAAQf,OAAOmK,IAAI/G,IAEhDuuB,EAAS7sB,KAAK1B,EACrB,CACL,GAAIT,EAAME,eACN,IAAK,MAAMO,KAAcT,EAAME,eAAgB,CAC3C,MAAMqjB,EAAkB1mB,EAASuB,QAAQf,OAAOmK,IAAI/G,GAChD8iB,GAAmBA,EAAgB3lB,SAASkB,MAAK2kB,IACjD,MAAM9jB,EAAU9C,EAASuB,QAAQR,SAAS4J,IAAIic,GAC9C,OAAO9jB,GAAW+jB,GAAqBhnB,SAASiD,EAAQ3E,KAAK,KAE7Dg0B,EAAS7sB,KAAK1B,EAErB,CACL,GAAIT,EAAMG,cACN,IAAK,MAAQhI,GAAIsI,KAAgBT,EAAMG,cAAe,CAC1BtD,EAASuB,QAAQf,OAAOmK,IAAI/G,IAEhDuuB,EAAS7sB,KAAK1B,EACrB,GAET,IAAK,MAAMouB,KAAWE,EAAcld,SAAU,CAC1Cgd,EAAQzhB,aAAa,YAAaC,OAAOjU,IACzC,MAAM4G,EAAQnD,EAASuB,QAAQf,OAAOmK,KAAK6F,OAAOwhB,EAAQ7gB,aAAa,WACjEhN,EAAU6M,IAAUR,OAAOwhB,EAAQ7gB,aAAa,gBAAkB,GAClEiS,EAAwB4O,EAAQ92B,UAAUyb,SAAS,kBACrDxT,EACAivB,EAASjvB,EAAOgB,EAASif,GAEzBtjB,QAAQC,KAAK,4DAA6DiyB,EAEjF,CACDC,EAAc3sB,KAAK6sB,EACtB,CACD,GAAIF,EAAch3B,OAAS,IAAMg3B,EAAc,GAAG,IAAMA,EAAc,GAAG,IAAMA,EAAc,GAAGA,EAAc,GAAGh3B,OAAS,IAAMg3B,EAAc,GAAGA,EAAc,GAAGh3B,OAAS,IAAK,CAC5K6E,QAAQ+B,KAAK,wFAAyFowB,GACtG,MAAMI,EAAwE,QAArDhmB,EAAKylB,EAAU/c,cAAcud,0BAAuC,IAAPjmB,OAAgB,EAASA,EAAGimB,mBAClH,GAAID,EACA,IAAK,MAAME,KAAaF,EAAgB/c,iBAAiB,yBAA0B,CAC/E,MAAMha,GAAMkV,OAAO+hB,EAAUphB,aAAa,WAAa,EACvD,GAAI7V,EACA,IAAK,MAAOiB,EAAGiE,KAAWyxB,EAAc/wB,UAChCV,EAAOX,SAASvE,IAChBi3B,EAAUhiB,aAAa,YAAaC,OAAOjU,GAE1D,CACR,CACJ,CAEL,GAAIiB,EAAAA,OAAOixB,sBACP,GAAIkD,EAAW12B,OACX,IAAK,MAAM6R,KAAU6kB,EACjBa,EAAyB1lB,QAE7BhN,QAAQC,KAAK,2RAGrB,GAAIvC,EAAAA,OAAOkxB,uBACP,GAAIiD,EAAW12B,OACX,IAAK,MAAM6R,KAAU6kB,EACjBc,EAAuB3lB,QAE3BhN,QAAQC,KAAK,8SAMrB,GAHIvC,EAAAA,OAAOmxB,2BF/iCZ,SAAsB3d,GACzB,IAAK,MAAM7M,KAAW6M,EAClB,IAAK,MAAMqQ,KAAWld,EAAQzH,UAAUiE,OAAQ,CAC5C,MAAM6rB,EAAQxsB,EAASuB,QAAQZ,OAAOgK,IAAI0W,GAC1C,IAAKmL,EAAO,CACR1sB,QAAQyC,MAAM,mCAAmC8e,yCACjD,QACH,CACD,MAAMqR,EAAgBvoB,IAClB,IAAK,MAAMpE,KAAOoE,EACTpE,EAAImF,2BAA8BkJ,EAAgBrO,EAAK5B,KAE3DA,EAAQzH,UAAU4H,MAAMe,QAAQU,EAAImF,6BAA+B/G,EAAQzH,UAAU4H,MAAMe,QAAQU,EAAImF,2BAA6B,KAChI5F,KAAK,CAAEK,OAAQ,+CAA+C6mB,EAAMxgB,eAAgBnG,SAAUE,EAAKtJ,MAAO,GAClH,EAED+vB,EAAMriB,WACNuoB,EAAalG,EAAMriB,WACvB,MAAMwoB,EAAmBhN,GAA0B6G,EAAOroB,GAC1D,GAAIwuB,EAAiBlvB,OACjB,IAAK,MAAMD,KAASmvB,EAAiBlvB,OACjC,GAAID,EAAMd,MACN,IAAK,MAAMC,KAAQa,EAAMd,MAAO,CAC5B,KAAM,SAAUC,GACZ,SACJ,MAAMC,EAAO5C,EAASuB,QAAQf,OAAOmK,IAAIhI,EAAKC,MACzCA,EAIDA,EAAKuH,YAAc,CAAC,OAAQ,aAAatK,SAAS+C,EAAK4I,aACvD1L,QAAQ+B,KAAK,4CAA4C2qB,EAAMxgB,gBAAgBpJ,EAAK4I,aAAa5I,EAAKoJ,SAASpJ,EAAKuH,UAAUlP,eAC9Hy3B,EAAa9vB,EAAKuH,YALlBrK,QAAQyC,MAAM,kCAAkCI,EAAKC,gFAO5D,CAChB,CAET,CE2gCYgwB,CAAqB5hB,IAErBxT,EAAAA,OAAOqxB,2BAA4B,CACnC,MAAMgE,EAAU93B,SAASua,iBAAiB,6BACtCud,EAAQ53B,OD5lCjB,SAA2B63B,GAC9B,MAAMC,EAA8B/hB,GAASzS,KAAIkU,IAC7C,MAAMjB,EAAS,CAAA,EACf,IAAK,MAAOlW,EAAIqX,KAAMrS,OAAOY,QAAQuR,EAAI/V,UAAUqV,eAAgB,CAC/D,IAAIL,GACCA,EAAO1R,EAASuB,QAAQb,MAAMiK,KAAKrP,KAAQ,YAAaoW,GAAwB,YAAhBA,EAAKC,UACtEH,GAAQlW,GAAMqX,EACrB,CACD,OAAOnB,CAAM,IAEXwhB,EAAsBhiB,GAASzS,KAAIkU,IACrC,IAAK,MAAOnX,EAAIqX,KAAMrS,OAAOY,QAAQuR,EAAI/V,UAAUqV,eAAgB,CAC/D,IAAIL,EACJ,IAAKA,EAAO1R,EAASuB,QAAQb,MAAMiK,KAAKrP,KAAQ,YAAaoW,GAAwB,cAAhBA,EAAKC,QACtE,OAAOrW,CACd,KAEL,IAAK,MAAMsU,KAAWkjB,EAAU,CAC5B,GAAIljB,EAAQ4G,kBAAoB,EAC5B,SACJ,MAAOyc,KAAWC,GAActjB,EAAQoF,SACxC,GAAoC,SAAhCie,EAAO9hB,aAAa,QACpB,SACJ,MAAMgiB,GAAW3iB,OAAOyiB,EAAO9hB,aAAa,gBAAkB,EACxDiiB,EAAaF,EAAWlxB,QAAOqxB,GAAgC,SAA3BA,EAAEliB,aAAa,SAAsBkiB,EAAEliB,aAAa,YACrFX,OAAOyiB,EAAO9hB,aAAa,gBAAkB,KAAOgiB,IACxD50B,KAAI80B,GAAKA,EAAEliB,aAAa,WAC7B,CACI,IAAI7V,EAAIoW,EACR,IAAKpW,GAAMkV,OAAOyiB,EAAO9hB,aAAa,aAAeO,EAAO1R,EAASuB,QAAQb,MAAMiK,IAAIrP,KAAQ,UAAWoW,EACtG,IAAK,MAAM2R,KAAQ3R,EAAK0T,MACpB,GAAY,YAAR/B,EAAoB,CACpB,MAAMiQ,EAAqBP,EAA4BI,GACvD,IAAK,MAAMI,KAAcjzB,OAAO2R,KAAKqhB,GAAqB,CACtDF,EAAW9tB,KAAKiuB,KACVD,EAAmBC,GAAc,UAC5BD,EAAmBC,GAE9B,KACH,CACJ,MACI,GAAY,cAARlQ,EAAsB,CAC3B,MAAMmQ,EAAaR,EAAoBG,GACnCK,GACAJ,EAAW9tB,KAAKkuB,EACvB,CAGZ,CACD,MAAMC,EAAaL,EAAW10B,KAAK,KAC/B+0B,GACAR,EAAO1iB,aAAa,UAAWkjB,EACtC,CACL,CCwiCgBC,CAAkBb,GAElB/yB,QAAQC,KAAK,kNAEpB,CACD,IAAK,MAAMrD,UAAEA,KAAesU,GACxB2iB,EAA4Bj3B,GAEhC,GAAIc,EAAAA,OAAOoxB,iCACP,IAAK,MAAMzqB,KAAW6M,GAClB,IAAK,MAAMgD,KAAe7P,EAAQzH,UAAU6H,iBAAiB0N,OACzD/N,EAA4BC,EAAS6P,GAIjD,IAAK,MAAOnP,EAAWgM,KAAaghB,EAAWpe,WAC3C,IAAK,MAAMhC,KAAWZ,EAClB8G,EAAiBlG,EAAS5M,EAEjC,GAET"}