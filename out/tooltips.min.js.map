{"version":3,"file":"tooltips.min.js","sources":["../src/Utils.ts","../src/API.ts","../src/APICache.ts","../src/CharacterAttributes.ts","../src/Constants.ts","../src/FactsProcessor.ts","../src/Collect.ts","../src/Inflators.ts","../src/EffectsShim.ts","../src/TooltipsV2.ts"],"sourcesContent":["export function newElm(spec, ...inner) {\n    const [tag, ...classes] = spec.split('.');\n    const el = document.createElement(tag);\n    if (classes.length)\n        el.classList.add(...classes);\n    if (inner.length)\n        el.append(...inner);\n    return el;\n}\nexport function formatImageUrl(id) {\n    return `https://assets.gw2dat.com/${id}.png`;\n}\nconst missingImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABuCAIAAACfnGvJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMCSURBVHhe7ZjpkeowEAaJywERD9GQDMGwumyPLj+2XssH+/UPyjMjjVBjUWXf3oJGTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSU51inr8d0u02PVwp/xf/MHQvt9Hm/Be7PlMgIHhyzCjn9hNlpc7ebxe9hhNPp8QifpTdfuz9Oe3thjHH6Cndkfv7DWb0/syNbnN8QJuzkZr5q5K+Xk2C6BtbCTDEAZJDTuIfKi0tUKuZgHhBx89P1Zj5rtK4YQzspL43z6RnltFBR5DMVKVhGFPTy3UYBO6vo0GuIMcxpvs1O2gbhei0tbOazRusvmCe+x6nddDtbBA4/LmEFNfN1o57TOD0F5ZIDGOh0CbL91SrqDYZ07iiQ5etGdrxNpGkz9XowQ53GG2Sa7H5rFc095n1W1nzdqOPUXzbXGMVYp1FqlqlVxMCNXEd9kG806t2n87cw2KE4g53mO/fUKrJgxkzp5Ou5Paf//E4wtNPzUelupki+32k8+cZgMDpQ6V9w6ij+UAeee8/fcLovcsojpzxyyiOnPHLKI6c8csqDOx39MH0B5JRHTnmGO00v2uKLi0B8e7E8ghf+7aP5RimyDrC1ga9HPmIXp2ajy95tvEhwUaHJlpaouUandgD7OF3MpHijbrAlf13MmsOwoulQxruzu9NfGLClvtO6QTF2d87mNISWuWT7ZGtUMwJy2nLVKK2YBcqGx3Mmp+XUomQqGUcf9YpT3afZ2BBUoWFpElqYnm7ooY5P9n8a9QRcDz83lfylFdVcJnGoUAfudAjlD+FopM7CNZy27/aTKr2KU4c93Y6jD/gG13F6HeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklOb9/gEv6oxxwmIw6QAAAABJRU5ErkJggg==';\nexport function newImg(src, className, alt) {\n    const img = document.createElement('img');\n    img.src = src ? ((typeof src === 'string' && src.includes(':')) ? src : formatImageUrl(src)) : missingImage;\n    if (className)\n        img.classList.add(className);\n    img.alt = alt ? alt + ' icon' : 'icon';\n    return img;\n}\nexport function fromHTML(html) {\n    const dummy = document.createElement('template');\n    dummy.innerHTML = html;\n    return dummy.content;\n}\nexport const GW2Text2HTML = (text, ...formatArgs) => text\n    ? text\n        .replaceAll(/<c=(#.*?)>(.*?)<\\/c>/g, `<span style=\"color: $1;\">$2</span>`)\n        .replaceAll(/<c=@(.*?)>(.*?)<\\/c>/g, `<span class=\"gw2-color-$1\">$2</span>`)\n        .replaceAll('[lbracket]', '[').replaceAll('[rbracket]', ']')\n        .replaceAll('[null]', '')\n        .replaceAll('\\n', '<br />')\n        .replaceAll(/%str(\\d)%/g, (_, i) => formatArgs[+i - 1] || '')\n        .replaceAll('%%', '%')\n    : '';\nexport const resolveInflections = (text, count, character) => text\n    .replaceAll('[s]', count > 1 ? 's' : '')\n    .replaceAll(/(\\S+)\\[pl:\"(.+?)\"]/g, count > 1 ? '$2' : '$1')\n    .replaceAll(/(\\S+)\\[f:\"(.+?)\"]/g, character.sex == \"Female\" ? '$2' : '$1');\nexport function n3(v) { return withUpToNDigits(v, 3); }\nexport function withUpToNDigits(x, digits) {\n    let str = x.toFixed(digits);\n    while (str.charAt(str.length - 1) === '0')\n        str = str.slice(0, -1);\n    if (str.charAt(str.length - 1) === '.')\n        str = str.slice(0, -1);\n    return str;\n}\nexport function s(v) { return v >= 0 ? '+' + v : v; }\nexport function n3s(v) { return v >= 0 ? '+' + n3(v) : n3(v); }\nexport function n3ss(v) { return v >= 0 ? '+ ' + n3(v) : '- ' + -n3(v); }\nexport function formatFraction(value, config) {\n    if (value === 0)\n        return '0';\n    if (!config.showPreciseAbilityTimings) {\n        const sign = value < 0 ? '-' : '';\n        value = Math.abs(value);\n        let fraction = '';\n        switch (Math.round((value % 1) * 4)) {\n            case 0:\n                if ((value % 1) === 0)\n                    break;\n            case 1: {\n                value = Math.floor(value);\n                fraction = '¼';\n                break;\n            }\n            case 2: {\n                value = Math.floor(value);\n                fraction = '½';\n                break;\n            }\n            case 3: {\n                value = Math.floor(value);\n                fraction = '¾';\n                break;\n            }\n            case 4: {\n                value = Math.ceil(value);\n                break;\n            }\n        }\n        return `${sign}${value > 0 ? value : ''}${fraction}`;\n    }\n    else {\n        return withUpToNDigits(value, 3);\n    }\n}\nexport function formatDuration(value, config) {\n    value /= 1000;\n    if (value >= 3600)\n        return formatFraction(value / 3600, config) + 'h';\n    else if (value > 60)\n        return formatFraction(value / 60, config) + 'min';\n    else\n        return formatFraction(value, config) + 's';\n}\nexport function localizeInternalName(type) {\n    switch (type) {\n        case 'ConditionDuration': return 'Condition Duration';\n        case 'ConditionDamage': return 'Condition Damage';\n        case 'HealingPower': return 'Healing Power';\n        case 'Projectile20': return 'Projectile (20% Chance)';\n        case 'MagicFind': return 'Magic Find';\n        case 'CritChance': return 'Critical Chance';\n        case 'CritDamage': return 'Critical Damage';\n        case 'BoonDuration': return 'Boon Duration';\n        default: return type;\n    }\n}\nexport function findSelfOrParent(self, selector, depth = 10) {\n    let current = self;\n    while (current && depth-- > 0 && !current.matches(selector))\n        current = current.parentElement;\n    if (depth == 0)\n        return null;\n    return current;\n}\nexport function joinWordList(words, quoteWords = false) {\n    if (quoteWords)\n        words = words.map(w => `'${w}'`);\n    switch (words.length) {\n        case 0: return '';\n        case 1: return words[0];\n        default:\n            const last = words[words.length - 1];\n            return words.slice(0, -1).join(', ') + ' and ' + last;\n    }\n}\nexport function IsDevIcon(ico) {\n    return [2141735, 2141736, 2141737].includes(ico);\n}\n//# sourceMappingURL=Utils.js.map","export class FakeAPI {\n    constructor() {\n        this.localAPI = new HSAPI('http://localhost:3000');\n        this.fallbackAPI = new HSAPI();\n        this.localApiOffline = false;\n    }\n    bulkRequest(endpoint, ids) {\n        return this.resolveRequest('bulkRequest', endpoint, ids);\n    }\n    requestId(endpoint, id) {\n        return this.resolveRequest('requestId', endpoint, id);\n    }\n    requestByName(endpoint, search) {\n        return this.resolveRequest('requestByName', endpoint, search);\n    }\n    async resolveRequest(method, endpoint, arg) {\n        try {\n            return await (this.localApiOffline ? this.fallbackAPI : this.localAPI)[method](endpoint, arg);\n        }\n        catch (ex) {\n            if (ex === null || ex === void 0 ? void 0 : ex.message.includes(\"NetworkError\")) {\n                this.localApiOffline = true;\n                console.warn(`[gw2-tooltips] [FakeAPI] Local api seems to be offline, swapping to the real one.\\n${ex}`);\n            }\n            else {\n                console.warn(`[gw2-tooltips] [FakeAPI] Error trying to get ep '${endpoint}' from localhost, will try to use the fallback API.\\n${ex}`);\n            }\n            return await this.fallbackAPI[method](endpoint, arg);\n        }\n    }\n}\nexport class HSAPI {\n    constructor(baseUrl = 'https://gw2-api.hardstuck.gg') {\n        this.baseUrl = baseUrl;\n    }\n    bulkRequest(endpoint, ids) {\n        return fetch(`${this.baseUrl}/${endpoint}?ids=${ids.join(',')}`, HSAPI.WORKER_CACHE_INIT).then(r => r.json());\n    }\n    requestId(endpoint, id) {\n        return fetch(`${this.baseUrl}/${endpoint}/${id}`, HSAPI.WORKER_CACHE_INIT).then(r => r.json());\n    }\n    requestByName(endpoint, search) {\n        return fetch(`${this.baseUrl}/${endpoint}/by-name/${search}`, HSAPI.WORKER_CACHE_INIT).then(r => r.json());\n    }\n}\nHSAPI.WORKER_CACHE_INIT = { headers: { [\"X-TTJS-Worker-Cached\"]: '1' } };\n//# sourceMappingURL=API.js.map","class APICache {\n    static async ensureExistence(endpoint, initialIds, validateResponse) {\n        if (!this.apiImpl) {\n            this.apiImpl = new HSAPI();\n        }\n        let additionalIds = Object.assign({\n            skills: new Set(),\n            items: new Set(),\n            traits: new Set(),\n            pets: new Set(),\n            'pvp/amulets': new Set(),\n            specializations: new Set(),\n            itemstats: new Set(),\n            palettes: new Set(),\n            skins: new Set(),\n            professions: new Set,\n        });\n        {\n            const initialSet = new Set();\n            const storage = this.storage[endpoint];\n            for (const id of initialIds) {\n                if (!storage.has(id))\n                    initialSet.add(id);\n            }\n            if (initialSet.size == 0)\n                return;\n            additionalIds[endpoint] = initialSet;\n        }\n        const findNextRelevantEndpoint = () => {\n            for (const [endpoint, ids] of Object.entries(additionalIds))\n                if (ids.size > 0)\n                    return endpoint;\n            return undefined;\n        };\n        let didCollectPalettes = false;\n        let currentEndpoint = endpoint;\n        let i = 0;\n        do {\n            if (currentEndpoint == 'palettes')\n                didCollectPalettes = true;\n            const storageSet = this.storage[currentEndpoint];\n            const request = Array.from(additionalIds[currentEndpoint].values());\n            additionalIds[currentEndpoint].clear();\n            console.info(`[gw2-tooltips] [API cache] round #${i++} for a ${endpoint} request, currently fetching ${currentEndpoint}. Ids: `, request);\n            try {\n                const response = await this.apiImpl.bulkRequest(currentEndpoint, request);\n                if (validateResponse) {\n                    const unobtainable = request.filter(id => !response.some(obj => obj.id == id));\n                    if (unobtainable.length)\n                        console.warn(`[gw2-tooltips] [API cache] Did not receive all requested ${currentEndpoint} ids. missing: `, unobtainable);\n                }\n                for (const datum of response) {\n                    if (storageSet.has(datum.id))\n                        continue;\n                    storageSet.set(datum.id, datum);\n                    this.collectConnectedIds(datum, additionalIds, didCollectPalettes);\n                }\n            }\n            catch (ex) {\n                console.error(ex);\n            }\n        } while ((currentEndpoint = findNextRelevantEndpoint()) && i < 100);\n    }\n    static collectConnectedIds(datum, connectedIdsStorage, didCollectPalettes) {\n        const addFacts = (facts) => {\n            for (const fact of facts) {\n                if (fact.type == 'Buff' || fact.type == 'BuffBrief') {\n                    if (!this.storage.skills.has(fact.buff))\n                        connectedIdsStorage.skills.add(fact.buff);\n                }\n                if (fact.type === 'PrefixedBuffBrief' || fact.type === 'PrefixedBuff') {\n                    if (!this.storage.skills.has(fact.prefix))\n                        connectedIdsStorage.skills.add(fact.prefix);\n                    if (!this.storage.skills.has(fact.buff))\n                        connectedIdsStorage.skills.add(fact.buff);\n                }\n            }\n        };\n        if (!didCollectPalettes && 'palettes' in datum)\n            for (const palette of datum.palettes) {\n                if (!this.storage.palettes.has(palette))\n                    connectedIdsStorage.palettes.add(palette);\n            }\n        if ('groups' in datum)\n            for (const group of datum.groups) {\n                for (const candidate of group.candidates) {\n                    if (!this.storage.skills.has(candidate.skill))\n                        connectedIdsStorage.skills.add(candidate.skill);\n                }\n            }\n        if ('related_skills' in datum) {\n            for (const subSkill of datum.related_skills)\n                if (!this.storage.skills.has(subSkill))\n                    connectedIdsStorage.skills.add(subSkill);\n        }\n        if ('ambush_skills' in datum) {\n            for (const subSkill of datum.ambush_skills)\n                if (!this.storage.skills.has(subSkill.id))\n                    connectedIdsStorage.skills.add(subSkill.id);\n        }\n        if ('bundle_skills' in datum) {\n            for (const subSkill of datum.bundle_skills)\n                if (!this.storage.skills.has(subSkill))\n                    connectedIdsStorage.skills.add(subSkill);\n        }\n        if ('blocks' in datum)\n            for (const block of datum.blocks) {\n                if (block.facts)\n                    addFacts(block.facts);\n            }\n        if ('override_groups' in datum) {\n            for (const { blocks } of datum.override_groups)\n                if (blocks)\n                    for (const block of blocks)\n                        if (block.facts)\n                            addFacts(block.facts);\n        }\n        if ('attribute_set' in datum) {\n            if (!this.storage.itemstats.has(datum.attribute_set))\n                connectedIdsStorage.itemstats.add(datum.attribute_set);\n        }\n        if ('skills' in datum)\n            for (const subSkillId of datum.skills) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('skills_ai' in datum)\n            for (const subSkillId of datum.skills_ai) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('skills_soulbeast' in datum)\n            for (const subSkillId of datum.skills_soulbeast) {\n                if (!this.storage.skills.has(subSkillId))\n                    connectedIdsStorage.skills.add(subSkillId);\n            }\n        if ('specialization' in datum) {\n            if (!this.storage.specializations.has(datum.specialization))\n                connectedIdsStorage.specializations.add(datum.specialization);\n        }\n        if ('applies_buff' in datum) {\n            if (!this.storage.skills.has(datum.applies_buff.buff))\n                connectedIdsStorage.skills.add(datum.applies_buff.buff);\n        }\n        if ('facts_from_skill' in datum) {\n            if (!this.storage.skills.has(datum.facts_from_skill))\n                connectedIdsStorage.skills.add(datum.facts_from_skill);\n        }\n        if ('trait' in datum) {\n            if (!this.storage.traits.has(datum.trait))\n                connectedIdsStorage.traits.add(datum.trait);\n        }\n        if ('default_skin' in datum) {\n            if (!this.storage.skins.has(datum.default_skin))\n                connectedIdsStorage.skins.add(datum.default_skin);\n        }\n    }\n}\nAPICache.storage = {\n    skills: new Map(),\n    items: new Map(),\n    traits: new Map(),\n    pets: new Map(),\n    'pvp/amulets': new Map(),\n    specializations: new Map(),\n    itemstats: new Map(),\n    palettes: new Map(),\n    skins: new Map(),\n    professions: new Map(),\n};\nexport default APICache;\nimport { HSAPI } from './API';\n//# sourceMappingURL=APICache.js.map","export function recomputeAttributesFromMods(context, weaponSet) {\n    const baseAttributes = ['Power', 'Toughness', 'Vitality', 'Precision', 'Ferocity', 'ConditionDamage', 'Expertise', 'Concentration', 'HealingPower', 'AgonyResistance'];\n    const computedAttributes = ['Health', 'Armor', 'ConditionDuration', 'BoonDuration', 'CritChance', 'CritDamage'];\n    const stats = context.character.statsWithWeapons[weaponSet !== null && weaponSet !== void 0 ? weaponSet : context.character.selectedWeaponSet];\n    const allParts = {};\n    const stage1Attributes = {};\n    const stage2Attributes = {};\n    function additiveModifiers(attributeOrder, convertedAttributes) {\n        for (const attribute of attributeOrder) {\n            const { baseAttribute, suffix, base, conversionOffset, div } = getAttributeInformation(attribute, context.character);\n            let value = base, text;\n            const displayMul = suffix ? 100 : 1;\n            const parts = [];\n            const sources = stats.sources[attribute];\n            allParts[attribute] = { parts, sources };\n            {\n                text = `${n3(base * displayMul) + suffix} base value`;\n                if (base) {\n                    text += ' from lvl 80';\n                }\n                parts.push(newElm('div.detail', text));\n                if (baseAttribute) {\n                    const baseAttrValue = convertedAttributes[baseAttribute];\n                    let attrValue = baseAttrValue - conversionOffset;\n                    const statBonus = attrValue / div;\n                    value += statBonus;\n                    if (statBonus) {\n                        let statSourceText = `${n3(baseAttrValue)} ${localizeInternalName(baseAttribute)}`;\n                        if (conversionOffset)\n                            statSourceText += ` - ${conversionOffset} (attrib. specific offset)`;\n                        text = ` +${n3(statBonus * displayMul) + suffix} from `;\n                        if (div != 1)\n                            text += (conversionOffset ? `[${statSourceText}]` : statSourceText) + ` / ${div / displayMul} (attrib. specific conv. factor)`;\n                        else\n                            text += statSourceText;\n                        parts.push(newElm('div.detail', text));\n                    }\n                }\n            }\n            let modValue = 0;\n            for (const source of sources.filter(s => !s.modifier.flags.includes('FormatPercent'))) {\n                const mod = calculateModifier(source.modifier, context.character.level, stage1Attributes) * source.count;\n                modValue += mod;\n                text = ` +${n3(mod)} from `;\n                if (source.count > 1)\n                    text += `${source.count} `;\n                text += source.source;\n                parts.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n            }\n            value += modValue;\n            stage1Attributes[attribute] = value;\n        }\n    }\n    function conversionModifiers(attributeOrder) {\n        for (const attribute of attributeOrder) {\n            const { parts, sources } = allParts[attribute];\n            let modValue = 0;\n            for (const source of sources.filter(s => s.modifier.flags.includes('FormatPercent') && s.modifier.source_attribute)) {\n                const mod = calculateModifier(source.modifier, context.character.level, stage1Attributes) * source.count;\n                modValue += Math.round(mod);\n                let text = ` +${n3(mod)} (${n3(source.modifier.base_amount)}% of ${source.modifier.source_attribute}) from `;\n                if (source.count > 1)\n                    text += `${source.count} `;\n                text += source.source;\n                parts.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n            }\n            stage2Attributes[attribute] = stage1Attributes[attribute] + modValue;\n        }\n    }\n    additiveModifiers(baseAttributes, stage1Attributes);\n    conversionModifiers(baseAttributes);\n    additiveModifiers(computedAttributes, stage2Attributes);\n    conversionModifiers(computedAttributes);\n    for (const attributeOrder of [baseAttributes, computedAttributes]) {\n        for (const attribute of attributeOrder) {\n            const { suffix, cap } = getAttributeInformation(attribute, context.character);\n            let value = stage2Attributes[attribute], text;\n            const { parts, sources } = allParts[attribute];\n            const displayMul = suffix ? 100 : 1;\n            for (const source of sources.filter(s => s.modifier.flags.includes('FormatPercent') && !s.modifier.source_attribute)) {\n                const mod = calculateModifier(source.modifier, context.character.level, stage2Attributes) * source.count / 100;\n                const toAdd = suffix ? mod : value * mod;\n                value += toAdd;\n                text = ` +${n3(toAdd * displayMul)}${suffix}`;\n                if (!suffix)\n                    text += ` (${n3(mod * 100)}%)`;\n                text += ' from ';\n                if (source.count > 1)\n                    text += `${source.count} `;\n                text += source.source;\n                parts.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n            }\n            const uncappedValue = value;\n            stage2Attributes[attribute] = value = Math.min(uncappedValue, cap - 1);\n            if (uncappedValue != value)\n                parts.push(newElm('span.detail.capped', `(Capped to ${n3(value * displayMul)}${suffix}! Uncapped value would be ${n3(uncappedValue * displayMul)}${suffix})`));\n            parts.unshift(newElm('h4.title', newElm('span.title-text', ' +' + n3(value * displayMul) + suffix + ' ' + localizeInternalName(attribute))));\n        }\n        for (const attribute of attributeOrder) {\n            stats.values[attribute] = stage2Attributes[attribute];\n            stats.htmlParts[attribute] = allParts[attribute].parts;\n        }\n    }\n}\nconst ATTRIBUTE_INFO_LUT = {\n    Power: [undefined, undefined, 66722, '', 1000, 0, 1, Number.MAX_SAFE_INTEGER],\n    Toughness: [undefined, 'Armor', 104162, '', 1000, 0, 1, Number.MAX_SAFE_INTEGER],\n    Vitality: [undefined, 'Health', 104163, '', 1000, 0, 1, Number.MAX_SAFE_INTEGER],\n    Precision: [undefined, 'CritChance', 156609, '', 1000, 0, 1, Number.MAX_SAFE_INTEGER],\n    Ferocity: [undefined, 'CritDamage', 156602, '', 0, 0, 1, Number.MAX_SAFE_INTEGER],\n    ConditionDamage: [undefined, undefined, 156600, '', 0, 0, 1, Number.MAX_SAFE_INTEGER],\n    Expertise: [undefined, 'ConditionDuration', 156601, '', 0, 0, 1, Number.MAX_SAFE_INTEGER],\n    Concentration: [undefined, 'BoonDuration', 156599, '', 0, 0, 1, Number.MAX_SAFE_INTEGER],\n    HealingPower: [undefined, undefined, 156606, '', 0, 0, 1, Number.MAX_SAFE_INTEGER],\n    AgonyResistance: [undefined, undefined, 536049, '', 0, 0, 1, Number.MAX_SAFE_INTEGER],\n    Health: ['Vitality', undefined, 536052, '', 0, 0, 0.1, Number.MAX_SAFE_INTEGER],\n    Armor: ['Toughness', undefined, 536048, '', 0, 0, 1, Number.MAX_SAFE_INTEGER],\n    ConditionDuration: ['Expertise', undefined, 156601, '%', 0, 0, 1500, 2],\n    BoonDuration: ['Concentration', undefined, 156599, '%', 0, 0, 1500, 2],\n    CritChance: ['Precision', undefined, 536051, '%', 0.05, 1000, 2100, Number.MAX_SAFE_INTEGER],\n    CritDamage: ['Ferocity', undefined, 784327, '%', 1.5, 0, 1500, Number.MAX_SAFE_INTEGER],\n};\nexport function getAttributeInformation(attribute, character) {\n    const _p2 = ATTRIBUTE_INFO_LUT[attribute];\n    let baseAttribute, computedAttribute, img, suffix = '', base = 0, conversionOffset = 0, div = 1, cap = Number.MAX_SAFE_INTEGER;\n    if (_p2)\n        [baseAttribute, computedAttribute, img, suffix, base, conversionOffset, div, cap] = _p2;\n    if (attribute == 'Health')\n        base = getBaseHealth(character);\n    return { baseAttribute, computedAttribute, img, suffix, base, conversionOffset, div, cap };\n}\nexport function getBaseHealth(character) {\n    return !character.profession\n        ? 1000\n        : {\n            Guardian: 1645,\n            Thief: 1645,\n            Elementalist: 1645,\n            Engineer: 5922,\n            Ranger: 5922,\n            Mesmer: 5922,\n            Revenant: 5922,\n            Necromancer: 9212,\n            Warrior: 9212,\n        }[character.profession];\n}\nfunction calculateConditionDuration(level, expertise) {\n    return expertise / (LUT_CRITICAL_DEFENSE[level] * (15 / LUT_CRITICAL_DEFENSE[80]));\n}\nfunction calculateBoonDuration(level, concentration) {\n    return concentration / (LUT_CRITICAL_DEFENSE[level] * (15 / LUT_CRITICAL_DEFENSE[80]));\n}\nexport const LUT_CRITICAL_DEFENSE = [\n    1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3.0, 3.2, 3.4, 3.6, 3.8, 4.0, 4.2, 4.4, 4.6, 4.8, 5.0, 5.2, 5.4, 5.6, 5.8, 6.0, 6.2, 6.4, 6.6, 6.8, 7.0, 7.3, 7.6, 7.9, 8.2, 8.5, 8.8, 9.1, 9.4, 9.7, 10.0, 10.3, 10.6, 10.9, 11.2, 11.5, 11.8, 12.1, 12.4, 12.7, 13.0, 13.4, 13.8, 14.2, 14.6, 15.0, 15.4, 15.8, 16.2, 16.6, 17.0, 17.4, 17.8, 18.2, 18.6, 19.0, 19.4, 19.8, 20.2, 20.6, 21.0, 21.5, 22.0, 22.5, 23.0, 23.5, 24.0, 24.5, 25.0, 25.5, 26.0, 26.5, 27.0, 27.5, 28.0, 28.5, 29.0, 29.5, 30.0, 30.5, 31.0,\n];\nexport const LUT_DEFENSE = [\n    115, 120, 125, 129, 133, 137, 142, 146, 150, 154, 162, 168, 175, 182, 189, 196, 202, 209, 216, 223, 232, 240, 248, 257, 265, 274, 282, 290, 299, 307, 319, 330, 341, 352, 363, 374, 385, 396, 407, 418, 431, 443, 456, 469, 481, 494, 506, 519, 532, 544, 560, 575, 590, 606, 621, 636, 651, 666, 682, 697, 714, 731, 748, 764, 781, 798, 815, 832, 848, 865, 885, 905, 924, 943, 963, 982, 1002, 1021, 1040, 1060, 1081, 1102, 1123, 1144, 1165, 1186, 1207, 1228, 1249, 1270, 1291, 1312, 1333, 1354, 1375, 1396, 1417, 1438, 1459, 1480, 1501,\n];\nexport const LUT_POWER_PLAYER = [\n    170, 173, 176, 179, 182, 185, 188, 191, 194, 197, 202, 207, 212, 217, 222, 227, 232, 237, 242, 247, 253, 259, 265, 271, 277, 283, 289, 295, 301, 307, 315, 323, 331, 339, 347, 355, 363, 371, 379, 387, 396, 405, 414, 423, 432, 441, 450, 459, 468, 477, 488, 499, 510, 521, 532, 543, 554, 565, 576, 587, 599, 611, 623, 635, 647, 659, 671, 683, 695, 707, 721, 735, 749, 763, 777, 791, 805, 819, 833, 847, 862, 877, 892, 907, 922, 937, 952, 967, 982, 997, 1012, 1027, 1042, 1057, 1072, 1087, 1102, 1117, 1132, 1147, 1162,\n];\nexport const LUT_POWER_MONSTER = [\n    162, 179, 197, 214, 231, 249, 267, 286, 303, 322, 344, 367, 389, 394, 402, 412, 439, 454, 469, 483, 500, 517, 556, 575, 593, 612, 622, 632, 672, 684, 728, 744, 761, 778, 820, 839, 885, 905, 924, 943, 991, 1016, 1067, 1093, 1119, 1145, 1193, 1220, 1275, 1304, 1337, 1372, 1427, 1461, 1525, 1562, 1599, 1637, 1692, 1731, 1802, 1848, 1891, 1936, 1999, 2045, 2153, 2201, 2249, 2298, 2368, 2424, 2545, 2604, 2662, 2723, 2792, 2854, 2985, 3047, 3191, 3269, 3348, 3427, 3508, 3589, 3671, 3754, 3838, 3922, 4007, 4093, 4180, 4267, 4356, 4445, 4535, 4625, 4717, 4809, 4902,\n];\nimport { calculateModifier } from \"./FactsProcessor\";\nimport { fromHTML, localizeInternalName, n3, newElm, resolveInflections } from \"./Utils\";\n//# sourceMappingURL=CharacterAttributes.js.map","export var RARITY;\n(function (RARITY) {\n    RARITY[RARITY[\"Junk\"] = 0] = \"Junk\";\n    RARITY[RARITY[\"Basic\"] = 1] = \"Basic\";\n    RARITY[RARITY[\"Fine\"] = 2] = \"Fine\";\n    RARITY[RARITY[\"Masterwork\"] = 3] = \"Masterwork\";\n    RARITY[RARITY[\"Rare\"] = 4] = \"Rare\";\n    RARITY[RARITY[\"Exotic\"] = 5] = \"Exotic\";\n    RARITY[RARITY[\"Ascended\"] = 6] = \"Ascended\";\n    RARITY[RARITY[\"Legendary\"] = 7] = \"Legendary\";\n})(RARITY || (RARITY = {}));\n;\nexport const LUT_RARITY = [0, 0, 1, 2, 3, 4, 4, 4];\nexport const LUT_RARITY_MUL = [0.5, 0.65, 0.8, 0.85, 0.9, 1.0, 1.05, 1.05];\nexport const LUT_WEAPON_STRENGTH = {\n    BundleLarge: 0,\n    Standard: 690.5,\n    Focus: 900,\n    Shield: 900,\n    Torch: 900,\n    Warhorn: 900,\n    Greatsword: 1100,\n    Hammer: 1100,\n    Staff: 1100,\n    Longbow: 1050,\n    Rifle: 1150,\n    Shortbow: 1000,\n    Axe: 1000,\n    Sword: 1000,\n    Dagger: 1000,\n    Pistol: 1000,\n    Scepter: 1000,\n    Mace: 1000,\n    Spear: 1000,\n    Speargun: 1000,\n    Trident: 1000,\n};\nexport const ICONS = {\n    CoinCopper: 156902,\n    CoinSilver: 156907,\n    CoinGold: 156904,\n    SlotUpgrade: 517197,\n    SlotInfusion: 517202,\n    SlotEnrichment: 517204,\n    ResourceThief: 156649,\n    ResourceRevenant: 156647,\n    CostUpkeep: 156058,\n    CostSupply: 2111003,\n    CostEndurance: 156649,\n    NoUnderwater: 358417,\n    Recharge: 156651,\n    Activation: 496252,\n    Range: 156666,\n    DefianceBreak: 1938788,\n    WeaponSwap: 156583,\n    Barrier: 1770209,\n    StunBreak: 156654,\n    Knockdown: 2440716,\n    Pull: 2440717,\n    Knockback: 2440715,\n    Launch: 2440712,\n    Float: 2440713,\n    Sink: 2440714,\n};\nexport const PROFESSIONS = ['Guardian', 'Warrior', 'Engineer', 'Ranger', 'Thief', 'Elementalist', 'Mesmer', 'Necromancer', 'Revenant'];\n;\nexport const WIKI_SEARCH_URL = 'https://wiki-en.guildwars2.com/wiki/Special:Search/';\nexport const VALID_CHAIN_PALETTES = ['Bundle', 'Heal', 'Elite', 'Profession', 'Standard', 'Equipment'];\nexport const DEFAULT_CONFIG = {\n    autoInitialize: true,\n    autoCollectRuneCounts: false,\n    autoCollectStatSources: false,\n    autoCollectSelectedTraits: false,\n    autoRecomputeCharacterAttributes: false,\n    adjustIncorrectStatIds: false,\n    adjustWikiLinks: true,\n    autoInferEquipmentUpgrades: false,\n    autoInferWeaponSetAssociation: false,\n    legacyCompatibility: true,\n    showPreciseAbilityTimings: false,\n    showFactComputationDetail: false,\n    globalKeyBinds: true,\n    validateApiResponses: true,\n};\nexport const DEFAULT_CONTEXT = {\n    gameMode: 'Pve',\n    underwater: false,\n    targetArmor: 2597,\n    character: {\n        level: 80,\n        isPlayer: true,\n        sex: \"Male\",\n        traits: new Set(),\n        specializations: new Set(),\n        stats: {\n            values: {\n                Power: 0,\n                Toughness: 0,\n                Vitality: 0,\n                Precision: 0,\n                Ferocity: 0,\n                ConditionDamage: 0,\n                Expertise: 0,\n                Concentration: 0,\n                HealingPower: 0,\n                AgonyResistance: 0,\n            },\n            sources: {\n                Power: [],\n                Toughness: [],\n                Vitality: [],\n                Precision: [],\n                Ferocity: [],\n                ConditionDamage: [],\n                Expertise: [],\n                Concentration: [],\n                HealingPower: [],\n                AgonyResistance: [],\n                Armor: [],\n                Damage: [],\n                LifeForce: [],\n                Health: [],\n                HealEffectiveness: [],\n                Stun: [],\n                ConditionDuration: [],\n                BoonDuration: [],\n                CritChance: [],\n                CritDamage: [],\n            },\n        },\n        statsWithWeapons: [{\n                values: {\n                    Power: 1000,\n                    Toughness: 1000,\n                    Vitality: 1000,\n                    Precision: 1000,\n                    Ferocity: 0,\n                    ConditionDamage: 0,\n                    Expertise: 0,\n                    Concentration: 0,\n                    HealingPower: 0,\n                    AgonyResistance: 0,\n                    Health: 10000,\n                    Armor: 1000,\n                    CritChance: 0.05,\n                    CritDamage: 1.5,\n                    ConditionDuration: 0,\n                    BoonDuration: 0,\n                },\n                sources: {\n                    Power: [],\n                    Toughness: [],\n                    Vitality: [],\n                    Precision: [],\n                    Ferocity: [],\n                    ConditionDamage: [],\n                    Expertise: [],\n                    Concentration: [],\n                    HealingPower: [],\n                    AgonyResistance: [],\n                    Armor: [],\n                    Damage: [],\n                    LifeForce: [],\n                    Health: [],\n                    HealEffectiveness: [],\n                    Stun: [],\n                    ConditionDuration: [],\n                    BoonDuration: [],\n                    CritChance: [],\n                    CritDamage: [],\n                },\n                htmlParts: {\n                    Power: [],\n                    Toughness: [],\n                    Vitality: [],\n                    Precision: [],\n                    Ferocity: [],\n                    ConditionDamage: [],\n                    Expertise: [],\n                    Concentration: [],\n                    HealingPower: [],\n                    AgonyResistance: [],\n                    Armor: [],\n                    Health: [],\n                    ConditionDuration: [],\n                    BoonDuration: [],\n                    CritChance: [],\n                    CritDamage: [],\n                },\n            }],\n        selectedWeaponSet: 0,\n        upgradeCounts: {},\n    },\n};\nexport const MISSING_ITEM = {\n    id: 0,\n    name: 'Missing Item',\n    description: '<c=@warning>This Item failed to load</c>',\n    rarity: \"Fine\",\n    type: \"UpgradeComponent\", subtype: \"Gem\",\n    flags: [], level: 0, required_level: 0, access_restrictions: [], tiers: [{\n            description: '<c=@warning>This Item failed to load</c>',\n        }],\n};\nexport const MISSING_BUFF = {\n    id: 0,\n    name: 'Missing Buff',\n    description: '<c=@warning>This Buff failed to load</c>',\n    categories: [], palettes: [], modifiers: [], flags: [],\n};\nexport const MISSING_SKILL = {\n    id: 0,\n    name: 'Missing Skill',\n    description: '<c=@warning>This Skill failed to load</c>',\n    categories: [], palettes: [], modifiers: [], flags: [],\n};\nexport const EMPTY_SKIN = {\n    id: 0,\n    type: 'Back',\n    subtype: 'Default',\n    rarity: 'Basic',\n    flags: ['HidePrefix'],\n    access_restrictions: [], dye_channels: [null, null, null, null]\n};\n//# sourceMappingURL=Constants.js.map","export function calculateModifier(modifier, level, stats) {\n    if (modifier.source_attribute) {\n        return stats[modifier.source_attribute] * modifier.base_amount / 100;\n    }\n    let attribute = 0;\n    switch (modifier.formula) {\n        case 'NoScaling':\n            level = 0;\n            break;\n        case 'SpawnScaleLinear':\n        case 'TargetLevelLinear':\n        case 'BuffLevelLinear':\n            break;\n        case 'BuffFormulaType11':\n            attribute = -1;\n            break;\n        case 'ConditionDamageSquared': level = level * level;\n        case 'ConditionDamage':\n            attribute = stats.ConditionDamage;\n            break;\n        case 'HealingPowerSquared': level = level * level;\n        case 'HealingPower':\n            attribute = stats.HealingPower;\n            break;\n        case 'PowerSquared': level = level * level;\n        case 'Power':\n            attribute = stats.Power;\n            break;\n        case 'FerocitySquared': level = level * level;\n        case 'Ferocity':\n            attribute = stats.Ferocity;\n            break;\n        default:\n            console.warn('[gw2-tooltips] [facts processor] Could not find formula #', modifier.formula, ', using base amount for now!');\n            level = 0;\n    }\n    return modifier.base_amount + level * modifier.formula_param1 + attribute * modifier.formula_param2;\n}\nexport function generateFacts(blocks, weaponStrength, context, weaponSet) {\n    const [looseBlock, ...remainingBlocks] = blocks;\n    let totalDefianceBreak = 0;\n    const makeFactElements = (facts) => (!facts ? [] : facts\n        .sort((a, b) => a.order - b.order)\n        .map(fact => {\n        const { wrapper, defiance_break } = generateFact(fact, weaponStrength, context, weaponSet);\n        totalDefianceBreak += defiance_break;\n        if (wrapper)\n            wrapper.dataset.order = String(fact.order);\n        return wrapper;\n    })\n        .filter(d => d));\n    const elements = [];\n    for (const block of remainingBlocks) {\n        const wrapper = newElm('div.fact-block');\n        if (block.trait_requirements) {\n            const trait_names = joinWordList(block.trait_requirements.map(id => { var _a; return `'<span class=\"gw2-color-traited-fact\">${((_a = APICache.storage.traits.get(id)) === null || _a === void 0 ? void 0 : _a.name) || id}</span>'`; }));\n            wrapper.append(fromHTML(`<span class=\"detail\">Block exists because of trait${block.trait_requirements.length == 1 ? '' : 's'} ${trait_names}</span>`));\n        }\n        if (block.description)\n            wrapper.append(newElm('p.description', fromHTML(GW2Text2HTML(block.description))));\n        const blockFacts = makeFactElements(block.facts);\n        wrapper.append(...blockFacts);\n        elements.push(wrapper);\n    }\n    if (looseBlock)\n        elements.push(...makeFactElements(looseBlock.facts));\n    if (totalDefianceBreak > 0) {\n        const defianceWrap = newElm('div.fact', newImg(ICONS.DefianceBreak, 'iconmed'), newElm('div.gw2-color-defiance-fact', `Total Defiance Break: ${withUpToNDigits(totalDefianceBreak, 2)}`));\n        let i = 0;\n        for (; i < elements.length; i++) {\n            const s = elements[i].dataset.order;\n            if (s && parseInt(s) > 1003)\n                break;\n        }\n        elements.splice(i, 0, defianceWrap);\n    }\n    return elements;\n}\nexport function generateFact(fact, weaponStrength, context, weaponSet, itemMode = false) {\n    let iconSlug = fact.icon;\n    let buffStackSize = 1;\n    let buffDuration = fact.duration;\n    let defiance_break_per_s = fact.defiance_break;\n    let activeModSources = context.character.statsWithWeapons[weaponSet].sources;\n    let activeStats = context.character.statsWithWeapons[weaponSet].values;\n    const generateBuffDescription = (buff, fact, duration, valueMod) => {\n        let modsArray = [];\n        if (buff.modifiers && !buff.description_brief) {\n            const relevantModifiers = buff.modifiers.filter(modifier => ((!modifier.source_trait_req || context.character.traits.has(modifier.source_trait_req))\n                && (!modifier.target_trait_req || context.character.traits.has(modifier.target_trait_req))\n                && (!modifier.mode || modifier.mode === context.gameMode)));\n            let modsMap = new Map();\n            for (let i = 0; i < relevantModifiers.length; i++) {\n                const modifier = relevantModifiers[i];\n                let entry = modsMap.get(modifier.id);\n                if (!entry)\n                    modsMap.set(modifier.id, entry = { modifier: modifier, value: 0 });\n                let value = calculateModifier(modifier, context.character.level, activeStats);\n                if (modifier.source_attribute) {\n                    value *= activeStats[modifier.source_attribute];\n                }\n                entry.value += value;\n                if (modifier.flags.includes('SkipNextEntry')) {\n                    i++;\n                }\n            }\n            for (let { value, modifier } of modsMap.values()) {\n                if (modifier.flags.includes('Subtract')) {\n                    value -= 100;\n                }\n                if (duration && modifier.flags.includes('MulByDuration')) {\n                    let this_duration = duration / 1000;\n                    if (modifier.flags.includes('DivDurationBy3')) {\n                        this_duration /= 3;\n                    }\n                    if (modifier.flags.includes('DivDurationBy10')) {\n                        this_duration /= 10;\n                    }\n                    value *= this_duration;\n                }\n                if (!modifier.flags.includes('NonStacking')) {\n                    value *= fact.apply_count;\n                }\n                if (modifier.formula.includes('Regeneration'))\n                    value *= valueMod;\n                let strValue = modifier.flags.includes('FormatFraction')\n                    ? formatFraction(value, config)\n                    : Math.floor(Math.fround(value)).toString();\n                if (modifier.flags.includes('FormatPercent')) {\n                    if (value > 0) {\n                        strValue = '+' + strValue;\n                    }\n                    strValue += '%';\n                }\n                strValue += ' ' + modifier.description;\n                if (typeof modifier.target === 'string') {\n                    const { computedAttribute } = getAttributeInformation(modifier.target, context.character);\n                    if (computedAttribute) {\n                        const { div, suffix } = getAttributeInformation(computedAttribute, context.character);\n                        const displayMul = suffix ? 100 : 1;\n                        strValue += ` <span class=\"detail\">(converts to ${n3(value / div * displayMul)}${suffix} ${localizeInternalName(computedAttribute)})</span>`;\n                    }\n                }\n                modsArray.push(strValue);\n            }\n        }\n        return GW2Text2HTML(buff.description_brief || modsArray.join(', ') || buff.description);\n    };\n    const applyMods = (baseDuration, buff, detailStack) => {\n        let durMod = 1, valueMod = 1, cap = Number.MAX_SAFE_INTEGER;\n        const durationAttr = (buff.buff_type == 'Boon' && 'BoonDuration') || (buff.buff_type == 'Condition' && 'ConditionDuration');\n        if (durationAttr) {\n            const { baseAttribute, div, cap: cap_ } = getAttributeInformation(durationAttr, context.character);\n            cap = cap_;\n            const attribVal = activeStats[baseAttribute];\n            durMod += attribVal / div;\n            if (attribVal > 0 && config.showFactComputationDetail) {\n                detailStack.push(`base duration: ${n3(baseDuration / 1000)}s`);\n                detailStack.push(`+ ${n3(baseDuration / 1000 * attribVal / div)}s (${n3(attribVal / div * 100)}%) from ${n3(attribVal)} ${baseAttribute}`);\n            }\n            for (const source of activeModSources[durationAttr]) {\n                let mod = calculateModifier(source.modifier, context.character.level, activeStats) * source.count;\n                const innerSuffix = source.modifier.flags.includes('FormatPercent') ? '%' : '';\n                const displayMul = innerSuffix ? 100 : 1;\n                mod /= displayMul;\n                durMod += mod;\n                const toAdd = innerSuffix ? mod * baseDuration : mod;\n                if (config.showFactComputationDetail) {\n                    let text = `+ ${n3(toAdd / 1000)}s`;\n                    if (innerSuffix)\n                        text += ` (${n3(mod * displayMul)}%)`;\n                    text += ' from ';\n                    if (source.count > 1)\n                        text += `${source.count} `;\n                    text += source.source;\n                    detailStack.push(newElm('div.detail', fromHTML(resolveInflections(text, source.count, context.character))));\n                }\n            }\n        }\n        let durModStack = activeModSources[buff.id];\n        if (durModStack) {\n            if (durMod === 1 && config.showFactComputationDetail)\n                detailStack.push(`base duration: ${n3(baseDuration / 1000)}s`);\n            let percentMod = 0;\n            for (const { source, modifier, count } of durModStack) {\n                const mod = calculateModifier(modifier, context.character.level, activeStats);\n                if (config.showFactComputationDetail)\n                    detailStack.push(newElm('span.detail', `${n3ss(baseDuration / 1000 * mod / 100)}s (${n3(mod)}%) from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                percentMod += mod;\n            }\n            durMod += percentMod / 100;\n        }\n        const uncappedMod = durMod;\n        durMod = Math.min(uncappedMod, cap);\n        if (durMod != uncappedMod && config.showFactComputationDetail) {\n            detailStack.push(newElm('span.detail', `(Capped to ${n3(baseDuration / 1000 * cap)}s! Uncapped duration would be ${n3(baseDuration / 1000 * uncappedMod)}s)`));\n        }\n        baseDuration *= durMod;\n        if (buff.name.includes('Regeneration')) {\n            let valueModStack = activeModSources.HealEffectiveness;\n            if (valueModStack.length) {\n                if (config.showFactComputationDetail)\n                    detailStack.push('regeneration value mods:');\n                let percentMod = 0;\n                for (const { source, modifier, count } of valueModStack) {\n                    let mod = calculateModifier(modifier, context.character.level, activeStats);\n                    if (modifier.source_attribute)\n                        mod *= 100;\n                    if (config.showFactComputationDetail) {\n                        const conversion = modifier.source_attribute\n                            ? `${n3ss(mod)}% from ${n3(modifier.base_amount)} * ${n3(activeStats[modifier.source_attribute])} ${localizeInternalName(modifier.source_attribute)}`\n                            : `${n3ss(mod)}%`;\n                        detailStack.push(newElm('span.detail', `${conversion} from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    }\n                    percentMod += mod;\n                }\n                valueMod += percentMod / 100;\n            }\n        }\n        return [baseDuration, valueMod];\n    };\n    const factInflators = {\n        AdjustByAttributeAndLevel: ({ fact }) => {\n            var _a;\n            let value = (fact.value + context.character.level ** fact.level_exponent * fact.level_multiplier) * fact.hit_count;\n            let attributeVal = 0;\n            if (fact.attribute) {\n                attributeVal = activeStats[fact.attribute];\n                value += attributeVal * fact.attribute_multiplier * fact.hit_count;\n            }\n            const lines = [];\n            if (config.showFactComputationDetail) {\n                lines.push(`${n3(fact.value)} base value`);\n                if (fact.level_multiplier)\n                    lines.push(`+ ${n3(context.character.level ** fact.level_exponent * fact.level_multiplier)} from lvl ${context.character.level} ^ ${n3(fact.level_exponent)} lvl exp. * ${n3(fact.level_multiplier)} lvl mul.`);\n                if (fact.attribute)\n                    lines.push(`+ ${n3(attributeVal * fact.attribute_multiplier)} from ${n3(attributeVal)} ${localizeInternalName(fact.attribute)} * ${n3(fact.attribute_multiplier)} attrib. mod.`);\n                if (fact.hit_count != 1)\n                    lines.push(` * ${fact.hit_count} hits`);\n            }\n            if ((_a = fact.text) === null || _a === void 0 ? void 0 : _a.includes('Heal')) {\n                let percentMod = 100;\n                for (const { source, modifier, count } of activeModSources.HealEffectiveness) {\n                    let mod = calculateModifier(modifier, context.character.level, activeStats);\n                    if (modifier.source_attribute)\n                        mod *= 100;\n                    if (config.showFactComputationDetail) {\n                        const conversion = modifier.source_attribute\n                            ? `${n3(mod)}% from ${n3(modifier.base_amount)} * ${n3(activeStats[modifier.source_attribute])} ${localizeInternalName(modifier.source_attribute)}`\n                            : `${n3(mod)}%`;\n                        lines.push(newElm('span.detail', `${n3ss(mod / 100 * value)} (${conversion}) from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    }\n                    percentMod += mod;\n                }\n                value *= percentMod / 100;\n            }\n            lines.unshift(`${GW2Text2HTML(fact.text) || localizeInternalName(fact.attribute)}: ${Math.round(value)}`);\n            return lines;\n        },\n        AttributeAdjust: ({ fact }) => {\n            const value = Math.round((fact.range[1] - fact.range[0]) / (context.character.level / 80) + fact.range[0]);\n            const parts = [`${GW2Text2HTML(fact.text) || localizeInternalName(fact.target)}: ${n3s(value)}`];\n            const { computedAttribute } = getAttributeInformation(fact.target, context.character);\n            if (computedAttribute) {\n                const { div, suffix } = getAttributeInformation(computedAttribute, context.character);\n                const displayMul = suffix ? 100 : 1;\n                parts.push(`(converts to ${n3(value / div * displayMul)}${suffix} ${localizeInternalName(computedAttribute)})`);\n            }\n            return parts;\n        },\n        Buff: ({ fact, buff }) => {\n            if (!buff) {\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n                buff = MISSING_BUFF;\n            }\n            iconSlug = buff.icon || iconSlug;\n            const parts = [];\n            let valueMod;\n            [buffDuration, valueMod] = applyMods(fact.duration, buff, parts);\n            let buffDescription = generateBuffDescription(buff, fact, buffDuration, valueMod);\n            if (buffDescription) {\n                if (itemMode)\n                    buffDescription = `:<div style=\"margin-left: 0.5em;\">${buffDescription}</div>`;\n                else\n                    buffDescription = `: ${buffDescription}`;\n            }\n            const seconds = buffDuration > 0 ? ` (${formatDuration(buffDuration, config)})` : '';\n            parts.unshift(`${GW2Text2HTML(resolveInflections(fact.text || buff.name_brief || buff.name, -1, context.character))}${seconds}${buffDescription}`);\n            buffStackSize = fact.apply_count;\n            return parts;\n        },\n        BuffBrief: ({ fact, buff }) => {\n            if (!buff) {\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n                buff = MISSING_BUFF;\n            }\n            iconSlug = buff.icon || iconSlug;\n            return [`${GW2Text2HTML(fact.text, buff.name)}`];\n        },\n        Distance: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${Math.round(fact.distance)}`];\n        },\n        Number: ({ fact: { text, value } }) => {\n            const lines = [];\n            if (defiance_break_per_s && text && text.includes('Defiance')) {\n                if (activeModSources.Stun.length) {\n                    if (config.showFactComputationDetail)\n                        lines.push(`${n3(value)} base value`);\n                    let percentMod = 100;\n                    for (const { source, modifier, count } of activeModSources.Stun) {\n                        const mod = calculateModifier(modifier, context.character.level, activeStats);\n                        if (config.showFactComputationDetail)\n                            lines.push(newElm('span.detail', `${n3ss(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                        percentMod += mod;\n                    }\n                    const mod = percentMod / 100;\n                    value *= mod;\n                    defiance_break_per_s *= mod;\n                }\n            }\n            lines.unshift(`${GW2Text2HTML(text)}: ${formatFraction(value, config)}`);\n            return lines;\n        },\n        Percent: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${formatFraction(fact.percent, config)}%`];\n        },\n        PercentHpSelfDamage: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${Math.floor(activeStats.Health * fact.percent / 100)} (${formatFraction(fact.percent, config)}% HP pool)`];\n        },\n        PercentLifeForceCost: ({ fact: { percent, text } }) => {\n            const hpPool = getBaseHealth(context.character);\n            const lines = [];\n            lines.push(`${GW2Text2HTML(text)}: ${n3(Math.round(hpPool * percent * 0.01))}`);\n            if (config.showFactComputationDetail)\n                lines.push(`from ${n3(percent)}% * ${n3(hpPool)} HP base pool`);\n            return lines;\n        },\n        PercentHealth: ({ fact: { percent, text } }) => {\n            const raw = Math.round(activeStats.Health * percent * 0.01);\n            return [`${GW2Text2HTML(text)}: ${formatFraction(percent, config)}% (${raw} HP)`];\n        },\n        PercentLifeForceGain: ({ fact: { percent, text } }) => {\n            const hpPool = activeStats.Health;\n            const lines = [];\n            if (config.showFactComputationDetail) {\n                lines.push(`${n3(percent * 0.01 * hpPool * 0.69)} from ${n3(percent)}% * (${n3(hpPool)} HP * 0.69) pool (${n3(getBaseHealth(context.character))} base pool modified by ${n3(activeStats.Vitality)} Vitality)`);\n            }\n            if (activeModSources.LifeForce.length) {\n                let percentMod = 100;\n                for (const { source, modifier, count } of activeModSources.LifeForce) {\n                    const mod = calculateModifier(modifier, context.character.level, activeStats);\n                    if (config.showFactComputationDetail)\n                        lines.push(newElm('span.detail', `${n3ss(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                percent *= percentMod / 100;\n            }\n            lines.unshift(`${GW2Text2HTML(text)}: ${formatFraction(percent, config)}% (${Math.round(hpPool * 0.69 * percent * 0.01)})`);\n            return lines;\n        },\n        Damage: ({ fact: { dmg_multiplier, hit_count, text }, weaponStrength }) => {\n            const lines = [];\n            let damage = dmg_multiplier * hit_count * weaponStrength * activeStats.Power / context.targetArmor;\n            if (config.showFactComputationDetail) {\n                lines.push(`${n3(damage)} from ${n3(dmg_multiplier)} internal mod. * ${n3(activeStats.Power)} power * ${weaponStrength} avg. weapon str. / ${context.targetArmor} target armor`);\n                if (hit_count != 1)\n                    lines.push(`* ${hit_count} hits`);\n            }\n            const critChance = Math.min(0.05 + (activeStats.Precision - 1000) / 21 * 0.01, 1);\n            const critDamage = 1.5 + activeStats.Ferocity / 15 * 0.01;\n            const moreDmgFromCrit = damage * critChance * (critDamage - 1);\n            damage += moreDmgFromCrit;\n            if (config.showFactComputationDetail) {\n                lines.push(`+ ${n3(moreDmgFromCrit)} (${n3(critChance * (critDamage - 1) * 100)}%) from ${n3(critChance * 100)}% crit chance and ${n3(critDamage * 100)}% damage on crit (${n3(activeStats.Precision)} precision and ${n3(activeStats.Ferocity)} ferocity)`);\n            }\n            if (activeModSources.Damage.length) {\n                let percentMod = 100;\n                for (const { source, modifier, count } of activeModSources.Damage) {\n                    const mod = calculateModifier(modifier, context.character.level, activeStats);\n                    if (config.showFactComputationDetail)\n                        lines.push(newElm('span.detail', `${n3ss(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                    percentMod += mod;\n                }\n                damage *= percentMod / 100;\n            }\n            const times = hit_count > 1 ? `(${hit_count}x)` : '';\n            lines.unshift(`${GW2Text2HTML(text)}${times}: ${Math.round(damage)}`);\n            return lines;\n        },\n        Time: ({ fact: { text } }) => {\n            const lines = [];\n            if (defiance_break_per_s && text && (text.includes('Stun') || text.includes('Daze')\n                || text.includes('Defiance'))) {\n                const modifiers = activeModSources.Stun;\n                if (modifiers.length) {\n                    if (config.showFactComputationDetail)\n                        lines.push(`${n3(buffDuration / 1000)}s base duration`);\n                    let percentMod = 100;\n                    for (const { source, modifier, count } of modifiers) {\n                        const mod = calculateModifier(modifier, context.character.level, activeStats);\n                        if (config.showFactComputationDetail)\n                            lines.push(newElm('span.detail', `${n3ss(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                        percentMod += mod;\n                    }\n                    buffDuration *= percentMod / 100;\n                }\n            }\n            const time = buffDuration != 1000 ? 'seconds' : 'second';\n            lines.unshift(`${GW2Text2HTML(text)}: ${formatFraction(buffDuration / 1000, config)} ${time}`);\n            return lines;\n        },\n        ComboField: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${localizeInternalName(fact.field_type)}`];\n        },\n        ComboFinisher: ({ fact }) => {\n            return [`${GW2Text2HTML(fact.text)}: ${localizeInternalName(fact.finisher_type)}`];\n        },\n        AttributeConversion: ({ fact }) => {\n            return [`Gain ${localizeInternalName(fact.target)} Based on a Percentage of ${localizeInternalName(fact.source)}: ${fact.percent}%`];\n        },\n        NoData: ({ fact }) => {\n            return [GW2Text2HTML(fact.text)];\n        },\n        PrefixedBuff: ({ fact, buff }) => {\n            let prefix = APICache.storage.skills.get(fact.prefix);\n            if (!prefix) {\n                console.error('[gw2-tooltips] [facts processor] prefix #', fact.prefix, ' is apparently missing in the cache');\n                prefix = MISSING_BUFF;\n            }\n            iconSlug = prefix.icon || iconSlug;\n            if (!buff) {\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n                buff = MISSING_BUFF;\n            }\n            let { duration, apply_count, text } = fact;\n            const parts = [];\n            let valueMod;\n            [buffDuration, valueMod] = applyMods(duration, buff, parts);\n            let buffDescription = generateBuffDescription(buff, fact, buffDuration, valueMod);\n            if (buffDescription) {\n                buffDescription = `: ${buffDescription}`;\n            }\n            const seconds = buffDuration > 0 ? ` (${formatDuration(buffDuration, config)})` : '';\n            parts.unshift(newElm('div.fact', generateBuffIcon(buff.icon, apply_count), newElm('span', fromHTML(`${GW2Text2HTML(text) || buff.name_brief || buff.name}${seconds}${buffDescription}`))));\n            return parts;\n        },\n        PrefixedBuffBrief: ({ fact, buff }) => {\n            let prefix = APICache.storage.skills.get(fact.prefix);\n            if (!prefix) {\n                console.error('[gw2-tooltips] [facts processor] prefix #', fact.prefix, ' is apparently missing in the cache');\n                prefix = MISSING_BUFF;\n            }\n            iconSlug = prefix.icon || iconSlug;\n            if (!buff) {\n                console.error('[gw2-tooltips] [facts processor] buff #', fact.buff, ' is apparently missing in the cache');\n                buff = MISSING_BUFF;\n            }\n            let node = newElm('div.fact', newImg(buff.icon), newElm('span', `${GW2Text2HTML(fact.text) || buff.name_brief || buff.name}`));\n            return [node];\n        },\n        Range: ({ fact: { min, max } }) => {\n            return [`Range: ${min ? `${min} - ${max}` : max}`];\n        },\n        StunBreak: () => {\n            return [\"Breaks Stun\"];\n        },\n    };\n    const buff = APICache.storage.skills.get(fact.buff || 0);\n    const data = { fact, buff, weaponStrength: weaponStrength };\n    const [firstLine, ...remainingDetail] = factInflators[fact.type](data);\n    const wrapper = newElm('div.fact');\n    if (fact.requires_trait) {\n        wrapper.classList.add('gw2-color-traited-fact');\n    }\n    let defianceBreak = 0;\n    if (defiance_break_per_s) {\n        let effectiveBuffDuration = buffDuration || 1000;\n        let breakDetail = '';\n        if (buffDuration < 1000 && fact.text && (fact.text.includes('Stun') || fact.text.includes('Daze') || fact.text.includes('Float') || fact.text.includes('Knockdown'))) {\n            effectiveBuffDuration = 1000;\n            breakDetail = ' (hard CC -> min = 100)';\n        }\n        else if (effectiveBuffDuration != 1000) {\n            breakDetail = ` (${fact.defiance_break}/s)`;\n        }\n        defianceBreak = defiance_break_per_s * effectiveBuffDuration / 1000;\n        remainingDetail.push(newElm('span.detail.gw2-color-defiance-fact', `Defiance Break: ${withUpToNDigits(defianceBreak, 2)}${breakDetail}`));\n    }\n    if (fact.requires_trait) {\n        const trait_names = joinWordList(fact.requires_trait.map(id => { var _a; return `'<span class=\"gw2-color-traited-fact\">${((_a = APICache.storage.traits.get(id)) === null || _a === void 0 ? void 0 : _a.name) || id}</span>'`; }));\n        remainingDetail.unshift(fromHTML(`<span class=\"detail\">${(fact.skip_next && (fact.skip_next > 1 || !fact.__gamemode_override_marker)) ? 'overridden' : 'exists'} because of trait${fact.requires_trait.length == 1 ? '' : 's'} ${trait_names}</span>`));\n    }\n    wrapper.append(generateBuffIcon(iconSlug, buffStackSize));\n    wrapper.append(newElm('div', newElm('span', typeof firstLine == 'string' && firstLine.includes('<') ? fromHTML(firstLine) : firstLine), ...remainingDetail.map(d => typeof d == 'string' ? newElm('span.detail', d) : d)));\n    return { wrapper, defiance_break: defianceBreak };\n}\nexport function generateBuffIcon(icon, stackSize = 1) {\n    const img = newImg(icon);\n    if (stackSize == 1) {\n        return img;\n    }\n    else {\n        const wrap = newElm('span.buff-ico', img);\n        wrap.setAttribute('count', String(stackSize));\n        return wrap;\n    }\n}\nimport { newElm, newImg, formatFraction, GW2Text2HTML, withUpToNDigits, localizeInternalName, joinWordList, fromHTML, n3, resolveInflections, formatDuration, n3s, n3ss } from './Utils';\nimport APICache from './APICache';\nimport { config } from './TooltipsV2';\nimport { getAttributeInformation, getBaseHealth } from './CharacterAttributes';\nimport { ICONS, MISSING_BUFF } from './Constants';\n//# sourceMappingURL=FactsProcessor.js.map","export function allUpgradeCounts(scope, mode = 1) {\n    const elements = scope.getElementsByTagName('gw2object');\n    for (const pair of contexts.entries()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('context-set')) || 0) == pair[0]);\n        if (elsInCorrectCtx.length)\n            _upgradeCounts(...pair, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('context-set')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificUpgradeCounts(contextIndex, targetContext, scope, mode = 1) {\n    _upgradeCounts(contextIndex, targetContext, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _upgradeCounts(contextIndex, targetContext, elements, mode) {\n    const counts = {};\n    for (const element of elements) {\n        let id;\n        if (element.getAttribute('type') !== 'item' || !(id = +String(element.getAttribute('objid'))))\n            continue;\n        const item = APICache.storage.items.get(id);\n        if (!item || !('subtype' in item) || (!['Rune', 'Infusion'].includes(item.subtype)))\n            continue;\n        let amountToAdd = 1;\n        if (item.subtype == \"Infusion\") {\n            if (!(amountToAdd = +String(element.getAttribute('count')))) {\n                if (config.legacyCompatibility) {\n                    amountToAdd = _legacy_getInfusionCount(element);\n                    if (!amountToAdd)\n                        continue;\n                }\n            }\n            if (!amountToAdd) {\n                console.warn(\"[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement \", element, \". Will not assume anything and just ignore the stack.\");\n                continue;\n            }\n        }\n        else if (targetContext.gameMode == \"Pvp\" && item.subtype == 'Rune') {\n            amountToAdd = 6;\n        }\n        counts[item.id] = (counts[item.id] || 0) + amountToAdd;\n    }\n    switch (mode) {\n        case 0:\n            targetContext.character.upgradeCounts = counts;\n            break;\n        case 1:\n            targetContext.character.upgradeCounts = Object.assign(targetContext.character.upgradeCounts, counts);\n            break;\n    }\n}\nexport function allStatSources(scope, mode = 1) {\n    const elements = scope.getElementsByTagName('gw2object');\n    for (const contextIndex of contexts.keys()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('context-set')) || 0) == contextIndex);\n        if (elsInCorrectCtx.length)\n            _statSources(contextIndex, contexts, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('context-set')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificStatSources(contextIndex, scope, mode = 1) {\n    _statSources(contextIndex, contexts, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _statSources(contextIndex, contexts, elements, mode) {\n    const context = contexts[contextIndex];\n    const baseSources = structuredClone(DEFAULT_CONTEXT.character.stats.sources);\n    const weaponSetSources = [];\n    const baseUpgrades = {};\n    const weaponSetUpgrades = [];\n    const actualInfusionCounts = contexts.map(ctx => {\n        let total = 0;\n        const counts = {};\n        for (let [id, c] of Object.entries(ctx.character.upgradeCounts)) {\n            let item;\n            if ((item = APICache.storage.items.get(+id)) && 'subtype' in item && item.subtype == 'Infusion') {\n                c = Math.min(c, 18);\n                counts[id] = c;\n                total += c;\n            }\n        }\n        let tooMany = Math.max(0, total - 18);\n        for (let stop = 100; tooMany > 0 && stop > 0; stop--) {\n            for (const [id, c] of Object.entries(counts).sort((a, b) => b[1] - a[1])) {\n                if (c > 2) {\n                    const toRemove = (c & 1) ? 1 : 2;\n                    counts[id] -= toRemove;\n                    tooMany -= toRemove;\n                    if (tooMany <= 0)\n                        break;\n                }\n            }\n        }\n        return counts;\n    });\n    for (const element of elements) {\n        const id = +String(element.getAttribute('objid'));\n        if (!id)\n            continue;\n        const type = element.getAttribute('type');\n        const weaponSetId = +String(element.getAttribute('weapon-set'));\n        let amountToAdd = 1;\n        let tiersToProcess, item, tierNumber, sourceRuneSuffix;\n        if (type == 'item') {\n            item = APICache.storage.items.get(id);\n            if (!item || !('subtype' in item))\n                continue;\n            if (item.type === 'UpgradeComponent' || item.type === 'Consumable') {\n                let tiersToAdd = 1;\n                if (item.subtype === 'Rune' && item.flags.includes('Pvp')) {\n                    tiersToAdd = 6;\n                }\n                const upgrades = isNaN(weaponSetId) ? baseUpgrades : (weaponSetUpgrades[weaponSetId] || (weaponSetUpgrades[weaponSetId] = {}));\n                tierNumber = upgrades[item.id] = (upgrades[item.id] || 0) + tiersToAdd;\n                if (item.subtype === 'Rune') {\n                    sourceRuneSuffix = true;\n                    if (tierNumber > 6) {\n                        if (!context.character.upgradeCounts[item.id])\n                            console.warn(\"[gw2-tooltips] [collect] Found more than 6 runes of the same type. Here is the 7th rune element: \", element);\n                        continue;\n                    }\n                    if (item.flags.includes('Pvp'))\n                        tiersToProcess = item.tiers;\n                    else\n                        tiersToProcess = [item.tiers[tierNumber - 1]];\n                }\n                else if ('applies_buff' in item) {\n                    const buff = APICache.storage.skills.get(item.applies_buff.buff);\n                    if (!buff) {\n                        console.warn(`[gw2-tooltips] [collect] Failed to resolve applied buff ${item.applies_buff} for `, element, \". Will not assume anything and just ignore the item.\");\n                        continue;\n                    }\n                    tiersToProcess = [{ modifiers: buff.modifiers }];\n                }\n                else if ('tiers' in item) {\n                    if (item.subtype == 'Infusion' || item.subtype == 'Enrichment') {\n                        if (!(amountToAdd = +String(element.getAttribute('count')))) {\n                            if (config.legacyCompatibility) {\n                                amountToAdd = _legacy_getInfusionCount(element);\n                                if (!amountToAdd)\n                                    continue;\n                            }\n                        }\n                        if (!amountToAdd) {\n                            console.warn(\"[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement \", element, \". Will not assume anything and just ignore the stack.\");\n                            continue;\n                        }\n                    }\n                    else if (item.subtype === 'Sigil' && tierNumber > 1) {\n                        console.warn(\"[gw2-tooltips] [collect] Found more than 1 sigils of the same type on the same weapon set. Here is the 2nd sigil element: \", element);\n                        continue;\n                    }\n                    tiersToProcess = item.tiers;\n                }\n            }\n        }\n        else if (type == 'pvp/amulet') {\n            item = APICache.storage['pvp/amulets'].get(id);\n            if (!item)\n                continue;\n        }\n        let attributeSet = item && (context.gameMode !== 'Pvp' || (item.type === 'Trinket' && item.subtype === 'Amulet')) && findCorrectAttributeSet(item, +String(element.getAttribute('stats')) || undefined);\n        if (attributeSet) {\n            tiersToProcess = [{\n                    modifiers: attributeSet.attributes.map(a => ({\n                        target: a.attribute,\n                        base_amount: Math.round(a.base_value + item.attribute_base * a.scaling),\n                        formula: \"NoScaling\",\n                        flags: [], id: -1, formula_param1: 0, formula_param2: 0, description: '',\n                    }))\n                }];\n        }\n        if (item && 'defense' in item) {\n            const defense = (typeof item.defense == \"number\")\n                ? item.defense\n                : LUT_DEFENSE[Math.min(100, (item.defense[0] + context.character.level))] * item.defense[1];\n            if (!tiersToProcess)\n                tiersToProcess = [{ modifiers: [] }];\n            tiersToProcess[0].modifiers.push({\n                target: 'Armor',\n                base_amount: Math.ceil(defense),\n                formula: \"NoScaling\",\n                flags: [], id: -1, formula_param1: 0, formula_param2: 0, description: '',\n            });\n        }\n        let targetSources = baseSources;\n        if (isNaN(weaponSetId) && item && item.type == \"UpgradeComponent\") {\n            const override = actualInfusionCounts[contextIndex][item.id];\n            if (override) {\n                amountToAdd = override;\n            }\n            else if (amountToAdd > 18) {\n                amountToAdd = 18;\n            }\n        }\n        if (!isNaN(weaponSetId)) {\n            targetSources = weaponSetSources[weaponSetId] || (weaponSetSources[weaponSetId] = structuredClone(DEFAULT_CONTEXT.character.stats.sources));\n        }\n        if (tiersToProcess)\n            for (const [i, tier] of tiersToProcess.entries()) {\n                if (tier.modifiers)\n                    for (const mod of tier.modifiers) {\n                        if (!mod.target || !isModApplicable(mod, context))\n                            continue;\n                        const skin = getActiveSkin(item, element);\n                        let source = formatItemName(item, context, skin, attributeSet, undefined, -1);\n                        if (sourceRuneSuffix) {\n                            source = `${source} (Tier ${tiersToProcess.length === 1 ? tierNumber : i + 1} Bonus)`;\n                        }\n                        (targetSources[mod.target] || (targetSources[mod.target] = []))\n                            .push({ modifier: mod, source, count: amountToAdd });\n                    }\n            }\n    }\n    const character = context.character;\n    const overwriteWeaponStatSources = () => {\n        for (let [i, specificSources] of weaponSetSources.entries()) {\n            const target = character.statsWithWeapons[i];\n            if (target)\n                target.sources = specificSources;\n            else\n                character.statsWithWeapons[i] = {\n                    sources: specificSources,\n                    values: Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values),\n                    htmlParts: structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].htmlParts),\n                };\n        }\n    };\n    switch (mode) {\n        case 0:\n            character.stats.sources = baseSources;\n            overwriteWeaponStatSources();\n            break;\n        case 1:\n            {\n                mergeSources(character.stats.sources, baseSources);\n                for (const [i, sources] of weaponSetSources.entries()) {\n                    const wTarget = character.statsWithWeapons[i];\n                    if (wTarget) {\n                        mergeSources(wTarget.sources, sources);\n                    }\n                    else {\n                        character.statsWithWeapons[i] = {\n                            sources,\n                            values: Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values),\n                            htmlParts: structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].htmlParts),\n                        };\n                    }\n                }\n            }\n            break;\n    }\n}\nfunction _legacy_getInfusionCount(element) {\n    var _a, _b;\n    const ownIndex = Array.prototype.indexOf.call(element.parentElement.children, element);\n    const amountEl = element.parentElement.getElementsByClassName('amount')[ownIndex];\n    if (!amountEl) {\n        console.warn(\"[gw2-tooltips] [collect] `legacyCompatibility` is active, but no amount element for infusion \", element, \" could be found. Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    const amountToAdd = +String((_b = (_a = amountEl.textContent) === null || _a === void 0 ? void 0 : _a.match(/\\d+/)) === null || _b === void 0 ? void 0 : _b[0]);\n    if (!amountToAdd) {\n        console.warn(\"[gw2-tooltips] [collect] [legacyCompatibility] Amount element \", amountEl, \" for infusion element \", element, \" did not contain any readable amount. Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    if (amountToAdd < 1 || amountToAdd > 20) {\n        console.warn(\"[gw2-tooltips] [collect] [legacyCompatibility] Amount element \", amountEl, \" for infusion element \", element, \" did got interpreted as x\", amountToAdd, \" which is outside of the range of sensible values (amount in [1...20]). Will not assume anything and just ignore the stack.\");\n        return;\n    }\n    return amountToAdd;\n}\nexport function allTraits(scope, mode = 1) {\n    const elements = scope.querySelectorAll('gw2object[type=specialization]:not(.gw2objectembed)');\n    for (const pair of contexts.entries()) {\n        const elsInCorrectCtx = Array.from(elements).filter(e => (+String(e.getAttribute('context-set')) || 0) == pair[0]);\n        if (elsInCorrectCtx.length)\n            _traits(...pair, elsInCorrectCtx, mode);\n    }\n    const elsWithWrongCtx = Array.from(elements).filter(e => (+String(e.getAttribute('context-set')) || 0) >= contexts.length);\n    if (elsWithWrongCtx.length) {\n        console.warn(\"[gw2-tooltips] [collect] Some targets in scope \", scope, \" have the wrong context: \", elsWithWrongCtx);\n    }\n}\nexport function specificTraits(contextIndex, targetContext, scope, mode = 1) {\n    _traits(contextIndex, targetContext, scope.getElementsByTagName('gw2object'), mode);\n}\nfunction _traits(contextIndex, targetContext, elements, mode) {\n    if (mode === 0) {\n        targetContext.character.traits = new Set();\n        targetContext.character.specializations = new Set();\n    }\n    const traits = targetContext.character.traits;\n    const specializations = targetContext.character.specializations;\n    for (const specialization of elements) {\n        const specId = +String(specialization.getAttribute('objid'));\n        if (!isNaN(specId)) {\n            specializations.add(specId);\n        }\n        const selectedPositions = String(specialization.getAttribute('selected_traits')).split(',').map(i => +i).filter(i => !isNaN(i) && 0 <= i && i <= 2);\n        if (selectedPositions.length != 3) {\n            console.warn(\"[gw2-tooltips] [collect] Specialization object \", specialization, \" does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\\\"0,2,1\\\"` where the numbers are 0-2 indicating top, middle or bottom selection. Will not assume anything and just ignore the element.\");\n            continue;\n        }\n        for (const [x, y] of selectedPositions.entries()) {\n            {\n                const traitEl = specialization.children[1 + x * 2].children[y];\n                let id;\n                if (!traitEl || !(id = +String(traitEl.getAttribute('objid')))) {\n                    console.warn(\"[gw2-tooltips] [collect] Trait object \", traitEl, \" is selected but does not exist or does not have an objid set. Add the attribute as `objid=\\\"1234\\\"`. Will not assume anything and just ignore the element.\");\n                    continue;\n                }\n                traits.add(id);\n            }\n            {\n                const traitEl = specialization.children[x * 2];\n                let id;\n                if (!(id = +String(traitEl.getAttribute('objid')))) {\n                    console.warn(\"[gw2-tooltips] [collect] Minor trait object \", traitEl, \" does not have an objid set. Add the attribute as `objid=\\\"1234\\\"`. Will not assume anything and just ignore the element.\");\n                    continue;\n                }\n                traits.add(id);\n            }\n        }\n    }\n}\nexport function traitEffects(contexts) {\n    for (const context of contexts) {\n        for (const traitId of context.character.traits) {\n            const trait = APICache.storage.traits.get(traitId);\n            if (!trait) {\n                console.error(`[gw2-tooltips] [collect] Trait #${traitId} is apparently missing in the cache.`);\n                continue;\n            }\n            const addModifiers = (modifiers) => {\n                for (const mod of modifiers) {\n                    if (!mod.target || !isModApplicable(mod, context))\n                        continue;\n                    (context.character.stats.sources[mod.target] || (context.character.stats.sources[mod.target] = []))\n                        .push({ source: `trait '<span class=\"gw2-color-traited-fact\">${trait.name}</span>'`, modifier: mod, count: 1 });\n                }\n            };\n            if (trait.modifiers)\n                addModifiers(trait.modifiers);\n            const contextBoundInfo = resolveTraitsAndOverrides(trait, context);\n            if (contextBoundInfo.blocks)\n                for (const block of contextBoundInfo.blocks)\n                    if (block.facts)\n                        for (const fact of block.facts) {\n                            if (!('buff' in fact))\n                                continue;\n                            const buff = APICache.storage.skills.get(fact.buff);\n                            if (!buff) {\n                                console.error(`[gw2-tooltips] [collect] Buff #${fact.buff} required for trait effect collection is apparently missing in the cache.`);\n                                continue;\n                            }\n                            if (buff.modifiers && !['Boon', 'Condition'].includes(buff.buff_type)) {\n                                console.info(`[gw2-tooltips] [collect] [trait-effects] ${trait.name} applies ${buff.buff_type} ${buff.name}: ${buff.modifiers.length} mods`);\n                                addModifiers(buff.modifiers);\n                            }\n                        }\n        }\n    }\n}\nexport function hoistGeneralSources(character) {\n    for (const specializedStats of character.statsWithWeapons) {\n        mergeSources(specializedStats.sources, character.stats.sources, true);\n    }\n}\nfunction mergeSources(prependOnto, copySource, prepend = false) {\n    for (const [k, v] of Object.entries(copySource)) {\n        let t = prependOnto[k];\n        if (t !== undefined) {\n            if (prepend)\n                t.splice(0, 0, ...v);\n            else\n                t.push(...v);\n        }\n        else\n            prependOnto[k] = v.slice();\n    }\n}\nfunction isModApplicable(mod, context) {\n    return (!mod.mode || mod.mode === context.gameMode) && (!mod.source_trait_req || context.character.traits.has(mod.source_trait_req)) && (!mod.target_trait_req || context.character.traits.has(mod.target_trait_req));\n}\nimport APICache from \"./APICache\";\nimport { LUT_DEFENSE } from \"./CharacterAttributes\";\nimport { resolveTraitsAndOverrides, config, formatItemName, contexts, findCorrectAttributeSet, getActiveSkin } from './TooltipsV2';\nimport { DEFAULT_CONTEXT } from './Constants';\n//# sourceMappingURL=Collect.js.map","export function inflateGenericIcon(element, data, force = false) {\n    if (!force && element.childElementCount > 0)\n        return;\n    const wikiLink = newElm('a', newImg(data.icon, undefined, data.name));\n    wikiLink.href = WIKI_SEARCH_URL + resolveInflections(GW2Text2HTML(data.name), 1, { sex: \"Male\" });\n    wikiLink.target = '_blank';\n    if (element.classList.contains('gw2objectembed') && !element.classList.contains('icononly')) {\n        const stackSize = +String(element.getAttribute('count')) || 1;\n        const context = contexts[+String(element.getAttribute('context-set')) || 0];\n        wikiLink.append(resolveInflections(element.textContent || GW2Text2HTML(data.name), stackSize, context.character));\n    }\n    element.replaceChildren(wikiLink);\n}\nexport function inflateSkill(gw2Object, skill) {\n    const contextSet = +String(gw2Object.getAttribute('context-set')) || 0;\n    const context = specializeContextFromInlineAttribs(contexts[contextSet], gw2Object);\n    let force = false;\n    if (gw2Object.classList.contains('auto-transform')) {\n        const replacementSkill = findTraitedOverride(skill, context);\n        if (replacementSkill) {\n            gw2Object.setAttribute('og-objid', String(skill.id));\n            gw2Object.setAttribute('objid', String(replacementSkill.id));\n            skill = replacementSkill;\n            force = true;\n        }\n    }\n    inflateGenericIcon(gw2Object, skill, force);\n}\nexport function inflateItem(element, item) {\n    if (element.childElementCount > 0)\n        return;\n    const stackSize = +String(element.getAttribute('count')) || 1;\n    const context = contexts[+String(element.getAttribute('context-set')) || 0];\n    const skin = getActiveSkin(item, element);\n    const wikiLink = newElm('a', newImg((skin === null || skin === void 0 ? void 0 : skin.icon) || item.icon, undefined, item.name));\n    wikiLink.href = WIKI_SEARCH_URL + resolveInflections(GW2Text2HTML(item.name), 1, { sex: \"Male\" });\n    wikiLink.target = '_blank';\n    if (element.classList.contains('gw2objectembed')) {\n        wikiLink.append(formatItemName(item, context, skin, undefined, undefined, stackSize));\n    }\n    element.append(wikiLink);\n}\nexport function inflateSpecialization(element, spec) {\n    if (element.classList.contains('gw2objectembed')) {\n        inflateGenericIcon(element, spec);\n    }\n    else {\n        element.style.backgroundImage = `url(${formatImageUrl(spec.background)})`;\n        element.dataset.label = spec.name;\n        const selectedPositions = String(element.getAttribute('selected_traits')).split(',').map(i => +i).filter(i => !isNaN(i) && 0 <= i && i <= 2);\n        if (selectedPositions.length != 3) {\n            console.warn(\"[gw2-tooltips] [inflator] Specialization object \", element, \" does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\\\"0,2,1\\\"` where the numbers are 0-2 indicating top, middle or bottom selection.\");\n            return;\n        }\n        for (const [x, y] of selectedPositions.entries()) {\n            const column = element.children[1 + x * 2];\n            if (!column) {\n                console.warn(\"[gw2-tooltips] [inflator] Cannot mark selected trait object in column #\", x, \" for specialization object \", element, \" because the column doesn't seem to exist. Either mark the specialization object as inline or add the missing column.\");\n                continue;\n            }\n            for (const [i, traitEl] of Array.prototype.entries.call(column.children)) {\n                traitEl.classList.toggle('trait_unselected', i !== y);\n            }\n        }\n    }\n}\nexport function inflateAttribute(element, attribute) {\n    const { character } = contexts[+String(element.getAttribute('context-set')) || 0];\n    const value = character.statsWithWeapons[character.selectedWeaponSet].values[attribute];\n    const _p = {\n        Power: [66722, ''],\n        Toughness: [104162, ''],\n        Vitality: [104163, ''],\n        Precision: [156609, ''],\n        Ferocity: [156602, ''],\n        ConditionDamage: [156600, ''],\n        Expertise: [156601, ''],\n        Concentration: [156599, ''],\n        HealingPower: [156606, ''],\n        AgonyResistance: [536049, ''],\n        Health: [536052, ''],\n        Armor: [536048, ''],\n        ConditionDuration: [156601, '%'],\n        BoonDuration: [156599, '%'],\n        CritChance: [536051, '%'],\n        CritDamage: [784327, '%'],\n        MagicFind: [536054, '%'],\n    }[attribute];\n    let img, suffix = '';\n    if (_p)\n        [img, suffix] = _p;\n    else {\n        console.warn(`[gw2-tooltips] [inflator] Unknown attribute '${attribute}' on object `, element);\n    }\n    const displayMul = suffix ? 100 : 1;\n    let search = localizeInternalName(attribute);\n    if (attribute == 'Profession') {\n        search = \"Attribute#Profession_Attributes\";\n    }\n    const wikiLink = newElm('a', newImg(img));\n    wikiLink.href = WIKI_SEARCH_URL + search;\n    wikiLink.target = '_blank';\n    if (element.classList.contains('gw2objectembed')) {\n        if (value !== undefined) {\n            wikiLink.append(withUpToNDigits(value * displayMul, 1) + suffix);\n        }\n        else {\n            wikiLink.append('???' + suffix);\n        }\n    }\n    element.replaceChildren(wikiLink);\n}\nexport function inflateProfession(element, profession) {\n    if (element.childElementCount > 0)\n        return;\n    const wikiLink = newElm('a', newImg(profession.icon_big, undefined, profession.name));\n    wikiLink.href = WIKI_SEARCH_URL + profession.name;\n    wikiLink.target = '_blank';\n    if (element.classList.contains('gw2objectembed'))\n        wikiLink.append(profession.name);\n    element.append(wikiLink);\n}\nexport function inferItemUpgrades(wrappers) {\n    const remainingInfusionsByContext = contexts.map(ctx => {\n        const counts = {};\n        for (const [id, c] of Object.entries(ctx.character.upgradeCounts)) {\n            let item;\n            if ((item = APICache.storage.items.get(+id)) && 'subtype' in item && item.subtype == 'Infusion')\n                counts[+id] = c;\n        }\n        return counts;\n    });\n    const enrichmentByContext = contexts.map(ctx => {\n        for (const [id, c] of Object.entries(ctx.character.upgradeCounts)) {\n            let item;\n            if ((item = APICache.storage.items.get(+id)) && 'subtype' in item && item.subtype == 'Enrichment')\n                return id;\n        }\n    });\n    for (const wrapper of wrappers) {\n        if (wrapper.childElementCount < 2)\n            continue;\n        const [itemEl, ...upgradeEls] = wrapper.children;\n        if (itemEl.getAttribute('type') !== 'item')\n            continue;\n        const itemCtx = +String(itemEl.getAttribute('context-set')) || 0;\n        const upgradeIds = upgradeEls.filter(u => u.getAttribute('type') === 'item' && u.getAttribute('objid')\n            && (+String(itemEl.getAttribute('context-set')) || 0) === itemCtx)\n            .map(u => u.getAttribute('objid'));\n        {\n            let id, item;\n            if ((id = +String(itemEl.getAttribute('objid'))) && (item = APICache.storage.items.get(id)) && 'slots' in item) {\n                for (const slot of item.slots) {\n                    if (slot == 'Infusion') {\n                        const remainingInfusions = remainingInfusionsByContext[itemCtx];\n                        for (const infusionId of Object.keys(remainingInfusions)) {\n                            upgradeIds.push(infusionId);\n                            if (--remainingInfusions[infusionId] < 1) {\n                                delete remainingInfusions[infusionId];\n                            }\n                            break;\n                        }\n                    }\n                    else if (slot == 'Enrichment') {\n                        const enrichment = enrichmentByContext[itemCtx];\n                        if (enrichment)\n                            upgradeIds.push(enrichment);\n                    }\n                }\n            }\n        }\n        const attrString = upgradeIds.join(',');\n        if (attrString)\n            itemEl.setAttribute('slotted', attrString);\n    }\n}\nimport APICache from \"./APICache\";\nimport { GW2Text2HTML, formatImageUrl, localizeInternalName, newElm, newImg, resolveInflections, withUpToNDigits } from \"./Utils\";\nimport { contexts, findTraitedOverride, formatItemName, getActiveSkin, specializeContextFromInlineAttribs } from \"./TooltipsV2\";\nimport { WIKI_SEARCH_URL } from \"./Constants\";\n//# sourceMappingURL=Inflators.js.map","export function transformEffectToSkillObject(element, error_store) {\n    const name = String(element.getAttribute('objId'));\n    let id = LUT_EFFECT_IDS[name];\n    if (!id) {\n        const hardCoded = LUT_HARDCODED_EFFECTS[name];\n        if (hardCoded) {\n            id = hardCoded.id;\n            APICache.storage.skills.set(id, hardCoded);\n        }\n    }\n    if (id) {\n        element.setAttribute('type', 'skill');\n        element.setAttribute('objId', String(id));\n        return id;\n    }\n    else {\n        element.innerText = name;\n        element.title = `Failed to translate effect '${name}'.`;\n        element.style.cursor = \"help\";\n        element.classList.add('error');\n        error_store.add(name);\n        return 0;\n    }\n}\nconst LUT_EFFECT_IDS = {\n    chaos_aura: 10332,\n    dark_aura: 39978,\n    fire_aura: 5677,\n    frost_aura: 5579,\n    light_aura: 25518,\n    magnetic_aura: 5684,\n    shocking_aura: 5577,\n    aegis: 743,\n    alac: 30328,\n    alacrity: 30328,\n    fury: 725,\n    might: 740,\n    prot: 717,\n    protection: 717,\n    quick: 1187,\n    quickness: 1187,\n    regen: 718,\n    regeneration: 718,\n    resistance: 26980,\n    resolution: 873,\n    stab: 1122,\n    stability: 1122,\n    swiftness: 719,\n    vigor: 726,\n    bleed: 736,\n    bleeding: 736,\n    blind: 720,\n    blinded: 720,\n    blindness: 720,\n    burn: 737,\n    burning: 737,\n    burned: 737,\n    chill: 722,\n    chilled: 722,\n    confusion: 861,\n    confused: 861,\n    cripple: 721,\n    crippled: 721,\n    fear: 896,\n    feared: 896,\n    immob: 727,\n    immobilise: 727,\n    immobilize: 727,\n    immobilised: 727,\n    immobilized: 727,\n    poison: 723,\n    poisoned: 723,\n    slow: 26766,\n    slowed: 26766,\n    taunt: 27705,\n    taunted: 27705,\n    torment: 19426,\n    tormented: 19426,\n    vuln: 738,\n    vulnerability: 738,\n    weakness: 742,\n    weakened: 742,\n    daze: 833,\n    stun: 872,\n    agony: 15773,\n    invulnerability: 56227,\n    revealed: 890,\n    stealth: 58026,\n    superspeed: 5974,\n    unblockable: 18843,\n    blight: 62653,\n    bloodstone_blessed: 34917,\n    blue_pylon_power: 31413,\n    champion_of_the_legions: 20845,\n    compromised: 35096,\n    crowd_favor: 36173,\n    curse_of_frailty: 53723,\n    debilitated: 67972,\n    debilitating_void: 64967,\n    defense_up: 28482,\n    derangement: 34965,\n    elemental_empowerment: 62733,\n    empowering_auras: 62939,\n    equalization_matrix: 67047,\n    expose_weakness: 26660,\n    exposed: 28778,\n    extreme_vulnerability: 65662,\n    fixated: 47434,\n    growing_rage_ashym: 3362,\n    ignite: 16259,\n    intervention: 35061,\n    necrosis: 47414,\n    not_sticking_together: 54378,\n    nova: 39193,\n    ooze_pheromone: 21538,\n    photon_saturation: 67872,\n    positive_flow: 66665,\n    power_of_the_void: 65601,\n    reinforced_armor: 9283,\n    relentless_fire: 62805,\n    retaliation_ashym: 24646,\n    sentinel_retribution: 16350,\n    shattering_ice: 62909,\n    shell_shocked: 33361,\n    spectral_darkness: 31498,\n    sticking_together: 54604,\n    synchronized_vitality: 63840,\n    unnatural_signet: 38224,\n    use_soul_binder: 55630,\n    void_empowerment: 68083,\n    xeras_embrace: 34979,\n};\nconst LUT_HARDCODED_EFFECTS = {\n    barrier: {\n        id: Number.MAX_SAFE_INTEGER - 1,\n        name: 'Barrier',\n        icon: ICONS.Barrier,\n        description: \"Creates a health barrier that takes damage prior to the health bar. Barrier disappears 5s after being applied. Applying a barrier while one is already active will add to it, but the previously-existing barrier will still disappear 5s after it was originally applied. The amount of barrier generated is based on the source's healing power, and is capped at 50% of the recipient's maximum health.\",\n        description_brief: \"Creates a health barrier that takes damage prior to the health bar.\",\n        categories: [], palettes: [], flags: [],\n    },\n    stunbreak: {\n        id: Number.MAX_SAFE_INTEGER - 2,\n        name: 'Stun Break',\n        description: 'Cancel control effects such as stuns.',\n        icon: ICONS.StunBreak,\n        categories: [], palettes: [], flags: [],\n    },\n    knockdown: {\n        id: Number.MAX_SAFE_INTEGER - 3,\n        name: 'Knockdown',\n        description: 'Knocks the target on ground, preventing movement and actions for a short duration.',\n        icon: ICONS.Knockdown,\n        categories: [], palettes: [], flags: [],\n    },\n    pull: {\n        id: Number.MAX_SAFE_INTEGER - 4,\n        name: 'Pull',\n        description: 'Pulls the caster to the target or the target to a specific location and disables them for a short duration.',\n        icon: ICONS.Pull,\n        categories: [], palettes: [], flags: [],\n    },\n    knockback: {\n        id: Number.MAX_SAFE_INTEGER - 5,\n        name: 'Knockback',\n        description: 'Knocks back the target away and on the ground, preventing movement and actions for a short duration.',\n        icon: ICONS.Knockback,\n        categories: [], palettes: [], flags: [],\n    },\n    launch: {\n        id: Number.MAX_SAFE_INTEGER - 6,\n        name: 'Launch',\n        description: 'Throws the target in the air over a short distance, preventing movement and actions for a short duration. Can move Downed targets.',\n        icon: ICONS.Launch,\n        categories: [], palettes: [], flags: [],\n    },\n    float: {\n        id: Number.MAX_SAFE_INTEGER - 7,\n        name: 'Float',\n        description: 'Causes the target to float in the air, preventing movement and actions for a short duration. Causes underwater targets to move up.',\n        icon: ICONS.Float,\n        categories: [], palettes: [], flags: [],\n    },\n    sink: {\n        id: Number.MAX_SAFE_INTEGER - 8,\n        name: 'Sink',\n        description: 'Causes the underwater target to move downwards.',\n        icon: ICONS.Sink,\n        categories: [], palettes: [], flags: [],\n    },\n};\nimport APICache from \"./APICache\";\nimport { ICONS } from \"./Constants\";\n//# sourceMappingURL=EffectsShim.js.map","export const VERSION = 0;\nlet tooltip;\nlet lastTooltipTarget;\nlet cyclePos = 0;\nlet lastMouseX;\nlet lastMouseY;\nexport const contexts = [];\nexport let config = null;\nfunction activateSubTooltip(tooltipIndex) {\n    const tooltips = tooltip.children;\n    for (let index = 0; index < tooltips.length; index++) {\n        tooltips[index].classList.toggle('active', index === tooltipIndex);\n    }\n}\nfunction updateAnchorElement(cyclerGw2object, tooltipIndex) {\n    var _a;\n    if (((_a = cyclerGw2object.firstElementChild) === null || _a === void 0 ? void 0 : _a.nodeName) != 'A')\n        return;\n    const tooltip_ = tooltip.children[tooltipIndex];\n    if (tooltip_) {\n        const name = tooltip_.querySelector('.title-text').textContent;\n        if (name && !name.startsWith('((') && !name.startsWith('<#')) {\n            cyclerGw2object.firstElementChild.href = WIKI_SEARCH_URL + name;\n        }\n    }\n}\nfunction scrollSubTooltipIntoView(tooltipIndex, animate = false) {\n    const tooltips = tooltip.children[tooltipIndex];\n    tooltip.style.transition = animate ? 'transform 0.25s' : '';\n    tooltip.style.transform = `translate(0, -${tooltips.offsetTop + tooltips.offsetHeight}px)`;\n}\nfunction positionTooltip(animate = false) {\n    const wpadminbar = document.getElementById('wpadminbar');\n    const topBarHeight = wpadminbar ? wpadminbar.offsetHeight : 0;\n    const marginX = 22;\n    const marginY = 13;\n    const offsetX = 6;\n    const offsetY = 6;\n    const currentSubTooltip = tooltip.children[cyclePos];\n    let tooltipXpos = lastMouseX + offsetX;\n    if (tooltipXpos + tooltip.offsetWidth > document.documentElement.clientWidth - marginX) {\n        tooltipXpos = document.documentElement.clientWidth - (tooltip.offsetWidth + marginX);\n    }\n    let tooltipYpos = lastMouseY - offsetY;\n    if (tooltipYpos - currentSubTooltip.offsetHeight < document.documentElement.scrollTop + topBarHeight + marginY) {\n        if (animate) {\n            tooltip.style.transition += ', top 0.25s';\n            setTimeout(() => tooltip.style.transition = '', 250);\n        }\n        tooltipYpos = document.documentElement.scrollTop + topBarHeight + marginY + currentSubTooltip.offsetHeight;\n    }\n    tooltip.style.left = `${tooltipXpos}px`;\n    tooltip.style.top = `${tooltipYpos}px`;\n}\nexport async function hookDocument(scope, _unused) {\n    var _a;\n    const buildNodes = document.getElementsByClassName('gw2-build-wrapper');\n    if (config.autoCollectSelectedTraits) {\n        if (buildNodes.length)\n            for (const target of buildNodes)\n                Collect.allTraits(target);\n        else {\n            console.warn(\"[gw2-tooltips] [collect] `config.autoCollectSelectedTraits` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.\");\n        }\n    }\n    const gw2Objects = await hookDOMSubtreeSlim(scope);\n    if (config.autoInferWeaponSetAssociation) {\n        for (const buildNode of buildNodes) {\n            for (const [i, setNode] of buildNode.querySelectorAll('.weapon-set').entries()) {\n                for (const objNode of setNode.getElementsByTagName('GW2OBJECT'))\n                    objNode.setAttribute('weapon-set', String(i));\n            }\n            const skillIdsBySet = [];\n            for (const [i, setSkillsNode] of buildNode.querySelectorAll('.skills-weapon-set').entries()) {\n                const skillIds = [];\n                const chainIds = (skill, context, adjustTraitedSkillIds) => {\n                    if (adjustTraitedSkillIds) {\n                        const replacementSkill = findTraitedOverride(skill, context);\n                        if (replacementSkill)\n                            skill = replacementSkill;\n                    }\n                    skillIds.push(skill.id);\n                    let palette, group, i;\n                    [palette, group, i, context] = guessGroupAndContext(skill, context);\n                    if (group) {\n                        let candidate = group.candidates[i];\n                        while (candidate.previous_chain_skill_index) {\n                            const otherCandidate = group.candidates[candidate.previous_chain_skill_index];\n                            if (!canBeSelected(otherCandidate, context))\n                                break;\n                            skillIds.push(otherCandidate.skill);\n                            candidate = otherCandidate;\n                        }\n                        for (let j = 0; j < i; j++) {\n                            const otherCandidate = group.candidates[j];\n                            if (otherCandidate.previous_chain_skill_index != i)\n                                continue;\n                            if (!canBeSelected(otherCandidate, context))\n                                continue;\n                            skillIds.push(otherCandidate.skill);\n                            i = j;\n                            j = -1;\n                        }\n                    }\n                    if (skill.bundle_skills)\n                        for (const subSkillId of skill.bundle_skills) {\n                            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n                            if (subSkillInChain)\n                                skillIds.push(subSkillId);\n                        }\n                    if (skill.related_skills)\n                        for (const subSkillId of skill.related_skills) {\n                            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n                            if (subSkillInChain && subSkillInChain.palettes.some(pid => {\n                                const palette = APICache.storage.palettes.get(pid);\n                                return palette && VALID_CHAIN_PALETTES.includes(palette.type);\n                            })) {\n                                skillIds.push(subSkillId);\n                            }\n                        }\n                    if (skill.ambush_skills)\n                        for (const { id: subSkillId } of skill.ambush_skills) {\n                            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n                            if (subSkillInChain)\n                                skillIds.push(subSkillId);\n                        }\n                };\n                for (const objNode of setSkillsNode.children) {\n                    objNode.setAttribute('weapon-set', String(i));\n                    const skill = APICache.storage.skills.get(+String(objNode.getAttribute('objid')));\n                    const context = contexts[+String(objNode.getAttribute('context-set')) || 0];\n                    const adjustTraitedSkillIds = objNode.classList.contains('auto-transform');\n                    if (skill)\n                        chainIds(skill, context, adjustTraitedSkillIds);\n                    else {\n                        console.warn(\"[gw2-tooltips] [collect] failed to find skill for object \", objNode);\n                    }\n                }\n                skillIdsBySet.push(skillIds);\n            }\n            if (skillIdsBySet.length > 1 && (skillIdsBySet[0][0] != skillIdsBySet[1][0] || skillIdsBySet[0][skillIdsBySet[0].length - 1] != skillIdsBySet[1][skillIdsBySet[1].length - 1])) {\n                console.info(\"[gw2-tooltips] [collect] Will mark the following skills as belonging to weapon sets: \", skillIdsBySet);\n                const descriptionNode = (_a = buildNode.parentElement.nextElementSibling) === null || _a === void 0 ? void 0 : _a.nextElementSibling;\n                if (descriptionNode)\n                    for (const skillNode of descriptionNode.querySelectorAll('gw2object[type=skill]')) {\n                        const id = +String(skillNode.getAttribute('objid')) || 0;\n                        if (id)\n                            for (const [i, skills] of skillIdsBySet.entries()) {\n                                if (skills.includes(id))\n                                    skillNode.setAttribute('weapon-set', String(i));\n                            }\n                    }\n            }\n        }\n    }\n    if (config.autoCollectRuneCounts) {\n        if (buildNodes.length)\n            for (const target of buildNodes)\n                Collect.allUpgradeCounts(target);\n        else {\n            console.warn(\"[gw2-tooltips] [collect] `config.autoCollectRuneCounts` is active, but no element with class `gw2-build` could be found to use as source. Upgrades will not be collected as there is no way to tell which upgrades belongs to the build and which ones are just in some arbitrary text.\");\n        }\n    }\n    if (config.autoCollectStatSources) {\n        if (buildNodes.length)\n            for (const target of buildNodes)\n                Collect.allStatSources(target);\n        else {\n            console.warn(\"[gw2-tooltips] [collect] `config.autoCollectStatSources` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.\");\n        }\n    }\n    if (config.autoCollectSelectedTraits) {\n        Collect.traitEffects(contexts);\n    }\n    if (config.autoInferEquipmentUpgrades) {\n        const targets = document.querySelectorAll('.weapon, .armor, .trinket');\n        if (targets.length)\n            inferItemUpgrades(targets);\n        else {\n            console.warn(\"[gw2-tooltips] [collect] `config.autoInferEquipmentUpgrades` is active, but no wrapper elements element with class `'weapon`, `armor` or `trinket` could be found to use as source. No elements will be updated\");\n        }\n    }\n    for (const { character } of contexts) {\n        Collect.hoistGeneralSources(character);\n    }\n    if (config.autoRecomputeCharacterAttributes) {\n        for (const context of contexts) {\n            for (const weaponSetId of context.character.statsWithWeapons.keys()) {\n                recomputeAttributesFromMods(context, weaponSetId);\n            }\n        }\n    }\n    for (const [attribute, elements] of gw2Objects.attributes) {\n        for (const element of elements) {\n            inflateAttribute(element, attribute);\n        }\n    }\n    return gw2Objects;\n}\nexport async function hookDOMSubtreeSlim(scope) {\n    var _a;\n    const objectsToGet = {\n        skills: new Map(),\n        traits: new Map(),\n        items: new Map(),\n        specializations: new Map(),\n        pets: new Map(),\n        'pvp/amulets': new Map(),\n        skins: new Map(),\n        attributes: new Map(),\n        professions: new Map(),\n    };\n    const statsToGet = new Set();\n    const _legacy_effectErrorStore = new Set();\n    for (const gw2Object of scope.getElementsByTagName('gw2object')) {\n        const stats = +String(gw2Object.getAttribute('stats'));\n        if (!isNaN(stats))\n            statsToGet.add(stats);\n        let objIdRaw = gw2Object.getAttribute('objId');\n        if (objIdRaw == null)\n            continue;\n        let type = (gw2Object.getAttribute('type') || 'skill') + 's';\n        if (type === 'attributes') {\n            if (objIdRaw != null) {\n                const elementsWithThisId = objectsToGet.attributes.get(objIdRaw);\n                if (elementsWithThisId)\n                    elementsWithThisId.push(gw2Object);\n                else\n                    objectsToGet.attributes.set(objIdRaw, [gw2Object]);\n            }\n        }\n        else {\n            let objId = +objIdRaw;\n            if (type === 'effects') {\n                if (config.legacyCompatibility) {\n                    type = 'skills';\n                    objId = transformEffectToSkillObject(gw2Object, _legacy_effectErrorStore);\n                }\n                else {\n                    continue;\n                }\n            }\n            if ((!isNaN(objId) && type in objectsToGet) || (type == 'professions' && (objId = objIdRaw[0].toUpperCase() + objIdRaw.slice(1)), PROFESSIONS.includes(objId))) {\n                const map = objectsToGet[type];\n                const elementsWithThisId = map.get(objId);\n                if (elementsWithThisId)\n                    elementsWithThisId.push(gw2Object);\n                else\n                    map.set(objId, [gw2Object]);\n                const inlineTraits = gw2Object.getAttribute('with-traits');\n                if (inlineTraits) {\n                    for (const traitStr of inlineTraits.split(',')) {\n                        const traitId = +traitStr;\n                        if (!traitId)\n                            continue;\n                        if (!objectsToGet.traits.has(traitId))\n                            objectsToGet.traits.set(traitId, []);\n                    }\n                }\n                let inlineSkinId;\n                if (type == 'items' && !isNaN(inlineSkinId = +String(gw2Object.getAttribute('skin')))) {\n                    if (!objectsToGet.skins.has(inlineSkinId))\n                        objectsToGet.skins.set(inlineSkinId, []);\n                }\n                const inlineSlottedUpgradeIds = gw2Object.getAttribute('slotted');\n                if (inlineSlottedUpgradeIds) {\n                    for (const idStr of inlineSlottedUpgradeIds.split(',')) {\n                        const id = +idStr;\n                        if (id && !isNaN(id) && !objectsToGet.items.has(id))\n                            objectsToGet.items.set(id, []);\n                    }\n                }\n            }\n            else {\n                continue;\n            }\n        }\n        attachMouseListeners(gw2Object);\n    }\n    if (_legacy_effectErrorStore.size) {\n        console.error(\"[gw2-tooltips] [legacy-compat] Some effects could not be translated into skills: \", Array.from(_legacy_effectErrorStore));\n    }\n    if (statsToGet.size > 0)\n        APICache.ensureExistence('itemstats', statsToGet.values(), config.validateApiResponses);\n    await Promise.all(Object.entries(objectsToGet).map(async ([key, values]) => {\n        if (values.size === 0 || key === 'attributes')\n            return;\n        let inflator;\n        switch (key) {\n            case 'skills':\n                inflator = inflateSkill;\n                break;\n            case 'items':\n                inflator = inflateItem;\n                break;\n            case 'specializations':\n                inflator = inflateSpecialization;\n                break;\n            case 'professions':\n                inflator = inflateProfession;\n                break;\n            default:\n                inflator = inflateGenericIcon;\n                break;\n        }\n        const cache = APICache.storage[key];\n        await APICache.ensureExistence(key, values.keys(), config.validateApiResponses);\n        for (const [id, objects] of values) {\n            const data = cache.get(id);\n            if (!objects || !data)\n                continue;\n            for (const gw2Object of objects)\n                inflator(gw2Object, data);\n        }\n    }));\n    (_a = config.afterDownload) === null || _a === void 0 ? void 0 : _a.call(globalThis);\n    return objectsToGet;\n}\nexport function attachMouseListeners(target) {\n    target.addEventListener('mouseenter', (e) => showTooltipOn(e.target));\n    target.addEventListener('mouseleave', hideTooltip);\n}\nexport function hideTooltip() {\n    tooltip.style.display = 'none';\n    tooltip.style.transform = '';\n}\nfunction showTooltipOn(element, visibleIndex = 0) {\n    var _a;\n    const type = (element.getAttribute('type') || 'skill');\n    if (type == 'effect' || type == 'profession')\n        return;\n    let objId;\n    let params;\n    const objIdRaw = String(element.getAttribute('objId'));\n    let context = contexts[+String(element.getAttribute('context-set')) || 0];\n    if (type === 'attribute') {\n        objId = objIdRaw;\n        params = { type };\n    }\n    else {\n        context = specializeContextFromInlineAttribs(context, element);\n        objId = +objIdRaw;\n        let weaponSet = +String(element.getAttribute('weapon-set'));\n        if (isNaN(weaponSet))\n            weaponSet = undefined;\n        if (type === 'item' || type === 'skin') {\n            params = { type, weaponSet, element,\n                statSetId: +String(element.getAttribute('stats')) || undefined,\n                stackSize: +String(element.getAttribute('count')) || undefined,\n                slottedItems: (_a = element.getAttribute('slotted')) === null || _a === void 0 ? void 0 : _a.split(',').map(id => APICache.storage.items.get(+id || 0) || MISSING_ITEM).filter(i => 'subtype' in i),\n            };\n        }\n        else {\n            params = { type, weaponSet,\n                adjustTraitedSkillIds: element.classList.contains('auto-transform'),\n            };\n        }\n    }\n    lastTooltipTarget = element;\n    showTooltipFor(objId, params, context, visibleIndex);\n    if (tooltip.childElementCount > 1) {\n        element.classList.add('cycler');\n        element.title = 'Right-click to cycle through tooltips';\n        if (config.adjustWikiLinks)\n            updateAnchorElement(element, cyclePos);\n    }\n}\nexport function showTooltipFor(objId, params, context, visibleIndex = 0) {\n    if (params.type === 'attribute') {\n        cyclePos = visibleIndex;\n        tooltip.replaceChildren(generateAttributeTooltip(objId, context));\n        tooltip.style.display = '';\n        scrollSubTooltipIntoView(cyclePos);\n        return;\n    }\n    else if (params.type === 'specialization') {\n        cyclePos = visibleIndex;\n        const data = APICache.storage.specializations.get(objId);\n        if (!data)\n            return;\n        tooltip.replaceChildren(generateSpecializationTooltip(data));\n        tooltip.style.display = '';\n        scrollSubTooltipIntoView(cyclePos);\n        return;\n    }\n    const data = APICache.storage[(params.type + 's')].get(objId);\n    if (!data)\n        return;\n    if ('palettes' in data) {\n        if (context.underwater) {\n            if (!data.flags.includes('UsableUnderWater') && data.flags.includes('UsableLand')) {\n                if (!context.cloned)\n                    context = Object.assign({}, context);\n                context.underwater = false;\n            }\n        }\n        else if (!context.underwater) {\n            if (!data.flags.includes('UsableLand') && data.flags.includes('UsableUnderWater')) {\n                if (!context.cloned)\n                    context = Object.assign({}, context);\n                context.underwater = true;\n            }\n        }\n    }\n    const [innerTooltips, initialActiveIndex] = generateToolTipList(data, params, context);\n    cyclePos = visibleIndex > 0 ? visibleIndex : initialActiveIndex;\n    tooltip.replaceChildren(...innerTooltips);\n    tooltip.style.display = '';\n    if (tooltip.childElementCount > 1) {\n        activateSubTooltip(cyclePos);\n    }\n    else if (tooltip.firstElementChild) {\n        tooltip.firstElementChild.classList.add('active');\n    }\n    scrollSubTooltipIntoView(cyclePos);\n}\nfunction generateToolTip(apiObject, slotName, iconMode, context, weaponSet) {\n    const headerElements = [];\n    if (iconMode == 1 || (iconMode == 2 && !IsDevIcon(apiObject.icon)))\n        headerElements.push(newImg(apiObject.icon));\n    headerElements.push(newElm('span.title-text', apiObject.name ? fromHTML(GW2Text2HTML(resolveInflections(apiObject.name, 1, context.character))) : `<#${apiObject.id}>`), newElm('div.flexbox-fill'));\n    const currentContextInformation = resolveTraitsAndOverrides(apiObject, context);\n    pushCostAndRestrictionLabels(headerElements, apiObject, currentContextInformation, context);\n    const secondHeaderRow = [];\n    if (slotName)\n        secondHeaderRow.push(newElm('span', `( ${slotName} )`));\n    if (weaponSet !== undefined)\n        secondHeaderRow.push(newElm('span', `( Weapon Set ${weaponSet + 1} )`));\n    secondHeaderRow.push(newElm('div.flexbox-fill'));\n    pushGamemodeSplitLabels(secondHeaderRow, apiObject, context);\n    const parts = [newElm('h4.title', ...headerElements)];\n    if (secondHeaderRow.length > 1)\n        parts.push(newElm('h4.detail', ...secondHeaderRow));\n    if ('description' in apiObject && apiObject.description) {\n        parts.push(newElm('p.description', fromHTML(GW2Text2HTML(apiObject.description))));\n    }\n    pushFacts(parts, apiObject, currentContextInformation, context, weaponSet === undefined ? context.character.selectedWeaponSet : weaponSet);\n    const tooltip = newElm('div.tooltip', ...parts);\n    tooltip.dataset.id = String(apiObject.id);\n    return tooltip;\n}\nfunction pushCostAndRestrictionLabels(destinationArray, sourceObject, specializedContextInformation, context) {\n    if ('flags' in sourceObject && sourceObject.flags.includes('DisallowUnderwater')) {\n        destinationArray.push(newImg(ICONS.NoUnderwater, 'iconsmall'));\n    }\n    if (specializedContextInformation.activation) {\n        const value = formatFraction(specializedContextInformation.activation / 1000, config);\n        if (value != '0') {\n            destinationArray.push(newElm('span.property', value, newImg(ICONS.Activation, 'iconsmall')));\n        }\n    }\n    if (specializedContextInformation.resource_cost) {\n        destinationArray.push(newElm('span.property', String(specializedContextInformation.resource_cost), newImg(ICONS['Resource' + context.character.profession] || ICONS.ResourceThief, 'iconsmall')));\n    }\n    if (specializedContextInformation.endurance_cost) {\n        destinationArray.push(newElm('span.property', String(Math.round(specializedContextInformation.endurance_cost)), newImg(ICONS.CostEndurance, 'iconsmall')));\n    }\n    if (specializedContextInformation.upkeep_cost) {\n        destinationArray.push(newElm('span.property', String(specializedContextInformation.upkeep_cost), newImg(ICONS.CostUpkeep, 'iconsmall')));\n    }\n    if (specializedContextInformation.recharge) {\n        const value = formatFraction(specializedContextInformation.recharge / 1000, config);\n        if (value != '0') {\n            destinationArray.push(newElm('span.property', value, newImg(ICONS.Recharge, 'iconsmall')));\n        }\n    }\n    if (specializedContextInformation.supply_cost) {\n        destinationArray.push(newElm('span.property', String(specializedContextInformation.supply_cost), newImg(ICONS.CostSupply, 'iconsmall')));\n    }\n}\nfunction pushGamemodeSplitLabels(destinationArray, SourceObject, context) {\n    if ('override_groups' in SourceObject && SourceObject.override_groups) {\n        const baseContext = new Set(['Pve', 'Pvp', 'Wvw']);\n        for (const override of SourceObject.override_groups) {\n            for (const context of override.context) {\n                baseContext.delete(context);\n            }\n        }\n        const splits = [Array.from(baseContext), ...SourceObject.override_groups.map(o => o.context)];\n        const splits_html = [];\n        for (const mode of ['Pve', 'Pvp', 'Wvw']) {\n            let split;\n            for (let i = 0; i < splits.length; i++) {\n                if (splits[i].includes(mode)) {\n                    split = splits.splice(i, 1)[0];\n                    break;\n                }\n            }\n            if (!split)\n                continue;\n            const text = split.join('/');\n            if (split.includes(context.gameMode))\n                splits_html.push(`<span style=\"color: var(--gw2-tt-color-text-accent) !important;\">${text}</span>`);\n            else\n                splits_html.push(text);\n        }\n        destinationArray.push(newElm('span', '( ', fromHTML(splits_html.join(' | ')), ' )'));\n    }\n}\nfunction pushFacts(destinationArray, sourceObject, specializedContextInformation, context, weaponSet) {\n    if (specializedContextInformation.blocks) {\n        let weaponStrength = 690.5;\n        if ('palettes' in sourceObject)\n            for (const pid of sourceObject.palettes) {\n                const palette = APICache.storage.palettes.get(pid);\n                if (!palette)\n                    continue;\n                const criteria = context.character.profession\n                    ? ((s) => s.profession === context.character.profession)\n                    : ((s) => s.profession);\n                if (palette.groups.some(criteria)) {\n                    weaponStrength = getWeaponStrength(palette);\n                    break;\n                }\n            }\n        destinationArray.push(...generateFacts(specializedContextInformation.blocks, weaponStrength, context, weaponSet));\n    }\n}\nexport function resolveTraitsAndOverrides(apiObject, context) {\n    var _a, _b, _c, _d, _e;\n    let override = (_a = apiObject.override_groups) === null || _a === void 0 ? void 0 : _a.find(g => g.context.includes(context.gameMode));\n    let result = Object.assign({}, apiObject, override);\n    result.blocks = structuredClone(apiObject.blocks);\n    if (!result.blocks)\n        return result;\n    if (override === null || override === void 0 ? void 0 : override.blocks) {\n        const end = Math.max(result.blocks.length, override.blocks.length);\n        for (let blockId = 0; blockId < end; blockId++) {\n            let baseBlock = result.blocks[blockId];\n            const overrideBlock = override.blocks[blockId];\n            if (overrideBlock) {\n                if (!baseBlock) {\n                    baseBlock = result.blocks[blockId] = {\n                        description: overrideBlock.description,\n                        trait_requirements: overrideBlock.trait_requirements,\n                    };\n                }\n                if (!overrideBlock.facts)\n                    continue;\n                const facts = result.blocks[blockId].facts = (_b = baseBlock.facts) !== null && _b !== void 0 ? _b : [];\n                for (const fact of overrideBlock.facts) {\n                    if ((_c = fact.requires_trait) === null || _c === void 0 ? void 0 : _c.some(t => !context.character.traits.has(t)))\n                        continue;\n                    if (fact.insert_before !== undefined) {\n                        if (fact.skip_next)\n                            fact.__gamemode_override_marker = true;\n                        facts.splice(fact.insert_before, 0, fact);\n                    }\n                    else\n                        facts.push(fact);\n                }\n            }\n        }\n    }\n    const finalBlocks = [];\n    for (const block of result.blocks) {\n        if ((_d = block.trait_requirements) === null || _d === void 0 ? void 0 : _d.some(t => !context.character.traits.has(t)))\n            continue;\n        if (block.facts) {\n            const finalFacts = [];\n            let to_skip = 0;\n            for (let i = 0; i < block.facts.length; i++) {\n                const fact = block.facts[i];\n                if ((_e = fact.requires_trait) === null || _e === void 0 ? void 0 : _e.some(t => !context.character.traits.has(t)))\n                    continue;\n                if (to_skip-- > 0)\n                    continue;\n                finalFacts.push(fact);\n                to_skip = fact.skip_next || 0;\n            }\n            block.facts = finalFacts;\n        }\n        finalBlocks.push(block);\n    }\n    result.blocks = finalBlocks;\n    return result;\n}\nfunction getWeaponStrength({ weapon_type, type: palette_type }) {\n    if (!weapon_type) {\n        if (palette_type === 'Bundle') {\n            return 922.5;\n        }\n        return 690.5;\n    }\n    else {\n        return LUT_WEAPON_STRENGTH[weapon_type];\n    }\n}\nfunction generateToolTipList(initialAPIObject, params, context) {\n    var _a;\n    let subiconRenderMode = 1;\n    if (params.type === 'trait')\n        subiconRenderMode = 2;\n    else if (initialAPIObject.type === 'Relic')\n        subiconRenderMode = 0;\n    let initialActiveIndex = 0;\n    const tooltipChain = [];\n    const paletteSkills = [];\n    let palette, group, slot = undefined;\n    if (params.type === 'skill') {\n        if (params.adjustTraitedSkillIds) {\n            const replacementSkill = findTraitedOverride(initialAPIObject, context);\n            if (replacementSkill)\n                initialAPIObject = replacementSkill;\n        }\n        let i;\n        [palette, group, i, context] = guessGroupAndContext(initialAPIObject, context);\n        if (group) {\n            slot = refineSlotName(palette, group.slot);\n            let candidate = group.candidates[i];\n            const insertAtIndex = tooltipChain.length;\n            while (candidate.previous_chain_skill_index) {\n                const otherCandidate = group.candidates[candidate.previous_chain_skill_index];\n                if (!canBeSelected(otherCandidate, context))\n                    break;\n                let skill = APICache.storage.skills.get(otherCandidate.skill);\n                if (!skill) {\n                    console.warn(`[gw2-tooltips] Chain skill #${otherCandidate.skill} is missing from the cache. The query was caused by `, lastTooltipTarget);\n                    skill = MISSING_SKILL;\n                }\n                tooltipChain.splice(insertAtIndex, 0, generateToolTip(skill, slot, 1, context, params.weaponSet));\n                candidate = otherCandidate;\n            }\n        }\n        tooltipChain.push(generateToolTip(initialAPIObject, slot, 1, context, params.weaponSet));\n        for (let j = 0; j < i; j++) {\n            const otherCandidate = group.candidates[j];\n            if (otherCandidate.previous_chain_skill_index != i)\n                continue;\n            if (!canBeSelected(otherCandidate, context))\n                continue;\n            let skill = APICache.storage.skills.get(otherCandidate.skill);\n            if (!skill) {\n                console.warn(`[gw2-tooltips] Chain skill #${otherCandidate.skill} is missing from the cache. The query was caused by `, lastTooltipTarget);\n                skill = MISSING_SKILL;\n            }\n            paletteSkills.push(skill.id);\n            tooltipChain.push(generateToolTip(skill, slot, 1, context, params.weaponSet));\n            i = j;\n            j = -1;\n        }\n    }\n    else {\n        if (params.type === 'skin' || params.type === 'item') {\n            const skin = getActiveSkin(initialAPIObject, params.element);\n            tooltipChain.push(generateItemTooltip(initialAPIObject, context, params.weaponSet === undefined ? context.character.selectedWeaponSet : params.weaponSet, skin, params.statSetId, params.slottedItems, params.stackSize));\n        }\n        else {\n            let slotName = undefined;\n            if ('slot' in initialAPIObject) {\n                slotName = initialAPIObject.slot;\n                if ('specialization' in initialAPIObject)\n                    (((_a = APICache.storage.specializations.get(initialAPIObject.specialization)) === null || _a === void 0 ? void 0 : _a.name) || initialAPIObject.specialization) + ' - ' + slotName;\n            }\n            tooltipChain.push(generateToolTip(initialAPIObject, slotName, 1, context, params.weaponSet));\n        }\n    }\n    if ('bundle_skills' in initialAPIObject) {\n        for (const subSkillId of initialAPIObject.bundle_skills) {\n            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n            if (subSkillInChain && canBeUsedOnCurrentTerrain(subSkillInChain, context)) {\n                const [palette, group] = guessGroupAndContext(subSkillInChain, context);\n                tooltipChain.push(generateToolTip(subSkillInChain, refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot), 1, context, params.weaponSet));\n            }\n        }\n    }\n    if ('related_skills' in initialAPIObject) {\n        for (const subSkillId of initialAPIObject.related_skills) {\n            if (paletteSkills.includes(subSkillId))\n                continue;\n            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n            if (subSkillInChain && canBeUsedOnCurrentTerrain(subSkillInChain, context) && ((params.type != 'skill') || subSkillInChain.palettes.some(pid => {\n                const palette = APICache.storage.palettes.get(pid);\n                return palette && VALID_CHAIN_PALETTES.includes(palette.type);\n            }))) {\n                const [palette, group] = guessGroupAndContext(subSkillInChain, context);\n                tooltipChain.push(generateToolTip(subSkillInChain, refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot), subiconRenderMode, context, params.weaponSet));\n            }\n        }\n    }\n    if ('ambush_skills' in initialAPIObject) {\n        for (const { id: subSkillId, spec } of initialAPIObject.ambush_skills) {\n            const subSkillInChain = APICache.storage.skills.get(subSkillId);\n            if (subSkillInChain && canBeUsedOnCurrentTerrain(subSkillInChain, context) && (!spec || context.character.specializations.has(spec))) {\n                if (!slot) {\n                    [palette, group] = guessGroupAndContext(subSkillInChain, context);\n                    slot = refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot);\n                }\n                tooltipChain.push(generateToolTip(subSkillInChain, slot, subiconRenderMode, context, params.weaponSet));\n                break;\n            }\n        }\n    }\n    if ('skills' in initialAPIObject)\n        for (const petSkillId of initialAPIObject.skills) {\n            initialActiveIndex = 1;\n            let petSkill = APICache.storage.skills.get(petSkillId);\n            if (!petSkill) {\n                console.warn(`[gw2-tooltips] pet skill #${petSkillId} is missing from the cache. The query was caused by `, lastTooltipTarget);\n                petSkill = MISSING_SKILL;\n            }\n            const [palette, group] = guessGroupAndContext(petSkill, context);\n            tooltipChain.push(generateToolTip(petSkill, refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot), subiconRenderMode, context, params.weaponSet));\n        }\n    if ('skills_ai' in initialAPIObject)\n        for (const petSkillId of initialAPIObject.skills_ai) {\n            let petSkill = APICache.storage.skills.get(petSkillId);\n            if (!petSkill) {\n                console.warn(`[gw2-tooltips] pet skill #${petSkillId} is missing from the cache. The query was caused by `, lastTooltipTarget);\n                petSkill = MISSING_SKILL;\n            }\n            const [palette, group] = guessGroupAndContext(petSkill, context);\n            let slotName = refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot);\n            if (slotName)\n                slotName = 'AI ' + slotName;\n            tooltipChain.push(generateToolTip(petSkill, slotName, subiconRenderMode, context, params.weaponSet));\n        }\n    if (context.character.specializations.has(55) && 'skills_soulbeast' in initialAPIObject)\n        for (const petSkillId of initialAPIObject.skills_soulbeast) {\n            let petSkill = APICache.storage.skills.get(petSkillId);\n            if (!petSkill) {\n                console.warn(`[gw2-tooltips] pet skill #${petSkillId} is missing from the cache. The query was caused by `, lastTooltipTarget);\n                petSkill = MISSING_SKILL;\n            }\n            const [palette, group] = guessGroupAndContext(petSkill, context);\n            tooltipChain.push(generateToolTip(petSkill, refineSlotName(palette, group === null || group === void 0 ? void 0 : group.slot), subiconRenderMode, context, params.weaponSet));\n        }\n    tooltip.append(...tooltipChain);\n    return [tooltipChain, initialActiveIndex];\n}\nfunction refineSlotName(palette, slot) {\n    if (!slot)\n        return undefined;\n    if (palette.type == 'Bundle' && slot.includes('_')) {\n        return 'Bundle ' + slot.substring(slot.lastIndexOf('_') + 1);\n    }\n    if (slot.startsWith('Weapon') && palette.weapon_type) {\n        return localizeInternalName(palette.weapon_type) + ' ' + slot.substring(slot.lastIndexOf('_') + 1);\n    }\n    return slot.replace(/(\\S+?)_(\\d)/, \"$1 $2\");\n}\nfunction guessGroupAndContext(skill, context) {\n    let fallback = undefined;\n    for (const pid of skill.palettes) {\n        const palette = APICache.storage.palettes.get(pid);\n        if (!palette) {\n            console.warn(`[gw2-tooltips] Palette #${pid} is missing from the cache. The query was caused by `, skill);\n            continue;\n        }\n        if (!VALID_CHAIN_PALETTES.includes(palette.type))\n            continue;\n        for (const group of palette.groups) {\n            if (context.character.profession && group.profession && group.profession != context.character.profession)\n                continue;\n            for (const [i, candidate] of group.candidates.entries()) {\n                if (candidate.skill != skill.id)\n                    continue;\n                if (!fallback)\n                    fallback = [palette, group, i, context];\n                if (canBeSelected(candidate, context))\n                    return [palette, group, i, context];\n            }\n        }\n    }\n    if (fallback) {\n        fallback[3] = transmuteContext(fallback[1].candidates[fallback[2]], context);\n        return fallback;\n    }\n    for (const pid of skill.palettes) {\n        const palette = APICache.storage.palettes.get(pid);\n        if (!palette)\n            continue;\n        if (!VALID_CHAIN_PALETTES.includes(palette.type))\n            continue;\n        for (const group of palette.groups) {\n            for (const [i, candidate] of group.candidates.entries()) {\n                if (candidate.skill == skill.id)\n                    return [palette, group, i, transmuteContext(candidate, context)];\n            }\n        }\n    }\n    for (const pid of skill.palettes) {\n        const palette = APICache.storage.palettes.get(pid);\n        if (!palette)\n            continue;\n        for (const group of palette.groups) {\n            for (const [i, candidate] of group.candidates.entries()) {\n                if (candidate.skill == skill.id)\n                    return [palette, group, i, transmuteContext(candidate, context)];\n            }\n        }\n    }\n    return [undefined, undefined, -1, context];\n}\nfunction transmuteContext(targetCandidate, context, clone = true) {\n    if (clone) {\n        const character = Object.assign({}, context.character, { specializations: structuredClone(context.character.specializations), traits: structuredClone(context.character.traits) });\n        context = Object.assign({}, context, { character });\n    }\n    if (targetCandidate.specialization)\n        context.character.specializations.add(targetCandidate.specialization);\n    if (targetCandidate.trait)\n        context.character.traits.add(targetCandidate.trait);\n    return context;\n}\n;\nfunction canBeSelected(info, context) {\n    return (info.specialization === undefined || context.character.specializations.has(info.specialization)) &&\n        (info.trait === undefined || context.character.traits.has(info.trait)) &&\n        (context.underwater ? info.usability.includes('UsableUnderWater') : info.usability.includes('UsableLand')) &&\n        (context.character.level >= (info.min_level || 0));\n}\nfunction canBeUsedOnCurrentTerrain(skill, context) {\n    return context.underwater ? skill.flags.includes('UsableUnderWater') : skill.flags.includes('UsableLand');\n}\nexport function findTraitedOverride(skill, context) {\n    var _a;\n    for (const pid of skill.palettes) {\n        const palette = APICache.storage.palettes.get(pid);\n        if (!palette) {\n            console.warn(`[gw2-tooltips] Palette #${pid} is missing from the cache. The query was caused by `, skill);\n            continue;\n        }\n        for (const group of palette.groups) {\n            if (context.character.profession && group.profession && group.profession != context.character.profession)\n                continue;\n            const end = group.candidates.findIndex(c => c.skill == skill.id);\n            if (end == -1)\n                continue;\n            for (let i = 0; i < end; i++) {\n                const candidate = group.candidates[i];\n                if (candidate.trait) {\n                    if (!context.character.traits.has(candidate.trait))\n                        continue;\n                    const replacementSkill = APICache.storage.skills.get(candidate.skill);\n                    if (!replacementSkill) {\n                        console.error(`[gw2-tooltips] Corrected skill #${candidate.skill} is missing in the cache.`);\n                        return;\n                    }\n                    else {\n                        console.info(`[gw2-tooltips] Corrected skill #${skill.id} (${skill.name}) to #${replacementSkill.id} (${replacementSkill.name}) because the trait #${candidate.trait} (${((_a = APICache.storage.traits.get(candidate.trait)) === null || _a === void 0 ? void 0 : _a.name) || '<not cached>'}) is active.`);\n                        return replacementSkill;\n                    }\n                }\n            }\n        }\n    }\n    return;\n}\nfunction generateItemTooltip(item, context, weaponSet, skin, statSetId, slottedItems, stackSize = 1) {\n    let statSet = ('attribute_base' in item && (context.gameMode !== 'Pvp' || (item.type === 'Trinket' && item.subtype === 'Amulet'))) && findCorrectAttributeSet(item, statSetId);\n    const countPrefix = stackSize > 1 ? stackSize + ' ' : '';\n    const upgradeNameSource = (slottedItems === null || slottedItems === void 0 ? void 0 : slottedItems.find(i => !['Infusion', 'Enrichment'].includes(i.subtype))) || (slottedItems === null || slottedItems === void 0 ? void 0 : slottedItems[0]);\n    const name = countPrefix + formatItemName(item, context, skin, statSet, upgradeNameSource, stackSize);\n    const parts = [newElm('h4.title', newImg((skin === null || skin === void 0 ? void 0 : skin.icon) || item.icon), newElm('span.title-text.gw2-color-rarity-' + item.rarity, name), newElm('div.flexbox-fill'))];\n    if ('defense' in item && item.defense) {\n        const defense = (typeof item.defense == \"number\")\n            ? item.defense\n            : LUT_DEFENSE[Math.min(100, (item.defense[0] + context.character.level))] * item.defense[1];\n        parts.push(newElm('span.line', newElm('tem', 'Defense: ', newElm('span.gw2-color-stat-green', String(Math.ceil(defense))))));\n    }\n    if ('power' in item) {\n        let power;\n        if ('mul' in item.power) {\n            let maxRarity = RARITY.Legendary;\n            if (['PlayerLevelScaleRarity', 'ItemScale4'].includes(item.power.scaling)) {\n                if (context.character.level < 14)\n                    maxRarity = RARITY.Fine;\n                else if (context.character.level < 30)\n                    maxRarity = RARITY.Masterwork;\n                else if (context.character.level < 60)\n                    maxRarity = RARITY.Rare;\n                else if (context.character.level < 80)\n                    maxRarity = RARITY.Exotic;\n            }\n            const rarity = Math.min(RARITY[item.rarity], maxRarity);\n            let index = LUT_RARITY[rarity];\n            if (!item.power.scaling)\n                index += item.level;\n            else {\n                index += context.character.level;\n            }\n            const avg = (context.character.isPlayer ? LUT_POWER_PLAYER : LUT_POWER_MONSTER)[Math.min(100, index)] * item.power.mul * LUT_RARITY_MUL[rarity];\n            const spread = avg * item.power.spread;\n            power = [Math.ceil(avg - spread), Math.ceil(avg + spread)];\n        }\n        else {\n            power = item.power;\n        }\n        const line = newElm('tem', 'Weapon Strength: ', newElm('span.gw2-color-stat-green', `${power[0]} - ${power[1]}`));\n        if (item.damage_type)\n            line.append(` (${item.damage_type})`);\n        parts.push(newElm('span.line', line));\n    }\n    if ('tiers' in item) {\n        parts.push(generateUpgradeItemGroup(item, context, weaponSet));\n    }\n    if (statSet && 'attribute_base' in item) {\n        parts.push(...statSet.attributes.map(({ attribute, base_value, scaling }) => {\n            const computedValue = Math.round(base_value + item.attribute_base * scaling);\n            return newElm('span.line', newElm('tem.gw2-color-stat-green', `+${computedValue} ${localizeInternalName(attribute)}`));\n        }));\n    }\n    if ('slots' in item) {\n        parts.push(newElm('div.group.slots', ...item.slots.map(s => {\n            let slottedItemIdx = -1;\n            if (slottedItems) {\n                switch (s) {\n                    case 'Upgrade':\n                        slottedItemIdx = slottedItems.findIndex(i => ['Rune', 'Sigil', 'Gem'].includes(i.subtype));\n                        break;\n                    case 'Infusion':\n                        slottedItemIdx = slottedItems.findIndex(i => i.subtype == 'Infusion');\n                        break;\n                    case 'Enrichment':\n                        slottedItemIdx = slottedItems.findIndex(i => i.subtype == 'Enrichment');\n                        break;\n                }\n                if (slottedItemIdx === -1) {\n                    slottedItemIdx = slottedItems.findIndex(i => i.id === 0);\n                }\n            }\n            if (slottedItemIdx > -1) {\n                const slottedItem = slottedItems.splice(slottedItemIdx, 1)[0];\n                const group = generateUpgradeItemGroup(slottedItem, context, weaponSet);\n                const name = formatItemName(slottedItem, context);\n                group.prepend(newElm('h4', newImg(slottedItem.icon, 'iconsmall'), newElm('span.title-text.gw2-color-rarity-' + slottedItem.rarity, name), newElm('div.flexbox-fill')));\n                return group;\n            }\n            else {\n                return newElm('span.line', newImg(ICONS['Slot' + s], 'iconsmall'), `Empty ${s} Slot`);\n            }\n        })));\n    }\n    let descriptionAlreadyShown = false;\n    if ('applies_buff' in item) {\n        parts.push(newElm('span', fromHTML(GW2Text2HTML(item.description))));\n        parts.push(newElm('div.group', generateFact(item.applies_buff, -1, context, weaponSet, true).wrapper));\n        descriptionAlreadyShown = true;\n    }\n    if ('facts_from_skill' in item) {\n        let factsSkill = APICache.storage.skills.get(item.facts_from_skill);\n        if (!factsSkill) {\n            console.warn(`[gw2-tooltips] Relic facts skill #${item.facts_from_skill} is missing from the cache. The query was caused by `, item, lastTooltipTarget);\n            factsSkill = MISSING_SKILL;\n        }\n        const contextInfo = resolveTraitsAndOverrides(factsSkill, context);\n        const headerElements = [];\n        pushGamemodeSplitLabels(headerElements, factsSkill, context);\n        headerElements.push(newElm('div.flexbox-fill'));\n        pushCostAndRestrictionLabels(headerElements, factsSkill, contextInfo, context);\n        const innerParts = [newElm('h4.title', ...headerElements)];\n        pushFacts(innerParts, factsSkill, contextInfo, context, weaponSet);\n        parts.push(newElm('span', fromHTML(GW2Text2HTML(item.description))));\n        parts.push(newElm('div.group', ...innerParts));\n        descriptionAlreadyShown = true;\n    }\n    const metaInfo = newElm('div.group');\n    if (item.type == \"Armor\" || item.type == \"Weapon\" || (item.type == \"Trinket\" && !item.flags.includes('Pvp'))) {\n        if (skin && skin.id != item.default_skin) {\n            parts.push(newElm('div.group', newElm('span', newElm('span.gw2-color-rarity-Junk', 'Transmuted, originally: '), formatItemName(item, context))));\n        }\n        metaInfo.append(newElm('span.gw2-color-rarity-' + item.rarity, item.rarity));\n        if ('weight' in item)\n            metaInfo.append(newElm('span', item.weight));\n        metaInfo.append(newElm('span', `${item.type}: ${item.subtype}`));\n        if (item.type == \"Weapon\" && item.subtype && isTwoHanded(item.subtype))\n            metaInfo.append(newElm('span.gw2-color-rarity-Junk', `(Two-Handed)`));\n        if ('required_level' in item)\n            metaInfo.append(newElm('span', 'Required Level: ' + item.required_level));\n    }\n    if (item.description && !descriptionAlreadyShown)\n        metaInfo.append(newElm('span', fromHTML(GW2Text2HTML(item.description))));\n    if (!item.flags.includes('Pvp')) {\n        if (item.flags.includes('Unique'))\n            metaInfo.append(newElm('span', 'Unique'));\n        if (item.flags.includes('AccountBound'))\n            metaInfo.append(newElm('span', 'Account Bound'));\n        if (item.flags.includes('SoulBindOnUse'))\n            metaInfo.append(newElm('span', 'Soulbound on Use'));\n        else if (item.flags.includes('SoulBindOnAcquire'))\n            metaInfo.append(newElm('span', 'Soulbound on Acquire'));\n    }\n    if (!item.flags.includes('NoSalvage')) {\n        const salvageOptions = [item.type == 'Consumable' && item.subtype == 'Food'\n                ? 'Compost'\n                : item.rarity == 'Ascended' ? 'Ascended' : 'Standard'\n        ];\n        if (item.flags.includes('SalvageResearch'))\n            salvageOptions.push('Research');\n        if (salvageOptions.length)\n            metaInfo.append(newElm('span', 'Salvage: ' + salvageOptions.join(', ')));\n    }\n    if (item.vendor_value) {\n        let inner = ['Vendor Value: ', formatCoins(item.vendor_value * stackSize)];\n        if (stackSize > 1)\n            inner.push(' (', formatCoins(item.vendor_value), ` x ${stackSize})`);\n        metaInfo.append(newElm('span', ...inner));\n    }\n    parts.push(metaInfo);\n    const tooltip = newElm('div.tooltip.item.active', ...parts);\n    tooltip.dataset.id = String(item.id);\n    return tooltip;\n}\nexport function findCorrectAttributeSet(item, statSetId) {\n    let statSet = undefined;\n    if (item.type == \"Armor\" || item.type == \"Trinket\" || item.type == \"Weapon\") {\n        statSetId = statSetId || item.attribute_set;\n        if (statSetId === undefined)\n            console.warn(`[gw2-tooltips] [tooltip engine] Resolving stats for item without specified or innate attributes. Specify the stats by adding 'stats=\"<stat_set_id>\" to the html element.' `);\n        else {\n            statSet = APICache.storage.itemstats.get(statSetId);\n            if (!statSet)\n                console.error(`[gw2-tooltips] [tooltip engine] itemstat #${statSetId} is missing in cache.`);\n            else {\n                if (config.adjustIncorrectStatIds && statSet.similar_sets) {\n                    const correctSetId = statSet.similar_sets[item.subtype];\n                    if (correctSetId !== undefined) {\n                        console.info(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${statSetId} to #${correctSetId} because the target is of type ${item.subtype}.`);\n                        const newSet = APICache.storage.itemstats.get(correctSetId);\n                        if (!newSet)\n                            console.error(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${correctSetId} is missing in the cache.`);\n                        else\n                            statSet = newSet;\n                    }\n                }\n            }\n        }\n    }\n    return statSet;\n}\nfunction generateUpgradeItemGroup(item, context, weaponSet) {\n    const group = newElm('div.group');\n    for (const [i, tier] of item.tiers.entries()) {\n        let tier_wrap = newElm('span.line');\n        if (tier.description)\n            tier_wrap.append(newElm('span', fromHTML(GW2Text2HTML(tier.description))));\n        else if (tier.facts) {\n            for (const fact of tier.facts) {\n                const { wrapper } = generateFact(fact, null, context, weaponSet);\n                if (wrapper)\n                    tier_wrap.append(wrapper);\n            }\n        }\n        else if (tier.modifiers) {\n            tier_wrap.style.flexDirection = \"column\";\n            const activeAttributes = context.character.statsWithWeapons[weaponSet].values;\n            for (const modifier of tier.modifiers) {\n                let modifierValue = calculateModifier(modifier, context.character.level, activeAttributes);\n                let text;\n                if (modifier.flags.includes('FormatPercent')) {\n                    text = `+${Math.round(modifierValue)}% ${localizeInternalName(modifier.description)}`;\n                }\n                else {\n                    text = `+${Math.round(modifierValue)} ${localizeInternalName(modifier.description)}`;\n                }\n                tier_wrap.append(newElm('span.line', text));\n            }\n        }\n        const w = newElm('span.line', tier_wrap);\n        if (item.subtype == \"Rune\") {\n            const colorClass = i < (context.character.upgradeCounts[item.id] || 0) ? '.gw2-color-stat-green' : '';\n            w.prepend(newElm('span' + colorClass, `(${i + 1})`));\n        }\n        group.append(w);\n    }\n    return group;\n}\nfunction generateAttributeTooltip(attribute, context) {\n    const weaponStats = context.character.statsWithWeapons[context.character.selectedWeaponSet];\n    const value = weaponStats.values[attribute];\n    let parts = weaponStats.htmlParts[attribute];\n    if (['ConditionDuration', 'BoonDuration'].includes(attribute)) {\n        parts = parts.slice();\n        const targetType = attribute === 'ConditionDuration' ? 'Condition' : 'Boon';\n        const modCap = (getAttributeInformation(attribute, context.character).cap - 1) * 100;\n        const activeAttributes = context.character.statsWithWeapons[context.character.selectedWeaponSet].values;\n        for (const [effectId, sources] of Object.entries(weaponStats.sources)) {\n            if (isNaN(+effectId))\n                continue;\n            const effect = APICache.storage.skills.get(+effectId);\n            if (!effect) {\n                console.error(`[gw2-tooltips] [tooltip engine] effect #${effectId} is missing in cache.`);\n                continue;\n            }\n            if (effect.buff_type !== targetType)\n                continue;\n            let specificMod = value * 100;\n            let specificParts = [];\n            for (const { source, modifier, count } of sources) {\n                const mod = calculateModifier(modifier, context.character.level, activeAttributes);\n                specificParts.push(newElm('span.detail', `${mod > 0 ? '+' : ''}${n3(mod)}% from ${count > 1 ? `${count} ` : ''}`, fromHTML(resolveInflections(source, count, context.character))));\n                specificMod += mod;\n            }\n            const uncappedMod = specificMod;\n            specificMod = Math.min(specificMod, modCap);\n            if (uncappedMod != specificMod) {\n                specificParts.push(newElm('span.detail.capped', `(Capped to +${n3(specificMod)}%! Uncapped value would be ${n3(uncappedMod)}%)`));\n            }\n            parts.push(newElm('div.fact', newImg(effect.icon), newElm('div', newElm('span', `${effect.name}: +${n3(specificMod)}%`), ...specificParts)));\n        }\n    }\n    return newElm('div.tooltip.item.active', ...parts);\n}\nfunction generateSpecializationTooltip(spec) {\n    return newElm('div.tooltip.item.active', newElm('h4.title', newImg(spec.icon), newElm('span.title-text', spec.name), newElm('div.flexbox-fill')), newElm('span', fromHTML(GW2Text2HTML(spec.description))));\n}\nexport function formatItemName(item, context, skin = EMPTY_SKIN, statSet, upgradeComponent, stackSize = 1) {\n    let name;\n    if (item.type == 'TraitGuide') {\n        const trait = APICache.storage.traits.get(item.trait);\n        if (trait)\n            name = trait.name;\n        else {\n            console.warn(`[gw2-tooltips] [item-name-formatter] Cache is missing trait #${item.trait} for trait guide `, item);\n            name = `Trait #${item.trait}`;\n        }\n    }\n    else {\n        name = skin.name || item.name;\n    }\n    let arg1, arg2, arg3, arg4;\n    arg1 = arg2 = arg3 = arg4 = '';\n    if (!skin.flags.includes('HidePrefix')) {\n        if (statSet && statSet.name) {\n            arg1 = statSet.name;\n            arg2 = \" \";\n        }\n    }\n    if (!item.flags.includes('HideSuffix')) {\n        if (upgradeComponent && upgradeComponent.suffix) {\n            arg4 = upgradeComponent.suffix;\n            arg3 = \" \";\n        }\n    }\n    name = GW2Text2HTML(name, arg1, arg2, arg3, arg4);\n    if (stackSize > -1)\n        name = resolveInflections(name, stackSize, context.character);\n    if (!item.flags.includes('Pve') && (item.flags.includes('Pvp') || item.flags.includes('PvpLobby')))\n        name += \" (PvP)\";\n    return name;\n}\nexport function specializeContextFromInlineAttribs(context, gw2Object) {\n    let traitOverrides = gw2Object.getAttribute('with-traits');\n    if (traitOverrides) {\n        context = Object.assign({}, context);\n        context.cloned = true;\n        context.character = Object.assign({}, context.character);\n        const invalid = [];\n        context.character.traits = new Set(traitOverrides.split(',').map(t => {\n            const v = +t;\n            if (!v)\n                invalid.push(t);\n            return v;\n        }).filter(t => t));\n        if (invalid.length)\n            console.warn(\"[gw2-tooltips] [tooltip engine] Inline trait-override for element \", gw2Object, \" has misformed overrides: \", invalid);\n    }\n    return context;\n}\nexport function formatCoins(amount) {\n    const parts = [String(Math.floor(amount % 100)), newImg(ICONS.CoinCopper, 'iconsmall', '')];\n    if (amount > 99)\n        parts.unshift(String(Math.floor((amount / 100) % 100)), newImg(ICONS.CoinSilver, 'iconsmall', ''));\n    if (amount > 9999)\n        parts.unshift(String(Math.floor(amount / 10000)), newImg(ICONS.CoinGold, 'iconsmall', ''));\n    return newElm('span', ...parts);\n}\nexport function getActiveSkin(item, element) {\n    const overrideId = +String(element.getAttribute('skin'));\n    const id = overrideId || item.default_skin;\n    if (!id)\n        return;\n    const skin = APICache.storage.skins.get(id);\n    if (!skin) {\n        console.warn(`[gw2-tooltips] Cache is missing skin #${id} for item `, item, '. Query was caused by ', element);\n        return item.default_skin != overrideId ? APICache.storage.skins.get(item.default_skin) : undefined;\n    }\n    if (skin.subtype !== item.subtype && (skin.type !== 'Back' || item.subtype !== 'Backpiece')) {\n        console.warn('[gw2-tooltips] Skin ', skin, ' cannot be applied to ', item, \", the subtype doesn't match. Query was caused by \", element);\n        return item.default_skin != overrideId ? APICache.storage.skins.get(item.default_skin) : undefined;\n    }\n    return skin;\n}\nfunction isTwoHanded(type) {\n    switch (type) {\n        case 'Axe': return false;\n        case 'Dagger': return false;\n        case 'Mace': return false;\n        case 'Pistol': return false;\n        case 'Scepter': return false;\n        case 'Focus': return false;\n        case 'Sword': return false;\n        case 'Shortbow': return false;\n        case 'Torch': return false;\n        case 'Shield': return false;\n        case 'Warhorn': return false;\n        case 'Toy': return false;\n        case 'ToyTwoHanded': return false;\n        case 'BundleSmall': return false;\n        case 'Hammer': return true;\n        case 'Longbow': return true;\n        case 'Greatsword': return true;\n        case 'Polearm': return true;\n        case 'Rifle': return true;\n        case 'Staff': return true;\n        case 'BundleLarge': return true;\n        case 'Spear': return true;\n        case 'Speargun': return true;\n        case 'Trident': return true;\n    }\n}\nfunction createCompleteContext(partialContext) {\n    var _a, _b, _c, _d, _e, _f;\n    if (partialContext.gameMode == \"Pvp\" && ((_a = partialContext.character) === null || _a === void 0 ? void 0 : _a.level) && ((_b = partialContext.character) === null || _b === void 0 ? void 0 : _b.level) != 80) {\n        console.error('[gw2-tooltips] [init] supplied (partial) context has its gamemode set to pvp, but has a character level specified thats other than 80. In pvp you are always level 80. This will lead to unexpected results; Remove the explicit level or change the gamemode. The (partial) context in question is: ', partialContext);\n    }\n    const stats = createCompletedBaseStats((_c = partialContext.character) === null || _c === void 0 ? void 0 : _c.stats);\n    const upgradeCounts = Object.assign({}, (_d = partialContext.character) === null || _d === void 0 ? void 0 : _d.upgradeCounts);\n    const statsWithWeapons = ((_f = (_e = partialContext.character) === null || _e === void 0 ? void 0 : _e.statsWithWeapons) === null || _f === void 0 ? void 0 : _f.map(s => createCompletedStats(s))) || [createCompletedStats()];\n    const character = Object.assign({}, DEFAULT_CONTEXT.character, { traits: new Set(), specializations: new Set() }, partialContext.character, { stats, upgradeCounts, statsWithWeapons });\n    return Object.assign({}, DEFAULT_CONTEXT, partialContext, { character });\n}\nexport function createCompletedBaseStats(partialSource = {}) {\n    const values = Object.assign({}, DEFAULT_CONTEXT.character.stats.values, partialSource.values);\n    const sources = Object.assign({}, structuredClone(DEFAULT_CONTEXT.character.stats.sources), partialSource.sources);\n    return { values, sources };\n}\nexport function createCompletedStats(partialSource = {}) {\n    const values = Object.assign({}, DEFAULT_CONTEXT.character.statsWithWeapons[0].values, partialSource.values);\n    const sources = Object.assign({}, structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].sources), partialSource.sources);\n    const htmlParts = Object.assign({}, structuredClone(DEFAULT_CONTEXT.character.statsWithWeapons[0].htmlParts), partialSource.htmlParts);\n    return { values, sources, htmlParts };\n}\n{\n    if (globalThis.GW2TooltipsContext instanceof Array) {\n        for (const partialContext of globalThis.GW2TooltipsContext)\n            contexts.push(createCompleteContext(partialContext));\n    }\n    else if (globalThis.GW2TooltipsContext) {\n        contexts.push(createCompleteContext(globalThis.GW2TooltipsContext));\n    }\n    else {\n        contexts.push(createCompleteContext({}));\n    }\n    config = Object.assign({}, DEFAULT_CONFIG, globalThis.GW2TooltipsConfig);\n    if (config.apiImpl)\n        APICache.apiImpl = config.apiImpl(APIs);\n    if (globalThis.navigator && \"serviceWorker\" in navigator && config.workerPath) {\n        navigator.serviceWorker.register(config.workerPath, { scope: '/' }).then((s) => console.log('[gw2-tooltips] [worker] APICache ServiceWorker registered.', s), (e) => console.error(`[gw2-tooltips] [worker] Failed to register APICache ServiceWorker: ${e}`));\n    }\n    tooltip = newElm('div.tooltipWrapper');\n    if (!globalThis.location.hostname.endsWith('hardstuck.gg')) {\n        console.info(\"GW2 Tooltips.js by Hardstuck\");\n        tooltip.classList.add('branded');\n    }\n    tooltip.style.display = 'none';\n    if (document.body)\n        document.body.appendChild(tooltip);\n    else\n        document.addEventListener('DOMContentLoaded', () => document.body.appendChild(tooltip));\n    const isMobile = globalThis.navigator && /android|webos|iphone|ipad|ipod|blackberry|bb|playbook|mobile|windows phone|kindle|silk|opera mini/.test(navigator.userAgent.toLowerCase());\n    document.addEventListener('mousemove', event => {\n        if (isMobile && (Math.abs(event.pageX - lastMouseX) + Math.abs(event.pageY - lastMouseY) > 20)) {\n            tooltip.style.display = 'none';\n        }\n        lastMouseX = event.pageX;\n        lastMouseY = event.pageY;\n        if (tooltip.style.display != 'none')\n            positionTooltip();\n    });\n    document.addEventListener('contextmenu', event => {\n        const node = findSelfOrParent(event.target, 'gw2object');\n        if (!node)\n            return;\n        if (node.classList.contains('cycler') && tooltip.style.display != 'none') {\n            event.preventDefault();\n            cyclePos = (cyclePos + 1) % tooltip.childElementCount;\n            if (config.adjustWikiLinks)\n                updateAnchorElement(node, cyclePos);\n            activateSubTooltip(cyclePos);\n            scrollSubTooltipIntoView(cyclePos, true);\n            positionTooltip(true);\n        }\n        if (isMobile && tooltip.style.display == 'none') {\n            event.preventDefault();\n            showTooltipOn(node);\n            positionTooltip();\n        }\n    });\n    if (globalThis.window) {\n        let touch;\n        const scrollHandler = (event) => {\n            if (tooltip.style.display == 'none')\n                return;\n            const activeTT = tooltip.children[cyclePos];\n            if (activeTT.scrollHeight == activeTT.clientHeight)\n                return;\n            event.preventDefault();\n            const deltaY = event.deltaY || event.detail || event.touches[0].clientY - touch.clientY;\n            activeTT.scrollBy(0, deltaY);\n        };\n        const passive = 'onwheel' in window ? { passive: false } : false;\n        window.addEventListener('DOMMouseScroll', scrollHandler, false);\n        window.addEventListener('wheel', scrollHandler, passive);\n        window.addEventListener('touchstart', event => {\n            touch = event.touches[0];\n        });\n        window.addEventListener('touchmove', scrollHandler, passive);\n        if (config.globalKeyBinds)\n            window.addEventListener('keydown', e => {\n                if (e.ctrlKey && e.altKey) {\n                    if (e.key == 'd') {\n                        e.preventDefault();\n                        config.showFactComputationDetail = !config.showFactComputationDetail;\n                        console.log(`[gw2-tooltips] [cfg] showFactComputationDetail is now ${config.showFactComputationDetail}.`);\n                        if (lastTooltipTarget && tooltip.style.display != 'none') {\n                            showTooltipOn(lastTooltipTarget, cyclePos);\n                            positionTooltip();\n                        }\n                    }\n                    else if (e.key == 't') {\n                        e.preventDefault();\n                        config.showPreciseAbilityTimings = !config.showPreciseAbilityTimings;\n                        console.log(`[gw2-tooltips] [cfg] showPreciseAbilityTimings is now ${config.showPreciseAbilityTimings}.`);\n                        if (lastTooltipTarget && tooltip.style.display != 'none') {\n                            showTooltipOn(lastTooltipTarget, cyclePos);\n                            positionTooltip();\n                        }\n                    }\n                    else if (e.key == 'w') {\n                        e.preventDefault();\n                        for (const [i, context] of contexts.entries()) {\n                            const mod = context.character.statsWithWeapons.length;\n                            context.character.selectedWeaponSet = (context.character.selectedWeaponSet + 1) % mod;\n                            console.log(`[gw2-tooltips] [cfg] Context #${i} is now on weapon set ${context.character.selectedWeaponSet + 1} / ${mod}.`);\n                        }\n                        if (lastTooltipTarget && tooltip.style.display != 'none') {\n                            showTooltipOn(lastTooltipTarget, cyclePos);\n                            positionTooltip();\n                        }\n                    }\n                }\n            });\n    }\n}\nif (config.autoInitialize) {\n    hookDocument(document);\n}\nimport { newElm, newImg, GW2Text2HTML, localizeInternalName, formatFraction, fromHTML, findSelfOrParent, n3, resolveInflections, IsDevIcon } from './Utils';\nimport * as APIs from './API';\nimport APICache from './APICache';\nexport { APICache };\nimport { calculateModifier, generateFact, generateFacts } from './FactsProcessor';\nimport * as Collect from './Collect';\nimport { inferItemUpgrades, inflateAttribute, inflateGenericIcon, inflateItem, inflateProfession, inflateSkill, inflateSpecialization } from './Inflators';\nimport { transformEffectToSkillObject as transformEffectToSkillObject } from './EffectsShim';\nimport { LUT_DEFENSE, LUT_POWER_MONSTER, LUT_POWER_PLAYER, getAttributeInformation, recomputeAttributesFromMods } from './CharacterAttributes';\nimport { DEFAULT_CONFIG, DEFAULT_CONTEXT, ICONS, LUT_RARITY, LUT_RARITY_MUL, LUT_WEAPON_STRENGTH, PROFESSIONS, RARITY, VALID_CHAIN_PALETTES, EMPTY_SKIN, MISSING_SKILL, WIKI_SEARCH_URL, MISSING_ITEM } from './Constants';\nimport { hoistGeneralSources } from './Collect';\nexport { DEFAULT_CONTEXT, generateFact, generateItemTooltip, createCompleteContext, generateToolTipList, hoistGeneralSources, recomputeAttributesFromMods };\n//# sourceMappingURL=TooltipsV2.js.map"],"names":["newElm","spec","inner","tag","classes","split","el","document","createElement","length","classList","add","append","formatImageUrl","id","missingImage","newImg","src","className","alt","img","includes","fromHTML","html","dummy","innerHTML","content","GW2Text2HTML","text","formatArgs","replaceAll","_","i","resolveInflections","count","character","sex","n3","v","withUpToNDigits","x","digits","str","toFixed","charAt","slice","n3ss","formatFraction","value","config","showPreciseAbilityTimings","sign","Math","abs","fraction","round","floor","ceil","formatDuration","localizeInternalName","type","joinWordList","words","quoteWords","map","w","last","join","HSAPI","constructor","baseUrl","this","bulkRequest","endpoint","ids","fetch","WORKER_CACHE_INIT","then","r","json","requestId","requestByName","search","headers","localAPI","fallbackAPI","localApiOffline","resolveRequest","method","arg","ex","message","console","warn","APICache","ensureExistence","initialIds","validateResponse","apiImpl","additionalIds","Object","assign","skills","Set","items","traits","pets","specializations","itemstats","palettes","skins","professions","initialSet","storage","has","size","findNextRelevantEndpoint","entries","didCollectPalettes","currentEndpoint","storageSet","request","Array","from","values","clear","info","response","unobtainable","filter","some","obj","datum","set","collectConnectedIds","error","connectedIdsStorage","addFacts","facts","fact","buff","prefix","palette","group","groups","candidate","candidates","skill","subSkill","related_skills","ambush_skills","bundle_skills","block","blocks","override_groups","attribute_set","subSkillId","skills_ai","skills_soulbeast","specialization","applies_buff","facts_from_skill","trait","default_skin","recomputeAttributesFromMods","context","weaponSet","baseAttributes","computedAttributes","stats","statsWithWeapons","selectedWeaponSet","allParts","stage1Attributes","stage2Attributes","additiveModifiers","attributeOrder","convertedAttributes","attribute","baseAttribute","suffix","base","conversionOffset","div","getAttributeInformation","displayMul","parts","sources","push","baseAttrValue","statBonus","statSourceText","modValue","source","s","modifier","flags","mod","calculateModifier","level","conversionModifiers","source_attribute","base_amount","cap","toAdd","uncappedValue","min","unshift","htmlParts","Map","ATTRIBUTE_INFO_LUT","Power","undefined","Number","MAX_SAFE_INTEGER","Toughness","Vitality","Precision","Ferocity","ConditionDamage","Expertise","Concentration","HealingPower","AgonyResistance","Health","Armor","ConditionDuration","BoonDuration","CritChance","CritDamage","_p2","computedAttribute","getBaseHealth","profession","Guardian","Thief","Elementalist","Engineer","Ranger","Mesmer","Revenant","Necromancer","Warrior","LUT_DEFENSE","LUT_POWER_PLAYER","LUT_POWER_MONSTER","RARITY","LUT_RARITY","LUT_RARITY_MUL","LUT_WEAPON_STRENGTH","BundleLarge","Standard","Focus","Shield","Torch","Warhorn","Greatsword","Hammer","Staff","Longbow","Rifle","Shortbow","Axe","Sword","Dagger","Pistol","Scepter","Mace","Spear","Speargun","Trident","ICONS","CoinCopper","CoinSilver","CoinGold","SlotUpgrade","SlotInfusion","SlotEnrichment","ResourceThief","ResourceRevenant","CostUpkeep","CostSupply","CostEndurance","NoUnderwater","Recharge","Activation","Range","DefianceBreak","WeaponSwap","Barrier","StunBreak","Knockdown","Pull","Knockback","Launch","Float","Sink","PROFESSIONS","WIKI_SEARCH_URL","VALID_CHAIN_PALETTES","DEFAULT_CONFIG","autoInitialize","autoCollectRuneCounts","autoCollectStatSources","autoCollectSelectedTraits","autoRecomputeCharacterAttributes","adjustIncorrectStatIds","adjustWikiLinks","autoInferEquipmentUpgrades","autoInferWeaponSetAssociation","legacyCompatibility","showFactComputationDetail","globalKeyBinds","validateApiResponses","DEFAULT_CONTEXT","gameMode","underwater","targetArmor","isPlayer","Damage","LifeForce","HealEffectiveness","Stun","upgradeCounts","MISSING_ITEM","name","description","rarity","subtype","required_level","access_restrictions","tiers","MISSING_BUFF","categories","modifiers","MISSING_SKILL","EMPTY_SKIN","dye_channels","formula","formula_param1","formula_param2","generateFact","weaponStrength","itemMode","iconSlug","icon","buffStackSize","buffDuration","duration","defiance_break_per_s","defiance_break","activeModSources","activeStats","generateBuffDescription","valueMod","modsArray","description_brief","relevantModifiers","source_trait_req","target_trait_req","mode","modsMap","entry","get","this_duration","apply_count","strValue","fround","toString","target","applyMods","baseDuration","detailStack","durMod","durationAttr","buff_type","cap_","attribVal","innerSuffix","durModStack","percentMod","uncappedMod","valueModStack","conversion","factInflators","AdjustByAttributeAndLevel","_a","level_exponent","level_multiplier","hit_count","attributeVal","attribute_multiplier","lines","AttributeAdjust","range","Buff","buffDescription","seconds","name_brief","BuffBrief","Distance","distance","Percent","percent","PercentHpSelfDamage","PercentLifeForceCost","hpPool","PercentHealth","raw","PercentLifeForceGain","dmg_multiplier","damage","critChance","critDamage","moreDmgFromCrit","times","Time","time","ComboField","field_type","ComboFinisher","finisher_type","AttributeConversion","NoData","PrefixedBuff","generateBuffIcon","PrefixedBuffBrief","max","data","firstLine","remainingDetail","wrapper","requires_trait","defianceBreak","effectiveBuffDuration","breakDetail","trait_names","skip_next","__gamemode_override_marker","d","stackSize","wrap","setAttribute","String","allUpgradeCounts","scope","elements","getElementsByTagName","pair","contexts","elsInCorrectCtx","e","getAttribute","_upgradeCounts","elsWithWrongCtx","contextIndex","targetContext","counts","element","item","amountToAdd","_legacy_getInfusionCount","allStatSources","keys","_statSources","baseSources","structuredClone","weaponSetSources","baseUpgrades","weaponSetUpgrades","actualInfusionCounts","ctx","total","c","tooMany","stop","sort","a","b","toRemove","weaponSetId","tiersToProcess","tierNumber","sourceRuneSuffix","tiersToAdd","upgrades","isNaN","attributeSet","findCorrectAttributeSet","attributes","base_value","attribute_base","scaling","defense","targetSources","override","tier","isModApplicable","skin","getActiveSkin","formatItemName","specificSources","overwriteWeaponStatSources","mergeSources","wTarget","_b","ownIndex","prototype","indexOf","call","parentElement","children","amountEl","getElementsByClassName","textContent","match","allTraits","querySelectorAll","_traits","specId","selectedPositions","y","traitEl","hoistGeneralSources","specializedStats","prependOnto","copySource","prepend","k","t","splice","inflateGenericIcon","force","childElementCount","wikiLink","href","contains","replaceChildren","inflateSkill","gw2Object","contextSet","specializeContextFromInlineAttribs","replacementSkill","findTraitedOverride","inflateItem","inflateSpecialization","style","backgroundImage","background","dataset","label","column","toggle","inflateAttribute","_p","MagicFind","inflateProfession","icon_big","transformEffectToSkillObject","error_store","LUT_EFFECT_IDS","hardCoded","LUT_HARDCODED_EFFECTS","innerText","title","cursor","chaos_aura","dark_aura","fire_aura","frost_aura","light_aura","magnetic_aura","shocking_aura","aegis","alac","alacrity","fury","might","prot","protection","quick","quickness","regen","regeneration","resistance","resolution","stab","stability","swiftness","vigor","bleed","bleeding","blind","blinded","blindness","burn","burning","burned","chill","chilled","confusion","confused","cripple","crippled","fear","feared","immob","immobilise","immobilize","immobilised","immobilized","poison","poisoned","slow","slowed","taunt","taunted","torment","tormented","vuln","vulnerability","weakness","weakened","daze","stun","agony","invulnerability","revealed","stealth","superspeed","unblockable","blight","bloodstone_blessed","blue_pylon_power","champion_of_the_legions","compromised","crowd_favor","curse_of_frailty","debilitated","debilitating_void","defense_up","derangement","elemental_empowerment","empowering_auras","equalization_matrix","expose_weakness","exposed","extreme_vulnerability","fixated","growing_rage_ashym","ignite","intervention","necrosis","not_sticking_together","nova","ooze_pheromone","photon_saturation","positive_flow","power_of_the_void","reinforced_armor","relentless_fire","retaliation_ashym","sentinel_retribution","shattering_ice","shell_shocked","spectral_darkness","sticking_together","synchronized_vitality","unnatural_signet","use_soul_binder","void_empowerment","xeras_embrace","barrier","stunbreak","knockdown","pull","knockback","launch","float","sink","tooltip","lastTooltipTarget","lastMouseX","lastMouseY","cyclePos","activateSubTooltip","tooltipIndex","tooltips","index","updateAnchorElement","cyclerGw2object","firstElementChild","nodeName","tooltip_","querySelector","startsWith","scrollSubTooltipIntoView","animate","transition","transform","offsetTop","offsetHeight","positionTooltip","wpadminbar","getElementById","topBarHeight","currentSubTooltip","tooltipXpos","offsetWidth","documentElement","clientWidth","tooltipYpos","scrollTop","setTimeout","left","top","async","hookDocument","_unused","buildNodes","Collect.allTraits","gw2Objects","hookDOMSubtreeSlim","buildNode","setNode","objNode","skillIdsBySet","setSkillsNode","skillIds","chainIds","adjustTraitedSkillIds","guessGroupAndContext","previous_chain_skill_index","otherCandidate","canBeSelected","j","subSkillInChain","pid","descriptionNode","nextElementSibling","skillNode","Collect.allUpgradeCounts","Collect.allStatSources","traitId","addModifiers","contextBoundInfo","resolveTraitsAndOverrides","Collect.traitEffects","targets","wrappers","remainingInfusionsByContext","enrichmentByContext","itemEl","upgradeEls","itemCtx","upgradeIds","u","slot","slots","remainingInfusions","infusionId","enrichment","attrString","inferItemUpgrades","Collect.hoistGeneralSources","objectsToGet","statsToGet","_legacy_effectErrorStore","objIdRaw","elementsWithThisId","objId","toUpperCase","inlineTraits","traitStr","inlineSkinId","inlineSlottedUpgradeIds","idStr","attachMouseListeners","Promise","all","key","inflator","cache","objects","afterDownload","globalThis","addEventListener","showTooltipOn","hideTooltip","display","visibleIndex","params","statSetId","slottedItems","showTooltipFor","weaponStats","targetType","modCap","activeAttributes","effectId","effect","specificMod","specificParts","generateAttributeTooltip","cloned","innerTooltips","initialActiveIndex","generateToolTipList","generateToolTip","apiObject","slotName","iconMode","headerElements","ico","currentContextInformation","pushCostAndRestrictionLabels","secondHeaderRow","pushGamemodeSplitLabels","pushFacts","destinationArray","sourceObject","specializedContextInformation","activation","resource_cost","endurance_cost","upkeep_cost","recharge","supply_cost","SourceObject","baseContext","delete","splits","o","splits_html","criteria","getWeaponStrength","looseBlock","remainingBlocks","totalDefianceBreak","makeFactElements","order","trait_requirements","blockFacts","defianceWrap","parseInt","generateFacts","_c","_d","_e","find","g","result","end","blockId","baseBlock","overrideBlock","insert_before","finalBlocks","finalFacts","to_skip","weapon_type","palette_type","initialAPIObject","subiconRenderMode","tooltipChain","paletteSkills","refineSlotName","insertAtIndex","generateItemTooltip","canBeUsedOnCurrentTerrain","petSkillId","petSkill","substring","lastIndexOf","replace","fallback","transmuteContext","targetCandidate","clone","usability","min_level","findIndex","statSet","countPrefix","upgradeNameSource","power","maxRarity","Legendary","Fine","Masterwork","Rare","Exotic","avg","mul","spread","line","damage_type","generateUpgradeItemGroup","slottedItemIdx","slottedItem","descriptionAlreadyShown","factsSkill","contextInfo","innerParts","metaInfo","weight","isTwoHanded","salvageOptions","vendor_value","formatCoins","similar_sets","correctSetId","newSet","tier_wrap","flexDirection","modifierValue","colorClass","upgradeComponent","arg1","arg2","arg3","arg4","traitOverrides","invalid","amount","overrideId","createCompleteContext","partialContext","_f","createCompletedBaseStats","createCompletedStats","partialSource","GW2TooltipsContext","GW2TooltipsConfig","APIs","navigator","workerPath","serviceWorker","register","log","location","hostname","endsWith","body","appendChild","isMobile","test","userAgent","toLowerCase","event","pageX","pageY","node","self","selector","depth","current","matches","findSelfOrParent","preventDefault","window","touch","scrollHandler","activeTT","scrollHeight","clientHeight","deltaY","detail","touches","clientY","scrollBy","passive","ctrlKey","altKey"],"mappings":"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"}