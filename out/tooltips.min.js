var GW2TooltipsV2=function(t){"use strict";function e(t,...e){const[o,...s]=t.split("."),n=document.createElement(o);return s.length&&n.classList.add(...s),e.length&&n.append(...e),n}const o="https://assets.gw2dat.com/",s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABuCAIAAACfnGvJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMCSURBVHhe7ZjpkeowEAaJywERD9GQDMGwumyPLj+2XssH+/UPyjMjjVBjUWXf3oJGTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSU51inr8d0u02PVwp/xf/MHQvt9Hm/Be7PlMgIHhyzCjn9hNlpc7ebxe9hhNPp8QifpTdfuz9Oe3thjHH6Cndkfv7DWb0/syNbnN8QJuzkZr5q5K+Xk2C6BtbCTDEAZJDTuIfKi0tUKuZgHhBx89P1Zj5rtK4YQzspL43z6RnltFBR5DMVKVhGFPTy3UYBO6vo0GuIMcxpvs1O2gbhei0tbOazRusvmCe+x6nddDtbBA4/LmEFNfN1o57TOD0F5ZIDGOh0CbL91SrqDYZ07iiQ5etGdrxNpGkz9XowQ53GG2Sa7H5rFc095n1W1nzdqOPUXzbXGMVYp1FqlqlVxMCNXEd9kG806t2n87cw2KE4g53mO/fUKrJgxkzp5Ou5Paf//E4wtNPzUelupki+32k8+cZgMDpQ6V9w6ij+UAeee8/fcLovcsojpzxyyiOnPHLKI6c8csqDOx39MH0B5JRHTnmGO00v2uKLi0B8e7E8ghf+7aP5RimyDrC1ga9HPmIXp2ajy95tvEhwUaHJlpaouUandgD7OF3MpHijbrAlf13MmsOwoulQxruzu9NfGLClvtO6QTF2d87mNISWuWT7ZGtUMwJy2nLVKK2YBcqGx3Mmp+XUomQqGUcf9YpT3afZ2BBUoWFpElqYnm7ooY5P9n8a9QRcDz83lfylFdVcJnGoUAfudAjlD+FopM7CNZy27/aTKr2KU4c93Y6jD/gG13F6HeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklOb9/gEv6oxxwmIw6QAAAABJRU5ErkJggg==";function n(t,e,n){"number"==typeof t&&(t+=".png");const i=document.createElement("img");return i.src=t?t.includes(":")?t:o+t:s,e&&i.classList.add(e),i.alt=n?n+" icon":"icon",i}function i(t){const e=document.createElement("template");return e.innerHTML=t,e.content}const a=(t,...e)=>t?t.replaceAll(/<c=(#.*?)>(.*?)<\/c>/g,'<span style="color: $1;">$2</span>').replaceAll(/<c=@(.*?)>(.*?)<\/c>/g,'<span class="gw2-color-$1">$2</span>').replaceAll("[lbracket]","[").replaceAll("[rbracket]","]").replaceAll("[null]","").replaceAll("\n","<br />").replaceAll(/%str(\d)%/g,((t,o)=>e[+o-1]||"")).replaceAll("%%","%"):"",r=(t,e,o)=>t.replaceAll("[s]",e>1?"s":"").replaceAll(/(\S+)\[pl:"(.+?)"]/g,e>1?"$2":"$1").replaceAll(/(\S+)\[f:"(.+?)"]/g,"Female"==o.sex?"$2":"$1");function c(t){return l(t,3)}function l(t,e){let o=t.toFixed(e);for(;"0"===o.charAt(o.length-1);)o=o.slice(0,-1);return"."===o.charAt(o.length-1)&&(o=o.slice(0,-1)),o}function u(t,e){if(e.showPreciseAbilityTimings)return l(t,3);{const e=t<0?"-":"";t=Math.abs(t);let o="";switch(Math.min(Math.round(t%1*4),4)){case 0:case 4:t=Math.round(t);break;case 1:t=Math.floor(t),o="¼";break;case 2:t=Math.floor(t),o="½";break;case 3:t=Math.floor(t),o="¾"}return 0==t&&""==o?"0":`${e}${t>0?t:""}${o}`}}function f(t,e){return(t/=1e3)>=3600?u(t/3600,e)+"h":t>60?u(t/60,e)+"min":u(t,e)+"s"}function d(t){switch(t){case"ConditionDuration":return"Condition Duration";case"ConditionDamage":return"Condition Damage";case"HealingPower":return"Healing Power";case"BowLong":return"Longbow";case"BowShort":return"Shortbow";case"Projectile20":return"Projectile (20% Chance)";case"MagicFind":return"Magic Find";case"CritChance":return"Critical Chance";case"CritDamage":return"Critical Damage";case"BoonDuration":return"Boon Duration";default:return t}}function p(t,e=!1){switch(e&&(t=t.map((t=>`'${t}'`))),t.length){case 0:return"";case 1:return t[0];default:const e=t[t.length-1];return t.slice(0,-1).join(", ")+" and "+e}}class g{constructor(t="https://api-v0.hardstuck.gg"){this.baseUrl=t}async bulkRequest(t,e){return fetch(`${this.baseUrl}/${t}?ids=${e.join(",")}`).then((t=>t.json()))}}var h=Object.freeze({__proto__:null,FakeAPI:class{constructor(){this.hsApi=new g("http://127.0.0.1:3000"),this.fallback=new g}async bulkRequest(t,e){try{return await this.hsApi.bulkRequest(t,e)}catch(o){return console.warn(`[gw2-tooltips] [FakeAPI] error trying to get ep '${t}' from localhost, will try to use the fallback API.\n${o}`),await this.fallback.bulkRequest(t,e)}}},HSAPI:g});class m{static async ensureExistence(t,e){this.apiImpl||(this.apiImpl=new g);let o=Object.assign({skills:new Set,items:new Set,traits:new Set,pets:new Set,"pvp/amulets":new Set,specializations:new Set,itemstats:new Set},{[t]:new Set(e)});const s=()=>{for(const[t,e]of Object.entries(o))if(e.size>0)return t};let n=t,i=0;do{const e=this.storage[n],s=Array.from(o[n].values());o[n].clear(),console.info(`[gw2-tooltips] [API cache] round #${i++} for a ${t} request, currently fetching ${n}. Ids: `,s);try{const t=await this.apiImpl.bulkRequest(n,s),i=s.filter((e=>!t.some((t=>t.id==e))));i.length&&console.warn(`[gw2-tooltips] [API cache] Did not receive all requested ${n} ids. missing: `,i);for(const s of t)e.has(s.id)||(e.set(s.id,s),this.collectConnectedIds({endpoint:n,datum:s},o))}catch(t){console.error(t)}}while((n=s())&&i<100)}static collectConnectedIds({endpoint:t,datum:e},o){const s=t=>{for(const e of t)"Buff"!=e.type&&"BuffBrief"!=e.type||this.storage.skills.has(e.buff)||o.skills.add(e.buff),"PrefixedBuffBrief"!==e.type&&"PrefixedBuff"!==e.type||(this.storage.skills.has(e.prefix)||o.skills.add(e.prefix),this.storage.skills.has(e.buff)||o.skills.add(e.buff))};if("palettes"in e)for(const t of e.palettes)for(const e of t.slots)if(e.profession&&e.next_chain&&!this.storage.items.has(e.next_chain)&&o.skills.add(e.next_chain),e.traited_alternatives)for(const[t,s]of e.traited_alternatives)this.storage.skills.has(s)||o.skills.add(s);if("related_skills"in e)for(const t of e.related_skills)this.storage.skills.has(t)||o.skills.add(t);if("bundle_skills"in e)for(const t of e.bundle_skills)this.storage.skills.has(t)||o.skills.add(t);if("blocks"in e)for(const t of e.blocks)t.facts&&s(t.facts);if("override_groups"in e)for(const{blocks:t}of e.override_groups)if(t)for(const e of t)e.facts&&s(e.facts);if("attribute_set"in e&&(this.storage.itemstats.has(e.attribute_set)||o.itemstats.add(e.attribute_set)),"skills"in e)for(const t of e.skills)this.storage.skills.has(t)||o.skills.add(t);if("skills_ai"in e)for(const t of e.skills_ai)this.storage.skills.has(t)||o.skills.add(t);if("skills_soulbeast"in e)for(const t of e.skills_soulbeast)this.storage.skills.has(t)||o.skills.add(t);"specialization"in e&&(this.storage.specializations.has(e.specialization)||o.specializations.add(e.specialization)),"applies_buff"in e&&(this.storage.skills.has(e.applies_buff.buff)||o.skills.add(e.applies_buff.buff))}}function b(t,o){const s=["Power","Toughness","Vitality","Precision","Ferocity","ConditionDamage","Expertise","Concentration","HealingPower","AgonyResistance","Health","Armor","ConditionDuration","BoonDuration","CritChance","CritDamage"],n=t.character.stats,a=t.character.statsWithWeapons[null!=o?o:t.character.selectedWeaponSet],l={},u={},f={},p={level:t.character.level,stats:{values:u}};for(const o of s){const{baseAttribute:s,suffix:f,base:g,div:h}=v(o,t.character);let m,b=g;const w=f?100:1,y=[],_=n.sources[o].concat(a.sources[o]);if(l[o]={parts:y,sources:_},m=`${c(g*w)+f} base value`,g&&(m+=" from lvl 80"),y.push(e("div.detail",m)),s){const t=u[s];let n=t;"CritChance"==o&&(n-=1e3);const i=n/h;b+=i,i&&(m=` +${c(i*w)+f} from ${c(t)} ${d(s)}`,1!=h&&(m+=` / ${h/w} (attrib. specific conv. factor)`),y.push(e("div.detail",m)))}let C=0;for(const o of _.filter((t=>!t.modifier.flags.includes("FormatPercent")))){const s=$(o.modifier,p)*o.count;C+=s,m=` +${c(s)} from `,o.count>1&&(m+=`${o.count} `),m+=o.source,y.push(e("div.detail",i(r(m,o.count,t.character))))}b+=C,u[o]=b}for(const o of s){const{parts:s,sources:n}=l[o];let a=0;for(const o of n.filter((t=>t.modifier.flags.includes("FormatPercent")&&t.modifier.source_attribute))){const n=$(o.modifier,p)*o.count;a+=n;let l=` +${c(n)} (${c(o.modifier.base_amount)}% of ${o.modifier.source_attribute}) from `;o.count>1&&(l+=`${o.count} `),l+=o.source,s.push(e("div.detail",i(r(l,o.count,t.character))))}f[o]=u[o]+a}p.stats.values=f;for(const o of s){const{suffix:s,cap:n}=v(o,t.character);let a,u=f[o];const{parts:g,sources:h}=l[o],m=s?100:1;for(const o of h.filter((t=>t.modifier.flags.includes("FormatPercent")&&!t.modifier.source_attribute))){const n=$(o.modifier,p)*o.count/100,l=s?n:u*n;u+=l,a=` +${c(l*m)}${s}`,s||(a+=` (${c(100*n)}%)`),a+=" from ",o.count>1&&(a+=`${o.count} `),a+=o.source,g.push(e("div.detail",i(r(a,o.count,t.character))))}const b=u;f[o]=u=Math.min(b,n-1),b!=u&&g.push(e("span.detail.capped",`(Capped to ${c(u*m)}${s}! Uncapped value would be ${c(b*m)}${s})`)),g.unshift(e("tet.title",e("teb"," +"+c(u*m)+s+" "+d(o))))}for(const t of s)a.values[t]=f[t],a.htmlParts[t]=l[t].parts}m.storage={skills:new Map,items:new Map,traits:new Map,pets:new Map,"pvp/amulets":new Map,specializations:new Map,itemstats:new Map},window.APICache=m;const w={Power:[void 0,void 0,66722,"",1e3,1,Number.MAX_SAFE_INTEGER],Toughness:[void 0,"Armor",104162,"",1e3,1,Number.MAX_SAFE_INTEGER],Vitality:[void 0,"Health",104163,"",1e3,1,Number.MAX_SAFE_INTEGER],Precision:[void 0,"CritChance",156609,"",1e3,1,Number.MAX_SAFE_INTEGER],Ferocity:[void 0,"CritDamage",156602,"",0,1,Number.MAX_SAFE_INTEGER],ConditionDamage:[void 0,void 0,156600,"",0,1,Number.MAX_SAFE_INTEGER],Expertise:[void 0,"ConditionDuration",156601,"",0,1,Number.MAX_SAFE_INTEGER],Concentration:[void 0,"BoonDuration",156599,"",0,1,Number.MAX_SAFE_INTEGER],HealingPower:[void 0,void 0,156606,"",0,1,Number.MAX_SAFE_INTEGER],AgonyResistance:[void 0,void 0,536049,"",0,1,Number.MAX_SAFE_INTEGER],Health:["Vitality",void 0,536052,"",0,.1,Number.MAX_SAFE_INTEGER],Armor:["Toughness",void 0,536048,"",0,1,Number.MAX_SAFE_INTEGER],ConditionDuration:["Expertise",void 0,156601,"%",0,1500,2],BoonDuration:["Concentration",void 0,156599,"%",0,1500,2],CritChance:["Precision",void 0,536051,"%",.05,2100,Number.MAX_SAFE_INTEGER],CritDamage:["Ferocity",void 0,784327,"%",1.5,1500,Number.MAX_SAFE_INTEGER]};function v(t,e){const o=w[t];let s,n,i,a="",r=0,c=1,l=Number.MAX_SAFE_INTEGER;return o&&([s,n,i,a,r,c,l]=o),"Health"==t&&(r=y(e)),{baseAttribute:s,computedAttribute:n,img:i,suffix:a,base:r,div:c,cap:l}}function y(t){return t.profession?{Guardian:1645,Thief:1645,Elementalist:1645,Engineer:5922,Ranger:5922,Mesmer:5922,Revenant:5922,Necromancer:9212,Warrior:9212}[t.profession]:1e3}function _(t,e){return t.statsWithWeapons[t.selectedWeaponSet].values[e]}function C(t,e){return[...t.stats.sources[e]||[],...t.statsWithWeapons[t.selectedWeaponSet].sources[e]||[]]}const A=[115,120,125,129,133,137,142,146,150,154,162,168,175,182,189,196,202,209,216,223,232,240,248,257,265,274,282,290,299,307,319,330,341,352,363,374,385,396,407,418,431,443,456,469,481,494,506,519,532,544,560,575,590,606,621,636,651,666,682,697,714,731,748,764,781,798,815,832,848,865,885,905,924,943,963,982,1002,1021,1040,1060,1081,1102,1123,1144,1165,1186,1207,1228,1249,1270,1291,1312,1333,1354,1375,1396,1417,1438,1459,1480,1501],k=[170,173,176,179,182,185,188,191,194,197,202,207,212,217,222,227,232,237,242,247,253,259,265,271,277,283,289,295,301,307,315,323,331,339,347,355,363,371,379,387,396,405,414,423,432,441,450,459,468,477,488,499,510,521,532,543,554,565,576,587,599,611,623,635,647,659,671,683,695,707,721,735,749,763,777,791,805,819,833,847,862,877,892,907,922,937,952,967,982,997,1012,1027,1042,1057,1072,1087,1102,1117,1132,1147,1162],S=[162,179,197,214,231,249,267,286,303,322,344,367,389,394,402,412,439,454,469,483,500,517,556,575,593,612,622,632,672,684,728,744,761,778,820,839,885,905,924,943,991,1016,1067,1093,1119,1145,1193,1220,1275,1304,1337,1372,1427,1461,1525,1562,1599,1637,1692,1731,1802,1848,1891,1936,1999,2045,2153,2201,2249,2298,2368,2424,2545,2604,2662,2723,2792,2854,2985,3047,3191,3269,3348,3427,3508,3589,3671,3754,3838,3922,4007,4093,4180,4267,4356,4445,4535,4625,4717,4809,4902];function $({formula:t,base_amount:e,formula_param1:o,formula_param2:s,source_attribute:n},{level:i,stats:{values:a}}){let{Power:r,ConditionDamage:c,HealingPower:l}=a;if(n)return a[n]*e/100;switch(t){case"BuffLevelLinear":case"SpawnScaleLinear":case"TargetLevelLinear":return i*o+e;case"ConditionDamage":return i*o+e+c*s;case"ConditionDamageSquared":return i*i*o+e+c*s;case"NoScaling":return e;case"Regeneration":return i*o+e+l*s;case"RegenerationSquared":return i*i*o+e+l*s;case"BuffFormulaType11":return i*o+e-s;case"Power":return i*o+e+r*s;case"PowerSquared":return i*i*o+e+r*s}return console.warn("[gw2-tooltips] [facts processor] Could not find formula #",t,", using base amount for now!"),e}function E(o,s,g,h=!1){let b=o.icon,w=1,A=o.duration,k=o.defiance_break;const S=(e,o,s,n)=>{let i=[];if(e.modifiers&&!e.description_brief&&!h){const a=e.modifiers.filter((t=>(!t.source_trait_req||g.character.traits.includes(t.source_trait_req))&&(!t.mode||t.mode===g.gameMode)));let r=new Map;for(let t=0;t<a.length;t++){const e=a[t];let o=r.get(e.id)||r.set(e.id,{modifier:e,value:0}).get(e.id),s=$(e,g.character);e.source_attribute&&(s*=_(g.character,e.source_attribute)),o.value+=s,e.flags.includes("SkipNextEntry")&&t++}for(let{value:e,modifier:a}of r.values()){if(a.flags.includes("Subtract")&&(e-=100),a.flags.includes("MulByDuration")){let t=s/1e3;a.flags.includes("DivDurationBy3")&&(t/=3),a.flags.includes("DivDurationBy10")&&(t/=10),e*=t||1}a.flags.includes("NonStacking")||(e*=o.apply_count),a.formula.includes("Regeneration")&&(e*=n);let r=a.flags.includes("FormatFraction")?u(e,t.config):Math.floor(Math.fround(e)).toString();if(a.flags.includes("FormatPercent")&&(e>0&&(r="+"+r),r+="%"),r+=" "+a.description,"string"==typeof a.target_attribute_or_skill){const{computedAttribute:t}=v(a.target_attribute_or_skill,g.character);if(t){const{div:o,suffix:s}=v(t,g.character);r+=` <span class="detail">(converts to ${c(e/o*(s?100:1))}${s} ${d(t)})</span>`}}i.push(r)}}return a(e.description_brief||i.join(", ")||e.description)},E=(o,s,n)=>{let a=1,l=1,u=Number.MAX_SAFE_INTEGER;const f="Boon"==s.buff_type?"BoonDuration":"Condition"==s.buff_type&&"ConditionDuration";if(f){const{baseAttribute:s,div:l,cap:d}=v(f,g.character);u=d;const p=_(g.character,s);a+=p/l,p>0&&t.config.showFactComputationDetail&&(n.push(`base duration: ${c(o/1e3)}s`),n.push(`+${c(o/1e3*p/l)}s (${c(p/l*100)}%) from ${c(p)} ${s}`));for(const s of C(g.character,f)){let l=$(s.modifier,g.character)*s.count;const u=s.modifier.flags.includes("FormatPercent")?"%":"",f=u?100:1;l/=f,a+=l;const d=u?l*o:l;if(t.config.showFactComputationDetail){let t=` +${c(d/1e3)}s`;u&&(t+=` (${c(l*f)}%)`),t+=" from ",s.count>1&&(t+=`${s.count} `),t+=s.source,n.push(e("div.detail",i(r(t,s.count,g.character))))}}}let d=C(g.character,s.id);if(d.length){1===a&&t.config.showFactComputationDetail&&n.push(`base duration: ${c(o/1e3)}s`);let s=0;for(const{source:a,modifier:l,count:u}of d){const f=$(l,g.character);t.config.showFactComputationDetail&&n.push(e("span.detail",`${f>0?"+":""}${o/1e3*f/100}s (${c(f)}%) from ${u>1?`${u} `:""}`,i(r(a,u,g.character)))),s+=f}a+=s/100}const p=a;if(a=Math.min(p,u),a!=p&&t.config.showFactComputationDetail&&n.push(e("span.detail",`(Capped to ${c(o/1e3*u)}s! Uncapped duration would be ${c(o/1e3*p)}s)`)),o*=a,s.name.includes("Regeneration")){let o=g.character.stats.sources.HealEffectiveness;if(o.length){t.config.showFactComputationDetail&&n.push("regeneration value mods:");let s=0;for(const{source:a,modifier:l,count:u}of o){const o=$(l,g.character);t.config.showFactComputationDetail&&n.push(e("span.detail",`${o>0?"+":""}${c(o)}% from ${u>1?`${u} `:""}`,i(r(a,u,g.character)))),s+=o}l+=s/100}}return[o,l]},P={AdjustByAttributeAndLevel:({fact:o})=>{var s;let n=(o.value+g.character.level**o.level_exponent*o.level_multiplier)*o.hit_count,l=0;o.attribute&&(l=_(g.character,o.attribute),n+=l*o.attribute_multiplier*o.hit_count);const u=[];if(t.config.showFactComputationDetail&&(u.push(`${c(o.value)} base value`),o.level_multiplier&&u.push(`+ ${c(g.character.level**o.level_exponent*o.level_multiplier)} from lvl ${g.character.level} ^ ${c(o.level_exponent)} lvl exp. * ${c(o.level_multiplier)} lvl mul.`),o.attribute&&u.push(`+ ${c(l*o.attribute_multiplier)} from ${c(l)} ${d(o.attribute)} * ${c(o.attribute_multiplier)} attrib. mod.`),1!=o.hit_count&&u.push(` * ${o.hit_count} hits`)),null===(s=o.text)||void 0===s?void 0:s.includes("Heal")){let o=100;for(const{source:s,modifier:a,count:l}of C(g.character,"HealEffectiveness")){const f=$(a,g.character);t.config.showFactComputationDetail&&u.push(e("span.detail",`${f>0?"+":""}${c(f/100*n)} (${c(f)}%) from ${l>1?`${l} `:""}`,i(r(s,l,g.character)))),o+=f}n*=o/100}return u.unshift(`${a(o.text)||d(o.attribute)}: ${Math.round(n)}`),u},AttributeAdjust:({fact:t})=>{const e=Math.round((t.range[1]-t.range[0])/(g.character.level/80)+t.range[0]),o=e>0?"+":"",s=[`${a(t.text)||d(t.target)}: ${o}${e}`],{computedAttribute:n}=v(t.target,g.character);if(n){const{div:t,suffix:o}=v(n,g.character),i=o?100:1;s.push(`(converts to ${c(e/t*i)}${o} ${d(n)})`)}return s},Buff:({fact:e,buff:o})=>{o||console.error("[gw2-tooltips] [facts processor] buff #",e.buff," is apparently missing in the cache"),b=(o=o||T).icon||b;const s=[];let n;[A,n]=E(e.duration,o,s);let i=S(o,e,A,n);i&&(i=h?`:<div style="margin-left: 0.5em;">${i}</div>`:`: ${i}`);const r=A>0?` (${f(A,t.config)})`:"";return s.unshift(`${a(e.text)||o.name_brief||o.name}${r}${i}`),w=e.apply_count,s},BuffBrief:({fact:t,buff:e})=>(e||console.error("[gw2-tooltips] [facts processor] buff #",t.buff," is apparently missing in the cache"),b=(e=e||T).icon||b,[`${a(t.text,e.name)}`]),Distance:({fact:t})=>[`${a(t.text)}: ${Math.round(t.distance)}`],Number:({fact:{text:o,value:s}})=>{const n=[];if(k&&o&&o.includes("Defiance")){const o=C(g.character,"Stun");if(o.length){t.config.showFactComputationDetail&&n.push(`${c(s)} base value`);let a=100;for(const{source:s,modifier:l,count:u}of o){const o=$(l,g.character);t.config.showFactComputationDetail&&n.push(e("span.detail",`${o>0?"+":""}${c(o)}% from ${u>1?`${u} `:""}`,i(r(s,u,g.character)))),a+=o}const l=a/100;s*=l,k*=l}}return n.unshift(`${a(o)}: ${u(s,t.config)}`),n},Percent:({fact:e})=>[`${a(e.text)}: ${u(e.percent,t.config)}%`],PercentDamage:({fact:e})=>[`${a(e.text)}: ${u(e.percent,t.config)}%`],PercentLifeForceCost:({fact:{percent:e,text:o}})=>{const s=y(g.character),n=[];return n.push(`${a(o)}: ${c(Math.round(s*e*.01))}`),t.config.showFactComputationDetail&&n.push(`from ${c(e)}% * ${c(s)} HP base pool`),n},PercentHealth:({fact:{percent:e,text:o}})=>{const s=Math.round(_(g.character,"Health")*e*.01);return[`${a(o)}: ${u(e,t.config)}% (${s} HP)`]},PercentLifeForceGain:({fact:{percent:o,text:s}})=>{const n=_(g.character,"Health"),l=[];t.config.showFactComputationDetail&&l.push(`${c(.01*o*n*.69)} from ${c(o)}% * (${c(n)} HP * 0.69) pool (${c(y(g.character))} base pool modified by ${c(_(g.character,"Vitality"))} Vitality)`);const f=C(g.character,"LifeForce");if(f.length){let s=100;for(const{source:o,modifier:n,count:a}of f){const u=$(n,g.character);t.config.showFactComputationDetail&&l.push(e("span.detail",`${u>0?"+":""}${c(u)}% from ${a>1?`${a} `:""}`,i(r(o,a,g.character)))),s+=u}o*=s/100}return l.unshift(`${a(s)}: ${u(o,t.config)}% (${Math.round(.69*n*o*.01)})`),l},Damage:({fact:{dmg_multiplier:o,hit_count:s,text:n},weaponStrength:l})=>{const u=[],f=_(g.character,"Power");let d=o*s*l*f/g.targetArmor;t.config.showFactComputationDetail&&(u.push(`${c(d)} from ${c(o)} internal mod. * ${c(f)} power * ${l} avg. weapon str. / ${g.targetArmor} target armor`),1!=s&&u.push(`* ${s} hits`));const p=_(g.character,"Precision"),h=_(g.character,"Ferocity"),m=Math.min(.05+(p-1e3)/21*.01,1),b=1.5+h/15*.01,w=d*m*(b-1);d+=w,t.config.showFactComputationDetail&&u.push(`+${c(w)} (${c(m*(b-1)*100)}%) from ${c(100*m)}% crit chance and ${c(100*b)}% damage on crit (${c(p)} precision and ${c(h)} ferocity)`);const v=C(g.character,"Damage");if(v.length){let o=100;for(const{source:s,modifier:n,count:a}of v){const l=$(n,g.character);t.config.showFactComputationDetail&&u.push(e("span.detail",`${l>0?"+":""}${c(l)}% from ${a>1?`${a} `:""}`,i(r(s,a,g.character)))),o+=l}d*=o/100}const y=s>1?`(${s}x)`:"";return u.unshift(`${a(n)}${y}: ${Math.round(d)}`),u},Time:({fact:{text:o}})=>{const s=[];if(k&&o&&(o.includes("Stun")||o.includes("Daze")||o.includes("Defiance"))){const o=C(g.character,"Stun");if(o.length){t.config.showFactComputationDetail&&s.push(`${c(A/1e3)}s base duration`);let n=100;for(const{source:a,modifier:l,count:u}of o){const o=$(l,g.character);t.config.showFactComputationDetail&&s.push(e("span.detail",`${o>0?"+":""}${c(o)}% from ${u>1?`${u} `:""}`,i(r(a,u,g.character)))),n+=o}A*=n/100}}const n=1e3!=A?"seconds":"second";return s.unshift(`${a(o)}: ${u(A/1e3,t.config)} ${n}`),s},ComboField:({fact:t})=>[`${a(t.text)}: ${d(t.field_type)}`],ComboFinisher:({fact:t})=>[`${a(t.text)}: ${d(t.finisher_type)}`],AttributeConversion:({fact:t})=>[`Gain ${d(t.target)} Based on a Percentage of ${d(t.source)}: ${t.percent}%`],NoData:({fact:t})=>[a(t.text)],PrefixedBuff:({fact:o,buff:s})=>{let n=m.storage.skills.get(o.prefix);n||console.error("[gw2-tooltips] [facts processor] prefix #",o.prefix," is apparently missing in the cache"),n=n||T,b=n.icon||b,s||console.error("[gw2-tooltips] [facts processor] buff #",o.buff," is apparently missing in the cache"),s=s||T;let{duration:r,apply_count:c,text:l}=o;const u=[];let d;[A,d]=E(r,s,u);let p=S(s,o,A,d);p&&(p=`: ${p}`);const g=A>0?` (${f(A,t.config)})`:"";return u.unshift(e("div.fact",x(s.icon,c),e("span",i(`${a(l)||s.name_brief||s.name}${g}${p}`)))),u},PrefixedBuffBrief:({fact:t,buff:o})=>{let s=m.storage.skills.get(t.prefix);return s||console.error("[gw2-tooltips] [facts processor] prefix #",t.prefix," is apparently missing in the cache"),s=s||T,b=s.icon||b,o||console.error("[gw2-tooltips] [facts processor] buff #",t.buff," is apparently missing in the cache"),[e("div.fact",n((o=o||T).icon),e("span",`${a(t.text)||o.name_brief||o.name}`))]},Range:({fact:{min:t,max:e}})=>[`Range: ${t?`${t} - ${e}`:e}`],StunBreak:()=>["Breaks Stun"]},D={fact:o,buff:m.storage.skills.get(o.buff||0),weaponStrength:s},[R,...j]=P[o.type](D),M=e("div.fact");o.requires_trait&&M.classList.add("gw2-color-traited-fact");let N=0;if(k){let t=A||1e3,s="";A<1e3&&o.text&&(o.text.includes("Stun")||o.text.includes("Daze")||o.text.includes("Float")||o.text.includes("Knockdown"))?(t=1e3,s=" (hard CC -> min = 100)"):1e3!=t&&(s=` (${o.defiance_break}/s)`),N=k*t/1e3,j.push(e("span.detail.gw2-color-defiance-fact",`Defiance Break: ${l(N,2)}${s}`))}if(o.requires_trait){const t=p(o.requires_trait.map((t=>{var e;return`'<span class="gw2-color-traited-fact">${(null===(e=m.storage.traits.get(t))||void 0===e?void 0:e.name)||t}</span>'`})));j.unshift(i(`<span class="detail">${o.skip_next&&(o.skip_next>1||!o.__gamemode_override_marker)?"overridden":"exists"} because of trait${1==o.requires_trait.length?"":"s"} ${t}</span>`))}return M.append(x(b,w)),M.append(e("div",e("span","string"==typeof R&&R.includes("<")?i(R):R),...j.map((t=>"string"==typeof t?e("span.detail",t):t)))),{wrapper:M,defiance_break:N}}function x(t,o=1){const s=n(t);if(1==o)return s;{const t=e("span.buff-ico",s);return t.setAttribute("count",String(o)),t}}const T={id:0,name:"Missing Buff",description:"<c=@warning>This Buff failed to load</c>",categories:[],palettes:[],modifiers:[]},P={id:0,name:"Missing Skill",description:"<c=@warning>This Skill failed to load</c>",categories:[],palettes:[],modifiers:[]};function D(t,e=3){const o=t.getElementsByTagName("gw2object");for(const t of X.entries()){const s=Array.from(o).filter((e=>(+String(e.getAttribute("contextSet"))||0)==t[0]));s.length&&R(...t,s,e)}const s=Array.from(o).filter((t=>(+String(t.getAttribute("contextSet"))||0)>=X.length));s.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",t," have the wrong context: ",s)}function R(e,o,s,n){var i,a,r,c;const l={};for(const e of s){let s;if("item"!==e.getAttribute("type")||!(s=+String(e.getAttribute("objid"))))continue;const n=m.storage.items.get(s);if(!n||!("subtype"in n)||!["Rune","Infusion"].includes(n.subtype))continue;let i=1;if("Infusion"==n.subtype){if(!(i=+String(e.getAttribute("count")))&&t.config.legacyCompatibility&&(i=N(e),!i))continue;if(!i){console.warn("[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement ",e,". Will not assume anything and just ignore the stack.");continue}}else"Pvp"==o.gameMode&&"Rune"==n.subtype&&(i=6);l[n.id]=(l[n.id]||0)+i}switch(n){case 0:o.character.upgradeCounts=l;break;case 3:o.character.upgradeCounts=Object.assign(o.character.upgradeCounts,l);break;case 1:window.GW2TooltipsContext instanceof Array?o.character.upgradeCounts=Object.assign(l,null===(i=window.GW2TooltipsContext[e].character)||void 0===i?void 0:i.upgradeCounts):window.GW2TooltipsContext?o.character.upgradeCounts=Object.assign(l,null===(a=window.GW2TooltipsContext.character)||void 0===a?void 0:a.upgradeCounts):o.character.upgradeCounts=l;break;case 2:window.GW2TooltipsContext instanceof Array?o.character.upgradeCounts=Object.assign({},null===(r=window.GW2TooltipsContext[e].character)||void 0===r?void 0:r.upgradeCounts,l):window.GW2TooltipsContext?o.character.upgradeCounts=Object.assign({},null===(c=window.GW2TooltipsContext.character)||void 0===c?void 0:c.upgradeCounts,l):o.character.upgradeCounts=l}}function j(t,e=3){const o=t.getElementsByTagName("gw2object");for(const t of X.keys()){const s=Array.from(o).filter((e=>(+String(e.getAttribute("contextSet"))||0)==t));s.length&&M(t,X,s,e)}const s=Array.from(o).filter((t=>(+String(t.getAttribute("contextSet"))||0)>=X.length));s.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",t," have the wrong context: ",s)}function M(e,o,s,n){var i,a,r,c,l,u,f,d;const p=o[e],g=structuredClone(ct.character.stats.sources),h=[];let b={};const w=o.map((t=>{let e=0;const o={};for(let[s,n]of Object.entries(t.character.upgradeCounts)){let t;(t=m.storage.items.get(+s))&&"subtype"in t&&"Infusion"==t.subtype&&(n=Math.min(n,18),o[s]=n,e+=n)}let s=Math.max(0,e-18);for(let t=100;s>0&&t>0;t--)for(const[t,e]of Object.entries(o).sort(((t,e)=>e[1]-t[1])))if(e>2){const n=1&e?1:2;if(o[t]-=n,s-=n,s<=0)break}return o}));for(const o of s){let s,n=o.getAttribute("type");if(!(s=+String(o.getAttribute("objid"))))continue;let i,a,r,c,l=1;if("item"==n){if(a=m.storage.items.get(s),!a||!("subtype"in a))continue;if("UpgradeComponent"===a.type||"Consumable"===a.type){let e=1;if("Rune"===a.subtype&&a.flags.includes("Pvp")&&(e=6),r=b[a.id]=(b[a.id]||0)+e,"Rune"===a.subtype){if(c=!0,r>6){p.character.upgradeCounts[a.id]||console.warn("[gw2-tooltips] [collect] Found more than 6 runes of the same type. Here is the 7th rune element: ",o);continue}i=a.flags.includes("Pvp")?a.tiers:[a.tiers[r-1]]}else if("applies_buff"in a){const t=m.storage.skills.get(a.applies_buff.buff);if(!t){console.warn(`[gw2-tooltips] [collect] Failed to resolve applied buff ${a.applies_buff} for `,o,". Will not assume anything and just ignore the item.");continue}i=[{modifiers:t.modifiers}]}else if("tiers"in a){if("Infusion"==a.subtype||"Enrichment"==a.subtype){if(!(l=+String(o.getAttribute("count")))&&t.config.legacyCompatibility&&(l=N(o),!l))continue;if(!l){console.warn("[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement ",o,". Will not assume anything and just ignore the stack.");continue}}else if("Sigil"===a.subtype&&r>1){r>2&&console.warn("[gw2-tooltips] [collect] Found more than 2 sigils of the same type. Here is the 3th sigil element: ",o);continue}i=a.tiers}}}else if("pvp/amulet"==n&&(a=m.storage["pvp/amulets"].get(s),!a))continue;let u=a&&st(a,+String(o.getAttribute("stats"))||void 0);if(u&&(i=[{modifiers:u.attributes.map((t=>({target_attribute_or_skill:t.attribute,base_amount:Math.round(t.base_value+a.attribute_base*t.scaling),formula:"NoScaling",flags:[],id:-1,formula_param1:0,formula_param2:0,description:""})))}]),a&&"defense"in a){const t="number"==typeof a.defense?a.defense:A[Math.min(100,a.defense[0]+p.character.level)]*a.defense[1];i||(i=[{modifiers:[]}]),i[0].modifiers.push({target_attribute_or_skill:"Armor",base_amount:t,formula:"NoScaling",flags:[],id:-1,formula_param1:0,formula_param2:0,description:""})}let f=g;const d=+String(o.getAttribute("weaponSet"));if(isNaN(d)&&a&&"UpgradeComponent"==a.type){const t=w[e][a.id];t?l=t:l>18&&(l=18)}if(isNaN(d)||(f=h[d]||(h[d]=structuredClone(ct.character.stats.sources))),i)for(const[t,e]of i.entries())if(e.modifiers)for(const o of e.modifiers){if(!o.target_attribute_or_skill||o.mode&&o.mode!==p.gameMode||o.source_trait_req&&!p.character.traits.includes(o.source_trait_req)||o.target_trait_req&&!p.character.traits.includes(o.target_trait_req))continue;let e=it(a,p,u,void 0,-1);c&&(e=`${e} (Tier ${1===i.length?r:t+1} Bonus)`),(f[o.target_attribute_or_skill]||(f[o.target_attribute_or_skill]=[])).push({modifier:o,source:e,count:l})}}const v=p.character,y=()=>{for(const[t,e]of h.entries()){const o=v.statsWithWeapons[t];o?o.sources=e:v.statsWithWeapons[t]={sources:e,values:Object.assign({},ct.character.statsWithWeapons[0].values),htmlParts:structuredClone(ct.character.statsWithWeapons[0].htmlParts)}}};switch(n){case 0:v.stats.sources=g,y();break;case 3:for(const[t,e]of Object.entries(g))(v.stats.sources[t]||(v.stats.sources[t]=[])).push(...e);for(const[t,e]of h.entries()){const o=v.statsWithWeapons[t];if(o)for(const[t,s]of Object.entries(e))(o.sources[t]||(o.sources[t]=[])).push(...s);else v.statsWithWeapons[t]={sources:e,values:Object.assign({},ct.character.statsWithWeapons[0].values),htmlParts:structuredClone(ct.character.statsWithWeapons[0].htmlParts)}}break;case 1:window.GW2TooltipsContext instanceof Array?(v.stats.sources=Object.assign(g,null===(a=null===(i=window.GW2TooltipsContext[e].character)||void 0===i?void 0:i.stats)||void 0===a?void 0:a.sources),console.assert(!1)):window.GW2TooltipsContext?(v.stats.sources=Object.assign(g,null===(c=null===(r=window.GW2TooltipsContext.character)||void 0===r?void 0:r.stats)||void 0===c?void 0:c.sources),console.assert(!1)):(v.stats.sources=g,y());break;case 2:window.GW2TooltipsContext instanceof Array?(v.stats.sources=Object.assign({},null===(u=null===(l=window.GW2TooltipsContext[e].character)||void 0===l?void 0:l.stats)||void 0===u?void 0:u.sources,g),console.assert(!1)):window.GW2TooltipsContext?(v.stats.sources=Object.assign({},null===(d=null===(f=window.GW2TooltipsContext.character)||void 0===f?void 0:f.stats)||void 0===d?void 0:d.sources,g),console.assert(!1)):(v.stats.sources=g,y())}}function N(t){var e,o;const s=Array.prototype.indexOf.call(t.parentElement.children,t),n=t.parentElement.getElementsByClassName("amount")[s];if(!n)return void console.warn("[gw2-tooltips] [collect] `legacyCompatibility` is active, but no amount element for infusion ",t," could be found. Will not assume anything and just ignore the stack.");const i=+String(null===(o=null===(e=n.textContent)||void 0===e?void 0:e.match(/\d+/))||void 0===o?void 0:o[0]);if(i){if(!(i<1||i>20))return i;console.warn("[gw2-tooltips] [collect] [legacyCompatibility] Amount element ",n," for infusion element ",t," did got interpreted as x",i," which is outside of the range of sensible values (amount in [1...20]). Will not assume anything and just ignore the stack.")}else console.warn("[gw2-tooltips] [collect] [legacyCompatibility] Amount element ",n," for infusion element ",t," did not contain any readable amount. Will not assume anything and just ignore the stack.")}function O(t,e=3){const o=t.querySelectorAll("gw2object[type=specialization]:not(.gw2objectembed)");for(const t of X.entries()){const s=Array.from(o).filter((e=>(+String(e.getAttribute("contextSet"))||0)==t[0]));s.length&&W(...t,s,e)}const s=Array.from(o).filter((t=>(+String(t.getAttribute("contextSet"))||0)>=X.length));s.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",t," have the wrong context: ",s)}function W(t,e,o,s){var n,i;const a=[];for(const t of o){const e=String(t.getAttribute("selected_traits")).split(",").map((t=>+t)).filter((t=>!isNaN(t)&&0<=t&&t<=2));if(3==e.length)for(const[o,s]of e.entries()){{const e=t.children[1+2*o].children[s];let n;if(!e||!(n=+String(e.getAttribute("objid")))){console.warn("[gw2-tooltips] [collect] Trait object ",e,' is selected but does not exist or does not have an objid set. Add the attribute as `objid="1234"`. Will not assume anything and just ignore the element.');continue}a.push(n)}{const e=t.children[2*o];let s;if(!(s=+String(e.getAttribute("objid")))){console.warn("[gw2-tooltips] [collect] Minor trait object ",e,' does not have an objid set. Add the attribute as `objid="1234"`. Will not assume anything and just ignore the element.');continue}a.push(s)}}else console.warn("[gw2-tooltips] [collect] Specialization object ",t," does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\"0,2,1\"` where the numbers are 0-2 indicating top, middle or bottom selection. Will not assume anything and just ignore the element.")}switch(s){case 0:case 2:e.character.traits=a;break;case 3:case 1:if(window.GW2TooltipsContext instanceof Array){const o=new Set(null===(n=window.GW2TooltipsContext[t].character)||void 0===n?void 0:n.traits);a.forEach((t=>o.add(t))),e.character.traits=Array.from(o)}else if(window.GW2TooltipsContext){const t=new Set(null===(i=window.GW2TooltipsContext.character)||void 0===i?void 0:i.traits);a.forEach((e=>t.add(e))),e.character.traits=Array.from(t)}else e.character.traits=a}}function B(t,o,s=!1){if(!s&&t.childElementCount>0)return;const i=e("a",n(o.icon,void 0,o.name));if(i.href="https://wiki-en.guildwars2.com/wiki/Special:Search/"+r(a(o.name),1,{sex:"Male"}),i.target="_blank",t.classList.contains("gw2objectembed")&&!t.classList.contains("icononly")){const t=a(o.name).replaceAll(/\[.*?\]/g,"");i.append(t)}t[s?"replaceChildren":"append"](i)}function F(t,e){const o=+String(t.getAttribute("contextSet"))||0,s=at(X[o],t);let n=!1;if(t.classList.contains("auto-transform")){const o=ot(e,s);o&&(t.setAttribute("objid",String(o.id)),e=o,n=!0)}B(t,e,n)}function I(t,o){if(t.childElementCount>0)return;const s=+String(t.getAttribute("count"))||1,i=X[+String(t.getAttribute("contextSet"))||0],r=e("a",n(o.icon,void 0,o.name));r.href="https://wiki-en.guildwars2.com/wiki/Special:Search/"+a(o.name).replaceAll(/\[.*?\]/g,""),r.target="_blank",t.classList.contains("gw2objectembed")&&r.append(it(o,i,void 0,void 0,s)),t.append(r)}function L(t,e){if(t.classList.contains("gw2objectembed"))B(t,e);else{t.style.backgroundImage=`url(${e.background.includes(":")?e.background:o+e.background})`,t.dataset.label=e.name;const s=String(t.getAttribute("selected_traits")).split(",").map((t=>+t)).filter((t=>!isNaN(t)&&0<=t&&t<=2));if(3!=s.length)return void console.warn("[gw2-tooltips] [inflator] Specialization object ",t," does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\"0,2,1\"` where the numbers are 0-2 indicating top, middle or bottom selection.");for(const[e,o]of s.entries()){const s=t.children[1+2*e];if(s)for(const[t,e]of Array.prototype.entries.call(s.children))e.classList.toggle("trait_unselected",t!==o);else console.warn("[gw2-tooltips] [inflator] Cannot mark selected trait object in column #",e," for specialization object ",t," because the column doesn't seem to exist. Either mark the specialization object as inline or add the missing column.")}}}function H(t,o){const s=_(X[+String(t.getAttribute("contextSet"))||0].character,o),i={Power:[66722,""],Toughness:[104162,""],Vitality:[104163,""],Precision:[156609,""],Ferocity:[156602,""],ConditionDamage:[156600,""],Expertise:[156601,""],Concentration:[156599,""],HealingPower:[156606,""],AgonyResistance:[536049,""],Health:[536052,""],Armor:[536048,""],ConditionDuration:[156601,"%"],BoonDuration:[156599,"%"],CritChance:[536051,"%"],CritDamage:[784327,"%"],MagicFind:[536054,"%"]}[o];let a,r="";i?[a,r]=i:console.warn(`[gw2-tooltips] [inflator] Unknown attribute '${o}' on object `,t);const c=r?100:1;let u=d(o);"Profession"==o&&(u="Attribute#Profession_Attributes");const f=e("a",n(a));f.href=`https://wiki-en.guildwars2.com/wiki/Special:Search/${u}`,f.target="_blank",t.classList.contains("gw2objectembed")&&(void 0!==s?f.append(l(s*c,1)+r):f.append("???"+r)),t.replaceChildren(f)}function G(t,e){const o=String(t.getAttribute("objId"));let s={chaos_aura:10332,dark_aura:39978,fire_aura:5677,frost_aura:5579,light_aura:25518,magnetic_aura:5684,shocking_aura:5577,aegis:743,alacrity:30328,fury:725,might:740,protection:717,quickness:1187,regeneration:718,resistance:26980,resolution:873,stability:1122,swiftness:719,vigor:726,bleeding:736,blinded:720,burning:737,chill:722,chilled:722,confusion:861,crippled:721,fear:896,immobilize:727,poison:723,slow:26766,taunt:27705,torment:19426,vulnerability:738,weakness:742,daze:833,stun:872,agony:15773,invulnerability:56227,revealed:890,stealth:58026,superspeed:5974,unblockable:18843,blight:62653,bloodstone_blessed:34917,blue_pylon_power:31413,champion_of_the_legions:20845,compromised:35096,crowd_favor:36173,curse_of_frailty:53723,debilitated:67972,debilitating_void:64967,defense_up:28482,derangement:34965,elemental_empowerment:62733,empowering_auras:62939,equalization_matrix:67047,expose_weakness:26660,exposed:28778,extreme_vulnerability:65662,fixated:47434,growing_rage_ashym:3362,ignite:16259,intervention:35061,necrosis:47414,not_sticking_together:54378,nova:39193,ooze_pheromone:21538,photon_saturation:67872,positive_flow:66665,power_of_the_void:65601,reinforced_armor:9283,relentless_fire:62805,retaliation_ashym:24646,sentinel_retribution:16350,shattering_ice:62909,shell_shocked:33361,spectral_darkness:31498,sticking_together:54604,synchronized_vitality:63840,unnatural_signet:38224,use_soul_binder:55630,void_empowerment:68083,xeras_embrace:34979}[o];if(!s){const t={barrier:{id:1,name:"Barrier",icon:mt.BARRIER,description:"Creates a health barrier that takes damage prior to the health bar. Barrier disappears 5s after being applied. Applying a barrier while one is already active will add to it, but the previously-existing barrier will still disappear 5s after it was originally applied. The amount of barrier generated is based on the source's healing power, and is capped at 50% of the recipient's maximum health.",description_brief:"Creates a health barrier that takes damage prior to the health bar.",categories:[],palettes:[]},stunbreak:{id:2,name:"Stun Break",description:"Cancel control effects such as stuns.",icon:mt.STUN_BREAK,categories:[],palettes:[]},knockdown:{id:3,name:"Knockdown",description:"Knocks the target on ground, preventing movement and actions for a short duration.",icon:mt.KNOCKDOWN,categories:[],palettes:[]},pull:{id:4,name:"Pull",description:"Pulls the caster to the target or the target to a specific location and disables them for a short duration.",icon:mt.PULL,categories:[],palettes:[]},knockback:{id:5,name:"Knockback",description:"Knocks back the target away and on the ground, preventing movement and actions for a short duration.",icon:mt.KNOCKBACK,categories:[],palettes:[]},launch:{id:6,name:"Launch",description:"Throws the target in the air over a short distance, preventing movement and actions for a short duration. Can move Downed targets.",icon:mt.LAUNCH,categories:[],palettes:[]},float:{id:7,name:"Float",description:"Causes the target to float in the air, preventing movement and actions for a short duration. Causes underwater targets to move up.",icon:mt.FLOAT,categories:[],palettes:[]},sink:{id:8,name:"Sink",description:"Causes the underwater target to move downwards.",icon:mt.SINK,categories:[],palettes:[]}}[o];t&&(s=t.id,m.storage.skills.set(s,t))}return s?(t.setAttribute("type","skill"),t.setAttribute("objId",String(s)),s):(t.innerText=o,t.title=`Failed to translate effect '${o}'.`,t.style.cursor="help",t.classList.add("error"),e.add(o),0)}let U,q,z,K,V=0;const X=[];function J(t){const e=U.children;for(let o=0;o<e.length;o++)e[o].classList.contains("not-collapsable")||e[o].classList.toggle("active",o===t)}function Q(t,e=!1){const o=U.children[t];U.style.transition=e?"transform 0.25s":"",U.style.transform=`translate(0, -${o.offsetTop+o.offsetHeight}px)`}function Y(t=!1){const e=document.getElementById("wpadminbar"),o=e?e.offsetHeight:0,s=U.children[V];let n=z+6;n+U.offsetWidth>document.documentElement.clientWidth-22&&(n=document.documentElement.clientWidth-(U.offsetWidth+22));let i=K-6;i-s.offsetHeight<document.documentElement.scrollTop+o+13&&(t&&(U.style.transition+=", top 0.25s",setTimeout((()=>U.style.transition=""),250)),i=document.documentElement.scrollTop+o+13+s.offsetHeight),U.style.left=`${n}px`,U.style.top=`${i}px`}async function Z(e,o){const s={skills:new Map,traits:new Map,items:new Map,specializations:new Map,pets:new Map,"pvp/amulets":new Map,attributes:new Map},n=new Set,i=new Set;for(const o of e.getElementsByTagName("gw2object")){const e=+String(o.getAttribute("stats"));isNaN(e)||n.add(e);let a=o.getAttribute("objId"),r=(o.getAttribute("type")||"skill")+"s";if("attributes"===r){if("string"==typeof a){const t=s.attributes.get(a);t?t.push(o):s.attributes.set(a,[o])}}else{let e=+String(a);if("effects"===r){if(!t.config.legacyCompatibility)continue;r="skills",e=G(o,i)}if(isNaN(e)||!(r in s))continue;{const t=s[r].get(e);t?t.push(o):s[r].set(e,[o])}}o.addEventListener("mouseenter",(t=>tt(t.target))),o.addEventListener("mouseleave",(()=>{U.style.display="none",U.style.transform=""}))}return i.size&&console.error("[gw2-tooltips] [legacy-compat] Some effects could not be translated into skills: ",Array.from(i)),n.size>0&&m.ensureExistence("itemstats",n.values()),await Promise.all(Object.entries(s).filter((([t,e])=>"attributes"!=t)).map((async([t,e])=>{if(0==e.size)return;let o;switch(t){case"skills":o=F;break;case"items":o=I;break;case"specializations":o=L;break;default:o=B}const s=m.storage[t];await m.ensureExistence(t,e.keys());for(const[t,n]of e){const e=s.get(t);if(n&&e)for(const t of n)o(t,e)}}))),s}function tt(o,s=0){const f=(o.getAttribute("type")||"skill")+"s",g=o.getAttribute("objId");let h=X[+String(o.getAttribute("contextSet"))||0];const b=+String(o.getAttribute("stats"))||void 0,w=+String(o.getAttribute("count"))||void 0;if("specializations"==f||"effects"==f)return;if(q=o,"attributes"==f){if(g){V=s,U.replaceChildren(function(t,o){const s=o.character.statsWithWeapons[o.character.selectedWeaponSet],a=s.values[t];let l=s.htmlParts[t];if(["ConditionDuration","BoonDuration"].includes(t)){l=l.slice();const u="ConditionDuration"===t?"Condition":"Boon",f=structuredClone(o.character.stats.sources);for(const[t,e]of Object.entries(s.sources))isNaN(+t)||(f[t]||(f[t]=[])).push(...e);const d=100*(v(t,o.character).cap-1);for(const[t,s]of Object.entries(f)){if(isNaN(+t))continue;const f=m.storage.skills.get(+t);if(!f){console.error(`[gw2-tooltips] [tooltip engine] effect #${t} is missing in cache.`);continue}if(f.buff_type!==u)continue;let p=100*a,g=[];for(const{source:t,modifier:n,count:a}of s){const s=$(n,o.character);g.push(e("span.detail",`${s>0?"+":""}${c(s)}% from ${a>1?`${a} `:""}`,i(r(t,a,o.character)))),p+=s}const h=p;p=Math.min(p,d),h!=p&&g.push(e("span.detail.capped",`(Capped to +${c(p)}%! Uncapped value would be ${c(h)}%)`)),l.push(e("div.fact",n(f.icon),e("div",e("span",`${f.name}: +${c(p)}%`),...g)))}}return e("div.tooltip.item.active",...l)}(g,h)),U.style.display="";for(const t of U.children)t.classList.add("active");Q(V)}return}const y=m.storage[f].get(+String(g));if(y){if(V=s,h=at(h,o),U.replaceChildren(...function(o,s,c,f,g){let h=1;"trait"==(s.getAttribute("type")||"skill")?h=2:o.name.includes("Relic[s] of")&&(h=0);const b=[],w=s.classList.contains("auto-transform"),v=(t,e)=>{let o=!1;if("palettes"in t){if(w){const e=ot(t,c);e&&(t=e)}b.push({obj:t,notCollapsable:!1,iconMode:e});const s=t.palettes.find((t=>bt.includes(t.type)&&t.slots.some((t=>t.profession))));if(s)for(const t of s.slots)if(t.next_chain&&t.profession){const e=m.storage.skills.get(t.next_chain);e&&(o=!0,v(e,h))}}else b.push({obj:t,notCollapsable:!1,iconMode:e});if(!o){if("bundle_skills"in t)for(const e of t.bundle_skills){const t=m.storage.skills.get(e);t&&b.push({obj:t,notCollapsable:!1,iconMode:h})}if("related_skills"in t){const e=s.getAttribute("type")||"skill";for(const o of t.related_skills){const t=m.storage.skills.get(o);t&&("skill"!=e||t.palettes.some((t=>bt.includes(t.type))))&&b.push({obj:t,notCollapsable:!1,iconMode:h})}}}if("skills"in t)for(const e of t.skills){let t=m.storage.skills.get(e);t||(console.warn(`[gw2-tooltips] pet skill #${e} is missing from the cache. The query was caused by `,s),t=P),b.push({obj:t,notCollapsable:!0,iconMode:h})}};v(o,1);let y=+String(s.getAttribute("weaponSet"));isNaN(y)&&(y=void 0);const _=b.map((({obj:o,notCollapsable:h,iconMode:b})=>"type"in o?function(t,o,s,r,c=1){var l;let u,f=st(t,r);"slots"in t&&(u=null===(l=s.getAttribute("slotted"))||void 0===l?void 0:l.split(",").map((t=>m.storage.items.get(+String(t)||0))).filter((t=>t&&"subtype"in t)));const p=c>1?c+" ":"",g=(null==u?void 0:u.find((t=>!["Infusion","Enrichment"].includes(t.subtype))))||(null==u?void 0:u[0]),h=p+it(t,o,f,g,c),b=[e("tet.title",n(t.icon),e("teb.gw2-color-rarity-"+t.rarity.toLowerCase(),h),e("div.flexbox-fill"))];if("defense"in t&&t.defense){const s="number"==typeof t.defense?t.defense:A[Math.min(100,t.defense[0]+o.character.level)]*t.defense[1];b.push(e("te",e("tem","Defense: ",e("span.gw2-color-stat-green",String(s)))))}if("power"in t){let s;if("mul"in t.power){let e=pt.Legendary;["PlayerLevelScaleRarity","ItemScale4"].includes(t.power.scaling)&&(o.character.level<14?e=pt.Common:o.character.level<30?e=pt.Uncommon:o.character.level<60?e=pt.Rare:o.character.level<80&&(e=pt.Exotic));const n=Math.min(pt[t.rarity],e);let i=gt[n];t.power.scaling?i+=o.character.level:i+=t.level;const a=(o.character.isPlayer?k:S)[Math.min(100,i)]*t.power.mul*ht[n],r=a*t.power.spread;s=[Math.ceil(a-r),Math.ceil(a+r)]}else s=t.power;const n=e("tem","Weapon Strength: ",e("span.gw2-color-stat-green",`${s[0]} - ${s[1]}`));t.damage_type&&n.append(` (${t.damage_type})`),b.push(e("te",n))}"tiers"in t&&b.push(nt(t,o));f&&"attribute_base"in t&&b.push(...f.attributes.map((({attribute:o,base_value:s,scaling:n})=>e("te",e("tem.gw2-color-stat-green",`+${Math.round(s+t.attribute_base*n)} ${d(o)}`)))));"slots"in t&&b.push(e("div.group.slots",...t.slots.map((t=>{let s=-1;if(u)switch(t){case"Upgrade":s=u.findIndex((t=>["Rune","Sigil","Gem"].includes(t.subtype)));break;case"Infusion":s=u.findIndex((t=>"Infusion"==t.subtype));break;case"Enrichment":s=u.findIndex((t=>"Enrichment"==t.subtype))}if(s>-1){const t=u.splice(s,1)[0],i=nt(t,o),a=it(t,o,f);return i.prepend(e("tet",n(t.icon,"iconsmall"),e("teb.gw2-color-rarity-"+t.rarity,a),e("div.flexbox-fill"))),i}return e("te",n(mt["SLOT_"+t],"iconsmall"),`Empty ${t} Slot`)}))));let w=!1;"applies_buff"in t&&(b.push(e("span",i(a(t.description)))),b.push(e("div.group",E(t.applies_buff,-1,o,!0).wrapper)),w=!0);const v=e("div.group");("Armor"==t.type||"Weapon"==t.type||"Trinket"==t.type&&!t.flags.includes("Pvp"))&&(v.append(e("span.gw2-color-rarity-"+t.rarity,t.rarity)),"weight"in t&&v.append(e("span",t.weight)),v.append(e("span",`${t.type}: ${t.subtype}`)),"Weapon"==t.type&&function(t){switch(t){case"Axe":case"Dagger":case"Mace":case"Pistol":case"Scepter":case"Focus":case"Sword":case"BowShort":case"Torch":case"Shield":case"Warhorn":case"Toy":case"ToyTwoHanded":case"BundleSmall":return!1;case"Hammer":case"BowLong":case"Greatsword":case"Polearm":case"Rifle":case"Staff":case"BundleLarge":case"Spear":case"Speargun":case"Trident":return!0}}(t.subtype)&&v.append(e("span.gw2-color-rarity-Junk","(Two-Handed)")),t.required_level&&v.append(e("span","Required Level: "+t.required_level)));t.description&&!w&&v.append(e("span",i(a(t.description))));t.flags.includes("Pvp")||(t.flags.includes("Unique")&&v.append(e("span","Unique")),t.flags.includes("AccountBound")&&v.append(e("span","Account Bound")),t.flags.includes("SoulBindOnUse")?v.append(e("span","Soulbound on Use")):t.flags.includes("SoulBindOnAcquire")&&v.append(e("span","Soulbound on Acquire")));if(!t.flags.includes("NoSalvage")){const o=["Consumable"==t.type&&"Food"==t.subtype?"Compost":"Ascended"==t.rarity?"Ascended":"Standard"];t.flags.includes("SalvageResearch")&&o.push("Research"),o.length&&v.append(e("span","Salvage: "+o.join(", ")))}if(t.vendor_value){let o=["Vendor Value: ",rt(t.vendor_value*c)];c>1&&o.push(" (",rt(t.vendor_value),` x ${c})`),v.append(e("span",...o))}b.push(v);const y=e("div.tooltip.item.active",...b);return y.dataset.id=String(t.id),y}(o,c,s,f,g):function(o,s,c,f,g){var h;const b=[];(1==c||2==c&&(w=o.icon,!["2141735.png","2141736.png","2141737.png"].includes(w)))&&b.push(n(o.icon));var w;b.push(e("teb",a(r(o.name,1,f.character))),e("div.flexbox-fill"));const v=et(o,f);"flags"in o&&o.flags.includes("DisallowUnderwater")&&b.push(n(mt.NO_UNDERWATER,"iconsmall"));if(v.activation){const o=u(v.activation/1e3,t.config);"0"!=o&&b.push(e("ter",o,n(mt.ACTIVATION,"iconsmall")))}v.resource_cost&&b.push(e("ter",String(v.resource_cost),n("Revenant"==f.character.profession?mt.RESOURCE_REV:mt.RESOURCE_THIEF,"iconsmall")));v.endurance_cost&&b.push(e("ter",String(Math.round(v.endurance_cost)),n(mt.ENDURANCE_COST,"iconsmall")));v.upkeep_cost&&b.push(e("ter",String(v.upkeep_cost),n(mt.UPKEEP_COST,"iconsmall")));if(v.recharge){const o=u(v.recharge/1e3,t.config);"0"!=o&&b.push(e("ter",o,n(mt.RECHARGE,"iconsmall")))}v.supply_cost&&b.push(e("ter",String(v.supply_cost),n(mt.SUPPLY_COST,"iconsmall")));const y=[];{let t="slot"in o&&o.slot||"palettes"in o&&function(t){let e;for(const o of t.palettes)for(const s of o.slots)switch(o.type){case"Equipment":case"Bundle":(o.weapon_type||"Bundle"==o.type)&&(e=s.slot.replace(/(Offhand|Main)(\d)/,((t,e,s)=>("Offhand"==e&&(s="1"===s?"4":"5"),`${o.weapon_type?d(o.weapon_type):"Bundle"} ${s}`))));break;case"Standard":"Standard"===s.slot&&(e="Utility");break;case"Heal":case"Toolbelt":case"Elite":e=o.type;break;case"Pet":case"Profession":e=s.slot.replace(/Profession(\d)/,"Profession $1");break;case"Monster":break;default:console.error(`[gw2-tooltips] [tooltip engine] unknown palette type '${o.type}' for skill '${t.name}'`)}return e}(o);"specialization"in o&&(t=((null===(h=m.storage.specializations.get(o.specialization))||void 0===h?void 0:h.name)||o.specialization)+" - "+t),t&&y.push(e("tes",`( ${t} )`)),void 0!==g&&y.push(e("tes",`( Weapon Set ${g+1} )`))}if(y.push(e("div.flexbox-fill")),"override_groups"in o&&o.override_groups){const t=new Set(["Pve","Pvp","Wvw"]);for(const e of o.override_groups)for(const o of e.context)t.delete(o);const s=[Array.from(t),...o.override_groups.map((t=>t.context))],n=[];for(const t of["Pve","Pvp","Wvw"]){let e;for(let o=0;o<s.length;o++)if(s[o].includes(t)){e=s.splice(o,1)[0];break}if(!e)continue;const o=e.join("/");e.includes(f.gameMode)?n.push(`<span style="color: var(--gw2-tt-color-text-accent) !important;">${o}</span>`):n.push(o)}y.push(e("tes","( ",i(n.join(" | "))," )"))}const _=[e("tet.title",...b)];y.length>1&&_.push(e("tet.detail",...y));"description"in o&&o.description&&_.push(e("p.description",i(a(o.description))));if(v.blocks){let t=690.5;if("palettes"in o&&o.palettes.length){const e=f.character.profession?t=>t.profession===f.character.profession:t=>t.profession,s=o.palettes.find((t=>t.slots.some(e)));s&&(t=function({weapon_type:t,type:e}){return t?{BundleLarge:0,Standard:690.5,Focus:900,Shield:900,Torch:900,Warhorn:900,Greatsword:1100,Hammer:1100,Staff:1100,BowLong:1050,Rifle:1150,BowShort:1e3,Axe:1e3,Sword:1e3,Dagger:1e3,Pistol:1e3,Scepter:1e3,Mace:1e3,Spear:1e3,Speargun:1e3,Trident:1e3}[t]:"Bundle"===e?922.5:690.5}(s))}_.push(...function(t,o,s){const[r,...c]=t;let u=0;const f=t=>t?t.sort(((t,e)=>t.order-e.order)).map((t=>{const{wrapper:e,defiance_break:n}=E(t,o,s);return u+=n,e})).filter((t=>t)):[],d=[];for(const t of c){const o=e("div.fact-block");if(t.trait_requirements){const e=p(t.trait_requirements.map((t=>{var e;return`'<span class="gw2-color-traited-fact">${(null===(e=m.storage.traits.get(t))||void 0===e?void 0:e.name)||t}</span>'`})));o.append(i(`<span class="detail">Block exists because of trait${1==t.trait_requirements.length?"":"s"} ${e}</span>`))}t.description&&o.append(e("p.description",i(a(t.description))));const s=f(t.facts);o.append(...s),d.push(o)}if(r&&d.push(...f(r.facts)),u>0){const t=e("div.fact",n(mt.DEFIANCE_BREAK,"iconmed"),e("div.gw2-color-defiance-fact",`Defiance Break: ${l(u,2)}`));d.push(t)}return d}(v.blocks,t,f))}const C=e("div.tooltip",..._);s&&C.classList.add("not-collapsable");return C.dataset.id=String(o.id),C}(o,h,b,c,y)));return U.append(..._),_}(y,o,h,b,w)),U.style.display="",Array.from(U.children).filter((t=>!t.classList.contains("not-collapsable"))).length>1)o.classList.add("cycler"),o.title="Right-click to cycle through tooltips",J(V);else for(const t of U.children)t.classList.add("active");Q(V)}}function et(t,e){var o,s,n,i,a,r;let c=null===(o=t.override_groups)||void 0===o?void 0:o.find((t=>t.context.includes(e.gameMode))),l=Object.assign({},t,c);if(l.blocks=structuredClone(t.blocks),!l.blocks)return l;if(null==c?void 0:c.blocks){const o=Math.max(t.blocks.length,c.blocks.length);for(let a=0;a<o;a++){const o=t.blocks[a],r=c.blocks[a];if(r){if(o||(l.blocks[a]={description:r.description,trait_requirements:r.trait_requirements}),!r.facts)continue;const t=l.blocks[a].facts=null!==(n=null===(s=o.facts)||void 0===s?void 0:s.slice())&&void 0!==n?n:[];for(const o of r.facts)(null===(i=o.requires_trait)||void 0===i?void 0:i.some((t=>!e.character.traits.includes(t))))||(void 0!==o.insert_before?(o.skip_next&&(o.__gamemode_override_marker=!0),t.splice(o.insert_before,0,o)):t.push(o))}}}const u=[];for(const t of l.blocks)if(!(null===(a=t.trait_requirements)||void 0===a?void 0:a.some((t=>!e.character.traits.includes(t))))){if(t.facts){const o=[];let s=0;for(let n=0;n<t.facts.length;n++){const i=t.facts[n];(null===(r=i.requires_trait)||void 0===r?void 0:r.some((t=>!e.character.traits.includes(t))))||(s-- >0||(o.push(i),s=i.skip_next||0))}t.facts=o}u.push(t)}return l.blocks=u,l}function ot(t,e){var o;for(const s of t.palettes)for(const n of s.slots)if(n.traited_alternatives){const s=n.traited_alternatives.find((([t,o])=>e.character.traits.includes(t)));if(!s)return;const[i,a]=s;if(a==t.id)return;const r=m.storage.skills.get(a);return r?(console.info(`[gw2-tooltips] Corrected skill #${t.id} (${t.name}) to #${r.id} (${r.name}) because the trait #${i} (${(null===(o=m.storage.traits.get(i))||void 0===o?void 0:o.name)||"<not cached>"}) is active.`),r):void console.error(`[gw2-tooltips] Corrected skill #${a} is missing in the cache.`)}}function st(e,o){let s;if("Armor"==e.type||"Trinket"==e.type||"Weapon"==e.type)if(void 0===(o=o||e.attribute_set))console.warn("[gw2-tooltips] [tooltip engine] Hovering on item without specified or innate stats. Specify the stats by adding 'stats=\"<stat_set_id>\" to the html element.' ");else if(s=m.storage.itemstats.get(o),s){if(t.config.adjustIncorrectStatIds&&s.similar_sets){const t=s.similar_sets[e.subtype];if(void 0!==t){console.info(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${o} to #${t} because the target is of type ${e.subtype}.`);const n=m.storage.itemstats.get(t);n?s=n:console.error(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${t} is missing in the cache.`)}}}else console.error(`[gw2-tooltips] [tooltip engine] itemstat #${o} is missing in cache.`);return s}function nt(t,o){const s=e("div.group");for(const[n,r]of t.tiers.entries()){let c=e("te");if(r.description)c.append(e("span",i(a(r.description))));else if(r.facts)for(const t of r.facts){const{wrapper:e}=E(t,null,o);e&&c.append(e)}else if(r.modifiers){c.style.flexDirection="column";for(const t of r.modifiers){let s,n=$(t,o.character);s=t.flags.includes("FormatPercent")?`+${Math.round(n)}% ${d(t.description)}`:`+${Math.round(n)} ${d(t.description)}`,c.append(e("te",s))}}const l=e("te",c);if("Rune"==t.subtype){const s=n<(o.character.upgradeCounts[t.id]||0)?".gw2-color-stat-green":"";l.prepend(e("span"+s,`(${n+1})`))}s.append(l)}return s}function it(t,e,o,s,n=1){let i,c,l,u,f;return i="TraitGuide"==t.type?t.trait:t.name,c=l=u=f="",t.flags.includes("HidePrefix")||o&&o.name&&(c=o.name,l=" "),t.flags.includes("HideSuffix")||s&&s.suffix&&(f=s.suffix,u=" "),i=a(i,c,l,u,f),n>-1&&(i=r(i,n,e.character)),t.flags.includes("Pve")||!t.flags.includes("Pvp")&&!t.flags.includes("PvpLobby")||(i+=" (PvP)"),i}function at(t,e){let o=e.getAttribute("with-traits");if(o){(t=Object.assign({},t)).character=Object.assign({},t.character);const s=[];t.character.traits=o.split(",").map((t=>{const e=+t;return e||s.push(t),e})).filter((t=>t)),s.length&&console.warn("[gw2-tooltips] [tooltip engine] Inline trait-override for element ",e," has misformed overrides: ",s)}return t}function rt(t){const o=[String(Math.floor(t%100)),n(mt.COIN_COPPER,"iconsmall","")];return t>99&&o.unshift(String(Math.floor(t/100%100)),n(mt.COIN_SILVER,"iconsmall","")),t>9999&&o.unshift(String(Math.floor(t/1e4)),n(mt.COIN_GOLD,"iconsmall","")),e("span",...o)}t.config=null;const ct={gameMode:"Pve",targetArmor:2597,character:{level:80,isPlayer:!0,sex:"Male",traits:[],stats:{values:{Power:0,Toughness:0,Vitality:0,Precision:0,Ferocity:0,ConditionDamage:0,Expertise:0,Concentration:0,HealingPower:0,AgonyResistance:0},sources:{Power:[],Toughness:[],Vitality:[],Precision:[],Ferocity:[],ConditionDamage:[],Expertise:[],Concentration:[],HealingPower:[],AgonyResistance:[],Armor:[],Damage:[],LifeForce:[],Health:[],HealEffectiveness:[],Stun:[],ConditionDuration:[],BoonDuration:[],CritChance:[],CritDamage:[]}},statsWithWeapons:[{values:{Power:1e3,Toughness:1e3,Vitality:1e3,Precision:1e3,Ferocity:0,ConditionDamage:0,Expertise:0,Concentration:0,HealingPower:0,AgonyResistance:0,Health:1e4,Armor:1e3,CritChance:.05,CritDamage:1.5,ConditionDuration:0,BoonDuration:0},sources:{Power:[],Toughness:[],Vitality:[],Precision:[],Ferocity:[],ConditionDamage:[],Expertise:[],Concentration:[],HealingPower:[],AgonyResistance:[],Armor:[],Damage:[],LifeForce:[],Health:[],HealEffectiveness:[],Stun:[],ConditionDuration:[],BoonDuration:[],CritChance:[],CritDamage:[]},htmlParts:{Power:[],Toughness:[],Vitality:[],Precision:[],Ferocity:[],ConditionDamage:[],Expertise:[],Concentration:[],HealingPower:[],AgonyResistance:[],Armor:[],Health:[],ConditionDuration:[],BoonDuration:[],CritChance:[],CritDamage:[]}}],selectedWeaponSet:0,upgradeCounts:{}}};function lt(t){var e,o,s,n,i,a;"Pvp"==t.gameMode&&(null===(e=t.character)||void 0===e?void 0:e.level)&&80!=(null===(o=t.character)||void 0===o?void 0:o.level)&&console.error("[gw2-tooltips] [init] supplied (partial) context has its gamemode set to pvp, but has a character level specified thats other than 80. In pvp you are always level 80. This will lead to unexpected results; Remove the explicit level or change the gamemode. The (partial) context in question is: ",t);const r=ut(null===(s=t.character)||void 0===s?void 0:s.stats),c=Object.assign({},null===(n=t.character)||void 0===n?void 0:n.upgradeCounts),l=(null===(a=null===(i=t.character)||void 0===i?void 0:i.statsWithWeapons)||void 0===a?void 0:a.map((t=>ft(t))))||[ft()],u=Object.assign({},ct.character,t.character,{stats:r,upgradeCounts:c,statsWithWeapons:l});return Object.assign({},ct,t,{character:u})}function ut(t={}){return{values:Object.assign({},ct.character.stats.values,t.values),sources:Object.assign({},structuredClone(ct.character.stats.sources),t.sources)}}function ft(t={}){return{values:Object.assign({},ct.character.statsWithWeapons[0].values,t.values),sources:Object.assign({},structuredClone(ct.character.statsWithWeapons[0].sources),t.sources),htmlParts:Object.assign({},structuredClone(ct.character.statsWithWeapons[0].htmlParts),t.htmlParts)}}const dt={autoInitialize:!0,autoCollectRuneCounts:!0,autoCollectStatSources:!0,autoCollectSelectedTraits:!0,autoRecomputeCharacterAttributes:!0,adjustIncorrectStatIds:!0,autoInferEquipmentUpgrades:!0,autoInferWeaponSetAssociation:!0,legacyCompatibility:!0,showPreciseAbilityTimings:!1,showFactComputationDetail:!1};var pt;!function(t){t[t.Junk=0]="Junk",t[t.Basic=1]="Basic",t[t.Common=2]="Common",t[t.Uncommon=3]="Uncommon",t[t.Rare=4]="Rare",t[t.Exotic=5]="Exotic",t[t.Ascended=6]="Ascended",t[t.Legendary=7]="Legendary"}(pt||(pt={}));const gt=[0,0,1,2,3,4,4,4],ht=[.5,.65,.8,.85,.9,1,1.05,1.05],mt={COIN_COPPER:156902,COIN_SILVER:156907,COIN_GOLD:156904,SLOT_Upgrade:517197,SLOT_Infusion:517202,SLOT_Enrichment:517204,RESOURCE_THIEF:156649,RESOURCE_REV:156647,UPKEEP_COST:156058,SUPPLY_COST:2111003,ENDURANCE_COST:156649,NO_UNDERWATER:358417,RECHARGE:156651,ACTIVATION:496252,RANGE:156666,DEFIANCE_BREAK:1938788,WEAPON_SWAP:156583,BARRIER:1770209,STUN_BREAK:156654,KNOCKDOWN:2440716,PULL:2440717,KNOCKBACK:2440715,LAUNCH:2440712,FLOAT:2440713,SINK:2440714},bt=["Bundle","Heal","Elite","Profession","Standard","Equipment"];if(function(){if(window.GW2TooltipsContext instanceof Array)for(const t of window.GW2TooltipsContext)X.push(lt(t));else window.GW2TooltipsContext?X.push(lt(window.GW2TooltipsContext)):X.push(lt({}));t.config=Object.assign({},dt,window.GW2TooltipsConfig),t.config.apiImpl&&(m.apiImpl=t.config.apiImpl(h)),U=e("div.tooltipWrapper"),U.style.display="none",document.body.appendChild(U);const o=/android|webos|iphone|ipad|ipod|blackberry|bb|playbook|mobile|windows phone|kindle|silk|opera mini/.test(navigator.userAgent.toLowerCase());let s;document.addEventListener("mousemove",(t=>{o&&Math.abs(t.pageX-z)+Math.abs(t.pageY-K)>20&&(U.style.display="none"),z=t.pageX,K=t.pageY,"none"!=U.style.display&&Y()})),document.addEventListener("contextmenu",(t=>{const e=function(t,e,o=10){let s=t;for(;s&&o-- >0&&!s.matches(e);)s=s.parentElement;return 0==o?null:s}(t.target,"gw2object");if(e){if(e.classList.contains("cycler")&&"none"!=U.style.display){t.preventDefault();do{V=(V+1)%U.childElementCount}while(U.children[V].classList.contains("not-collapsable"));J(V),Q(V,!0),Y(!0)}o&&"none"==U.style.display&&(t.preventDefault(),tt(e),Y())}}));const n=t=>{if("none"==U.style.display)return;const e=U.children[V];if(e.scrollHeight==e.clientHeight)return;t.preventDefault();const o=t.deltaY||t.detail||t.touches[0].clientY-s.clientY;e.scrollBy(0,o)},i="onwheel"in window&&{passive:!1};window.addEventListener("DOMMouseScroll",n,!1),window.addEventListener("wheel",n,i),window.addEventListener("touchstart",(t=>{s=t.touches[0]})),window.addEventListener("touchmove",n,i),window.addEventListener("keydown",(e=>{e.ctrlKey&&e.altKey&&("d"==e.key?(e.preventDefault(),t.config.showFactComputationDetail=!t.config.showFactComputationDetail,console.log(`[gw2-tooltips] [cfg] showFactComputationDetail is now ${t.config.showFactComputationDetail}`),q&&"none"!=U.style.display&&(tt(q,V),Y())):"t"==e.key&&(e.preventDefault(),t.config.showPreciseAbilityTimings=!t.config.showPreciseAbilityTimings,console.log(`[gw2-tooltips] [cfg] showPreciseAbilityTimings is now ${t.config.showPreciseAbilityTimings}`),q&&"none"!=U.style.display&&(tt(q,V),Y())))}))}(),t.config.autoInitialize){const e=document.getElementsByClassName("gw2-build-wrapper");if(t.config.autoCollectSelectedTraits)if(e.length)for(const t of e)O(t);else console.warn("[gw2-tooltips] [collect] `config.autoCollectSelectedTraits` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.");Z(document).then((o=>{var s;if(t.config.autoInferWeaponSetAssociation)for(const t of e){for(const[e,o]of t.querySelectorAll(".weapon-set").entries())for(const t of o.getElementsByTagName("GW2OBJECT"))t.setAttribute("weaponSet",String(e));const e=[];for(const[o,s]of t.querySelectorAll(".skills-weapon-set").entries()){const t=[],n=e=>{t.push(e.id);let o=!1;const s=e.palettes.find((t=>bt.includes(t.type)));if(s)for(const t of s.slots)if(t.next_chain&&t.profession){const e=m.storage.skills.get(t.next_chain);e&&(o=!0,n(e))}if(!o){if(e.bundle_skills)for(const o of e.bundle_skills){m.storage.skills.get(o)&&t.push(o)}if(e.related_skills)for(const o of e.related_skills){const e=m.storage.skills.get(o);e&&e.palettes.some((t=>bt.includes(t.type)))&&t.push(o)}}};for(const t of s.children){t.setAttribute("weaponSet",String(o));const e=m.storage.skills.get(+String(t.getAttribute("objid")));e?n(e):console.warn("[gw2-tooltips] [collect] failed to find skill for object ",t)}e.push(t)}if(e.length>1&&(e[0][0]!=e[1][0]||e[0][e[0].length-1]!=e[1][e[1].length-1])){console.info("[gw2-tooltips] [collect] Will mark the following skills as belonging to weapon sets: ",e);const o=null===(s=t.parentElement.nextElementSibling)||void 0===s?void 0:s.nextElementSibling;if(o)for(const t of o.querySelectorAll("gw2object[type=skill]")){const o=+String(t.getAttribute("objid"))||0;if(o)for(const[s,n]of e.entries())n.includes(o)&&t.setAttribute("weaponSet",String(s))}}}if(t.config.autoCollectRuneCounts)if(e.length)for(const t of e)D(t);else console.warn("[gw2-tooltips] [collect] `config.autoCollectRuneCounts` is active, but no element with class `gw2-build` could be found to use as source. Upgrades will not be collected as there is no way to tell which upgrades belongs to the build and which ones are just in some arbitrary text.");if(t.config.autoCollectStatSources)if(e.length)for(const t of e)j(t);else console.warn("[gw2-tooltips] [collect] `config.autoCollectStatSources` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.");if(t.config.autoCollectSelectedTraits&&function(t){for(const e of t)for(const t of e.character.traits){const o=m.storage.traits.get(t);if(!o){console.error(`[gw2-tooltips] [collect] Trait #${t} is apparently missing in the cache.`);continue}const s=t=>{for(const s of t)!s.target_attribute_or_skill||s.mode&&s.mode!==e.gameMode||s.source_trait_req&&!e.character.traits.includes(s.source_trait_req)||s.target_trait_req&&!e.character.traits.includes(s.target_trait_req)||(e.character.stats.sources[s.target_attribute_or_skill]||(e.character.stats.sources[s.target_attribute_or_skill]=[])).push({source:`trait '<span class="gw2-color-traited-fact">${o.name}</span>'`,modifier:s,count:1})};o.modifiers&&s(o.modifiers);const n=et(o,e);if(n.blocks)for(const t of n.blocks)if(t.facts)for(const e of t.facts){if(!("buff"in e))continue;const t=m.storage.skills.get(e.buff);t?t.modifiers&&!["Boon","Condition"].includes(t.buff_type)&&(console.info(`[gw2-tooltips] [collect] [trait-effects] ${o.name} applies ${t.buff_type} ${t.name}: ${t.modifiers.length} mods`),s(t.modifiers)):console.error(`[gw2-tooltips] [collect] Buff #${e.buff} required for trait effect collection is apparently missing in the cache.`)}}}(X),t.config.autoInferEquipmentUpgrades){const t=document.querySelectorAll(".weapon, .armor, .trinket");t.length?function(t){const e=X.map((t=>{const e={};for(const[o,s]of Object.entries(t.character.upgradeCounts)){let t;(t=m.storage.items.get(+o))&&"subtype"in t&&"Infusion"==t.subtype&&(e[+o]=s)}return e})),o=X.map((t=>{for(const[e,o]of Object.entries(t.character.upgradeCounts)){let t;if((t=m.storage.items.get(+e))&&"subtype"in t&&"Enrichment"==t.subtype)return e}}));for(const s of t){if(s.childElementCount<2)continue;const[t,...n]=s.children;if("item"!==t.getAttribute("type"))continue;const i=+String(t.getAttribute("contextSet"))||0,a=n.filter((e=>"item"===e.getAttribute("type")&&e.getAttribute("objid")&&(+String(t.getAttribute("contextSet"))||0)===i)).map((t=>t.getAttribute("objid")));{let s,n;if((s=+String(t.getAttribute("objid")))&&(n=m.storage.items.get(s))&&"slots"in n)for(const t of n.slots)if("Infusion"==t){const t=e[i];for(const e of Object.keys(t)){a.push(e),--t[e]<1&&delete t[e];break}}else if("Enrichment"==t){const t=o[i];t&&a.push(t)}}const r=a.join(",");r&&t.setAttribute("slotted",r)}}(t):console.warn("[gw2-tooltips] [collect] `config.autoInferEquipmentUpgrades` is active, but no wrapper elements element with class `'weapon`, `armor` or `trinket` could be found to use as source. No elements will be updated")}if(t.config.autoRecomputeCharacterAttributes)for(const t of X)for(const e of t.character.statsWithWeapons.keys())b(t,e);for(const[t,e]of o.attributes)for(const o of e)H(o,t)}))}return t.DEFAULT_CONTEXT=ct,t.ICONS=mt,t.contexts=X,t.createCompletedBaseStats=ut,t.createCompletedStats=ft,t.findCorrectAttributeSet=st,t.findTraitedOverride=ot,t.formatItemName=it,t.hookDocument=Z,t.resolveTraitsAndOverrides=et,t.specializeContextFromInlineAttribs=at,t}({});
//# sourceMappingURL=tooltips.min.js.map
