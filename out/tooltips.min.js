var GW2TooltipsV2=function(t){"use strict";function e(t,...e){const[o,...n]=t.split("."),i=document.createElement(o);return n.length&&i.classList.add(...n),e.length&&i.append(...e),i}const o="https://assets.gw2dat.com/",n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABuCAIAAACfnGvJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMCSURBVHhe7ZjpkeowEAaJywERD9GQDMGwumyPLj+2XssH+/UPyjMjjVBjUWXf3oJGTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSU51inr8d0u02PVwp/xf/MHQvt9Hm/Be7PlMgIHhyzCjn9hNlpc7ebxe9hhNPp8QifpTdfuz9Oe3thjHH6Cndkfv7DWb0/syNbnN8QJuzkZr5q5K+Xk2C6BtbCTDEAZJDTuIfKi0tUKuZgHhBx89P1Zj5rtK4YQzspL43z6RnltFBR5DMVKVhGFPTy3UYBO6vo0GuIMcxpvs1O2gbhei0tbOazRusvmCe+x6nddDtbBA4/LmEFNfN1o57TOD0F5ZIDGOh0CbL91SrqDYZ07iiQ5etGdrxNpGkz9XowQ53GG2Sa7H5rFc095n1W1nzdqOPUXzbXGMVYp1FqlqlVxMCNXEd9kG806t2n87cw2KE4g53mO/fUKrJgxkzp5Ou5Paf//E4wtNPzUelupki+32k8+cZgMDpQ6V9w6ij+UAeee8/fcLovcsojpzxyyiOnPHLKI6c8csqDOx39MH0B5JRHTnmGO00v2uKLi0B8e7E8ghf+7aP5RimyDrC1ga9HPmIXp2ajy95tvEhwUaHJlpaouUandgD7OF3MpHijbrAlf13MmsOwoulQxruzu9NfGLClvtO6QTF2d87mNISWuWT7ZGtUMwJy2nLVKK2YBcqGx3Mmp+XUomQqGUcf9YpT3afZ2BBUoWFpElqYnm7ooY5P9n8a9QRcDz83lfylFdVcJnGoUAfudAjlD+FopM7CNZy27/aTKr2KU4c93Y6jD/gG13F6HeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklOb9/gEv6oxxwmIw6QAAAABJRU5ErkJggg==";function i(t,e,i){"number"==typeof t&&(t+=".png");const s=document.createElement("img");return s.src=t?t.includes(":")?t:o+t:n,e&&s.classList.add(e),s.alt=i?i+" icon":"icon",s}function s(t){const e=document.createElement("template");return e.innerHTML=t,e.content}const a=(t,...e)=>t?t.replace(/<c=@(.*?)>(.*?)<\/c>/g,'<span class="gw2-color-$1">$2</span>').replace(/%%/g,"%").replaceAll("[lbracket]","[").replaceAll("[rbracket]","]").replaceAll("[null]","").replaceAll("\n","<br />").replaceAll(/%str\d%/g,((t,o)=>e[+o-1]||"")):"",r=t=>t.charAt(0).toLowerCase()+t.slice(1);function c(t,e){let o=t.toFixed(e);for(;"0"===o.charAt(o.length-1);)o=o.slice(0,-1);return"."===o.charAt(o.length-1)&&(o=o.slice(0,-1)),o}function l(t,e){if(e.showPreciseAbilityTimings)return c(t,3);{const e=t<0?"-":"";t=Math.abs(t);let o="";switch(Math.min(Math.round(t%1*4),4)){case 0:case 4:t=Math.round(t);break;case 1:t=Math.floor(t),o="¼";break;case 2:t=Math.floor(t),o="½";break;case 3:t=Math.floor(t),o="¾"}return 0==t&&""==o?"0":`${e}${t>0?t:""}${o}`}}function u(t){switch(t){case"ConditionDmg":return"Condition Damage";case"Healing":return"Healing Power";case"BowLong":return"Longbow";case"BowShort":return"Shortbow";case"Projectile20":return"Projectile (20% Chance)";default:return t}}class f{constructor(t="https://api-v0.hardstuck.gg"){this.baseUrl=t}async bulkRequest(t,e){if(["specializations","pvp/amulets","pets"].includes(t)){const o=await fetch(`https://api.guildwars2.com/v2/${t}?ids=${e.join(",")}`).then((t=>t.json()));if("pvp/amulets"==t){const t={BoonDuration:"Concentration",ConditionDamage:"ConditionDmg",ConditionDuration:"Expertise",CritDamage:"Ferocity"},e=[];for(const n of o){const o={modifiers:[]};for(const[e,i]of Object.entries(n.attributes)){const n=t[e]||e;o.modifiers.push({formula:"NoScaling",base_amount:i,id:-1,formula_param1:0,formula_param2:0,target_attribute_or_buff:n,description:n,flags:[]})}e.push({id:n.id,type:"Trinket",subtype:"Amulet",name:n.name,icon:n.icon,flags:["Pvp","NoSalvage"],flags_ex:[],tiers:[o],rarity:"Exotic",level:82,required_level:0,vendor_value:0})}return e}return o}return fetch(`${this.baseUrl}/${t}?ids=${e.join(",")}`).then((t=>t.json()))}}var d=Object.freeze({__proto__:null,FakeAPI:class{constructor(){this.hsApi=new f("http://127.0.0.1:3000"),this.fallback=new f}async bulkRequest(t,e){try{return await this.hsApi.bulkRequest(t,e)}catch(o){return console.warn(`[gw2-tooltips] [FakeAPI] error trying to get ep '${t}' from localhost, will try to use the fallback API.\n${o}`),await this.fallback.bulkRequest(t,e)}}},HSAPI:f});class p{static async ensureExistence(t,e){this.apiImpl||(this.apiImpl=new f);let o=Object.assign({skills:new Set,items:new Set,traits:new Set,pets:new Set,"pvp/amulets":new Set,specializations:new Set,itemstats:new Set},{[t]:new Set(e)});const n=()=>{for(const[t,e]of Object.entries(o))if(e.size>0)return t};let i=t,s=0;do{const e=this.storage[i],n=Array.from(o[i].values());o[i].clear(),console.info(`[gw2-tooltips] [API cache] round #${s++} for a ${t} request, currently fetching ${i}. Ids: `,n);try{const t=await this.apiImpl.bulkRequest(i,n),s=n.filter((e=>!t.some((t=>t.id==e))));s.length&&console.warn(`[gw2-tooltips] [API cache] Did not receive all requested ${i} ids. missing: `,s);for(const n of t)e.has(n.id)||(e.set(n.id,n),this.collectConnectedIds({endpoint:i,datum:n},o))}catch(t){console.error(t)}}while((i=n())&&s<100)}static collectConnectedIds({endpoint:t,datum:e},o){const n=t=>{for(const e of t)"Buff"!=e.type&&"BuffBrief"!=e.type||this.storage.skills.has(e.buff)||o.skills.add(e.buff),"PrefixedBuffBrief"!==e.type&&"PrefixedBuff"!==e.type||(this.storage.skills.has(e.prefix)||o.skills.add(e.prefix),this.storage.skills.has(e.buff)||o.skills.add(e.buff))};if("palettes"in e)for(const t of e.palettes)for(const e of t.slots)"None"!==e.profession&&e.next_chain&&!this.storage.items.has(e.next_chain)&&o.skills.add(e.next_chain);if("related_skills"in e&&e.related_skills)for(const t of e.related_skills)this.storage.skills.has(t)||o.skills.add(t);if("facts"in e&&e.facts&&n(e.facts),"override_groups"in e&&e.override_groups)for(const{facts:t}of e.override_groups)t&&n(t);if("attribute_set"in e&&e.attribute_set&&(this.storage.itemstats.has(e.attribute_set)||o.itemstats.add(e.attribute_set)),"skills"in e)for(const{id:t}of e.skills)this.storage.skills.has(t)||o.skills.add(t)}}function g({formula:t,base_amount:e,formula_param1:o,formula_param2:n},{level:i,stats:{power:s,conditionDmg:a,healing:r}}){switch(t){case"BuffLevelLinear":case"SpawnScaleLinear":case"TargetLevelLinear":return i*o+e;case"ConditionDamage":return i*o+e+a*n;case"ConditionDamageSquared":return i*i*o+e+a*n;case"NoScaling":return e;case"Regeneration":return i*o+e+r*n;case"RegenerationSquared":return i*i*o+e+r*n;case"BuffFormulaType11":return i*o+e-n;case"Power":return i*o+e+s*n;case"PowerSquared":return i*i*o+e+s*n}return console.warn("[gw2-tooltips] [facts processor] Could not find formula #",t,", using base amount for now!"),e}function h(o,n,f){let d=o.icon,h=1,w=o.duration;const v=(e,o,n,i)=>{let s=[];if(e.modifiers&&!e.description_brief){const a=e.modifiers.filter((t=>(!t.trait_req||f.character.traits.includes(t.trait_req))&&(!t.mode||t.mode===f.gameMode)));let c=new Map;for(let t=0;t<a.length;t++){const e=a[t];let o=c.get(e.id)||c.set(e.id,{modifier:e,value:0}).get(e.id),n=g(e,f.character);e.attribute_conversion&&(n*=f.character.stats[r(e.attribute_conversion)]),o.value+=n,e.flags.includes("SkipNextEntry")&&t++}for(let{value:e,modifier:a}of c.values()){a.flags.includes("Subtract")&&(e-=100),a.flags.includes("MulByDuration")&&(n/=1e3,a.flags.includes("DivDurationBy3")&&(n/=3),a.flags.includes("DivDurationBy10")&&(n/=10),e*=n||1),a.flags.includes("NonStacking")||(e*=o.apply_count),a.formula.includes("Regeneration")&&(e*=i);let r=a.flags.includes("FormatFraction")?l(e,t.config):Math.floor(Math.fround(e)).toString();a.flags.includes("FormatPercent")&&(e>0&&(r="+"+r),r+="%"),r+=" "+a.description,s.push(r)}}return a(e.description_brief||s.join(", ")||e.description)},y=(o,n,i)=>{let a=1,r=1;const u="Boon"==n.buff_type?"concentration":"Condition"==n.buff_type&&"expertise";if(u){const e=f.character.stats[u];a+=e/15*.01,e>0&&t.config.showFactComputationDetail&&(i.push(`base duration: ${l(o/1e3,t.config)}s`),i.push(`+${c(e/15,2)}% from ${e} ${u}`))}let d=f.character.statSources[n.id];if(d){1===a&&t.config.showFactComputationDetail&&i.push(`base duration: ${l(o/1e3,t.config)}s`);let n=0;for(const{source:o,modifier:a,count:r}of d){const c=g(a,f.character);t.config.showFactComputationDetail&&i.push(e("span.detail",`${c>0?"+":""}${c}% from `,s(o),r>1?` (x ${r})`:"")),n+=c}a+=n/100}if(o*=a,n.name.includes("Regeneration")){let o=f.character.statSources.healEffectiveness;if(o.length){t.config.showFactComputationDetail&&i.push("regeneration value mods:");let n=0;for(const{source:a,modifier:r,count:c}of o){const o=g(r,f.character);t.config.showFactComputationDetail&&i.push(e("span.detail",`${o>0?"+":""}${o}% from `,s(a),c>1?` (x ${c})`:"")),n+=o}r+=n/100}}return[o,r]},_={AdjustByAttributeAndLevelHealing:({fact:o})=>{var n;const i=f.character.stats[r(o.target)]||0;let l=(o.value+i*o.attribute_multiplier+f.character.level**o.level_exponent*o.level_multiplier)*o.hit_count;const d=[];if(t.config.showFactComputationDetail&&(d.push(`${o.value} base value`),o.level_multiplier&&d.push(`+ ${c(f.character.level**o.level_exponent*o.level_multiplier,2)} from lvl ${f.character.level} ^ ${o.level_exponent} lvl exp. * ${o.level_multiplier} lvl mul.`),i&&d.push(`+ ${c(i*o.attribute_multiplier,2)} from ${i} ${u(o.target)} * ${o.attribute_multiplier} attrib mod.`),1!=o.hit_count&&d.push(` * ${o.hit_count} hits`)),!(null===(n=o.text)||void 0===n?void 0:n.includes("Barrier"))){let o=100;for(const{source:n,modifier:i,count:a}of f.character.statSources.healEffectiveness){const r=g(i,f.character);t.config.showFactComputationDetail&&d.push(e("span.detail",`${r>0?"+":""}${r}% from `,s(n),a>1?` (x ${a})`:"")),o+=r}l*=o/100}return d.unshift(`${a(o.text)||u(o.target)}: ${Math.round(l)}`),d},AttributeAdjust:({fact:t})=>{const e=Math.round((t.range[1]-t.range[0])/(f.character.level/80)+t.range[0]),o=e>0?"+":"";return[`${a(t.text)||u(t.target)}: ${o}${e}`]},Buff:({fact:e,buff:o})=>{o||console.error("[gw2-tooltips] [facts processor] buff #",e.buff," is apparently missing in the cache"),d=(o=o||b).icon||d;const n=[];let i;[w,i]=y(e.duration,o,n);let s=v(o,e,w,i);s&&(s=`: ${s}`);const r=w>0?`(${l(w/1e3,t.config)}s)`:"";return n.unshift(`${a(e.text)||o.name_brief||o.name} ${r}${s}`),h=e.apply_count,n},BuffBrief:({fact:t,buff:e})=>(e||console.error("[gw2-tooltips] [facts processor] buff #",t.buff," is apparently missing in the cache"),d=(e=e||b).icon||d,[`${a(t.text,e.name)}`]),Distance:({fact:t})=>[`${a(t.text)}: ${Math.round(t.distance)}`],HealthAdjustHealing:({fact:t})=>{const e=f.character.stats[r(t.attribute)]||0,o=Math.round((t.value+e*t.multiplier)*t.hit_count);return[`${a(t.text)||u(t.attribute)}: ${o}`]},Number:({fact:e})=>[`${a(e.text)}: ${l(e.value,t.config)}`],Percent:({fact:e})=>[`${a(e.text)}: ${l(e.percent,t.config)}%`],PercentDamage:({fact:e})=>[`${a(e.text)}: ${l(e.percent,t.config)}%`],PercentLifeForceAdjust:({fact:{percent:o,text:n}})=>{const i=H(f.character),r=[];if(f.character.statSources.lifeForce.length){t.config.showFactComputationDetail&&r.push(`${o*i*.69} from ${o}% * (${i} HP * 0.69) base pool`);let n=100;for(const{source:o,modifier:i,count:a}of f.character.statSources.lifeForce){const c=g(i,f.character);t.config.showFactComputationDetail&&r.push(e("span.detail",`${c>0?"+":""}${c}% from `,s(o),a>1?` (x ${a})`:"")),n+=c}o*=n/100}let c=Math.round(.69*i*o*.01);return r.unshift(`${a(n)}: ${l(o,t.config)}% (${c})`),r},PercentHealth:({fact:{percent:e,text:o}})=>{const n=Math.round(H(f.character)*e*.01);return[`${a(o)}: ${l(e,t.config)}% (${n})`]},LifeForceAdjust:({fact:{percent:o,text:n}})=>{const i=H(f.character),r=[];if(f.character.statSources.lifeForce.length){t.config.showFactComputationDetail&&r.push(`${c(.01*o*i*.69,3)} from ${o}% * (${i} HP * 0.69) base pool`);let n=100;for(const{source:o,modifier:i,count:a}of f.character.statSources.lifeForce){const c=g(i,f.character);t.config.showFactComputationDetail&&r.push(e("span.detail",`${c>0?"+":""}${c}% from `,s(o),a>1?` (x ${a})`:"")),n+=c}o*=n/100}let u=Math.round(.69*i*o*.01);return r.unshift(`${a(n)}: ${l(o,t.config)}% (${u})`),r},Damage:({fact:{dmg_multiplier:o,hit_count:n,text:i},weaponStrength:r})=>{const l=[];let u=o*n*r*f.character.stats.power/f.targetArmor;t.config.showFactComputationDetail&&(l.push(`${c(u,2)} from ${c(o,2)} internal mod. * ${f.character.stats.power} power * ${r} avg. weapon str. / ${f.targetArmor} target armor`),1!=n&&l.push(`* ${n} hits`));const d=Math.min(.05+(f.character.stats.precision-1e3)/21*.01,1),p=1.5+f.character.stats.ferocity/15*.01,h=u*d*(p-1);if(u+=h,t.config.showFactComputationDetail&&l.push(`+${c(h,2)} (${c(d*(p-1)*100,2)}%) from ${c(100*d,2)}% crit chance and ${c(100*p,2)}% damage on crit (${c(f.character.stats.precision,2)} precision and ${c(f.character.stats.ferocity,2)} ferocity)`),f.character.statSources.damage.length){let o=100;for(const{source:n,modifier:i,count:a}of f.character.statSources.damage){const r=g(i,f.character);t.config.showFactComputationDetail&&l.push(e("span.detail",`${r>0?"+":""}${r}% from `,s(n),a>1?` (x ${a})`:"")),o+=r}u*=o/100}const m=n>1?`(${n}x)`:"";return l.unshift(`${a(i)}${m}: ${Math.round(u)}`),l},Time:({fact:{duration:o,text:n}})=>{const i=[];if(n&&(n.includes("Stun")||n.includes("Daze"))&&f.character.statSources.stun.length){t.config.showFactComputationDetail&&i.push(o/1e3+"s base duration");let n=100;for(const{source:o,modifier:a,count:r}of f.character.statSources.stun){const c=g(a,f.character);t.config.showFactComputationDetail&&i.push(e("span.detail",`${c>0?"+":""}${c}% from `,s(o),r>1?` (x ${r})`:"")),n+=c}o*=n/100}const r=1e3!=o?"seconds":"second";return i.unshift(`${a(n)}: ${l(o/1e3,t.config)} ${r}`),i},ComboField:({fact:t})=>[`${a(t.text)}: ${u(t.field_type)}`],ComboFinisher:({fact:t})=>[`${a(t.text)}: ${u(t.finisher_type)}`],BuffConversion:({fact:t})=>[`Gain ${u(t.target)} Based on a Percentage of ${u(t.source)}: ${t.percent}%`],NoData:({fact:t})=>[a(t.text)],PrefixedBuff:({fact:o,buff:n})=>{let i=p.storage.skills.get(o.prefix);i||console.error("[gw2-tooltips] [facts processor] prefix #",o.prefix," is apparently missing in the cache"),i=i||b,d=i.icon||d,n||console.error("[gw2-tooltips] [facts processor] buff #",o.buff," is apparently missing in the cache"),n=n||b;let{duration:r,apply_count:c,text:u}=o;const f=[];let g;[w,g]=y(r,n,f);let h=v(n,o,w,g);h&&(h=`: ${h}`);const _=w>0?`(${l(w/1e3,t.config)}s)`:"",S=[e("div.fact",m(n.icon,c),e("span",s(`${a(u)||n.name_brief||n.name} ${_}${h}`)))];return S.push(...f),S},PrefixedBuffBrief:({fact:t,buff:o})=>{let n=p.storage.skills.get(t.prefix);return n||console.error("[gw2-tooltips] [facts processor] prefix #",t.prefix," is apparently missing in the cache"),n=n||b,d=n.icon||d,o||console.error("[gw2-tooltips] [facts processor] buff #",t.buff," is apparently missing in the cache"),[e("div.fact",i((o=o||b).icon),e("span",`${a(t.text)||o.name_brief||o.name}`))]},Range:({fact:{min:t,max:e}})=>[`Range: ${t?`${t} - ${e}`:e}`],StunBreak:()=>["Breaks Stun"]},S={fact:o,buff:p.storage.skills.get(o.buff||0),weaponStrength:n},[A,...$]=_[o.type](S),C=e("div.fact");o.requires_trait&&C.classList.add("gw2-color-traited-fact");let k=0;if(o.defiance_break){k=o.defiance_break*(w||1e3)/1e3;const t=null!=w&&1e3!=w?` (${o.defiance_break}/s)`:"";$.push(e("span.detail.gw2-color-defiance-fact",`Defiance Break: ${c(k,2)}${t}`))}if(o.requires_trait){const t=function(t,e=!1){switch(e&&(t=t.map((t=>`'${t}'`))),t.length){case 0:return"";case 1:return t[0];default:const e=t[t.length-1];return t.slice(0,-1).join(", ")+e}}(o.requires_trait.map((t=>{var e;return`'<span class="gw2-color-traited-fact">${(null===(e=p.storage.traits.get(t))||void 0===e?void 0:e.name)||t}</span>'`})));$.unshift(s(`<span class="detail">${o.skip_next?"overridden":"exists"} because of trait${1==o.requires_trait.length?"":"s"} ${t}</span>`))}return C.append(m(d,h)),C.append(e("div",e("span","string"==typeof A&&A.includes("<")?s(A):A),...$.map((t=>"string"==typeof t?e("span.detail",t):t)))),{wrapper:C,defiance_break:k}}function m(t,o=1){const n=i(t);if(1==o)return n;{const t=e("span.buff-ico",n);return t.setAttribute("count",String(o)),t}}p.storage={skills:new Map,items:new Map,traits:new Map,pets:new Map,"pvp/amulets":new Map,specializations:new Map,itemstats:new Map},window.APICache=p;const b={id:0,name:"Missing Buff",description:"<c=@warning>This Buff failed to load</c>",categories:[],palettes:[],modifiers:[]},w={id:0,name:"Missing Skill",description:"<c=@warning>This Skill failed to load</c>",categories:[],palettes:[],modifiers:[]};function v(t,e,o=1){const n=e.getElementsByTagName("gw2object");for(const e of t.entries()){const t=Array.from(n).filter((t=>(+String(t.getAttribute("contextSet"))||0)==e[0]));t.length&&y(...e,t,o)}const i=Array.from(n).filter((e=>(+String(e.getAttribute("contextSet"))||0)>=t.length));i.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",e," have the wrong context: ",i)}function y(e,o,n,i){var s,a,r,c;const l={};for(const e of n){let n;if("item"!==e.getAttribute("type")||!(n=+String(e.getAttribute("objid"))))continue;const i=p.storage.items.get(n);if(!i||!("subtype"in i)||!["Rune","Infusion"].includes(i.subtype))continue;let s=1;if("Infusion"==i.subtype){if(!(s=+String(e.getAttribute("count")))&&t.config.legacyCompatibility&&(s=A(e),!s))continue;if(!s){console.warn("[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement ",e,". Will not assume anything and just ignore the stack.");continue}}else"Pvp"==o.gameMode&&"Rune"==i.subtype&&(s=6);l[i.id]=(l[i.id]||0)+s}switch(i){case 0:o.character.upgradeCounts=l;break;case 3:o.character.upgradeCounts=Object.assign(o.character.upgradeCounts,l);break;case 1:window.GW2TooltipsContext instanceof Array?o.character.upgradeCounts=Object.assign(l,null===(s=window.GW2TooltipsContext[e].character)||void 0===s?void 0:s.upgradeCounts):window.GW2TooltipsContext?o.character.upgradeCounts=Object.assign(l,null===(a=window.GW2TooltipsContext.character)||void 0===a?void 0:a.upgradeCounts):o.character.upgradeCounts=l;break;case 2:window.GW2TooltipsContext instanceof Array?o.character.upgradeCounts=Object.assign({},null===(r=window.GW2TooltipsContext[e].character)||void 0===r?void 0:r.upgradeCounts,l):window.GW2TooltipsContext?o.character.upgradeCounts=Object.assign({},null===(c=window.GW2TooltipsContext.character)||void 0===c?void 0:c.upgradeCounts,l):o.character.upgradeCounts=l}}function _(t,e,o=1){const n=e.getElementsByTagName("gw2object");for(const e of t.entries()){const t=Array.from(n).filter((t=>(+String(t.getAttribute("contextSet"))||0)==e[0]));t.length&&S(...e,t,o)}const i=Array.from(n).filter((e=>(+String(e.getAttribute("contextSet"))||0)>=t.length));i.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",e," have the wrong context: ",i)}function S(e,o,n,i=1){var s,a,c,l,u,f;const d={power:[],toughness:[],vitality:[],precision:[],ferocity:[],conditionDmg:[],expertise:[],concentration:[],healing:[],agonyResistance:[],damage:[],lifeForce:[],health:[],healEffectiveness:[],stun:[]};let h={};for(const i of n){let n,s=i.getAttribute("type");if(!(n=+String(i.getAttribute("objid"))))continue;let a,c,l=1;if("item"==s){if(c=p.storage.items.get(n),!c||!("subtype"in c))continue;if("UpgradeComponent"===c.type||"Consumable"===c.type){"Rune"===c.subtype&&c.flags.includes("Pvp")&&(l=6);const e=h[c.id]=(h[c.id]||0)+l;if("Rune"===c.subtype){if(e>6){o.character.upgradeCounts[c.id]||console.warn("[gw2-tooltips] [collect] Found more than 6 runes of the same type. Here is the 7th rune element: ",i);continue}a=c.flags.includes("Pvp")?c.tiers:[c.tiers[e-1]]}else{if("Infusion"==c.subtype||"Enrichment"==c.subtype){if(!(l=+String(i.getAttribute("count")))&&t.config.legacyCompatibility&&(l=A(i),!l))continue;if(!l){console.warn("[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement ",i,". Will not assume anything and just ignore the stack.");continue}}else if("Sigil"===c.subtype&&e>1){e>2&&console.warn("[gw2-tooltips] [collect] Found more than 2 sigils of the same type. Here is the 3th sigil element: ",i);continue}a=c.tiers}}}else if("pvp/amulet"==s){if(c=p.storage["pvp/amulets"].get(n),!c)continue;a=c.tiers}if(a)for(const t of a)if(t.modifiers)for(const n of t.modifiers)if(!(!n.target_attribute_or_buff||n.mode&&n.mode!==o.gameMode||n.trait_req&&!o.character.traits.includes(n.trait_req))&&(("number"!=typeof n.target_attribute_or_buff?d[r(n.target_attribute_or_buff)]:d[n.target_attribute_or_buff]||(d[n.target_attribute_or_buff]=[])).push({modifier:n,source:c.name,count:l}),"number"==typeof n.target_attribute_or_buff)){const t=p.storage.skills.get(n.target_attribute_or_buff);n.flags.includes("FormatPercent")?console.log(`[gw2-tooltips] [collect] [ctx #${e}] [@unstable] ${c.name}: Percent ${null==t?void 0:t.name} ${n.base_amount>0?"+":""}${n.base_amount}%`):console.log(`[gw2-tooltips] [collect] [ctx #${e}] [@unstable] ${c.name}: Flat ${null==t?void 0:t.name} ${n.base_amount>0?"+":""}${n.base_amount}`)}}switch(i){case 0:o.character.statSources=d;break;case 3:o.character.statSources=Object.assign(o.character.statSources,d);break;case 1:window.GW2TooltipsContext instanceof Array?o.character.statSources=Object.assign(d,null===(s=window.GW2TooltipsContext[e].character)||void 0===s?void 0:s.statSources):window.GW2TooltipsContext?o.character.statSources=Object.assign(d,null===(a=window.GW2TooltipsContext.character)||void 0===a?void 0:a.statSources):o.character.statSources=d;break;case 2:window.GW2TooltipsContext instanceof Array?o.character.statSources=Object.assign({},null===(c=window.GW2TooltipsContext[e].character)||void 0===c?void 0:c.statSources,d):window.GW2TooltipsContext?o.character.statSources=Object.assign({},null===(l=window.GW2TooltipsContext.character)||void 0===l?void 0:l.statSources,d):o.character.statSources=d}{let t;t=window.GW2TooltipsContext instanceof Array?Object.assign({},null===(u=window.GW2TooltipsContext[e].character)||void 0===u?void 0:u.stats,V.character.stats):window.GW2TooltipsContext?Object.assign({},null===(f=window.GW2TooltipsContext.character)||void 0===f?void 0:f.stats,V.character.stats):Object.assign({},V.character.stats),o.character.stats=t;for(const[t,n]of Object.entries(o.character.statSources))if(isNaN(+t)){for(const{modifier:i,source:s,count:a}of n.filter((t=>!t.modifier.flags.includes("FormatPercent")))){const n=g(i,o.character)*a;o.character.stats[t]+=n,console.log(`[gw2-tooltips] [collect] [ctx #${e}] ${s}${a>1?" x "+a:""}: Flat ${t} ${n>0?"+":""}${n} => ${o.character.stats[t]}`)}for(const{modifier:i,source:s,count:a}of n.filter((t=>t.modifier.flags.includes("FormatPercent")))){const n=g(i,o.character),r=o.character.stats[t]*n/100*a;o.character.stats[t]+=r,console.log(`[gw2-tooltips] [collect] [ctx #${e}] ${s}${a>1?" x "+a:""}: Percent ${t} ${n>0?"+":""}${n}% (${r}) => ${o.character.stats[t]}`)}}}}function A(t){var e,o;const n=Array.prototype.indexOf.call(t.parentElement.children,t),i=t.parentElement.getElementsByClassName("amount")[n];if(!i)return void console.warn("[gw2-tooltips] [collect] `legacyCompatibility` is active, but no amount element for infusion ",t," could be found. Will not assume anything and just ignore the stack.");const s=+String(null===(o=null===(e=i.textContent)||void 0===e?void 0:e.match(/\d+/))||void 0===o?void 0:o[0]);if(s){if(!(s<1||s>20))return s;console.warn("[gw2-tooltips] [collect] [legacyCompatibility] Amount element ",i," for infusion element ",t," did got interpreted as x",s," which is outside of the range of sensible values (amount in [1...20]). Will not assume anything and just ignore the stack.")}else console.warn("[gw2-tooltips] [collect] [legacyCompatibility] Amount element ",i," for infusion element ",t," did not contain any readable amount. Will not assume anything and just ignore the stack.")}function $(t,e,o=1){const n=e.querySelectorAll("gw2object[type=specialization]:not(.gw2objectembed)");for(const e of t.entries()){const t=Array.from(n).filter((t=>(+String(t.getAttribute("contextSet"))||0)==e[0]));t.length&&C(...e,t,o)}const i=Array.from(n).filter((e=>(+String(e.getAttribute("contextSet"))||0)>=t.length));i.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",e," have the wrong context: ",i)}function C(t,e,o,n=1){var i,s;const a=[];for(const t of o){const e=String(t.getAttribute("selected_traits")).split(",").map((t=>+t)).filter((t=>!isNaN(t)&&0<=t&&t<=2));if(3==e.length)for(const[o,n]of e.entries()){{const e=t.children[1+2*o].children[n];let i;if(!e||!(i=+String(e.getAttribute("objid")))){console.warn("[gw2-tooltips] [collect] Trait object ",e,' is selected but does not exist or does not have an objid set. Add the attribute as `objid="1234"`. Will not assume anything and just ignore the element.');continue}a.push(i)}{const e=t.children[2*o];let n;if(!(n=+String(e.getAttribute("objid")))){console.warn("[gw2-tooltips] [collect] Minor trait object ",e,' does not have an objid set. Add the attribute as `objid="1234"`. Will not assume anything and just ignore the element.');continue}a.push(n)}}else console.warn("[gw2-tooltips] [collect] Specialization object ",t," does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\"0,2,1\"` where the numbers are 0-2 indicating top, middle or bottom selection. Will not assume anything and just ignore the element.")}switch(n){case 0:case 2:e.character.traits=a;break;case 3:case 1:if(window.GW2TooltipsContext instanceof Array){const o=new Set(null===(i=window.GW2TooltipsContext[t].character)||void 0===i?void 0:i.traits);a.forEach((t=>o.add(t))),e.character.traits=Array.from(o)}else if(window.GW2TooltipsContext){const t=new Set(null===(s=window.GW2TooltipsContext.character)||void 0===s?void 0:s.traits);a.forEach((e=>t.add(e))),e.character.traits=Array.from(t)}else e.character.traits=a}}function k(t,o){if(t.childElementCount>0)return;const n=e("a",i(o.icon,void 0,o.name));if(n.href="https://wiki-en.guildwars2.com/wiki/Special:Search/"+a(o.name).replaceAll(/\[.*?\]/g,""),n.target="_blank",t.classList.contains("gw2objectembed")&&!t.classList.contains("icononly")){const t=a(o.name).replaceAll(/\[.*?\]/g,"");n.append(t)}t.append(n)}function x(e,o){const n=+String(e.getAttribute("contextSet"))||0,i=K(M[n],e);if(t.config.adjustTraitedSkillIds){const t=W(o,i);t&&(e.setAttribute("objid",String(t.id)),o=t)}k(e,o)}function E(t,o){if(t.childElementCount>0)return;const n=+String(t.getAttribute("count"))||1,s=M[+String(t.getAttribute("contextSet"))||0],r=e("a",i(o.icon,void 0,o.name));r.href="https://wiki-en.guildwars2.com/wiki/Special:Search/"+a(o.name).replaceAll(/\[.*?\]/g,""),r.target="_blank",t.classList.contains("gw2objectembed")&&r.append(z(o,s,void 0,void 0,n)),t.append(r)}function T(t,e){if(t.classList.contains("gw2objectembed"))k(t,e);else{t.style.backgroundImage=`url(${e.background})`,t.dataset.label=e.name;const o=String(t.getAttribute("selected_traits")).split(",").map((t=>+t)).filter((t=>!isNaN(t)&&0<=t&&t<=2));if(3!=o.length)return void console.warn("[gw2-tooltips] [inflator] Specialization object ",t," does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\"0,2,1\"` where the numbers are 0-2 indicating top, middle or bottom selection.");for(const[e,n]of o.entries()){const o=t.children[1+2*e];if(o)for(const[t,e]of Array.prototype.entries.call(o.children))e.classList.toggle("trait_unselected",t!==n);else console.warn("[gw2-tooltips] [inflator] Cannot mark selected trait object in column #",e," for specialization object ",t," because the column doesn't seem to exist. Either mark the specialization object as inline or add the missing column.")}}}function j(t,e){const o=String(t.getAttribute("objId"));let n={blight:62653,bleeding:736,burning:40549,blinded:720,bloodstone_blessed:34917,blue_pylon_power:31317,chill:722,quickness:1187,chilled:722,crippled:23525,fear:896,alacrity:30328,protection:717,vigor:726,barrier:0,fury:725,stability:1122,stunbreak:0,aegis:743,might:740,regeneration:16538,immobilize:22501,slow:26766,resistance:26980,champion_of_the_legions:20845,compromised:35096,crowd_favor:36173,curse_of_frailty:53723,confusion:861,dark_aura:39978,daze:833,debilitated:0,debilitating_void:0,defense_up:28482,derangement:34965,elemental_empowerment:62733,empowering_auras:62939,equalization_matrix:66586,exposed:28778,expose_weakness:26660,extreme_vulnerability:65662,fixated:47434,growing_rage_ashym:3362,ignite:16259,intervention:35061,invulnerability:56227,necrosis:47414,not_sticking_together:54378,nova:39193,ooze_pheromone:21538,photon_saturation:0,positive_flow:66665,power_of_the_void:0,poison:723,reinforced_armor:9283,relentless_fire:62805,retaliation_ashym:24646,revealed:890,resolution:873,sentinel_retribution:16350,shattering_ice:62909,shell_shocked:33361,spectral_darkness:31498,sticking_together:54604,synchronized_vitality:63840,stun:872,stealth:58026,torment:21632,superspeed:5974,swiftness:719,taunt:27705,unnatural_signet:38224,unblockable:18843,use_soul_binder:55630,void_empowerment:68083,vulnerability:738,weakness:742,xeras_embrace:34979}[o];if(!n){const t={barrier:{id:1,name:"Barrier",icon:ot.BARRIER,description:"Creates a health barrier that takes damage prior to the health bar. Barrier disappears 5s after being applied. Applying a barrier while one is already active will add to it, but the previously-existing barrier will still disappear 5s after it was originally applied. The amount of barrier generated is based on the source's healing power, and is capped at 50% of the recipient's maximum health.",description_brief:"Creates a health barrier that takes damage prior to the health bar.",categories:[],palettes:[]},stunbreak:{id:2,name:"Stun Break",description:"Cancel control effects such as stuns.",icon:ot.STUN_BREAK,categories:[],palettes:[]},knockdown:{id:3,name:"Knockdown",description:"Knocks the target on ground, preventing movement and actions for a short duration.",icon:ot.KNOCKDOWN,categories:[],palettes:[]},pull:{id:4,name:"Pull",description:"Pulls the caster to the target or the target to a specific location and disables them for a short duration.",icon:ot.PULL,categories:[],palettes:[]},knockback:{id:5,name:"Knockdown",description:"Knocks back the target away and on the ground, preventing movement and actions for a short duration.",icon:ot.KNOCKBACK,categories:[],palettes:[]},launch:{id:6,name:"Launch",description:"Throws the target in the air over a short distance, preventing movement and actions for a short duration. Can move Downed targets.",icon:ot.LAUNCH,categories:[],palettes:[]},float:{id:7,name:"Float",description:"Causes the target to float in the air, preventing movement and actions for a short duration. Causes underwater targets to move up.",icon:ot.FLOAT,categories:[],palettes:[]},sink:{id:8,name:"Sink",description:"Causes the underwater target to move downwards.",icon:ot.SINK,categories:[],palettes:[]}}[o];t&&(n=t.id,p.storage.skills.set(n,t))}return n?(t.setAttribute("type","skill"),t.setAttribute("objId",String(n)),n):(t.innerText=o,t.title=`Failed to translate effect '${o}'.`,t.style.cursor="help",t.classList.add("error"),e.add(o),0)}let O,R,P,D,B=0;const M=[];function I(t){const e=O.children;for(let o=0;o<e.length;o++)e[o].classList.contains("not-collapsable")||e[o].classList.toggle("active",o===t)}function L(t,e=!1){const o=O.children[t];O.style.transition=e?"transform 0.25s":"",O.style.transform=`translate(0, -${o.offsetTop+o.offsetHeight}px)`}function N(t=!1){const e=document.getElementById("wpadminbar"),o=e?e.offsetHeight:0,n=O.children[B];let i=P+6;i+O.offsetWidth>document.documentElement.clientWidth-22&&(i=document.documentElement.clientWidth-(O.offsetWidth+22));let s=D-6;s-n.offsetHeight<document.documentElement.scrollTop+o+13&&(t&&(O.style.transition+=", top 0.25s",setTimeout((()=>O.style.transition=""),250)),s=document.documentElement.scrollTop+o+13+n.offsetHeight),O.style.left=`${i}px`,O.style.top=`${s}px`}function F(e,o){const n={skills:new Map,traits:new Map,items:new Map,specializations:new Map,pets:new Map,"pvp/amulets":new Map},i=new Set,s=new Set;for(const o of e.getElementsByTagName("gw2object")){const e=+String(o.getAttribute("stats"));isNaN(e)||i.add(e);let a=+String(o.getAttribute("objId")),r=(o.getAttribute("type")||"skill")+"s";if(t.config.legacyCompatibility&&"effects"===r&&(r="skills",a=j(o,s)),isNaN(a)||!(r in n))continue;const c=n[r].get(a);c?c.push(o):n[r].set(a,[o]),o.addEventListener("mouseenter",(t=>U(t.target))),o.addEventListener("mouseleave",(()=>{O.style.display="none",O.style.transform=""}))}return s.size&&console.error("[gw2-tooltips] [legacy-compat] Some effects could not be translated into skills: ",Array.from(s)),i.size>0&&p.ensureExistence("itemstats",i.values()),Promise.all(Object.entries(n).map((async([t,e])=>{if(0==e.size)return;let o;switch(t){case"skills":o=x;break;case"items":o=E;break;case"specializations":o=T;break;default:o=k}const n=p.storage[t];await p.ensureExistence(t,e.keys());for(const[t,i]of e){const e=n.get(t);if(i&&e)for(const t of i)o(t,e)}})))}function U(o,n=0){const r=(o.getAttribute("type")||"skill")+"s",f=+String(o.getAttribute("objId"));let d=M[+String(o.getAttribute("contextSet"))||0];const g=+String(o.getAttribute("count"))||void 0;if("specializations"==r||"effects"==r)return;R=o;const m=p.storage[r].get(f);if(m){if(B=n,"items"==r||"pvp/amulets"==r){const n=+String(o.getAttribute("stats"))||void 0;O.replaceChildren(function(o,n,r,c,l=1){var f;let d,g;if("Armor"==o.type||"Trinket"==o.type||"Weapon"==o.type)if(void 0===(c=c||o.attribute_set))console.warn("[gw2-tooltips] [tooltip engine] Hovering on item without specified or innate stats. Specify the stats by adding 'stats=\"<stat_set_id>\" to the html element.' ");else if(d=p.storage.itemstats.get(c),d){if(t.config.adjustIncorrectStatIds&&d.similar_sets){const t=d.similar_sets[o.subtype];if(void 0!==t){console.info(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${c} to #${t} because the target is of type ${o.subtype}.`);const e=p.storage.itemstats.get(t);e?d=e:console.error(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${t} is missing in the cache.`)}}}else console.error(`[gw2-tooltips] [tooltip engine] itemstat #${c} is missing in cache.`);"slots"in o&&(g=null===(f=r.getAttribute("slotted"))||void 0===f?void 0:f.split(",").map((t=>p.storage.items.get(+String(t)||0))).filter((t=>t&&"subtype"in t)));const h=l>1?l+" ":"",m=(null==g?void 0:g.find((t=>!["Infusion","Enrichment"].includes(t.subtype))))||(null==g?void 0:g[0]),b=h+z(o,n,d,m,l),w=[e("tet",i(o.icon),e("teb.gw2-color-rarity-"+o.rarity.toLowerCase(),b),e("div.flexbox-fill"))];if("defense"in o&&o.defense){const t="number"==typeof o.defense?o.defense:X[Math.min(100,o.defense[0]+n.character.level)]*o.defense[1];w.push(e("te",e("tem","Defense: ",e("span.gw2-color-stat-green",String(t)))))}if("power"in o){let t;if("mul"in o.power){let e="Common";["PlayerLevelScaleRarity","ItemScale4"].includes(o.power.scaling)&&(n.character.level>=14?e="Uncommon":n.character.level>=30?e="Rare":n.character.level>=60?e="Exotic":n.character.level>=80&&(e="Legendary"));let i=Math.max(et[o.rarity],et[e]);o.power.scaling?i+=n.character.level:i+=o.level;const s=(n.character.isPlayer?Z:tt)[Math.min(100,i)]*o.power.mul,a=s*o.power.spread;t=[Math.ceil(s-a),Math.ceil(s+a)]}else t=o.power;w.push(e("te",e("tem","Weapon Strength: ",e("span.gw2-color-stat-green",`${t[0]} - ${t[1]}`))))}"tiers"in o&&w.push(q(o,n));d&&"attribute_base"in o&&w.push(...d.attributes.map((({attribute:t,base_value:n,scaling:i})=>e("te",e("tem.gw2-color-stat-green",`+${Math.round(n+o.attribute_base*i)} ${u(t)}`)))));"slots"in o&&w.push(e("div.group.slots",...o.slots.map((t=>{let o=-1;if(g)switch(t){case"Upgrade":o=g.findIndex((t=>["Rune","Sigil","Gem"].includes(t.subtype)));break;case"Infusion":o=g.findIndex((t=>"Infusion"==t.subtype));break;case"Enrichment":o=g.findIndex((t=>"Enrichment"==t.subtype))}if(o>-1){const t=g.splice(o,1)[0],s=q(t,n),a=z(t,n,d);return s.prepend(e("tet",i(t.icon,"iconsmall"),e("teb.gw2-color-rarity-"+t.rarity,a),e("div.flexbox-fill"))),s}return e("te",i(ot["SLOT_"+t],"iconsmall"),`Empty ${t} Slot`)}))));const v=e("div.group");"Armor"!=o.type&&"Weapon"!=o.type&&"Trinket"!=o.type||"Amulet"==o.subtype&&o.flags.includes("Pvp")||(v.append(e("span.gw2-color-rarity-"+o.rarity,o.rarity)),"weight"in o&&v.append(e("span",o.weight)),v.append(e("span",`${o.type}: ${o.subtype}`)),"Weapon"==o.type&&function(t){switch(t){case"Axe":case"Dagger":case"Mace":case"Pistol":case"Scepter":case"Focus":case"Sword":case"BowShort":case"Torch":case"Shield":case"Warhorn":case"Toy":case"ToyTwoHanded":case"BundleSmall":return!1;case"Hammer":case"BowLong":case"Greatsword":case"Polearm":case"Rifle":case"Staff":case"BundleLarge":case"Spear":case"Speargun":case"Trident":return!0}}(o.subtype)&&v.append(e("span.gw2-color-rarity-Junk","(Two-Handed)")),o.required_level&&v.append(e("span","Required Level: "+o.required_level)));o.description&&v.append(e("span",s(a(o.description))));o.flags.includes("Pvp")||(o.flags.includes("Unique")&&v.append(e("span","Unique")),o.flags.includes("AccountBound")&&v.append(e("span","Account Bound")),o.flags.includes("SoulBindOnUse")?v.append(e("span","Soulbound on Use")):o.flags.includes("SoulBindOnAcquire")&&v.append(e("span","Soulbound on Acquire")));if(!o.flags.includes("NoSalvage")){const t=["Consumable"==o.type&&"Food"==o.subtype?"Compost":"Ascended"==o.rarity?"Ascended":"Standard"];o.flags_ex.includes("SalvageResearch")&&t.push("Research"),t.length&&v.append(e("span","Salvage: "+t.join(", ")))}if(o.vendor_value){let t=["Vendor Value: ",J(o.vendor_value*l)];l>1&&t.push(" (",J(o.vendor_value),` x ${l})`),v.append(e("span",...t))}w.push(v);const y=e("div.tooltip.item.active",...w);return y.dataset.id=String(o.id),y}(m,d,o,n,g))}else d=K(d,o),O.replaceChildren(...function(o,n,r){const f=[],d=["Bundle","Heal","Elite","Profession","Standard","Equipment"],g=e=>{let o=!1;if("palettes"in e){if(t.config.adjustTraitedSkillIds){const t=W(e,r);t&&(e=t)}f.push({obj:e,notCollapsable:!1});for(const t of e.palettes)for(const e of t.slots)if(e.next_chain&&"None"!==e.profession){const t=p.storage.skills.get(e.next_chain);t&&(o=!0,g(t))}}else f.push({obj:e,notCollapsable:!1});if(!o&&"related_skills"in e){const t=n.getAttribute("type")||"skill";for(const o of e.related_skills){const e=p.storage.skills.get(o);e&&("trait"==t||e.palettes.some((t=>d.includes(t.type))))&&f.push({obj:e,notCollapsable:!1})}}if("skills"in e)for(const{id:t}of e.skills){let e=p.storage.skills.get(t);e||(console.warn(`[gw2-tooltips] pet skill #${t} is missing from the cache. The query was caused by `,n),e=w),f.push({obj:e,notCollapsable:!0})}};g(o);const m=f.map((({obj:o,notCollapsable:n})=>function(o,n,r){const f=[e("teb",a(o.name))];f.push(e("div.flexbox-fill"));const d=G(o,r);if(d.activation){const o=l(d.activation/1e3,t.config);"0"!=o&&f.push(e("ter",o,i(ot.ACTIVATION,"iconsmall")))}d.resource_cost&&f.push(e("ter",String(d.resource_cost),i("Revenant"==r.character.profession?ot.RESOURCE_REV:ot.RESOURCE_THIEF,"iconsmall")));d.endurance_cost&&f.push(e("ter",String(Math.round(d.endurance_cost)),i(ot.ENDURANCE_COST,"iconsmall")));d.upkeep_cost&&f.push(e("ter",String(d.upkeep_cost),i(ot.UPKEEP_COST,"iconsmall")));if(d.recharge){const o=l(d.recharge/1e3,t.config);"0"!=o&&f.push(e("ter",o,i(ot.RECHARGE,"iconsmall")))}d.supply_cost&&f.push(e("ter",String(d.supply_cost),i(ot.SUPPLY_COST,"iconsmall")));const p=[];{let t="slot"in o&&o.slot||"palettes"in o&&function(t){let e;for(const o of t.palettes)for(const n of o.slots)switch(o.type){case"Equipment":case"Bundle":"None"===o.weapon_type&&"Bundle"!=o.type||(e=n.slot.replace(/(Offhand|Main)(\d)/,((t,e,n)=>("Offhand"==e&&(n="1"===n?"4":"5"),`${u(o.weapon_type)} ${n}`))));break;case"Standard":"Standard"===n.slot&&(e="Utility");break;case"Heal":case"Toolbelt":case"Elite":e=o.type;break;case"Pet":case"Profession":e=n.slot;break;case"Monster":break;default:console.error(`[gw2-tooltips] [tooltip engine] unknown palette type '${o.type}' for skill '${t.name}'`)}return e}(o);t&&p.push(e("tes",`( ${t} )`))}if(p.push(e("div.flexbox-fill")),"override_groups"in o&&o.override_groups){const t=new Set(["Pve","Pvp","Wvw"]);for(const e of o.override_groups)for(const o of e.context)t.delete(o);const n=[Array.from(t),...o.override_groups.map((t=>t.context))],i=[];for(const t of["Pve","Pvp","Wvw"]){let e;for(let o=0;o<n.length;o++)if(n[o].includes(t)){e=n.splice(o,1)[0];break}if(!e)continue;const o=e.join("/");e.includes(r.gameMode)?i.push(`<span style="color: var(--gw2-tt-color-text-accent) !important;">${o}</span>`):i.push(o)}p.push(e("tes","( ",s(i.join(" | "))," )"))}const g=[e("tet",...f)];p.length>1&&g.push(e("tet.detail",...p));if("description"in o&&o.description){const t=document.createElement("ted");t.style.marginTop=".5em",t.style.marginBottom=".5em",t.innerHTML=`<teh>${a(o.description)}</teh>`,g.push(t)}if(d.facts){let t=690.5;if("palettes"in o&&o.palettes.length){const e=r.character.profession?t=>t.profession===r.character.profession:t=>"None"!==t.profession,n=o.palettes.find((t=>t.slots.some(e)));n&&(t=function({weapon_type:t,type:e}){return"None"===t?"Bundle"===e?922.5:690.5:{BundleLarge:0,Standard:690.5,Focus:900,Shield:900,Torch:900,Warhorn:900,Greatsword:1100,Hammer:1100,Staff:1100,BowLong:1050,Rifle:1150,BowShort:1e3,Axe:1e3,Sword:1e3,Dagger:1e3,Pistol:1e3,Scepter:1e3,Mace:1e3,Spear:1e3,Speargun:1e3,Trident:1e3}[t]}(n))}g.push(...function(t,o,n){let s=0;const a=t.sort(((t,e)=>t.order-e.order)).map((t=>{const{wrapper:e,defiance_break:i}=h(t,o,n);return s+=i,e})).filter((t=>t));if(s>0){const t=e("div.fact",i(ot.DEFIANCE_BREAK,"iconmed"),e("div.gw2-color-defiance-fact",`Defiance Break: ${c(s,2)}`));a.push(t)}return a}(d.facts,t,r))}const m=e("div.tooltip",...g);n&&m.classList.add("not-collapsable");return m.dataset.id=String(o.id),m}(o,n,r)));return O.append(...m),m}(m,o,d));if(O.style.display="",Array.from(O.children).filter((t=>!t.classList.contains("not-collapsable"))).length>1)o.classList.add("cycler"),o.title="Right-click to cycle through tooltips",I(B);else for(const t of O.children)t.classList.add("active");L(B)}}function G(t,e){var o,n,i;let s=null===(o=t.override_groups)||void 0===o?void 0:o.find((t=>t.context.includes(e.gameMode))),a=Object.assign({},t,s);if(t.facts&&s&&s.facts){a.facts=t.facts.slice();for(const t of s.facts)(null===(n=t.requires_trait)||void 0===n?void 0:n.some((t=>!e.character.traits.includes(t))))||(void 0!==t.insert_before?a.facts.splice(t.insert_before,0,t):a.facts.push(t))}if(a.facts){const t=[];for(let o=0;o<a.facts.length;o++){const n=a.facts[o];(null===(i=n.requires_trait)||void 0===i?void 0:i.some((t=>!e.character.traits.includes(t))))||(t.push(n),n.skip_next&&o++)}a.facts=t}return a}function H(t){return(t.profession?{Guardian:1645,Thief:1645,Elementalist:1645,Engineer:5922,Ranger:5922,Mesmer:5922,Revenant:5922,Necromancer:9212,Warrior:9212}[t.profession]:1e3)+10*t.stats.vitality}function W(t,e){var o;for(const n of t.palettes)for(const i of n.slots)if(i.traited_alternatives){const n=i.traited_alternatives.find((([t,o])=>e.character.traits.includes(t)));if(!n)return;const[s,a]=n;if(a==t.id)return;const r=p.storage.skills.get(a);return r?(console.info(`[gw2-tooltips] Corrected skill #${t.id} (${t.name}) to #${r.id} (${r.name}) because the trait #${s} (${(null===(o=p.storage.traits.get(s))||void 0===o?void 0:o.name)||"<not cached>"}) is active.`),r):void console.error(`[gw2-tooltips] Corrected skill #${a} is missing in the cache.`)}}function q(t,o){const n=e("div.group");for(const[i,r]of t.tiers.entries()){let c=e("te");if(r.description)c.append(e("span",s(a(r.description))));else if(r.facts)for(const t of r.facts){const{wrapper:e}=h(t,null,o);e&&c.append(e)}else if(r.modifiers){c.style.flexDirection="column";for(const t of r.modifiers){let n,i=g(t,o.character);n=t.flags.includes("FormatPercent")?`+${Math.round(i)}% ${u(t.description)}`:`+${Math.round(i)} ${u(t.description)}`,c.append(e("te",n))}}const l=e("te",c);if("Rune"==t.subtype){const n=i<(o.character.upgradeCounts[t.id]||0)?".gw2-color-stat-green":"";l.prepend(e("span"+n,`(${i+1})`))}n.append(l)}return n}function z(t,e,o,n,i=1){let s,a,r,c,l;return s="TraitGuide"==t.type?t.trait:t.name,a=r=c=l="",t.flags.includes("HidePrefix")||o&&o.name&&(a=o.name,r=" "),t.flags.includes("HideSuffix")||n&&n.suffix&&(l=n.suffix,c=" "),s=s.replace("%str1%",a).replace("%str2%",r).replace("%str3%",c).replace("%str4%",l),t.flags.includes("Pve")||!t.flags.includes("Pvp")&&!t.flags.includes("PvpLobby")||(s+=" (PvP)"),s.replaceAll("[s]",i>1?"s":"").replaceAll(/(\S+)\[pl:"(.+?)"]/g,i>1?"$2":"$1").replaceAll(/(\S+)\[f:"(.+?)"]/g,"Female"==e.character.sex?"$2":"$1").replaceAll("[lbracket]","[").replaceAll("[rbracket]","]").replaceAll("[null]","")}function K(t,e){let o;if("skill"===e.getAttribute("type")&&(o=e.getAttribute("with-traits"))){t=structuredClone(t);const n=[];t.character.traits=o.split(",").map((t=>{const e=+t;return e||n.push(t),e})).filter((t=>t)),n.length&&console.warn("[gw2-tooltips] [tooltip engine] Inline trait-override for element ",e," has misformed overrides: ",n)}return t}function J(t){const o=[String(Math.floor(t%100)),i(ot.COIN_COPPER,"iconsmall","")];return t>99&&o.unshift(String(Math.floor(t/100%100)),i(ot.COIN_SILVER,"iconsmall","")),t>9999&&o.unshift(String(Math.floor(t/1e4)),i(ot.COIN_GOLD,"iconsmall","")),e("span",...o)}t.config=null;const V={gameMode:"Pve",targetArmor:2597,character:{level:80,isPlayer:!0,sex:"Male",traits:[],stats:{power:1e3,toughness:1e3,vitality:1e3,precision:1e3,ferocity:0,conditionDmg:0,expertise:0,concentration:0,healing:0,agonyResistance:0},statSources:{power:[],toughness:[],vitality:[],precision:[],ferocity:[],conditionDmg:[],expertise:[],concentration:[],healing:[],agonyResistance:[],damage:[],lifeForce:[],health:[],healEffectiveness:[],stun:[]},upgradeCounts:{}}};function Q(t){var e,o,n,i,s;"Pvp"==t.gameMode&&(null===(e=t.character)||void 0===e?void 0:e.level)&&80!=(null===(o=t.character)||void 0===o?void 0:o.level)&&console.error("[gw2-tooltips] [init] supplied (partial) context has its gamemode set to pvp, but has a character level specified thats other than 80. In pvp you are always level 80. This will lead to unexpected results; Remove the explicit level or change the gamemode. The (partial) context in question is: ",t);const a=Object.assign({},V.character.stats,null===(n=t.character)||void 0===n?void 0:n.stats),r=Object.assign({},V.character.statSources,null===(i=t.character)||void 0===i?void 0:i.statSources),c=Object.assign({},null===(s=t.character)||void 0===s?void 0:s.upgradeCounts),l=Object.assign({},V.character,t.character,{stats:a,statSources:r,upgradeCounts:c});return Object.assign({},V,t,{character:l})}const Y={autoInitialize:!0,autoCollectRuneCounts:!0,autoCollectStatSources:!0,autoCollectSelectedTraits:!0,adjustIncorrectStatIds:!0,adjustTraitedSkillIds:!0,autoInferEquipmentUpgrades:!0,legacyCompatibility:!0,showPreciseAbilityTimings:!1,showFactComputationDetail:!1},X=[115,120,125,129,133,137,142,146,150,154,162,168,175,182,189,196,202,209,216,223,232,240,248,257,265,274,282,290,299,307,319,330,341,352,363,374,385,396,407,418,431,443,456,469,481,494,506,519,532,544,560,575,590,606,621,636,651,666,682,697,714,731,748,764,781,798,815,832,848,865,885,905,924,943,963,982,1002,1021,1040,1060,1081,1102,1123,1144,1165,1186,1207,1228,1249,1270,1291,1312,1333,1354,1375,1396,1417,1438,1459,1480,1501],Z=[170,173,176,179,182,185,188,191,194,197,202,207,212,217,222,227,232,237,242,247,253,259,265,271,277,283,289,295,301,307,315,323,331,339,347,355,363,371,379,387,396,405,414,423,432,441,450,459,468,477,488,499,510,521,532,543,554,565,576,587,599,611,623,635,647,659,671,683,695,707,721,735,749,763,777,791,805,819,833,847,862,877,892,907,922,937,952,967,982,997,1012,1027,1042,1057,1072,1087,1102,1117,1132,1147,1162],tt=[162,179,197,214,231,249,267,286,303,322,344,367,389,394,402,412,439,454,469,483,500,517,556,575,593,612,622,632,672,684,728,744,761,778,820,839,885,905,924,943,991,1016,1067,1093,1119,1145,1193,1220,1275,1304,1337,1372,1427,1461,1525,1562,1599,1637,1692,1731,1802,1848,1891,1936,1999,2045,2153,2201,2249,2298,2368,2424,2545,2604,2662,2723,2792,2854,2985,3047,3191,3269,3348,3427,3508,3589,3671,3754,3838,3922,4007,4093,4180,4267,4356,4445,4535,4625,4717,4809,4902],et={Junk:0,Basic:0,Common:1,Uncommon:2,Rare:3,Exotic:4,Ascended:4,Legendary:4},ot={COIN_COPPER:156902,COIN_SILVER:156907,COIN_GOLD:156904,SLOT_Upgrade:517197,SLOT_Infusion:517202,SLOT_Enrichment:517204,RESOURCE_THIEF:156649,RESOURCE_REV:156647,UPKEEP_COST:156058,SUPPLY_COST:2111003,ENDURANCE_COST:156649,NO_UNDERWATER:358417,RECHARGE:156651,ACTIVATION:496252,RANGE:156666,DEFIANCE_BREAK:1938788,WEAPON_SWAP:156583,BARRIER:1770209,STUN_BREAK:156654,KNOCKDOWN:2440716,PULL:2440717,KNOCKBACK:2440715,LAUNCH:2440712,FLOAT:2440713,SINK:2440714};if(function(){if(window.GW2TooltipsContext instanceof Array)for(const t of window.GW2TooltipsContext)M.push(Q(t));else window.GW2TooltipsContext?M.push(Q(window.GW2TooltipsContext)):M.push(Q({}));t.config=Object.assign({},Y,window.GW2TooltipsConfig),t.config.apiImpl&&(p.apiImpl=t.config.apiImpl(d)),O=e("div.tooltipWrapper"),O.style.display="none",document.body.appendChild(O);const o=/android|webos|iphone|ipad|ipod|blackberry|bb|playbook|mobile|windows phone|kindle|silk|opera mini/.test(navigator.userAgent.toLowerCase());let n;document.addEventListener("mousemove",(t=>{o&&Math.abs(t.pageX-P)+Math.abs(t.pageY-D)>20&&(O.style.display="none"),P=t.pageX,D=t.pageY,"none"!=O.style.display&&N()})),document.addEventListener("contextmenu",(t=>{const e=function(t,e,o=10){let n=t;for(;n&&o-- >0&&!n.matches(e);)n=n.parentElement;return 0==o?null:n}(t.target,"gw2object");if(e){if(e.classList.contains("cycler")&&"none"!=O.style.display){t.preventDefault();do{B=(B+1)%O.childElementCount}while(O.children[B].classList.contains("not-collapsable"));I(B),L(B,!0),N(!0)}o&&"none"==O.style.display&&(t.preventDefault(),U(e),N())}}));const i=t=>{if("none"==O.style.display)return;const e=O.children[B];if(e.scrollHeight==e.clientHeight)return;t.preventDefault();const o=t.deltaY||t.detail||t.touches[0].clientY-n.clientY;e.scrollBy(0,o)},s="onwheel"in window&&{passive:!1};window.addEventListener("DOMMouseScroll",i,!1),window.addEventListener("wheel",i,s),window.addEventListener("touchstart",(t=>{n=t.touches[0]})),window.addEventListener("touchmove",i,s),window.addEventListener("keydown",(e=>{e.ctrlKey&&e.altKey&&("d"==e.key?(e.preventDefault(),t.config.showFactComputationDetail=!t.config.showFactComputationDetail,console.log(`[gw2-tooltips] [cfg] showFactComputationDetail is now ${t.config.showFactComputationDetail}`),R&&"none"!=O.style.display&&(U(R,B),N())):"t"==e.key&&(e.preventDefault(),t.config.showPreciseAbilityTimings=!t.config.showPreciseAbilityTimings,console.log(`[gw2-tooltips] [cfg] showPreciseAbilityTimings is now ${t.config.showPreciseAbilityTimings}`),R&&"none"!=O.style.display&&(U(R,B),N())))}))}(),t.config.autoInitialize){const e=document.getElementsByClassName("gw2-build-wrapper");if(t.config.autoCollectSelectedTraits)if(e.length)for(const t of e)$(M,t);else console.warn("[gw2-tooltips] [collect] `config.autoCollectSelectedTraits` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.");F(document).then((o=>{if(t.config.autoCollectRuneCounts)if(e.length)for(const t of e)v(M,t);else console.warn("[gw2-tooltips] [collect] `config.autoCollectRuneCounts` is active, but no element with class `gw2-build` could be found to use as source. Upgrades will not be collected as there is no way to tell which upgrades belongs to the build and which ones are just in some arbitrary text.");if(t.config.autoCollectStatSources)if(e.length)for(const t of e)_(M,t);else console.warn("[gw2-tooltips] [collect] `config.autoCollectStatSources` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.");if(t.config.autoCollectSelectedTraits&&function(t){for(const e of t)for(const t of e.character.traits){const o=p.storage.traits.get(t);if(!o){console.error(`[gw2-tooltips] [collect] Trait #${t} is apparently missing in the cache.`);continue}const n=t=>{for(const n of t)!n.target_attribute_or_buff||n.mode&&n.mode!==e.gameMode||n.trait_req&&!e.character.traits.includes(n.trait_req)||("number"==typeof n.target_attribute_or_buff?e.character.statSources[n.target_attribute_or_buff]||(e.character.statSources[n.target_attribute_or_buff]=[]):e.character.statSources[r(n.target_attribute_or_buff)]).push({source:`trait '<span class="gw2-color-traited-fact">${o.name}</span>'`,modifier:n,count:1})};o.modifiers&&n(o.modifiers);const i=G(o,e);if(i.facts)for(const t of i.facts){if(!("buff"in t))continue;const e=p.storage.skills.get(t.buff);e?e.modifiers&&n(e.modifiers):console.error(`[gw2-tooltips] [collect] Trait #${t.buff} is apparently missing in the cache.`)}}}(M),t.config.autoInferEquipmentUpgrades){const t=document.querySelectorAll(".weapon, .armor, .trinket");t.length?function(t){const e=M.map((t=>{const e={};for(const[o,n]of Object.entries(t.character.upgradeCounts)){let t;(t=p.storage.items.get(+o))&&"subtype"in t&&"Infusion"==t.subtype&&(e[+o]=n)}return e})),o=M.map((t=>{for(const[e,o]of Object.entries(t.character.upgradeCounts)){let t;if((t=p.storage.items.get(+e))&&"subtype"in t&&"Enrichment"==t.subtype)return e}}));for(const n of t){if(n.childElementCount<2)continue;const[t,...i]=n.children;if("item"!==t.getAttribute("type"))continue;const s=+String(t.getAttribute("contextSet"))||0,a=i.filter((e=>"item"===e.getAttribute("type")&&e.getAttribute("objid")&&(+String(t.getAttribute("contextSet"))||0)===s)).map((t=>t.getAttribute("objid")));{let n,i;if((n=+String(t.getAttribute("objid")))&&(i=p.storage.items.get(n))&&"slots"in i)for(const t of i.slots)if("Infusion"==t){const t=e[s];for(const e of Object.keys(t)){a.push(e),--t[e]<1&&delete t[e];break}}else if("Enrichment"==t){const t=o[s];t&&a.push(t)}}const r=a.join(",");r&&t.setAttribute("slotted",r)}}(t):console.warn("[gw2-tooltips] [collect] `config.autoInferEquipmentUpgrades` is active, but no wrapper elements element with class `'weapon`, `armor` or `trinket` could be found to use as source. No elements will be updated")}}))}return t.DEFAULT_CONTEXT=V,t.ICONS=ot,t.context=M,t.findTraitedOverride=W,t.formatItemName=z,t.getHealth=H,t.hookDocument=F,t.resolveTraitsAndOverrides=G,t.specializeContextFromInlineAttribs=K,t}({});
//# sourceMappingURL=tooltips.min.js.map
