var GW2TooltipsV2=function(e){"use strict";function t(e,...t){const[o,...s]=e.split("."),i=document.createElement(o);return s.length&&i.classList.add(...s),t.length&&i.append(...t),i}function o(e){return`https://assets.gw2dat.com/${e}.png`}const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABuCAIAAACfnGvJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMCSURBVHhe7ZjpkeowEAaJywERD9GQDMGwumyPLj+2XssH+/UPyjMjjVBjUWXf3oJGTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSU51inr8d0u02PVwp/xf/MHQvt9Hm/Be7PlMgIHhyzCjn9hNlpc7ebxe9hhNPp8QifpTdfuz9Oe3thjHH6Cndkfv7DWb0/syNbnN8QJuzkZr5q5K+Xk2C6BtbCTDEAZJDTuIfKi0tUKuZgHhBx89P1Zj5rtK4YQzspL43z6RnltFBR5DMVKVhGFPTy3UYBO6vo0GuIMcxpvs1O2gbhei0tbOazRusvmCe+x6nddDtbBA4/LmEFNfN1o57TOD0F5ZIDGOh0CbL91SrqDYZ07iiQ5etGdrxNpGkz9XowQ53GG2Sa7H5rFc095n1W1nzdqOPUXzbXGMVYp1FqlqlVxMCNXEd9kG806t2n87cw2KE4g53mO/fUKrJgxkzp5Ou5Paf//E4wtNPzUelupki+32k8+cZgMDpQ6V9w6ij+UAeee8/fcLovcsojpzxyyiOnPHLKI6c8csqDOx39MH0B5JRHTnmGO00v2uKLi0B8e7E8ghf+7aP5RimyDrC1ga9HPmIXp2ajy95tvEhwUaHJlpaouUandgD7OF3MpHijbrAlf13MmsOwoulQxruzu9NfGLClvtO6QTF2d87mNISWuWT7ZGtUMwJy2nLVKK2YBcqGx3Mmp+XUomQqGUcf9YpT3afZ2BBUoWFpElqYnm7ooY5P9n8a9QRcDz83lfylFdVcJnGoUAfudAjlD+FopM7CNZy27/aTKr2KU4c93Y6jD/gG13F6HeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklEdOeeSUR0555JRHTnnklOb9/gEv6oxxwmIw6QAAAABJRU5ErkJggg==";function i(e,t,i){const n=document.createElement("img");return n.src=e?o(e):s,t&&n.classList.add(t),n.alt=i?i+" icon":"icon",n}function n(e){const t=document.createElement("template");return t.innerHTML=e,t.content}const a=(e,...t)=>e?e.replaceAll(/<c=(#.*?)>(.*?)<\/c>/g,'<span style="color: $1;">$2</span>').replaceAll(/<c=@(.*?)>(.*?)<\/c>/g,'<span class="gw2-color-$1">$2</span>').replaceAll("[lbracket]","[").replaceAll("[rbracket]","]").replaceAll("[null]","").replaceAll("\n","<br />").replaceAll(/%str(\d)%/g,((e,o)=>t[+o-1]||"")).replaceAll("%%","%"):"",r=(e,t,o)=>e.replaceAll("[s]",t>1?"s":"").replaceAll(/(\S+)\[pl:"(.+?)"]/g,t>1?"$2":"$1").replaceAll(/(\S+)\[f:"(.+?)"]/g,"Female"==o.sex?"$2":"$1");function c(e){return l(e,3)}function l(e,t){let o=e.toFixed(t);for(;"0"===o.charAt(o.length-1);)o=o.slice(0,-1);return"."===o.charAt(o.length-1)&&(o=o.slice(0,-1)),o}function u(e){return e>=0?"+ "+c(e):"- "+-c(e)}function f(e,t){if(t.showPreciseAbilityTimings)return l(e,3);{const t=e<0?"-":"";e=Math.abs(e);let o="";switch(Math.min(Math.round(e%1*4),4)){case 0:case 4:e=Math.round(e);break;case 1:e=Math.floor(e),o="¼";break;case 2:e=Math.floor(e),o="½";break;case 3:e=Math.floor(e),o="¾"}return 0==e&&""==o?"0":`${t}${e>0?e:""}${o}`}}function d(e,t){return(e/=1e3)>=3600?f(e/3600,t)+"h":e>60?f(e/60,t)+"min":f(e,t)+"s"}function p(e){switch(e){case"ConditionDuration":return"Condition Duration";case"ConditionDamage":return"Condition Damage";case"HealingPower":return"Healing Power";case"BowLong":return"Longbow";case"BowShort":return"Shortbow";case"Projectile20":return"Projectile (20% Chance)";case"MagicFind":return"Magic Find";case"CritChance":return"Critical Chance";case"CritDamage":return"Critical Damage";case"BoonDuration":return"Boon Duration";default:return e}}function g(e,t=!1){switch(t&&(e=e.map((e=>`'${e}'`))),e.length){case 0:return"";case 1:return e[0];default:const t=e[e.length-1];return e.slice(0,-1).join(", ")+" and "+t}}class h{constructor(e="https://api-v0.hardstuck.gg"){this.baseUrl=e}bulkRequest(e,t){return fetch(`${this.baseUrl}/${e}?ids=${t.join(",")}`,h.WORKER_CACHE_INIT).then((e=>e.json()))}requestId(e,t){return fetch(`${this.baseUrl}/${e}/${t}`,h.WORKER_CACHE_INIT).then((e=>e.json()))}requestByName(e,t){return fetch(`${this.baseUrl}/${e}/by-name/${t}`,h.WORKER_CACHE_INIT).then((e=>e.json()))}}h.WORKER_CACHE_INIT={headers:{"X-TTJS-Worker-Cached":"1"}};var m=Object.freeze({__proto__:null,FakeAPI:class{constructor(){this.localAPI=new h("http://localhost:3000"),this.fallbackAPI=new h,this.localApiOffline=!1}bulkRequest(e,t){return this.resolveRequest("bulkRequest",e,t)}requestId(e,t){return this.resolveRequest("requestId",e,t)}requestByName(e,t){return this.resolveRequest("requestByName",e,t)}async resolveRequest(e,t,o){try{return await(this.localApiOffline?this.fallbackAPI:this.localAPI)[e](t,o)}catch(s){return(null==s?void 0:s.message.includes("NetworkError"))?(this.localApiOffline=!0,console.warn(`[gw2-tooltips] [FakeAPI] Local api seems to be offline, swapping to the real one.\n${s}`)):console.warn(`[gw2-tooltips] [FakeAPI] Error trying to get ep '${t}' from localhost, will try to use the fallback API.\n${s}`),await this.fallbackAPI[e](t,o)}}},HSAPI:h});class b{static async ensureExistence(e,t,o){this.apiImpl||(this.apiImpl=new h);let s=Object.assign({skills:new Set,items:new Set,traits:new Set,pets:new Set,"pvp/amulets":new Set,specializations:new Set,itemstats:new Set,palettes:new Set,professions:new Set},{[e]:new Set(t)});const i=()=>{for(const[e,t]of Object.entries(s))if(t.size>0)return e};let n=!1,a=e,r=0;do{"palettes"==a&&(n=!0);const t=this.storage[a],i=Array.from(s[a].values());s[a].clear(),console.info(`[gw2-tooltips] [API cache] round #${r++} for a ${e} request, currently fetching ${a}. Ids: `,i);try{const e=await this.apiImpl.bulkRequest(a,i);if(o){const t=i.filter((t=>!e.some((e=>e.id==t))));t.length&&console.warn(`[gw2-tooltips] [API cache] Did not receive all requested ${a} ids. missing: `,t)}for(const o of e)t.has(o.id)||(t.set(o.id,o),this.collectConnectedIds(o,s,n))}catch(e){console.error(e)}}while((a=i())&&r<100)}static collectConnectedIds(e,t,o){const s=e=>{for(const o of e)"Buff"!=o.type&&"BuffBrief"!=o.type||this.storage.skills.has(o.buff)||t.skills.add(o.buff),"PrefixedBuffBrief"!==o.type&&"PrefixedBuff"!==o.type||(this.storage.skills.has(o.prefix)||t.skills.add(o.prefix),this.storage.skills.has(o.buff)||t.skills.add(o.buff))};if(!o&&"palettes"in e)for(const o of e.palettes)this.storage.palettes.has(o)||t.palettes.add(o);if("groups"in e)for(const o of e.groups)for(const e of o.candidates)this.storage.skills.has(e.skill)||t.skills.add(e.skill);if("related_skills"in e)for(const o of e.related_skills)this.storage.skills.has(o)||t.skills.add(o);if("ambush_skills"in e)for(const o of e.ambush_skills)this.storage.skills.has(o.id)||t.skills.add(o.id);if("bundle_skills"in e)for(const o of e.bundle_skills)this.storage.skills.has(o)||t.skills.add(o);if("blocks"in e)for(const t of e.blocks)t.facts&&s(t.facts);if("override_groups"in e)for(const{blocks:t}of e.override_groups)if(t)for(const e of t)e.facts&&s(e.facts);if("attribute_set"in e&&(this.storage.itemstats.has(e.attribute_set)||t.itemstats.add(e.attribute_set)),"skills"in e)for(const o of e.skills)this.storage.skills.has(o)||t.skills.add(o);if("skills_ai"in e)for(const o of e.skills_ai)this.storage.skills.has(o)||t.skills.add(o);if("skills_soulbeast"in e)for(const o of e.skills_soulbeast)this.storage.skills.has(o)||t.skills.add(o);"specialization"in e&&(this.storage.specializations.has(e.specialization)||t.specializations.add(e.specialization)),"applies_buff"in e&&(this.storage.skills.has(e.applies_buff.buff)||t.skills.add(e.applies_buff.buff)),"facts_from_skill"in e&&(this.storage.skills.has(e.facts_from_skill)||t.skills.add(e.facts_from_skill))}}function w(e,o){const s=["Power","Toughness","Vitality","Precision","Ferocity","ConditionDamage","Expertise","Concentration","HealingPower","AgonyResistance","Health","Armor","ConditionDuration","BoonDuration","CritChance","CritDamage"],i=e.character.statsWithWeapons[null!=o?o:e.character.selectedWeaponSet],a={},l={},u={};let f=l;for(const o of s){const{baseAttribute:s,suffix:u,base:d,div:g}=_(o,e.character);let h,m=d;const b=u?100:1,w=[],v=i.sources[o];if(a[o]={parts:w,sources:v},h=`${c(d*b)+u} base value`,d&&(h+=" from lvl 80"),w.push(t("div.detail",h)),s){const e=l[s];let i=e;"CritChance"==o&&(i-=1e3);const n=i/g;m+=n,n&&(h=` +${c(n*b)+u} from ${c(e)} ${p(s)}`,1!=g&&(h+=` / ${g/b} (attrib. specific conv. factor)`),w.push(t("div.detail",h)))}let y=0;for(const o of v.filter((e=>!e.modifier.flags.includes("FormatPercent")))){const s=x(o.modifier,e.character.level,f)*o.count;y+=s,h=` +${c(s)} from `,o.count>1&&(h+=`${o.count} `),h+=o.source,w.push(t("div.detail",n(r(h,o.count,e.character))))}m+=y,l[o]=m}for(const o of s){const{parts:s,sources:i}=a[o];let d=0;for(const o of i.filter((e=>e.modifier.flags.includes("FormatPercent")&&e.modifier.source_attribute))){const i=x(o.modifier,e.character.level,f)*o.count;d+=Math.round(i);let a=` +${c(i)} (${c(o.modifier.base_amount)}% of ${o.modifier.source_attribute}) from `;o.count>1&&(a+=`${o.count} `),a+=o.source,s.push(t("div.detail",n(r(a,o.count,e.character))))}u[o]=l[o]+d}f=u;for(const o of s){const{suffix:s,cap:i}=_(o,e.character);let l,d=u[o];const{parts:g,sources:h}=a[o],m=s?100:1;for(const o of h.filter((e=>e.modifier.flags.includes("FormatPercent")&&!e.modifier.source_attribute))){const i=x(o.modifier,e.character.level,f)*o.count/100,a=s?i:d*i;d+=a,l=` +${c(a*m)}${s}`,s||(l+=` (${c(100*i)}%)`),l+=" from ",o.count>1&&(l+=`${o.count} `),l+=o.source,g.push(t("div.detail",n(r(l,o.count,e.character))))}const b=d;u[o]=d=Math.min(b,i-1),b!=d&&g.push(t("span.detail.capped",`(Capped to ${c(d*m)}${s}! Uncapped value would be ${c(b*m)}${s})`)),g.unshift(t("tet.title",t("teb"," +"+c(d*m)+s+" "+p(o))))}for(const e of s)i.values[e]=u[e],i.htmlParts[e]=a[e].parts}b.storage={skills:new Map,items:new Map,traits:new Map,pets:new Map,"pvp/amulets":new Map,specializations:new Map,itemstats:new Map,palettes:new Map,professions:new Map};const v={Power:[void 0,void 0,66722,"",1e3,1,Number.MAX_SAFE_INTEGER],Toughness:[void 0,"Armor",104162,"",1e3,1,Number.MAX_SAFE_INTEGER],Vitality:[void 0,"Health",104163,"",1e3,1,Number.MAX_SAFE_INTEGER],Precision:[void 0,"CritChance",156609,"",1e3,1,Number.MAX_SAFE_INTEGER],Ferocity:[void 0,"CritDamage",156602,"",0,1,Number.MAX_SAFE_INTEGER],ConditionDamage:[void 0,void 0,156600,"",0,1,Number.MAX_SAFE_INTEGER],Expertise:[void 0,"ConditionDuration",156601,"",0,1,Number.MAX_SAFE_INTEGER],Concentration:[void 0,"BoonDuration",156599,"",0,1,Number.MAX_SAFE_INTEGER],HealingPower:[void 0,void 0,156606,"",0,1,Number.MAX_SAFE_INTEGER],AgonyResistance:[void 0,void 0,536049,"",0,1,Number.MAX_SAFE_INTEGER],Health:["Vitality",void 0,536052,"",0,.1,Number.MAX_SAFE_INTEGER],Armor:["Toughness",void 0,536048,"",0,1,Number.MAX_SAFE_INTEGER],ConditionDuration:["Expertise",void 0,156601,"%",0,1500,2],BoonDuration:["Concentration",void 0,156599,"%",0,1500,2],CritChance:["Precision",void 0,536051,"%",.05,2100,Number.MAX_SAFE_INTEGER],CritDamage:["Ferocity",void 0,784327,"%",1.5,1500,Number.MAX_SAFE_INTEGER]};function _(e,t){const o=v[e];let s,i,n,a="",r=0,c=1,l=Number.MAX_SAFE_INTEGER;return o&&([s,i,n,a,r,c,l]=o),"Health"==e&&(r=y(t)),{baseAttribute:s,computedAttribute:i,img:n,suffix:a,base:r,div:c,cap:l}}function y(e){return e.profession?{Guardian:1645,Thief:1645,Elementalist:1645,Engineer:5922,Ranger:5922,Mesmer:5922,Revenant:5922,Necromancer:9212,Warrior:9212}[e.profession]:1e3}function k(e,t){return A(e)[t]}function A(e){return e.statsWithWeapons[e.selectedWeaponSet].values}function S(e,t){return e.statsWithWeapons[e.selectedWeaponSet].sources[t]||[]}const C=[115,120,125,129,133,137,142,146,150,154,162,168,175,182,189,196,202,209,216,223,232,240,248,257,265,274,282,290,299,307,319,330,341,352,363,374,385,396,407,418,431,443,456,469,481,494,506,519,532,544,560,575,590,606,621,636,651,666,682,697,714,731,748,764,781,798,815,832,848,865,885,905,924,943,963,982,1002,1021,1040,1060,1081,1102,1123,1144,1165,1186,1207,1228,1249,1270,1291,1312,1333,1354,1375,1396,1417,1438,1459,1480,1501],$=[170,173,176,179,182,185,188,191,194,197,202,207,212,217,222,227,232,237,242,247,253,259,265,271,277,283,289,295,301,307,315,323,331,339,347,355,363,371,379,387,396,405,414,423,432,441,450,459,468,477,488,499,510,521,532,543,554,565,576,587,599,611,623,635,647,659,671,683,695,707,721,735,749,763,777,791,805,819,833,847,862,877,892,907,922,937,952,967,982,997,1012,1027,1042,1057,1072,1087,1102,1117,1132,1147,1162],E=[162,179,197,214,231,249,267,286,303,322,344,367,389,394,402,412,439,454,469,483,500,517,556,575,593,612,622,632,672,684,728,744,761,778,820,839,885,905,924,943,991,1016,1067,1093,1119,1145,1193,1220,1275,1304,1337,1372,1427,1461,1525,1562,1599,1637,1692,1731,1802,1848,1891,1936,1999,2045,2153,2201,2249,2298,2368,2424,2545,2604,2662,2723,2792,2854,2985,3047,3191,3269,3348,3427,3508,3589,3671,3754,3838,3922,4007,4093,4180,4267,4356,4445,4535,4625,4717,4809,4902];function x({formula:e,base_amount:t,formula_param1:o,formula_param2:s,source_attribute:i},n,a){let{Power:r,ConditionDamage:c,HealingPower:l}=a;if(i)return a[i]*t/100;switch(e){case"BuffLevelLinear":case"SpawnScaleLinear":case"TargetLevelLinear":return n*o+t;case"ConditionDamage":return n*o+t+c*s;case"ConditionDamageSquared":return n*n*o+t+c*s;case"NoScaling":return t;case"Regeneration":return n*o+t+l*s;case"RegenerationSquared":return n*n*o+t+l*s;case"BuffFormulaType11":return n*o+t-s;case"Power":return n*o+t+r*s;case"PowerSquared":return n*n*o+t+r*s}return console.warn("[gw2-tooltips] [facts processor] Could not find formula #",e,", using base amount for now!"),t}function R(o,s,h,m=!1){let w=o.icon,v=1,C=o.duration,$=o.defiance_break,E=A(h.character);const R=(t,o,s,i)=>{let n=[];if(t.modifiers&&!t.description_brief&&!m){const a=t.modifiers.filter((e=>(!e.source_trait_req||h.character.traits.has(e.source_trait_req))&&(!e.mode||e.mode===h.gameMode)));let r=new Map;for(let e=0;e<a.length;e++){const t=a[e];let o=r.get(t.id);o||r.set(t.id,o={modifier:t,value:0});let s=x(t,h.character.level,E);t.source_attribute&&(s*=E[t.source_attribute]),o.value+=s,t.flags.includes("SkipNextEntry")&&e++}for(let{value:t,modifier:a}of r.values()){if(a.flags.includes("Subtract")&&(t-=100),a.flags.includes("MulByDuration")){let e=s/1e3;a.flags.includes("DivDurationBy3")&&(e/=3),a.flags.includes("DivDurationBy10")&&(e/=10),t*=e||1}a.flags.includes("NonStacking")||(t*=o.apply_count),a.formula.includes("Regeneration")&&(t*=i);let r=a.flags.includes("FormatFraction")?f(t,e.config):Math.floor(Math.fround(t)).toString();if(a.flags.includes("FormatPercent")&&(t>0&&(r="+ "+r),r+="%"),r+=" "+a.description,"string"==typeof a.target_attribute_or_skill){const{computedAttribute:e}=_(a.target_attribute_or_skill,h.character);if(e){const{div:o,suffix:s}=_(e,h.character);r+=` <span class="detail">(converts to ${c(t/o*(s?100:1))}${s} ${p(e)})</span>`}}n.push(r)}}return a(t.description_brief||n.join(", ")||t.description)},N=(o,s,i)=>{let a=1,l=1,f=Number.MAX_SAFE_INTEGER;const d="Boon"==s.buff_type?"BoonDuration":"Condition"==s.buff_type&&"ConditionDuration";if(d){const{baseAttribute:s,div:l,cap:u}=_(d,h.character);f=u;const p=k(h.character,s);a+=p/l,p>0&&e.config.showFactComputationDetail&&(i.push(`base duration: ${c(o/1e3)}s`),i.push(`+ ${c(o/1e3*p/l)}s (${c(p/l*100)}%) from ${c(p)} ${s}`));for(const s of S(h.character,d)){let l=x(s.modifier,h.character.level,E)*s.count;const u=s.modifier.flags.includes("FormatPercent")?"%":"",f=u?100:1;l/=f,a+=l;const d=u?l*o:l;if(e.config.showFactComputationDetail){let e=`+ ${c(d/1e3)}s`;u&&(e+=` (${c(l*f)}%)`),e+=" from ",s.count>1&&(e+=`${s.count} `),e+=s.source,i.push(t("div.detail",n(r(e,s.count,h.character))))}}}let g=S(h.character,s.id);if(g.length){1===a&&e.config.showFactComputationDetail&&i.push(`base duration: ${c(o/1e3)}s`);let s=0;for(const{source:a,modifier:l,count:f}of g){const d=x(l,h.character.level,E);e.config.showFactComputationDetail&&i.push(t("span.detail",`${u(o/1e3*d/100)}s (${c(d)}%) from ${f>1?`${f} `:""}`,n(r(a,f,h.character)))),s+=d}a+=s/100}const m=a;if(a=Math.min(m,f),a!=m&&e.config.showFactComputationDetail&&i.push(t("span.detail",`(Capped to ${c(o/1e3*f)}s! Uncapped duration would be ${c(o/1e3*m)}s)`)),o*=a,s.name.includes("Regeneration")){let o=S(h.character,"HealEffectiveness");if(o.length){e.config.showFactComputationDetail&&i.push("regeneration value mods:");let s=0;for(const{source:a,modifier:l,count:f}of o){let o=x(l,h.character.level,E);if(l.source_attribute&&(o*=100),e.config.showFactComputationDetail){const e=l.source_attribute?`${u(o)}% from ${c(l.base_amount)} * ${c(E[l.source_attribute])} ${p(l.source_attribute)}`:`${u(o)}%`;i.push(t("span.detail",`${e} from ${f>1?`${f} `:""}`,n(r(a,f,h.character))))}s+=o}l+=s/100}}return[o,l]},D={AdjustByAttributeAndLevel:({fact:o})=>{var s;let i=(o.value+h.character.level**o.level_exponent*o.level_multiplier)*o.hit_count,l=0;o.attribute&&(l=k(h.character,o.attribute),i+=l*o.attribute_multiplier*o.hit_count);const f=[];if(e.config.showFactComputationDetail&&(f.push(`${c(o.value)} base value`),o.level_multiplier&&f.push(`+ ${c(h.character.level**o.level_exponent*o.level_multiplier)} from lvl ${h.character.level} ^ ${c(o.level_exponent)} lvl exp. * ${c(o.level_multiplier)} lvl mul.`),o.attribute&&f.push(`+ ${c(l*o.attribute_multiplier)} from ${c(l)} ${p(o.attribute)} * ${c(o.attribute_multiplier)} attrib. mod.`),1!=o.hit_count&&f.push(` * ${o.hit_count} hits`)),null===(s=o.text)||void 0===s?void 0:s.includes("Heal")){let o=100;for(const{source:s,modifier:a,count:l}of S(h.character,"HealEffectiveness")){let d=x(a,h.character.level,E);if(a.source_attribute&&(d*=100),e.config.showFactComputationDetail){const e=a.source_attribute?`${c(d)}% from ${c(a.base_amount)} * ${c(E[a.source_attribute])} ${p(a.source_attribute)}`:`${c(d)}%`;f.push(t("span.detail",`${u(d/100*i)} (${e}) from ${l>1?`${l} `:""}`,n(r(s,l,h.character))))}o+=d}i*=o/100}return f.unshift(`${a(o.text)||p(o.attribute)}: ${Math.round(i)}`),f},AttributeAdjust:({fact:e})=>{const t=Math.round((e.range[1]-e.range[0])/(h.character.level/80)+e.range[0]),o=[`${a(e.text)||p(e.target)}: ${s=t,s>=0?"+"+c(s):c(s)}`];var s;const{computedAttribute:i}=_(e.target,h.character);if(i){const{div:e,suffix:s}=_(i,h.character),n=s?100:1;o.push(`(converts to ${c(t/e*n)}${s} ${p(i)})`)}return o},Buff:({fact:t,buff:o})=>{o||(console.error("[gw2-tooltips] [facts processor] buff #",t.buff," is apparently missing in the cache"),o=T),w=o.icon||w;const s=[];let i;[C,i]=N(t.duration,o,s);let n=R(o,t,C,i);n&&(n=m?`:<div style="margin-left: 0.5em;">${n}</div>`:`: ${n}`);const c=C>0?` (${d(C,e.config)})`:"";return s.unshift(`${a(r(t.text||o.name_brief||o.name,-1,h.character))}${c}${n}`),v=t.apply_count,s},BuffBrief:({fact:e,buff:t})=>(t||(console.error("[gw2-tooltips] [facts processor] buff #",e.buff," is apparently missing in the cache"),t=T),w=t.icon||w,[`${a(e.text,t.name)}`]),Distance:({fact:e})=>[`${a(e.text)}: ${Math.round(e.distance)}`],Number:({fact:{text:o,value:s}})=>{const i=[];if($&&o&&o.includes("Defiance")){const o=S(h.character,"Stun");if(o.length){e.config.showFactComputationDetail&&i.push(`${c(s)} base value`);let a=100;for(const{source:s,modifier:c,count:l}of o){const o=x(c,h.character.level,E);e.config.showFactComputationDetail&&i.push(t("span.detail",`${u(o)}% from ${l>1?`${l} `:""}`,n(r(s,l,h.character)))),a+=o}const l=a/100;s*=l,$*=l}}return i.unshift(`${a(o)}: ${f(s,e.config)}`),i},Percent:({fact:t})=>[`${a(t.text)}: ${f(t.percent,e.config)}%`],PercentHpSelfDamage:({fact:t})=>{const o=k(h.character,"Health");return[`${a(t.text)}: ${Math.floor(o*t.percent/100)} (${f(t.percent,e.config)}% HP pool)`]},PercentLifeForceCost:({fact:{percent:t,text:o}})=>{const s=y(h.character),i=[];return i.push(`${a(o)}: ${c(Math.round(s*t*.01))}`),e.config.showFactComputationDetail&&i.push(`from ${c(t)}% * ${c(s)} HP base pool`),i},PercentHealth:({fact:{percent:t,text:o}})=>{const s=Math.round(k(h.character,"Health")*t*.01);return[`${a(o)}: ${f(t,e.config)}% (${s} HP)`]},PercentLifeForceGain:({fact:{percent:o,text:s}})=>{const i=k(h.character,"Health"),l=[];e.config.showFactComputationDetail&&l.push(`${c(.01*o*i*.69)} from ${c(o)}% * (${c(i)} HP * 0.69) pool (${c(y(h.character))} base pool modified by ${c(k(h.character,"Vitality"))} Vitality)`);const d=S(h.character,"LifeForce");if(d.length){let s=100;for(const{source:o,modifier:i,count:a}of d){const c=x(i,h.character.level,E);e.config.showFactComputationDetail&&l.push(t("span.detail",`${u(c)}% from ${a>1?`${a} `:""}`,n(r(o,a,h.character)))),s+=c}o*=s/100}return l.unshift(`${a(s)}: ${f(o,e.config)}% (${Math.round(.69*i*o*.01)})`),l},Damage:({fact:{dmg_multiplier:o,hit_count:s,text:i},weaponStrength:l})=>{const f=[],d=k(h.character,"Power");let p=o*s*l*d/h.targetArmor;e.config.showFactComputationDetail&&(f.push(`${c(p)} from ${c(o)} internal mod. * ${c(d)} power * ${l} avg. weapon str. / ${h.targetArmor} target armor`),1!=s&&f.push(`* ${s} hits`));const g=k(h.character,"Precision"),m=k(h.character,"Ferocity"),b=Math.min(.05+(g-1e3)/21*.01,1),w=1.5+m/15*.01,v=p*b*(w-1);p+=v,e.config.showFactComputationDetail&&f.push(`+ ${c(v)} (${c(b*(w-1)*100)}%) from ${c(100*b)}% crit chance and ${c(100*w)}% damage on crit (${c(g)} precision and ${c(m)} ferocity)`);const _=S(h.character,"Damage");if(_.length){let o=100;for(const{source:s,modifier:i,count:a}of _){const c=x(i,h.character.level,E);e.config.showFactComputationDetail&&f.push(t("span.detail",`${u(c)}% from ${a>1?`${a} `:""}`,n(r(s,a,h.character)))),o+=c}p*=o/100}const y=s>1?`(${s}x)`:"";return f.unshift(`${a(i)}${y}: ${Math.round(p)}`),f},Time:({fact:{text:o}})=>{const s=[];if($&&o&&(o.includes("Stun")||o.includes("Daze")||o.includes("Defiance"))){const o=S(h.character,"Stun");if(o.length){e.config.showFactComputationDetail&&s.push(`${c(C/1e3)}s base duration`);let i=100;for(const{source:a,modifier:c,count:l}of o){const o=x(c,h.character.level,E);e.config.showFactComputationDetail&&s.push(t("span.detail",`${u(o)}% from ${l>1?`${l} `:""}`,n(r(a,l,h.character)))),i+=o}C*=i/100}}const i=1e3!=C?"seconds":"second";return s.unshift(`${a(o)}: ${f(C/1e3,e.config)} ${i}`),s},ComboField:({fact:e})=>[`${a(e.text)}: ${p(e.field_type)}`],ComboFinisher:({fact:e})=>[`${a(e.text)}: ${p(e.finisher_type)}`],AttributeConversion:({fact:e})=>[`Gain ${p(e.target)} Based on a Percentage of ${p(e.source)}: ${e.percent}%`],NoData:({fact:e})=>[a(e.text)],PrefixedBuff:({fact:o,buff:s})=>{let i=b.storage.skills.get(o.prefix);i||(console.error("[gw2-tooltips] [facts processor] prefix #",o.prefix," is apparently missing in the cache"),i=T),w=i.icon||w,s||(console.error("[gw2-tooltips] [facts processor] buff #",o.buff," is apparently missing in the cache"),s=T);let{duration:r,apply_count:c,text:l}=o;const u=[];let f;[C,f]=N(r,s,u);let p=R(s,o,C,f);p&&(p=`: ${p}`);const g=C>0?` (${d(C,e.config)})`:"";return u.unshift(t("div.fact",P(s.icon,c),t("span",n(`${a(l)||s.name_brief||s.name}${g}${p}`)))),u},PrefixedBuffBrief:({fact:e,buff:o})=>{let s=b.storage.skills.get(e.prefix);return s||(console.error("[gw2-tooltips] [facts processor] prefix #",e.prefix," is apparently missing in the cache"),s=T),w=s.icon||w,o||(console.error("[gw2-tooltips] [facts processor] buff #",e.buff," is apparently missing in the cache"),o=T),[t("div.fact",i(o.icon),t("span",`${a(e.text)||o.name_brief||o.name}`))]},Range:({fact:{min:e,max:t}})=>[`Range: ${e?`${e} - ${t}`:t}`],StunBreak:()=>["Breaks Stun"]},M={fact:o,buff:b.storage.skills.get(o.buff||0),weaponStrength:s},[I,...j]=D[o.type](M),O=t("div.fact");o.requires_trait&&O.classList.add("gw2-color-traited-fact");let F=0;if($){let e=C||1e3,s="";C<1e3&&o.text&&(o.text.includes("Stun")||o.text.includes("Daze")||o.text.includes("Float")||o.text.includes("Knockdown"))?(e=1e3,s=" (hard CC -> min = 100)"):1e3!=e&&(s=` (${o.defiance_break}/s)`),F=$*e/1e3,j.push(t("span.detail.gw2-color-defiance-fact",`Defiance Break: ${l(F,2)}${s}`))}if(o.requires_trait){const e=g(o.requires_trait.map((e=>{var t;return`'<span class="gw2-color-traited-fact">${(null===(t=b.storage.traits.get(e))||void 0===t?void 0:t.name)||e}</span>'`})));j.unshift(n(`<span class="detail">${o.skip_next&&(o.skip_next>1||!o.__gamemode_override_marker)?"overridden":"exists"} because of trait${1==o.requires_trait.length?"":"s"} ${e}</span>`))}return O.append(P(w,v)),O.append(t("div",t("span","string"==typeof I&&I.includes("<")?n(I):I),...j.map((e=>"string"==typeof e?t("span.detail",e):e)))),{wrapper:O,defiance_break:F}}function P(e,o=1){const s=i(e);if(1==o)return s;{const e=t("span.buff-ico",s);return e.setAttribute("count",String(o)),e}}const T={id:0,name:"Missing Buff",description:"<c=@warning>This Buff failed to load</c>",categories:[],palettes:[],modifiers:[],flags:[]},N={id:0,name:"Missing Skill",description:"<c=@warning>This Skill failed to load</c>",categories:[],palettes:[],modifiers:[],flags:[]};function D(e,t=1){const o=e.getElementsByTagName("gw2object");for(const e of te.entries()){const s=Array.from(o).filter((t=>(+String(t.getAttribute("contextSet"))||0)==e[0]));s.length&&M(...e,s,t)}const s=Array.from(o).filter((e=>(+String(e.getAttribute("contextSet"))||0)>=te.length));s.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",e," have the wrong context: ",s)}function M(t,o,s,i){const n={};for(const t of s){let s;if("item"!==t.getAttribute("type")||!(s=+String(t.getAttribute("objid"))))continue;const i=b.storage.items.get(s);if(!i||!("subtype"in i)||!["Rune","Infusion"].includes(i.subtype))continue;let a=1;if("Infusion"==i.subtype){if(!(a=+String(t.getAttribute("count")))&&e.config.legacyCompatibility&&(a=O(t),!a))continue;if(!a){console.warn("[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement ",t,". Will not assume anything and just ignore the stack.");continue}}else"Pvp"==o.gameMode&&"Rune"==i.subtype&&(a=6);n[i.id]=(n[i.id]||0)+a}switch(i){case 0:o.character.upgradeCounts=n;break;case 1:o.character.upgradeCounts=Object.assign(o.character.upgradeCounts,n)}}function I(e,t=1){const o=e.getElementsByTagName("gw2object");for(const e of te.keys()){const s=Array.from(o).filter((t=>(+String(t.getAttribute("contextSet"))||0)==e));s.length&&j(e,te,s,t)}const s=Array.from(o).filter((e=>(+String(e.getAttribute("contextSet"))||0)>=te.length));s.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",e," have the wrong context: ",s)}function j(t,o,s,i){const n=o[t],a=structuredClone(Ee.character.stats.sources),r=[];let c={};const l=o.map((e=>{let t=0;const o={};for(let[s,i]of Object.entries(e.character.upgradeCounts)){let e;(e=b.storage.items.get(+s))&&"subtype"in e&&"Infusion"==e.subtype&&(i=Math.min(i,18),o[s]=i,t+=i)}let s=Math.max(0,t-18);for(let e=100;s>0&&e>0;e--)for(const[e,t]of Object.entries(o).sort(((e,t)=>t[1]-e[1])))if(t>2){const i=1&t?1:2;if(o[e]-=i,s-=i,s<=0)break}return o}));for(const o of s){let s,i=o.getAttribute("type");if(!(s=+String(o.getAttribute("objid"))))continue;let u,f,d,p,g=1;if("item"==i){if(f=b.storage.items.get(s),!f||!("subtype"in f))continue;if("UpgradeComponent"===f.type||"Consumable"===f.type){let t=1;if("Rune"===f.subtype&&f.flags.includes("Pvp")&&(t=6),d=c[f.id]=(c[f.id]||0)+t,"Rune"===f.subtype){if(p=!0,d>6){n.character.upgradeCounts[f.id]||console.warn("[gw2-tooltips] [collect] Found more than 6 runes of the same type. Here is the 7th rune element: ",o);continue}u=f.flags.includes("Pvp")?f.tiers:[f.tiers[d-1]]}else if("applies_buff"in f){const e=b.storage.skills.get(f.applies_buff.buff);if(!e){console.warn(`[gw2-tooltips] [collect] Failed to resolve applied buff ${f.applies_buff} for `,o,". Will not assume anything and just ignore the item.");continue}u=[{modifiers:e.modifiers}]}else if("tiers"in f){if("Infusion"==f.subtype||"Enrichment"==f.subtype){if(!(g=+String(o.getAttribute("count")))&&e.config.legacyCompatibility&&(g=O(o),!g))continue;if(!g){console.warn("[gw2-tooltips] [collect] Could not figure how many infusions to add for sourceElement ",o,". Will not assume anything and just ignore the stack.");continue}}else if("Sigil"===f.subtype&&d>1){d>2&&console.warn("[gw2-tooltips] [collect] Found more than 2 sigils of the same type. Here is the 3th sigil element: ",o);continue}u=f.tiers}}}else if("pvp/amulet"==i&&(f=b.storage["pvp/amulets"].get(s),!f))continue;let h=f&&("Pvp"!==n.gameMode||"Trinket"===f.type&&"Amulet"===f.subtype)&&ke(f,+String(o.getAttribute("stats"))||void 0);if(h&&(u=[{modifiers:h.attributes.map((e=>({target_attribute_or_skill:e.attribute,base_amount:Math.round(e.base_value+f.attribute_base*e.scaling),formula:"NoScaling",flags:[],id:-1,formula_param1:0,formula_param2:0,description:""})))}]),f&&"defense"in f){const e="number"==typeof f.defense?f.defense:C[Math.min(100,f.defense[0]+n.character.level)]*f.defense[1];u||(u=[{modifiers:[]}]),u[0].modifiers.push({target_attribute_or_skill:"Armor",base_amount:Math.ceil(e),formula:"NoScaling",flags:[],id:-1,formula_param1:0,formula_param2:0,description:""})}let m=a;const w=+String(o.getAttribute("weaponSet"));if(isNaN(w)&&f&&"UpgradeComponent"==f.type){const e=l[t][f.id];e?g=e:g>18&&(g=18)}if(isNaN(w)||(m=r[w]||(r[w]=structuredClone(Ee.character.stats.sources))),u)for(const[e,t]of u.entries())if(t.modifiers)for(const o of t.modifiers){if(!o.target_attribute_or_skill||!U(o,n))continue;let t=Se(f,n,h,void 0,-1);p&&(t=`${t} (Tier ${1===u.length?d:e+1} Bonus)`),(m[o.target_attribute_or_skill]||(m[o.target_attribute_or_skill]=[])).push({modifier:o,source:t,count:g})}}const u=n.character;switch(i){case 0:u.stats.sources=a,(()=>{for(let[e,t]of r.entries()){const o=u.statsWithWeapons[e];o?o.sources=t:u.statsWithWeapons[e]={sources:t,values:Object.assign({},Ee.character.statsWithWeapons[0].values),htmlParts:structuredClone(Ee.character.statsWithWeapons[0].htmlParts)}}})();break;case 1:L(u.stats.sources,a);for(const[e,t]of r.entries()){const o=u.statsWithWeapons[e];o?L(o.sources,t):u.statsWithWeapons[e]={sources:t,values:Object.assign({},Ee.character.statsWithWeapons[0].values),htmlParts:structuredClone(Ee.character.statsWithWeapons[0].htmlParts)}}}}function O(e){var t,o;const s=Array.prototype.indexOf.call(e.parentElement.children,e),i=e.parentElement.getElementsByClassName("amount")[s];if(!i)return void console.warn("[gw2-tooltips] [collect] `legacyCompatibility` is active, but no amount element for infusion ",e," could be found. Will not assume anything and just ignore the stack.");const n=+String(null===(o=null===(t=i.textContent)||void 0===t?void 0:t.match(/\d+/))||void 0===o?void 0:o[0]);if(n){if(!(n<1||n>20))return n;console.warn("[gw2-tooltips] [collect] [legacyCompatibility] Amount element ",i," for infusion element ",e," did got interpreted as x",n," which is outside of the range of sensible values (amount in [1...20]). Will not assume anything and just ignore the stack.")}else console.warn("[gw2-tooltips] [collect] [legacyCompatibility] Amount element ",i," for infusion element ",e," did not contain any readable amount. Will not assume anything and just ignore the stack.")}function F(e,t=1){const o=e.querySelectorAll("gw2object[type=specialization]:not(.gw2objectembed)");for(const e of te.entries()){const s=Array.from(o).filter((t=>(+String(t.getAttribute("contextSet"))||0)==e[0]));s.length&&W(...e,s,t)}const s=Array.from(o).filter((e=>(+String(e.getAttribute("contextSet"))||0)>=te.length));s.length&&console.warn("[gw2-tooltips] [collect] Some targets in scope ",e," have the wrong context: ",s)}function W(e,t,o,s){0===s&&(t.character.traits=new Set,t.character.specializations=new Set);const i=t.character.traits,n=t.character.specializations;for(const e of o){const t=+String(e.getAttribute("objid"));isNaN(t)||n.add(t);const o=String(e.getAttribute("selected_traits")).split(",").map((e=>+e)).filter((e=>!isNaN(e)&&0<=e&&e<=2));if(3==o.length)for(const[t,s]of o.entries()){{const o=e.children[1+2*t].children[s];let n;if(!o||!(n=+String(o.getAttribute("objid")))){console.warn("[gw2-tooltips] [collect] Trait object ",o,' is selected but does not exist or does not have an objid set. Add the attribute as `objid="1234"`. Will not assume anything and just ignore the element.');continue}i.add(n)}{const o=e.children[2*t];let s;if(!(s=+String(o.getAttribute("objid")))){console.warn("[gw2-tooltips] [collect] Minor trait object ",o,' does not have an objid set. Add the attribute as `objid="1234"`. Will not assume anything and just ignore the element.');continue}i.add(s)}}else console.warn("[gw2-tooltips] [collect] Specialization object ",e," does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\"0,2,1\"` where the numbers are 0-2 indicating top, middle or bottom selection. Will not assume anything and just ignore the element.")}}function B(e){for(const t of e.statsWithWeapons)L(t.sources,e.stats.sources,!0)}function L(e,t,o=!1){for(const[s,i]of Object.entries(t)){let t=e[s];void 0!==t?o?t.splice(0,0,...i):t.push(...i):e[s]=i.slice()}}function U(e,t){return(!e.mode||e.mode===t.gameMode)&&(!e.source_trait_req||t.character.traits.has(e.source_trait_req))&&(!e.target_trait_req||t.character.traits.has(e.target_trait_req))}function H(e,o,s=!1){if(!s&&e.childElementCount>0)return;const n=t("a",i(o.icon,void 0,o.name));if(n.href="https://wiki-en.guildwars2.com/wiki/Special:Search/"+r(a(o.name),1,{sex:"Male"}),n.target="_blank",e.classList.contains("gw2objectembed")&&!e.classList.contains("icononly")){const t=+String(e.getAttribute("count"))||1,s=te[+String(e.getAttribute("contextSet"))||0];n.append(r(a(o.name),t,s.character))}e.replaceChildren(n)}function q(e,t){const o=+String(e.getAttribute("contextSet"))||0,s=Ce(te[o],e);let i=!1;if(e.classList.contains("auto-transform")){const o=ye(t,s);o&&(e.setAttribute("og-objid",String(t.id)),e.setAttribute("objid",String(o.id)),t=o,i=!0)}H(e,t,i)}function G(e,o){if(e.childElementCount>0)return;const s=+String(e.getAttribute("count"))||1,n=te[+String(e.getAttribute("contextSet"))||0],r=t("a",i(o.icon,void 0,o.name));r.href="https://wiki-en.guildwars2.com/wiki/Special:Search/"+a(o.name).replaceAll(/\[.*?\]/g,""),r.target="_blank",e.classList.contains("gw2objectembed")&&r.append(Se(o,n,void 0,void 0,s)),e.append(r)}function z(e,t){if(e.classList.contains("gw2objectembed"))H(e,t);else{e.style.backgroundImage=`url(${o(t.background)})`,e.dataset.label=t.name;const s=String(e.getAttribute("selected_traits")).split(",").map((e=>+e)).filter((e=>!isNaN(e)&&0<=e&&e<=2));if(3!=s.length)return void console.warn("[gw2-tooltips] [inflator] Specialization object ",e," does not have its 'selected_traits' (properly) set. Add the attribute as `selected_traits=\"0,2,1\"` where the numbers are 0-2 indicating top, middle or bottom selection.");for(const[t,o]of s.entries()){const s=e.children[1+2*t];if(s)for(const[e,t]of Array.prototype.entries.call(s.children))t.classList.toggle("trait_unselected",e!==o);else console.warn("[gw2-tooltips] [inflator] Cannot mark selected trait object in column #",t," for specialization object ",e," because the column doesn't seem to exist. Either mark the specialization object as inline or add the missing column.")}}}function K(e,o){const s=k(te[+String(e.getAttribute("contextSet"))||0].character,o),n={Power:[66722,""],Toughness:[104162,""],Vitality:[104163,""],Precision:[156609,""],Ferocity:[156602,""],ConditionDamage:[156600,""],Expertise:[156601,""],Concentration:[156599,""],HealingPower:[156606,""],AgonyResistance:[536049,""],Health:[536052,""],Armor:[536048,""],ConditionDuration:[156601,"%"],BoonDuration:[156599,"%"],CritChance:[536051,"%"],CritDamage:[784327,"%"],MagicFind:[536054,"%"]}[o];let a,r="";n?[a,r]=n:console.warn(`[gw2-tooltips] [inflator] Unknown attribute '${o}' on object `,e);const c=r?100:1;let u=p(o);"Profession"==o&&(u="Attribute#Profession_Attributes");const f=t("a",i(a));f.href=`https://wiki-en.guildwars2.com/wiki/Special:Search/${u}`,f.target="_blank",e.classList.contains("gw2objectembed")&&(void 0!==s?f.append(l(s*c,1)+r):f.append("???"+r)),e.replaceChildren(f)}function X(e,o){if(e.childElementCount>0)return;const s=t("a",i(o.icon_big,void 0,o.name));s.href="https://wiki-en.guildwars2.com/wiki/Special:Search/"+o.name,s.target="_blank",e.classList.contains("gw2objectembed")&&s.append(o.name),e.append(s)}function V(e,t){const o=String(e.getAttribute("objId"));let s={chaos_aura:10332,dark_aura:39978,fire_aura:5677,frost_aura:5579,light_aura:25518,magnetic_aura:5684,shocking_aura:5577,aegis:743,alacrity:30328,fury:725,might:740,protection:717,quickness:1187,regeneration:718,resistance:26980,resolution:873,stability:1122,swiftness:719,vigor:726,bleeding:736,blinded:720,burning:737,chill:722,chilled:722,confusion:861,crippled:721,fear:896,immobilize:727,poison:723,slow:26766,taunt:27705,torment:19426,vulnerability:738,weakness:742,daze:833,stun:872,agony:15773,invulnerability:56227,revealed:890,stealth:58026,superspeed:5974,unblockable:18843,blight:62653,bloodstone_blessed:34917,blue_pylon_power:31413,champion_of_the_legions:20845,compromised:35096,crowd_favor:36173,curse_of_frailty:53723,debilitated:67972,debilitating_void:64967,defense_up:28482,derangement:34965,elemental_empowerment:62733,empowering_auras:62939,equalization_matrix:67047,expose_weakness:26660,exposed:28778,extreme_vulnerability:65662,fixated:47434,growing_rage_ashym:3362,ignite:16259,intervention:35061,necrosis:47414,not_sticking_together:54378,nova:39193,ooze_pheromone:21538,photon_saturation:67872,positive_flow:66665,power_of_the_void:65601,reinforced_armor:9283,relentless_fire:62805,retaliation_ashym:24646,sentinel_retribution:16350,shattering_ice:62909,shell_shocked:33361,spectral_darkness:31498,sticking_together:54604,synchronized_vitality:63840,unnatural_signet:38224,use_soul_binder:55630,void_empowerment:68083,xeras_embrace:34979}[o];if(!s){const e={barrier:{id:Number.MAX_SAFE_INTEGER-1,name:"Barrier",icon:Ie.BARRIER,description:"Creates a health barrier that takes damage prior to the health bar. Barrier disappears 5s after being applied. Applying a barrier while one is already active will add to it, but the previously-existing barrier will still disappear 5s after it was originally applied. The amount of barrier generated is based on the source's healing power, and is capped at 50% of the recipient's maximum health.",description_brief:"Creates a health barrier that takes damage prior to the health bar.",categories:[],palettes:[],flags:[]},stunbreak:{id:Number.MAX_SAFE_INTEGER-2,name:"Stun Break",description:"Cancel control effects such as stuns.",icon:Ie.STUN_BREAK,categories:[],palettes:[],flags:[]},knockdown:{id:Number.MAX_SAFE_INTEGER-3,name:"Knockdown",description:"Knocks the target on ground, preventing movement and actions for a short duration.",icon:Ie.KNOCKDOWN,categories:[],palettes:[],flags:[]},pull:{id:Number.MAX_SAFE_INTEGER-4,name:"Pull",description:"Pulls the caster to the target or the target to a specific location and disables them for a short duration.",icon:Ie.PULL,categories:[],palettes:[],flags:[]},knockback:{id:Number.MAX_SAFE_INTEGER-5,name:"Knockback",description:"Knocks back the target away and on the ground, preventing movement and actions for a short duration.",icon:Ie.KNOCKBACK,categories:[],palettes:[],flags:[]},launch:{id:Number.MAX_SAFE_INTEGER-6,name:"Launch",description:"Throws the target in the air over a short distance, preventing movement and actions for a short duration. Can move Downed targets.",icon:Ie.LAUNCH,categories:[],palettes:[],flags:[]},float:{id:Number.MAX_SAFE_INTEGER-7,name:"Float",description:"Causes the target to float in the air, preventing movement and actions for a short duration. Causes underwater targets to move up.",icon:Ie.FLOAT,categories:[],palettes:[],flags:[]},sink:{id:Number.MAX_SAFE_INTEGER-8,name:"Sink",description:"Causes the underwater target to move downwards.",icon:Ie.SINK,categories:[],palettes:[],flags:[]}}[o];e&&(s=e.id,b.storage.skills.set(s,e))}return s?(e.setAttribute("type","skill"),e.setAttribute("objId",String(s)),s):(e.innerText=o,e.title=`Failed to translate effect '${o}'.`,e.style.cursor="help",e.classList.add("error"),t.add(o),0)}let J,Q,Y,Z,ee=0;const te=[];e.config=null;const oe=["Guardian","Warrior","Engineer","Ranger","Thief","Elementalist","Mesmer","Necromancer","Revenant"];function se(e){const t=J.children;for(let o=0;o<t.length;o++)t[o].classList.toggle("active",o===e)}function ie(e,t=!1){const o=J.children[e];J.style.transition=t?"transform 0.25s":"",J.style.transform=`translate(0, -${o.offsetTop+o.offsetHeight}px)`}function ne(e=!1){const t=document.getElementById("wpadminbar"),o=t?t.offsetHeight:0,s=J.children[ee];let i=Y+6;i+J.offsetWidth>document.documentElement.clientWidth-22&&(i=document.documentElement.clientWidth-(J.offsetWidth+22));let n=Z-6;n-s.offsetHeight<document.documentElement.scrollTop+o+13&&(e&&(J.style.transition+=", top 0.25s",setTimeout((()=>J.style.transition=""),250)),n=document.documentElement.scrollTop+o+13+s.offsetHeight),J.style.left=`${i}px`,J.style.top=`${n}px`}async function ae(t,o){var s;const i=document.getElementsByClassName("gw2-build-wrapper");if(e.config.autoCollectSelectedTraits)if(i.length)for(const e of i)F(e);else console.warn("[gw2-tooltips] [collect] `config.autoCollectSelectedTraits` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.");const n=await re(t);if(e.config.autoInferWeaponSetAssociation)for(const e of i){for(const[t,o]of e.querySelectorAll(".weapon-set").entries())for(const e of o.getElementsByTagName("GW2OBJECT"))e.setAttribute("weaponSet",String(t));const t=[];for(const[o,s]of e.querySelectorAll(".skills-weapon-set").entries()){const e=[],i=(t,o,s)=>{if(s){const e=ye(t,o);e&&(t=e)}let i,n,a;if(e.push(t.id),[i,n,a,o]=be(t,o),n){let t=n.candidates[a];for(;t.previous_chain_skill_index;){const s=n.candidates[t.previous_chain_skill_index];if(!ve(s,o))break;e.push(s.skill),t=s}for(let t=0;t<a;t++){const s=n.candidates[t];s.previous_chain_skill_index==a&&(ve(s,o)&&(e.push(s.skill),a=t,t=-1))}}if(t.bundle_skills)for(const o of t.bundle_skills){b.storage.skills.get(o)&&e.push(o)}if(t.related_skills)for(const o of t.related_skills){const t=b.storage.skills.get(o);t&&t.palettes.some((e=>{const t=b.storage.palettes.get(e);return t&&je.includes(t.type)}))&&e.push(o)}if(t.ambush_skills)for(const{id:o}of t.ambush_skills){b.storage.skills.get(o)&&e.push(o)}};for(const e of s.children){e.setAttribute("weaponSet",String(o));const t=b.storage.skills.get(+String(e.getAttribute("objid"))),s=te[+String(e.getAttribute("contextSet"))||0],n=e.classList.contains("auto-transform");t?i(t,s,n):console.warn("[gw2-tooltips] [collect] failed to find skill for object ",e)}t.push(e)}if(t.length>1&&(t[0][0]!=t[1][0]||t[0][t[0].length-1]!=t[1][t[1].length-1])){console.info("[gw2-tooltips] [collect] Will mark the following skills as belonging to weapon sets: ",t);const o=null===(s=e.parentElement.nextElementSibling)||void 0===s?void 0:s.nextElementSibling;if(o)for(const e of o.querySelectorAll("gw2object[type=skill]")){const o=+String(e.getAttribute("objid"))||0;if(o)for(const[s,i]of t.entries())i.includes(o)&&e.setAttribute("weaponSet",String(s))}}}if(e.config.autoCollectRuneCounts)if(i.length)for(const e of i)D(e);else console.warn("[gw2-tooltips] [collect] `config.autoCollectRuneCounts` is active, but no element with class `gw2-build` could be found to use as source. Upgrades will not be collected as there is no way to tell which upgrades belongs to the build and which ones are just in some arbitrary text.");if(e.config.autoCollectStatSources)if(i.length)for(const e of i)I(e);else console.warn("[gw2-tooltips] [collect] `config.autoCollectStatSources` is active, but no element with class `gw2-build` could be found to use as source. Build information will not be collected as there is no way to tell which objects belong to the build definition and which ones are just in some arbitrary text.");if(e.config.autoCollectSelectedTraits&&function(e){for(const t of e)for(const e of t.character.traits){const o=b.storage.traits.get(e);if(!o){console.error(`[gw2-tooltips] [collect] Trait #${e} is apparently missing in the cache.`);continue}const s=e=>{for(const s of e)s.target_attribute_or_skill&&U(s,t)&&(t.character.stats.sources[s.target_attribute_or_skill]||(t.character.stats.sources[s.target_attribute_or_skill]=[])).push({source:`trait '<span class="gw2-color-traited-fact">${o.name}</span>'`,modifier:s,count:1})};o.modifiers&&s(o.modifiers);const i=ge(o,t);if(i.blocks)for(const e of i.blocks)if(e.facts)for(const t of e.facts){if(!("buff"in t))continue;const e=b.storage.skills.get(t.buff);e?e.modifiers&&!["Boon","Condition"].includes(e.buff_type)&&(console.info(`[gw2-tooltips] [collect] [trait-effects] ${o.name} applies ${e.buff_type} ${e.name}: ${e.modifiers.length} mods`),s(e.modifiers)):console.error(`[gw2-tooltips] [collect] Buff #${t.buff} required for trait effect collection is apparently missing in the cache.`)}}}(te),e.config.autoInferEquipmentUpgrades){const e=document.querySelectorAll(".weapon, .armor, .trinket");e.length?function(e){const t=te.map((e=>{const t={};for(const[o,s]of Object.entries(e.character.upgradeCounts)){let e;(e=b.storage.items.get(+o))&&"subtype"in e&&"Infusion"==e.subtype&&(t[+o]=s)}return t})),o=te.map((e=>{for(const[t,o]of Object.entries(e.character.upgradeCounts)){let e;if((e=b.storage.items.get(+t))&&"subtype"in e&&"Enrichment"==e.subtype)return t}}));for(const s of e){if(s.childElementCount<2)continue;const[e,...i]=s.children;if("item"!==e.getAttribute("type"))continue;const n=+String(e.getAttribute("contextSet"))||0,a=i.filter((t=>"item"===t.getAttribute("type")&&t.getAttribute("objid")&&(+String(e.getAttribute("contextSet"))||0)===n)).map((e=>e.getAttribute("objid")));{let s,i;if((s=+String(e.getAttribute("objid")))&&(i=b.storage.items.get(s))&&"slots"in i)for(const e of i.slots)if("Infusion"==e){const e=t[n];for(const t of Object.keys(e)){a.push(t),--e[t]<1&&delete e[t];break}}else if("Enrichment"==e){const e=o[n];e&&a.push(e)}}const r=a.join(",");r&&e.setAttribute("slotted",r)}}(e):console.warn("[gw2-tooltips] [collect] `config.autoInferEquipmentUpgrades` is active, but no wrapper elements element with class `'weapon`, `armor` or `trinket` could be found to use as source. No elements will be updated")}for(const{character:e}of te)B(e);if(e.config.autoRecomputeCharacterAttributes)for(const e of te)for(const t of e.character.statsWithWeapons.keys())w(e,t);for(const[e,t]of n.attributes)for(const o of t)K(o,e);return n}async function re(t){const o={skills:new Map,traits:new Map,items:new Map,specializations:new Map,pets:new Map,"pvp/amulets":new Map,attributes:new Map,professions:new Map},s=new Set,i=new Set;for(const n of t.getElementsByTagName("gw2object")){const t=+String(n.getAttribute("stats"));isNaN(t)||s.add(t);let a=n.getAttribute("objId");if(null==a)continue;let r=(n.getAttribute("type")||"skill")+"s";if("attributes"===r){if(null!=a){const e=o.attributes.get(a);e?e.push(n):o.attributes.set(a,[n])}}else{let t=+a;if("effects"===r){if(!e.config.legacyCompatibility)continue;r="skills",t=V(n,i)}if(!(!isNaN(t)&&r in o||("professions"==r&&(t=a[0].toUpperCase()+a.slice(1)),oe.includes(t))))continue;{const e=o[r],s=e.get(t);s?s.push(n):e.set(t,[n]);const i=n.getAttribute("with-traits");if(i)for(const e of i.split(",")){const t=+e;if(!t)continue;o.traits.get(t)||o.traits.set(t,[])}}}ce(n)}return i.size&&console.error("[gw2-tooltips] [legacy-compat] Some effects could not be translated into skills: ",Array.from(i)),s.size>0&&b.ensureExistence("itemstats",s.values(),e.config.validateApiResponses),await Promise.all(Object.entries(o).map((async([t,o])=>{if(0===o.size||"attributes"===t)return;let s;switch(t){case"skills":s=q;break;case"items":s=G;break;case"specializations":s=z;break;case"professions":s=X;break;default:s=H}const i=b.storage[t];await b.ensureExistence(t,o.keys(),e.config.validateApiResponses);for(const[e,t]of o){const o=i.get(e);if(t&&o)for(const e of t)s(e,o)}}))),o}function ce(e){e.addEventListener("mouseenter",(e=>le(e.target))),e.addEventListener("mouseleave",(()=>{J.style.display="none",J.style.transform=""}))}function le(e,o=0){const s=(e.getAttribute("type")||"skill")+"s",l=e.getAttribute("objId");let u=te[+String(e.getAttribute("contextSet"))||0];const f=+String(e.getAttribute("stats"))||void 0,d=+String(e.getAttribute("count"))||void 0;if("specializations"==s||"effects"==s||"professions"==s)return;if(Q=e,"attributes"==s){if(l){ee=o,J.replaceChildren(function(e,o){const s=o.character.statsWithWeapons[o.character.selectedWeaponSet],a=s.values[e];let l=s.htmlParts[e];if(["ConditionDuration","BoonDuration"].includes(e)){l=l.slice();const u="ConditionDuration"===e?"Condition":"Boon",f=100*(_(e,o.character).cap-1),d=A(o.character);for(const[e,p]of Object.entries(s.sources)){if(isNaN(+e))continue;const s=b.storage.skills.get(+e);if(!s){console.error(`[gw2-tooltips] [tooltip engine] effect #${e} is missing in cache.`);continue}if(s.buff_type!==u)continue;let g=100*a,h=[];for(const{source:e,modifier:s,count:i}of p){const a=x(s,o.character.level,d);h.push(t("span.detail",`${a>0?"+":""}${c(a)}% from ${i>1?`${i} `:""}`,n(r(e,i,o.character)))),g+=a}const m=g;g=Math.min(g,f),m!=g&&h.push(t("span.detail.capped",`(Capped to +${c(g)}%! Uncapped value would be ${c(m)}%)`)),l.push(t("div.fact",i(s.icon),t("div",t("span",`${s.name}: +${c(g)}%`),...h)))}}return t("div.tooltip.item.active",...l)}(l,u)),J.style.display="";for(const e of J.children)e.classList.add("active");ie(ee)}return}const g=b.storage[s].get(+String(l));if(g){u=Ce(u,e),"palettes"in g&&(u.underwater?!g.flags.includes("UsableUnderWater")&&g.flags.includes("UsableLand")&&(u.cloned||(u=Object.assign({},u)),u.underwater=!1):u.underwater||!g.flags.includes("UsableLand")&&g.flags.includes("UsableUnderWater")&&(u.cloned||(u=Object.assign({},u)),u.underwater=!0));const[s,r]=function(e,o,s,r,c){var l;let u=1;"trait"===String(o.getAttribute("type"))?u=2:"Relic"===e.type&&(u=0);let f=0;const d=[],g=o.classList.contains("auto-transform");let h=+String(o.getAttribute("weaponSet"));isNaN(h)&&(h=void 0);let m,w,v;if("palettes"in e){if(g){const t=ye(e,s);t&&(e=t)}let t;if([m,w,t,s]=be(e,s),w){v=me(m,w.slot);let e=w.candidates[t];const i=d.length;for(;e.previous_chain_skill_index;){const t=w.candidates[e.previous_chain_skill_index];if(!ve(t,s))break;let n=b.storage.skills.get(t.skill);n||(console.warn(`[gw2-tooltips] Chain skill #${t.skill} is missing from the cache. The query was caused by `,o),n=N),d.splice(i,0,ue(n,v,1,s,h)),e=t}}d.push(ue(e,v,1,s,h));for(let e=0;e<t;e++){const i=w.candidates[e];if(i.previous_chain_skill_index!=t)continue;if(!ve(i,s))continue;let n=b.storage.skills.get(i.skill);n||(console.warn(`[gw2-tooltips] Chain skill #${i.skill} is missing from the cache. The query was caused by `,o),n=N),d.push(ue(n,v,1,s,h)),t=e,e=-1}}else if("type"in e)d.push(function(e,o,s,r,c=1){var l;let u,f=("Pvp"!==o.gameMode||"Trinket"===e.type&&"Amulet"===e.subtype)&&ke(e,r);"slots"in e&&(u=null===(l=s.getAttribute("slotted"))||void 0===l?void 0:l.split(",").map((e=>b.storage.items.get(+String(e)||0))).filter((e=>e&&"subtype"in e)));const d=c>1?c+" ":"",g=(null==u?void 0:u.find((e=>!["Infusion","Enrichment"].includes(e.subtype))))||(null==u?void 0:u[0]),h=d+Se(e,o,f,g,c),m=[t("tet.title",i(e.icon),t("teb.gw2-color-rarity-"+e.rarity,h),t("div.flexbox-fill"))];if("defense"in e&&e.defense){const s="number"==typeof e.defense?e.defense:C[Math.min(100,e.defense[0]+o.character.level)]*e.defense[1];m.push(t("te",t("tem","Defense: ",t("span.gw2-color-stat-green",String(Math.ceil(s))))))}if("power"in e){let s;if("mul"in e.power){let t=Ne.Legendary;["PlayerLevelScaleRarity","ItemScale4"].includes(e.power.scaling)&&(o.character.level<14?t=Ne.Common:o.character.level<30?t=Ne.Uncommon:o.character.level<60?t=Ne.Rare:o.character.level<80&&(t=Ne.Exotic));const i=Math.min(Ne[e.rarity],t);let n=De[i];e.power.scaling?n+=o.character.level:n+=e.level;const a=(o.character.isPlayer?$:E)[Math.min(100,n)]*e.power.mul*Me[i],r=a*e.power.spread;s=[Math.ceil(a-r),Math.ceil(a+r)]}else s=e.power;const i=t("tem","Weapon Strength: ",t("span.gw2-color-stat-green",`${s[0]} - ${s[1]}`));e.damage_type&&i.append(` (${e.damage_type})`),m.push(t("te",i))}"tiers"in e&&m.push(Ae(e,o));f&&"attribute_base"in e&&m.push(...f.attributes.map((({attribute:o,base_value:s,scaling:i})=>t("te",t("tem.gw2-color-stat-green",`+${Math.round(s+e.attribute_base*i)} ${p(o)}`)))));"slots"in e&&m.push(t("div.group.slots",...e.slots.map((e=>{let s=-1;if(u)switch(e){case"Upgrade":s=u.findIndex((e=>["Rune","Sigil","Gem"].includes(e.subtype)));break;case"Infusion":s=u.findIndex((e=>"Infusion"==e.subtype));break;case"Enrichment":s=u.findIndex((e=>"Enrichment"==e.subtype))}if(s>-1){const e=u.splice(s,1)[0],n=Ae(e,o),a=Se(e,o);return n.prepend(t("tet",i(e.icon,"iconsmall"),t("teb.gw2-color-rarity-"+e.rarity,a),t("div.flexbox-fill"))),n}return t("te",i(Ie["SLOT_"+e],"iconsmall"),`Empty ${e} Slot`)}))));let w=!1;"applies_buff"in e&&(m.push(t("span",n(a(e.description)))),m.push(t("div.group",R(e.applies_buff,-1,o,!0).wrapper)),w=!0);if("facts_from_skill"in e){let i=b.storage.skills.get(e.facts_from_skill);i||(console.warn(`[gw2-tooltips] Relic facts skill #${e.facts_from_skill} is missing from the cache. The query was caused by `,e,s),i=N);const r=ge(i,o),c=[];de(c,i,o),c.push(t("div.flexbox-fill")),fe(c,i,r,o);const l=[t("tet.title",...c)];pe(l,i,r,o),m.push(t("span",n(a(e.description)))),m.push(t("div.group",...l)),w=!0}const v=t("div.group");("Armor"==e.type||"Weapon"==e.type||"Trinket"==e.type&&!e.flags.includes("Pvp"))&&(v.append(t("span.gw2-color-rarity-"+e.rarity,e.rarity)),"weight"in e&&v.append(t("span",e.weight)),v.append(t("span",`${e.type}: ${e.subtype}`)),"Weapon"==e.type&&function(e){switch(e){case"Axe":case"Dagger":case"Mace":case"Pistol":case"Scepter":case"Focus":case"Sword":case"BowShort":case"Torch":case"Shield":case"Warhorn":case"Toy":case"ToyTwoHanded":case"BundleSmall":return!1;case"Hammer":case"BowLong":case"Greatsword":case"Polearm":case"Rifle":case"Staff":case"BundleLarge":case"Spear":case"Speargun":case"Trident":return!0}}(e.subtype)&&v.append(t("span.gw2-color-rarity-Junk","(Two-Handed)")),e.required_level&&v.append(t("span","Required Level: "+e.required_level)));e.description&&!w&&v.append(t("span",n(a(e.description))));e.flags.includes("Pvp")||(e.flags.includes("Unique")&&v.append(t("span","Unique")),e.flags.includes("AccountBound")&&v.append(t("span","Account Bound")),e.flags.includes("SoulBindOnUse")?v.append(t("span","Soulbound on Use")):e.flags.includes("SoulBindOnAcquire")&&v.append(t("span","Soulbound on Acquire")));if(!e.flags.includes("NoSalvage")){const o=["Consumable"==e.type&&"Food"==e.subtype?"Compost":"Ascended"==e.rarity?"Ascended":"Standard"];e.flags.includes("SalvageResearch")&&o.push("Research"),o.length&&v.append(t("span","Salvage: "+o.join(", ")))}if(e.vendor_value){let o=["Vendor Value: ",$e(e.vendor_value*c)];c>1&&o.push(" (",$e(e.vendor_value),` x ${c})`),v.append(t("span",...o))}m.push(v);const _=t("div.tooltip.item.active",...m);return _.dataset.id=String(e.id),_}(e,s,o,r,c));else{let t;"slot"in e&&(t=e.slot,"specialization"in e&&((null===(l=b.storage.specializations.get(e.specialization))||void 0===l?void 0:l.name)||e.specialization)),d.push(ue(e,t,1,s,h))}if("bundle_skills"in e)for(const t of e.bundle_skills){const e=b.storage.skills.get(t);if(e&&_e(e,s)){const[t,o]=be(e,s);d.push(ue(e,me(t,null==o?void 0:o.slot),1,s,h))}}if("related_skills"in e){const t=o.getAttribute("type")||"skill";for(const o of e.related_skills){const e=b.storage.skills.get(o);if(e&&_e(e,s)&&("skill"!=t||e.palettes.some((e=>{const t=b.storage.palettes.get(e);return t&&je.includes(t.type)})))){const[t,o]=be(e,s);d.push(ue(e,me(t,null==o?void 0:o.slot),u,s,h))}}}if("ambush_skills"in e)for(const{id:t,spec:o}of e.ambush_skills){const e=b.storage.skills.get(t);if(e&&_e(e,s)&&(!o||s.character.specializations.has(o))){v||([m,w]=be(e,s),v=me(m,null==w?void 0:w.slot)),d.push(ue(e,v,u,s,h));break}}if("skills"in e)for(const t of e.skills){f=1;let e=b.storage.skills.get(t);e||(console.warn(`[gw2-tooltips] pet skill #${t} is missing from the cache. The query was caused by `,o),e=N);const[i,n]=be(e,s);d.push(ue(e,me(i,null==n?void 0:n.slot),u,s,h))}if("skills_ai"in e)for(const t of e.skills_ai){let e=b.storage.skills.get(t);e||(console.warn(`[gw2-tooltips] pet skill #${t} is missing from the cache. The query was caused by `,o),e=N);const[i,n]=be(e,s);let a=me(i,null==n?void 0:n.slot);a&&(a="ai "+a),d.push(ue(e,a,u,s,h))}if(s.character.specializations.has(55)&&"skills_soulbeast"in e)for(const t of e.skills_soulbeast){let e=b.storage.skills.get(t);e||(console.warn(`[gw2-tooltips] pet skill #${t} is missing from the cache. The query was caused by `,o),e=N);const[i,n]=be(e,s);d.push(ue(e,me(i,null==n?void 0:n.slot),u,s,h))}return J.append(...d),[d,f]}(g,e,u,f,d);ee=o>0?o:r,J.replaceChildren(...s),J.style.display="",J.childElementCount>1?(e.classList.add("cycler"),e.title="Right-click to cycle through tooltips",se(ee)):J.firstElementChild&&J.firstElementChild.classList.add("active"),ie(ee)}}function ue(e,o,s,c,l){const u=[];var f;(1==s||2==s&&(f=e.icon,![2141735,2141736,2141737].includes(f)))&&u.push(i(e.icon)),u.push(t("teb",n(a(r(e.name,1,c.character)))),t("div.flexbox-fill"));const d=ge(e,c);fe(u,e,d,c);const p=[];o&&p.push(t("tes",`( ${o} )`)),void 0!==l&&p.push(t("tes",`( Weapon Set ${l+1} )`)),p.push(t("div.flexbox-fill")),de(p,e,c);const g=[t("tet.title",...u)];p.length>1&&g.push(t("tet.detail",...p)),"description"in e&&e.description&&g.push(t("p.description",n(a(e.description)))),pe(g,e,d,c);const h=t("div.tooltip",...g);return h.dataset.id=String(e.id),h}function fe(o,s,n,a){if("flags"in s&&s.flags.includes("DisallowUnderwater")&&o.push(i(Ie.NO_UNDERWATER,"iconsmall")),n.activation){const s=f(n.activation/1e3,e.config);"0"!=s&&o.push(t("ter",s,i(Ie.ACTIVATION,"iconsmall")))}if(n.resource_cost&&o.push(t("ter",String(n.resource_cost),i("Revenant"==a.character.profession?Ie.RESOURCE_REV:Ie.RESOURCE_THIEF,"iconsmall"))),n.endurance_cost&&o.push(t("ter",String(Math.round(n.endurance_cost)),i(Ie.ENDURANCE_COST,"iconsmall"))),n.upkeep_cost&&o.push(t("ter",String(n.upkeep_cost),i(Ie.UPKEEP_COST,"iconsmall"))),n.recharge){const s=f(n.recharge/1e3,e.config);"0"!=s&&o.push(t("ter",s,i(Ie.RECHARGE,"iconsmall")))}n.supply_cost&&o.push(t("ter",String(n.supply_cost),i(Ie.SUPPLY_COST,"iconsmall")))}function de(e,o,s){if("override_groups"in o&&o.override_groups){const i=new Set(["Pve","Pvp","Wvw"]);for(const e of o.override_groups)for(const t of e.context)i.delete(t);const a=[Array.from(i),...o.override_groups.map((e=>e.context))],r=[];for(const e of["Pve","Pvp","Wvw"]){let t;for(let o=0;o<a.length;o++)if(a[o].includes(e)){t=a.splice(o,1)[0];break}if(!t)continue;const o=t.join("/");t.includes(s.gameMode)?r.push(`<span style="color: var(--gw2-tt-color-text-accent) !important;">${o}</span>`):r.push(o)}e.push(t("tes","( ",n(r.join(" | "))," )"))}}function pe(e,o,s,r){if(s.blocks){let c=690.5;if("palettes"in o)for(const e of o.palettes){const t=b.storage.palettes.get(e);if(!t)continue;const o=r.character.profession?e=>e.profession===r.character.profession:e=>e.profession;if(t.groups.some(o)){c=he(t);break}}e.push(...function(e,o,s){const[r,...c]=e;let u=0;const f=e=>e?e.sort(((e,t)=>e.order-t.order)).map((e=>{const{wrapper:t,defiance_break:i}=R(e,o,s);return u+=i,t&&(t.dataset.order=String(e.order)),t})).filter((e=>e)):[],d=[];for(const e of c){const o=t("div.fact-block");if(e.trait_requirements){const t=g(e.trait_requirements.map((e=>{var t;return`'<span class="gw2-color-traited-fact">${(null===(t=b.storage.traits.get(e))||void 0===t?void 0:t.name)||e}</span>'`})));o.append(n(`<span class="detail">Block exists because of trait${1==e.trait_requirements.length?"":"s"} ${t}</span>`))}e.description&&o.append(t("p.description",n(a(e.description))));const s=f(e.facts);o.append(...s),d.push(o)}if(r&&d.push(...f(r.facts)),u>0){const e=t("div.fact",i(Ie.DEFIANCE_BREAK,"iconmed"),t("div.gw2-color-defiance-fact",`Total Defiance Break: ${l(u,2)}`));let o=0;for(;o<d.length;o++){const e=d[o].dataset.order;if(e&&parseInt(e)>1003)break}d.splice(o,0,e)}return d}(s.blocks,c,r))}}function ge(e,t){var o,s,i,n,a;let r=null===(o=e.override_groups)||void 0===o?void 0:o.find((e=>e.context.includes(t.gameMode))),c=Object.assign({},e,r);if(c.blocks=structuredClone(e.blocks),!c.blocks)return c;if(null==r?void 0:r.blocks){const e=Math.max(c.blocks.length,r.blocks.length);for(let o=0;o<e;o++){let e=c.blocks[o];const n=r.blocks[o];if(n){if(e||(e=c.blocks[o]={description:n.description,trait_requirements:n.trait_requirements}),!n.facts)continue;const a=c.blocks[o].facts=null!==(s=e.facts)&&void 0!==s?s:[];for(const e of n.facts)(null===(i=e.requires_trait)||void 0===i?void 0:i.some((e=>!t.character.traits.has(e))))||(void 0!==e.insert_before?(e.skip_next&&(e.__gamemode_override_marker=!0),a.splice(e.insert_before,0,e)):a.push(e))}}}const l=[];for(const e of c.blocks)if(!(null===(n=e.trait_requirements)||void 0===n?void 0:n.some((e=>!t.character.traits.has(e))))){if(e.facts){const o=[];let s=0;for(let i=0;i<e.facts.length;i++){const n=e.facts[i];(null===(a=n.requires_trait)||void 0===a?void 0:a.some((e=>!t.character.traits.has(e))))||(s-- >0||(o.push(n),s=n.skip_next||0))}e.facts=o}l.push(e)}return c.blocks=l,c}function he({weapon_type:e,type:t}){return e?{BundleLarge:0,Standard:690.5,Focus:900,Shield:900,Torch:900,Warhorn:900,Greatsword:1100,Hammer:1100,Staff:1100,BowLong:1050,Rifle:1150,BowShort:1e3,Axe:1e3,Sword:1e3,Dagger:1e3,Pistol:1e3,Scepter:1e3,Mace:1e3,Spear:1e3,Speargun:1e3,Trident:1e3}[e]:"Bundle"===t?922.5:690.5}function me(e,t){if(t)return"Bundle"==e.type&&t.includes("_")?"Bundle "+t.substring(t.lastIndexOf("_")+1):t.startsWith("Weapon")&&e.weapon_type?p(e.weapon_type)+" "+t.substring(t.lastIndexOf("_")+1):t.replace(/(\S+?)_(\d)/,"$1 $2")}function be(e,t){let o;for(const s of e.palettes){const i=b.storage.palettes.get(s);if(i){if(je.includes(i.type))for(const s of i.groups)if(!t.character.profession||!s.profession||s.profession==t.character.profession)for(const[n,a]of s.candidates.entries())if(a.skill==e.id&&(o||(o=[i,s,n,t]),ve(a,t)))return[i,s,n,t]}else console.warn(`[gw2-tooltips] Palette #${s} is missing from the cache. The query was caused by `,e)}if(o)return o[3]=we(o[1].candidates[o[2]],t),o;for(const o of e.palettes){const s=b.storage.palettes.get(o);if(s&&je.includes(s.type))for(const o of s.groups)for(const[i,n]of o.candidates.entries())if(n.skill==e.id)return[s,o,i,we(n,t)]}for(const o of e.palettes){const s=b.storage.palettes.get(o);if(s)for(const o of s.groups)for(const[i,n]of o.candidates.entries())if(n.skill==e.id)return[s,o,i,we(n,t)]}return[void 0,void 0,-1,t]}function we(e,t,o=!0){if(o){const e=Object.assign({},t.character,{specializations:structuredClone(t.character.specializations),traits:structuredClone(t.character.traits)});t=Object.assign({},t,{character:e})}return e.specialization&&t.character.specializations.add(e.specialization),e.trait&&t.character.traits.add(e.trait),t}function ve(e,t){return(void 0===e.specialization||t.character.specializations.has(e.specialization))&&(void 0===e.trait||t.character.traits.has(e.trait))&&(t.underwater?e.usability.includes("UsableUnderWater"):e.usability.includes("UsableLand"))&&t.character.level>=(e.min_level||0)}function _e(e,t){return t.underwater?e.flags.includes("UsableUnderWater"):e.flags.includes("UsableLand")}function ye(e,t){var o;for(const s of e.palettes){const i=b.storage.palettes.get(s);if(i)for(const s of i.groups){if(t.character.profession&&s.profession&&s.profession!=t.character.profession)continue;const i=s.candidates.findIndex((t=>t.skill==e.id));if(-1!=i)for(let n=0;n<i;n++){const i=s.candidates[n];if(i.trait){if(!t.character.traits.has(i.trait))continue;const s=b.storage.skills.get(i.skill);return s?(console.info(`[gw2-tooltips] Corrected skill #${e.id} (${e.name}) to #${s.id} (${s.name}) because the trait #${i.trait} (${(null===(o=b.storage.traits.get(i.trait))||void 0===o?void 0:o.name)||"<not cached>"}) is active.`),s):void console.error(`[gw2-tooltips] Corrected skill #${i.skill} is missing in the cache.`)}}}else console.warn(`[gw2-tooltips] Palette #${s} is missing from the cache. The query was caused by `,e)}}function ke(t,o){let s;if("Armor"==t.type||"Trinket"==t.type||"Weapon"==t.type)if(void 0===(o=o||t.attribute_set))console.warn("[gw2-tooltips] [tooltip engine] Resolving stats for item without specified or innate attributes. Specify the stats by adding 'stats=\"<stat_set_id>\" to the html element.' ");else if(s=b.storage.itemstats.get(o),s){if(e.config.adjustIncorrectStatIds&&s.similar_sets){const e=s.similar_sets[t.subtype];if(void 0!==e){console.info(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${o} to #${e} because the target is of type ${t.subtype}.`);const i=b.storage.itemstats.get(e);i?s=i:console.error(`[gw2-tooltips] [tooltip engine] Corrected itemstat #${e} is missing in the cache.`)}}}else console.error(`[gw2-tooltips] [tooltip engine] itemstat #${o} is missing in cache.`);return s}function Ae(e,o){const s=t("div.group");for(const[i,r]of e.tiers.entries()){let c=t("te");if(r.description)c.append(t("span",n(a(r.description))));else if(r.facts)for(const e of r.facts){const{wrapper:t}=R(e,null,o);t&&c.append(t)}else if(r.modifiers){c.style.flexDirection="column";const e=A(o.character);for(const s of r.modifiers){let i,n=x(s,o.character.level,e);i=s.flags.includes("FormatPercent")?`+${Math.round(n)}% ${p(s.description)}`:`+${Math.round(n)} ${p(s.description)}`,c.append(t("te",i))}}const l=t("te",c);if("Rune"==e.subtype){const s=i<(o.character.upgradeCounts[e.id]||0)?".gw2-color-stat-green":"";l.prepend(t("span"+s,`(${i+1})`))}s.append(l)}return s}function Se(e,t,o,s,i=1){let n,c,l,u,f;return n="TraitGuide"==e.type?e.trait:e.name,c=l=u=f="",e.flags.includes("HidePrefix")||o&&o.name&&(c=o.name,l=" "),e.flags.includes("HideSuffix")||s&&s.suffix&&(f=s.suffix,u=" "),n=a(n,c,l,u,f),i>-1&&(n=r(n,i,t.character)),e.flags.includes("Pve")||!e.flags.includes("Pvp")&&!e.flags.includes("PvpLobby")||(n+=" (PvP)"),n}function Ce(e,t){let o=t.getAttribute("with-traits");if(o){(e=Object.assign({},e)).cloned=!0,e.character=Object.assign({},e.character);const s=[];e.character.traits=new Set(o.split(",").map((e=>{const t=+e;return t||s.push(e),t})).filter((e=>e))),s.length&&console.warn("[gw2-tooltips] [tooltip engine] Inline trait-override for element ",t," has misformed overrides: ",s)}return e}function $e(e){const o=[String(Math.floor(e%100)),i(Ie.COIN_COPPER,"iconsmall","")];return e>99&&o.unshift(String(Math.floor(e/100%100)),i(Ie.COIN_SILVER,"iconsmall","")),e>9999&&o.unshift(String(Math.floor(e/1e4)),i(Ie.COIN_GOLD,"iconsmall","")),t("span",...o)}const Ee={gameMode:"Pve",underwater:!1,targetArmor:2597,character:{level:80,isPlayer:!0,sex:"Male",traits:new Set,specializations:new Set,stats:{values:{Power:0,Toughness:0,Vitality:0,Precision:0,Ferocity:0,ConditionDamage:0,Expertise:0,Concentration:0,HealingPower:0,AgonyResistance:0},sources:{Power:[],Toughness:[],Vitality:[],Precision:[],Ferocity:[],ConditionDamage:[],Expertise:[],Concentration:[],HealingPower:[],AgonyResistance:[],Armor:[],Damage:[],LifeForce:[],Health:[],HealEffectiveness:[],Stun:[],ConditionDuration:[],BoonDuration:[],CritChance:[],CritDamage:[]}},statsWithWeapons:[{values:{Power:1e3,Toughness:1e3,Vitality:1e3,Precision:1e3,Ferocity:0,ConditionDamage:0,Expertise:0,Concentration:0,HealingPower:0,AgonyResistance:0,Health:1e4,Armor:1e3,CritChance:.05,CritDamage:1.5,ConditionDuration:0,BoonDuration:0},sources:{Power:[],Toughness:[],Vitality:[],Precision:[],Ferocity:[],ConditionDamage:[],Expertise:[],Concentration:[],HealingPower:[],AgonyResistance:[],Armor:[],Damage:[],LifeForce:[],Health:[],HealEffectiveness:[],Stun:[],ConditionDuration:[],BoonDuration:[],CritChance:[],CritDamage:[]},htmlParts:{Power:[],Toughness:[],Vitality:[],Precision:[],Ferocity:[],ConditionDamage:[],Expertise:[],Concentration:[],HealingPower:[],AgonyResistance:[],Armor:[],Health:[],ConditionDuration:[],BoonDuration:[],CritChance:[],CritDamage:[]}}],selectedWeaponSet:0,upgradeCounts:{}}};function xe(e){var t,o,s,i,n,a;"Pvp"==e.gameMode&&(null===(t=e.character)||void 0===t?void 0:t.level)&&80!=(null===(o=e.character)||void 0===o?void 0:o.level)&&console.error("[gw2-tooltips] [init] supplied (partial) context has its gamemode set to pvp, but has a character level specified thats other than 80. In pvp you are always level 80. This will lead to unexpected results; Remove the explicit level or change the gamemode. The (partial) context in question is: ",e);const r=Re(null===(s=e.character)||void 0===s?void 0:s.stats),c=Object.assign({},null===(i=e.character)||void 0===i?void 0:i.upgradeCounts),l=(null===(a=null===(n=e.character)||void 0===n?void 0:n.statsWithWeapons)||void 0===a?void 0:a.map((e=>Pe(e))))||[Pe()],u=Object.assign({},Ee.character,{traits:new Set,specializations:new Set},e.character,{stats:r,upgradeCounts:c,statsWithWeapons:l});return Object.assign({},Ee,e,{character:u})}function Re(e={}){return{values:Object.assign({},Ee.character.stats.values,e.values),sources:Object.assign({},structuredClone(Ee.character.stats.sources),e.sources)}}function Pe(e={}){return{values:Object.assign({},Ee.character.statsWithWeapons[0].values,e.values),sources:Object.assign({},structuredClone(Ee.character.statsWithWeapons[0].sources),e.sources),htmlParts:Object.assign({},structuredClone(Ee.character.statsWithWeapons[0].htmlParts),e.htmlParts)}}const Te={autoInitialize:!0,autoCollectRuneCounts:!0,autoCollectStatSources:!0,autoCollectSelectedTraits:!0,autoRecomputeCharacterAttributes:!0,adjustIncorrectStatIds:!0,autoInferEquipmentUpgrades:!0,autoInferWeaponSetAssociation:!0,legacyCompatibility:!0,showPreciseAbilityTimings:!1,showFactComputationDetail:!1,validateApiResponses:!0};var Ne;!function(e){e[e.Junk=0]="Junk",e[e.Basic=1]="Basic",e[e.Common=2]="Common",e[e.Uncommon=3]="Uncommon",e[e.Rare=4]="Rare",e[e.Exotic=5]="Exotic",e[e.Ascended=6]="Ascended",e[e.Legendary=7]="Legendary"}(Ne||(Ne={}));const De=[0,0,1,2,3,4,4,4],Me=[.5,.65,.8,.85,.9,1,1.05,1.05],Ie={COIN_COPPER:156902,COIN_SILVER:156907,COIN_GOLD:156904,SLOT_Upgrade:517197,SLOT_Infusion:517202,SLOT_Enrichment:517204,RESOURCE_THIEF:156649,RESOURCE_REV:156647,UPKEEP_COST:156058,SUPPLY_COST:2111003,ENDURANCE_COST:156649,NO_UNDERWATER:358417,RECHARGE:156651,ACTIVATION:496252,RANGE:156666,DEFIANCE_BREAK:1938788,WEAPON_SWAP:156583,BARRIER:1770209,STUN_BREAK:156654,KNOCKDOWN:2440716,PULL:2440717,KNOCKBACK:2440715,LAUNCH:2440712,FLOAT:2440713,SINK:2440714},je=["Bundle","Heal","Elite","Profession","Standard","Equipment"];{if(window.GW2TooltipsContext instanceof Array)for(const e of window.GW2TooltipsContext)te.push(xe(e));else window.GW2TooltipsContext?te.push(xe(window.GW2TooltipsContext)):te.push(xe({}));e.config=Object.assign({},Te,window.GW2TooltipsConfig),e.config.apiImpl&&(b.apiImpl=e.config.apiImpl(m)),"serviceWorker"in navigator&&e.config.workerPath&&navigator.serviceWorker.register(e.config.workerPath,{scope:"/"}).then((e=>console.log("[gw2-tooltips] [worker] APICache ServiceWorker registered.",e)),(e=>console.error(`[gw2-tooltips] [worker] Failed to register APICache ServiceWorker: ${e}`))),J=t("div.tooltipWrapper"),J.style.display="none",document.body?document.body.appendChild(J):document.addEventListener("DOMContentLoaded",(()=>document.body.appendChild(J)));const o=/android|webos|iphone|ipad|ipod|blackberry|bb|playbook|mobile|windows phone|kindle|silk|opera mini/.test(navigator.userAgent.toLowerCase());let s;document.addEventListener("mousemove",(e=>{o&&Math.abs(e.pageX-Y)+Math.abs(e.pageY-Z)>20&&(J.style.display="none"),Y=e.pageX,Z=e.pageY,"none"!=J.style.display&&ne()})),document.addEventListener("contextmenu",(e=>{const t=function(e,t,o=10){let s=e;for(;s&&o-- >0&&!s.matches(t);)s=s.parentElement;return 0==o?null:s}(e.target,"gw2object");t&&(t.classList.contains("cycler")&&"none"!=J.style.display&&(e.preventDefault(),ee=(ee+1)%J.childElementCount,se(ee),ie(ee,!0),ne(!0)),o&&"none"==J.style.display&&(e.preventDefault(),le(t),ne()))}));const i=e=>{if("none"==J.style.display)return;const t=J.children[ee];if(t.scrollHeight==t.clientHeight)return;e.preventDefault();const o=e.deltaY||e.detail||e.touches[0].clientY-s.clientY;t.scrollBy(0,o)},n="onwheel"in window&&{passive:!1};window.addEventListener("DOMMouseScroll",i,!1),window.addEventListener("wheel",i,n),window.addEventListener("touchstart",(e=>{s=e.touches[0]})),window.addEventListener("touchmove",i,n),window.addEventListener("keydown",(t=>{t.ctrlKey&&t.altKey&&("d"==t.key?(t.preventDefault(),e.config.showFactComputationDetail=!e.config.showFactComputationDetail,console.log(`[gw2-tooltips] [cfg] showFactComputationDetail is now ${e.config.showFactComputationDetail}`),Q&&"none"!=J.style.display&&(le(Q,ee),ne())):"t"==t.key&&(t.preventDefault(),e.config.showPreciseAbilityTimings=!e.config.showPreciseAbilityTimings,console.log(`[gw2-tooltips] [cfg] showPreciseAbilityTimings is now ${e.config.showPreciseAbilityTimings}`),Q&&"none"!=J.style.display&&(le(Q,ee),ne())))}))}return e.config.autoInitialize&&ae(document),e.APICache=b,e.DEFAULT_CONTEXT=Ee,e.ICONS=Ie,e.attachMouseListeners=ce,e.contexts=te,e.createCompletedBaseStats=Re,e.createCompletedStats=Pe,e.findCorrectAttributeSet=ke,e.findTraitedOverride=ye,e.formatItemName=Se,e.hookDOMSubtreeSlim=re,e.hookDocument=ae,e.resolveTraitsAndOverrides=ge,e.specializeContextFromInlineAttribs=Ce,e}({});
//# sourceMappingURL=tooltips.min.js.map
